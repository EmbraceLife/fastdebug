<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>fastdebug - 0011_fastai_multi_target_road_to_top_part_4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="fastdebug - 0011_fastai_multi_target_road_to_top_part_4">
<meta property="og:description" content="This is part 4 of the Road to the Top series, in which I show the process I used to tackle the Paddy Doctor competition.">
<meta property="og:site-name" content="fastdebug">
<meta name="twitter:title" content="fastdebug - 0011_fastai_multi_target_road_to_top_part_4">
<meta name="twitter:description" content="This is part 4 of the Road to the Top series, in which I show the process I used to tackle the Paddy Doctor competition.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">fastdebug</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">0011_fastai_multi_target_road_to_top_part_4</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Learning fastai with joy</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Interesting_fastai</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Interesting_fastai/the_origin_of_apl .html" class="sidebar-item-text sidebar-link">0001_The_origin_of_APL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Interesting_fastai/Interesting_things_fastai.html" class="sidebar-item-text sidebar-link">Interesting_things_fastai.html</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">demos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/intro_fastdebug.html" class="sidebar-item-text sidebar-link">Introducing fastdebug</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/tour.html" class="sidebar-item-text sidebar-link">0000_tour</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_meta_delegates.html" class="sidebar-item-text sidebar-link">0001_Fastcore.meta.delegates</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/signature_from_callable.html" class="sidebar-item-text sidebar-link">0002_signature_from_callable</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/explore_document_fixsigmeta_prepostinitmeta_autoinit.html" class="sidebar-item-text sidebar-link">03_FixSigMeta_PrePostInitMeta_AutoInit</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta._rm_self.html" class="sidebar-item-text sidebar-link">04_rm_self</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.test_sig.html" class="sidebar-item-text sidebar-link">05_test_sig</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.newchkmeta.html" class="sidebar-item-text sidebar-link">06_NewChkMeta</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.bypassnewmeta.html" class="sidebar-item-text sidebar-link">07_BypassNewMeta</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/use_kwargs_dict.html" class="sidebar-item-text sidebar-link">08_use_kwargs_dict</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/funcs_kwargs.html" class="sidebar-item-text sidebar-link">09_method_funcs_kwargs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_meta_summary.html" class="sidebar-item-text sidebar-link">0010_fastcore_meta_summary</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastdb.html" class="sidebar-item-text sidebar-link">0011_Fastdb</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_foundation_l.html" class="sidebar-item-text sidebar-link">0012_fastcore_foundation_L</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">fastai_notebooks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_is_it_a_bird.html" class="sidebar-item-text sidebar-link">0001_fastai_Is it a bird? Creating a model from your own data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_saving_a_basic_fastai_model.html" class="sidebar-item-text sidebar-link">0002_fastai_saving_a_basic_fastai_model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_which_image_model_best.html" class="sidebar-item-text sidebar-link">0003_fastai_which_image_model_best</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_how_neuralnet_work.html" class="sidebar-item-text sidebar-link">0004_fastai_how_neuralnet_work</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_linear_neuralnet_scratch.html" class="sidebar-item-text sidebar-link">0005_fastai_linear_neuralnet_scratch</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_why_should_use_framework.html" class="sidebar-item-text sidebar-link">0006_fastai_why_should_use_framework</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_how_random_forests_really_work.html" class="sidebar-item-text sidebar-link">0007_fastai_how_random_forests_really_work</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_first_steps_road_to_top_part_1.html" class="sidebar-item-text sidebar-link">0008_fastai_first_steps_road_to_top_part_1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_small_models_road_to_the_top_part_2.html" class="sidebar-item-text sidebar-link">0009_fastai_small_models_road_to_the_top_part_2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_scaling_up_road_to_top_part_3.html" class="sidebar-item-text sidebar-link">0010_fastai_scaling_up_road_to_top_part_3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_multi_target_road_to_top_part_4.html" class="sidebar-item-text sidebar-link active">0011_fastai_multi_target_road_to_top_part_4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_using_nbdev_export_in_kaggle_notebook.html" class="sidebar-item-text sidebar-link">0012_fastai_using_nbdev_export_in_kaggle_notebook</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/best_vision_models_for_fine_tuning.html" class="sidebar-item-text sidebar-link">0013_best_vision_models_for_fine_tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/iterate_like_grandmaster.html" class="sidebar-item-text sidebar-link">0014_iterate_like_grandmaster</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/getting_started_with_nlp_for_absolute_beginner.html" class="sidebar-item-text sidebar-link">0015_getting_started_with_nlp_for_absolute_beginner</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/collaborative_filtering_deep_dive.html" class="sidebar-item-text sidebar-link">0016_collaborative_filtering_deep_dive</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptmatmul.html" class="sidebar-item-text sidebar-link">0017_fastai_pt2_2019_matmul</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptexports.html" class="sidebar-item-text sidebar-link">0018_fastai_pt2_2019_exports</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptlectureintro.html" class="sidebar-item-text sidebar-link">0019_fastai_pt2_2019_lecture1_intro</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptsource_explained.html" class="sidebar-item-text sidebar-link">0020_fastai_pt2_2019_source_explained</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptfully_connected.html" class="sidebar-item-text sidebar-link">0021_fastai_pt2_2019_fully_connected</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptwhy_sqrt5.html" class="sidebar-item-text sidebar-link">0022_fastai_pt2_2019_why_sqrt5</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">questions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../questions/question_anno_dict.html" class="sidebar-item-text sidebar-link">00_quesolved_anno_dict</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-multi-target-for-why-would-multi-target-be-useful" id="toc-what-is-multi-target-for-why-would-multi-target-be-useful" class="nav-link active" data-scroll-target="#what-is-multi-target-for-why-would-multi-target-be-useful">what is multi-target for; why would multi-target be useful</a></li>
  <li><a href="#multi-output-dataloader" id="toc-multi-output-dataloader" class="nav-link" data-scroll-target="#multi-output-dataloader">Multi-output <code>DataLoader</code></a>
  <ul class="collapse">
  <li><a href="#how-to-get-dataset-and-libraries-ready-for-kaggles-paddy-doctor-competition" id="toc-how-to-get-dataset-and-libraries-ready-for-kaggles-paddy-doctor-competition" class="nav-link" data-scroll-target="#how-to-get-dataset-and-libraries-ready-for-kaggles-paddy-doctor-competition">how to get dataset and libraries ready for Kaggle’s Paddy Doctor competition</a></li>
  <li><a href="#how-to-read-a-csv-into-a-pandas-dataframe-and-select-a-column-to-be-its-index-column" id="toc-how-to-read-a-csv-into-a-pandas-dataframe-and-select-a-column-to-be-its-index-column" class="nav-link" data-scroll-target="#how-to-read-a-csv-into-a-pandas-dataframe-and-select-a-column-to-be-its-index-column">how to read a csv into a pandas dataframe and select a column to be its index column</a></li>
  <li><a href="#how-to-extract-a-particular-info-from-a-row-using-an-index-from-the-index-column-and-the-column-of-interest-with-df.loc" id="toc-how-to-extract-a-particular-info-from-a-row-using-an-index-from-the-index-column-and-the-column-of-interest-with-df.loc" class="nav-link" data-scroll-target="#how-to-extract-a-particular-info-from-a-row-using-an-index-from-the-index-column-and-the-column-of-interest-with-df.loc">how to extract a particular info from a row using an index from the index column and the column of interest with <code>df.loc</code></a></li>
  <li><a href="#how-to-get-the-rice-variety-of-each-image-with-df.loc-and-the-path-from-get_image_files" id="toc-how-to-get-the-rice-variety-of-each-image-with-df.loc-and-the-path-from-get_image_files" class="nav-link" data-scroll-target="#how-to-get-the-rice-variety-of-each-image-with-df.loc-and-the-path-from-get_image_files">how to get the rice variety of each image with <code>df.loc</code> and the path from <code>get_image_files</code></a></li>
  <li><a href="#how-to-use-datablock-to-create-dataloaders-what-is-datablock" id="toc-how-to-use-datablock-to-create-dataloaders-what-is-datablock" class="nav-link" data-scroll-target="#how-to-use-datablock-to-create-dataloaders-what-is-datablock">how to use <code>DataBlock</code> to create dataloaders; what is DataBlock</a></li>
  <li><a href="#how-to-display-6-images-from-a-batch" id="toc-how-to-display-6-images-from-a-batch" class="nav-link" data-scroll-target="#how-to-display-6-images-from-a-batch">how to display 6 images from a batch</a></li>
  </ul></li>
  <li><a href="#replicating-the-disease-model" id="toc-replicating-the-disease-model" class="nav-link" data-scroll-target="#replicating-the-disease-model">Replicating the disease model</a>
  <ul class="collapse">
  <li><a href="#how-to-create-disease-error-rate-and-disease-entropy-loss-functions-to-receive-3-instead-of-2-inputs" id="toc-how-to-create-disease-error-rate-and-disease-entropy-loss-functions-to-receive-3-instead-of-2-inputs" class="nav-link" data-scroll-target="#how-to-create-disease-error-rate-and-disease-entropy-loss-functions-to-receive-3-instead-of-2-inputs">how to create disease error-rate and disease entropy loss functions to receive 3 instead of 2 inputs</a></li>
  <li><a href="#how-to-create-a-vision-learner-using-vision_learner-which-specifies-loss_func-metrics-n_out-num-of-outputs" id="toc-how-to-create-a-vision-learner-using-vision_learner-which-specifies-loss_func-metrics-n_out-num-of-outputs" class="nav-link" data-scroll-target="#how-to-create-a-vision-learner-using-vision_learner-which-specifies-loss_func-metrics-n_out-num-of-outputs">how to create a vision learner using <code>vision_learner</code> which specifies <code>loss_func</code>, <code>metrics</code>, <code>n_out</code> (num of outputs)</a></li>
  </ul></li>
  <li><a href="#multi-target-model" id="toc-multi-target-model" class="nav-link" data-scroll-target="#multi-target-model">Multi-target model</a>
  <ul class="collapse">
  <li><a href="#how-to-make-the-vision_learner-to-return-20-outputs-10-for-diseases-10-for-varieties-how-to-use-to_fp16" id="toc-how-to-make-the-vision_learner-to-return-20-outputs-10-for-diseases-10-for-varieties-how-to-use-to_fp16" class="nav-link" data-scroll-target="#how-to-make-the-vision_learner-to-return-20-outputs-10-for-diseases-10-for-varieties-how-to-use-to_fp16">how to make the vision_learner to return 20 outputs, 10 for diseases, 10 for varieties; how to use to_fp16</a></li>
  <li><a href="#how-to-split-the-inputs-for-creating-entropy-loss-for-disease-and-variety" id="toc-how-to-split-the-inputs-for-creating-entropy-loss-for-disease-and-variety" class="nav-link" data-scroll-target="#how-to-split-the-inputs-for-creating-entropy-loss-for-disease-and-variety">how to split the inputs for creating entropy loss for disease and variety</a></li>
  <li><a href="#how-to-combine-both-disease-loss-and-variety-loss-together-to-be-the-model-loss" id="toc-how-to-combine-both-disease-loss-and-variety-loss-together-to-be-the-model-loss" class="nav-link" data-scroll-target="#how-to-combine-both-disease-loss-and-variety-loss-together-to-be-the-model-loss">how to combine both disease loss and variety loss together to be the model loss</a></li>
  <li><a href="#how-to-split-the-input-data-to-calc-both-disease-error-rate-and-variety-error-rate" id="toc-how-to-split-the-input-data-to-calc-both-disease-error-rate-and-variety-error-rate" class="nav-link" data-scroll-target="#how-to-split-the-input-data-to-calc-both-disease-error-rate-and-variety-error-rate">how to split the input data to calc both disease error rate and variety error rate</a></li>
  <li><a href="#how-to-wrap-all-error-rates-and-losses-into-a-tuple-all_metrics-and-give-it-to-metrics-of-vision_learner" id="toc-how-to-wrap-all-error-rates-and-losses-into-a-tuple-all_metrics-and-give-it-to-metrics-of-vision_learner" class="nav-link" data-scroll-target="#how-to-wrap-all-error-rates-and-losses-into-a-tuple-all_metrics-and-give-it-to-metrics-of-vision_learner">how to wrap all error rates and losses into a tuple <code>all_metrics</code> and give it to <code>metrics</code> of <code>vision_learner</code></a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul class="collapse">
  <li><a href="#how-can-multi-target-model-be-useful-to-us" id="toc-how-can-multi-target-model-be-useful-to-us" class="nav-link" data-scroll-target="#how-can-multi-target-model-be-useful-to-us">how can multi-target model be useful to us</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/EmbraceLife/fastdebug/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">0011_fastai_multi_target_road_to_top_part_4</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install fastkaggle if not available</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: <span class="im">import</span> fastkaggle</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ModuleNotFoundError:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">-</span>Uq fastkaggle</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastkaggle <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</code></pre>
</div>
</div>
<section id="what-is-multi-target-for-why-would-multi-target-be-useful" class="level3">
<h3 class="anchored" data-anchor-id="what-is-multi-target-for-why-would-multi-target-be-useful">what is multi-target for; why would multi-target be useful</h3>
<p>This is part 4 of the <a href="https://www.kaggle.com/code/jhoward/first-steps-road-to-the-top-part-1">Road to the Top</a> series, in which I show the process I used to tackle the <a href="https://www.kaggle.com/competitions/paddy-disease-classification">Paddy Doctor</a> competition. The first three parts show the process I took that lead to four 1st place submissions. This part onwards discusses various extensions and advanced tricks you might want to consider – but which I don’t promise will necessarily help your score (you’ll need to do your own experiments to figure this out!) If you haven’t read the rest of this series yet, I’d suggest starting at <a href="https://www.kaggle.com/code/jhoward/first-steps-road-to-the-top-part-1">part 1</a>.</p>
<p>In this notebook we’re going to build a model that doesn’t just predict what disease the rice paddy has, but also predicts what kind of rice is shown.</p>
<p>This might sound like a bad idea. After all, doesn’t that mean that the model has <em>more</em> to do? Mightn’t it get rather distracted from its main task, which is to identify paddy disease?</p>
<p>Perhaps… But in previous projects I’ve often found the opposite to be true, especially when training for quite a few epochs. By giving the model more signal about what is present in a picture, it may be able to use this information to find more interesting features that predict our target of interest. For instance, perhaps some of the features of disease change between varieties.</p>
</section>
<section id="multi-output-dataloader" class="level2">
<h2 class="anchored" data-anchor-id="multi-output-dataloader">Multi-output <code>DataLoader</code></h2>
<section id="how-to-get-dataset-and-libraries-ready-for-kaggles-paddy-doctor-competition" class="level3">
<h3 class="anchored" data-anchor-id="how-to-get-dataset-and-libraries-ready-for-kaggles-paddy-doctor-competition">how to get dataset and libraries ready for Kaggle’s Paddy Doctor competition</h3>
<p>First we’ll repeat the steps we used last time to access the data and ensure all the latest libraries are installed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> <span class="st">'paddy-disease-classification'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> setup_comp(comp, install<span class="op">=</span><span class="st">'fastai "timm&gt;=0.6.2.dev0"'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">42</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.parallel <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>trn_path <span class="op">=</span> path<span class="op">/</span><span class="st">'train_images'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-read-a-csv-into-a-pandas-dataframe-and-select-a-column-to-be-its-index-column" class="level3">
<h3 class="anchored" data-anchor-id="how-to-read-a-csv-into-a-pandas-dataframe-and-select-a-column-to-be-its-index-column">how to read a csv into a pandas dataframe and select a column to be its index column</h3>
<p>Here’s the CSV that Kaggle provides, showing the variety of rice contained in each image – we’ll make <code>image_id</code> the index of our data frame so that we can look up images directly to grab their variety:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'train.csv'</span>, index_col<span class="op">=</span><span class="st">'image_id'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>label</th>
      <th>variety</th>
      <th>age</th>
    </tr>
    <tr>
      <th>image_id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100330.jpg</th>
      <td>bacterial_leaf_blight</td>
      <td>ADT45</td>
      <td>45</td>
    </tr>
    <tr>
      <th>100365.jpg</th>
      <td>bacterial_leaf_blight</td>
      <td>ADT45</td>
      <td>45</td>
    </tr>
    <tr>
      <th>100382.jpg</th>
      <td>bacterial_leaf_blight</td>
      <td>ADT45</td>
      <td>45</td>
    </tr>
    <tr>
      <th>100632.jpg</th>
      <td>bacterial_leaf_blight</td>
      <td>ADT45</td>
      <td>45</td>
    </tr>
    <tr>
      <th>101918.jpg</th>
      <td>bacterial_leaf_blight</td>
      <td>ADT45</td>
      <td>45</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="how-to-extract-a-particular-info-from-a-row-using-an-index-from-the-index-column-and-the-column-of-interest-with-df.loc" class="level3">
<h3 class="anchored" data-anchor-id="how-to-extract-a-particular-info-from-a-row-using-an-index-from-the-index-column-and-the-column-of-interest-with-df.loc">how to extract a particular info from a row using an index from the index column and the column of interest with <code>df.loc</code></h3>
<p>Pandas uses the <code>loc</code> attribute to look up rows by index. Here’s how we can get the variety of image <code>100330.jpg</code>, for instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'100330.jpg'</span>, <span class="st">'variety'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'ADT45'</code></pre>
</div>
</div>
</section>
<section id="how-to-get-the-rice-variety-of-each-image-with-df.loc-and-the-path-from-get_image_files" class="level3">
<h3 class="anchored" data-anchor-id="how-to-get-the-rice-variety-of-each-image-with-df.loc-and-the-path-from-get_image_files">how to get the rice variety of each image with <code>df.loc</code> and the path from <code>get_image_files</code></h3>
<p>Our DataBlock will be using <code>get_image_files</code> to get the list of training images, which returns <code>Path</code> objects. Therefore, to look up an item to get its variety, we’ll need to pass its <code>name</code>. Here’s a function which does just that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_variety(p): <span class="cf">return</span> df.loc[p.name, <span class="st">'variety'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-use-datablock-to-create-dataloaders-what-is-datablock" class="level3">
<h3 class="anchored" data-anchor-id="how-to-use-datablock-to-create-dataloaders-what-is-datablock">how to use <code>DataBlock</code> to create dataloaders; what is DataBlock</h3>
<p>We’re now ready to create our <code>DataLoaders</code>. To do this, we’ll use the <code>DataBlock</code> API, which is a flexible and convenient way to plug pieces of a data processing pipeline together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> DataBlock(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    blocks<span class="op">=</span>(ImageBlock,CategoryBlock,CategoryBlock),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    n_inp<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    get_items<span class="op">=</span>get_image_files,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    get_y <span class="op">=</span> [parent_label,get_variety],</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    splitter<span class="op">=</span>RandomSplitter(<span class="fl">0.2</span>, seed<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    item_tfms<span class="op">=</span>Resize(<span class="dv">192</span>, method<span class="op">=</span><span class="st">'squish'</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    batch_tfms<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">128</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>).dataloaders(trn_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s an explanation of each line:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>blocks<span class="op">=</span>(ImageBlock,CategoryBlock,CategoryBlock),</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>DataBlock</code> will create 3 things from each file: an image (the contents of the file), and 2 categorical variables (the disease and the variety).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>n_inp<span class="op">=</span><span class="dv">1</span>,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There is <code>1</code> input (the image) – and therefore the other two variables (the two categories) are outputs.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>get_items<span class="op">=</span>get_image_files,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Use <code>get_image_files</code> to get a list of inputs.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>get_y <span class="op">=</span> [parent_label,get_variety],</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To create the two outputs for each file, call two functions: <code>parent_label</code> (from fastai) and <code>get_variety</code> (defined above).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>splitter<span class="op">=</span>RandomSplitter(<span class="fl">0.2</span>, seed<span class="op">=</span><span class="dv">42</span>),</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Randomly split the input into 80% train and 20% validation sets.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>item_tfms<span class="op">=</span>Resize(<span class="dv">192</span>, method<span class="op">=</span><span class="st">'squish'</span>),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>batch_tfms<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">128</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These are the same item and batch transforms we’ve used in previous notebooks.</p>
</section>
<section id="how-to-display-6-images-from-a-batch" class="level3">
<h3 class="anchored" data-anchor-id="how-to-display-6-images-from-a-batch">how to display 6 images from a batch</h3>
<p>Let’s take a look at part of a batch of this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dls.show_batch(max_n<span class="op">=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="0011_fastai_multi_target_road_to_top_part_4_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can see that fastai has created both the image input and two categorical outputs that we requested!</p>
</section>
</section>
<section id="replicating-the-disease-model" class="level2">
<h2 class="anchored" data-anchor-id="replicating-the-disease-model">Replicating the disease model</h2>
<section id="how-to-create-disease-error-rate-and-disease-entropy-loss-functions-to-receive-3-instead-of-2-inputs" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-disease-error-rate-and-disease-entropy-loss-functions-to-receive-3-instead-of-2-inputs">how to create disease error-rate and disease entropy loss functions to receive 3 instead of 2 inputs</h3>
<p>Now we’ll replicate the same disease model we’ve made before, but have it work with this new data.</p>
<p>The key difference is that our metrics and loss will now receive three things instead of two: the model outputs (i.e.&nbsp;the metric and loss function inputs), and the two targets (disease and variety). Therefore, we need to define slight variations of our metric (<code>error_rate</code>) and loss function (<code>cross_entropy</code>) to pass on just the <code>disease</code> target:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> disease_err(inp,disease,variety): <span class="cf">return</span> error_rate(inp,disease)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> disease_loss(inp,disease,variety): <span class="cf">return</span> F.cross_entropy(inp,disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-create-a-vision-learner-using-vision_learner-which-specifies-loss_func-metrics-n_out-num-of-outputs" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-a-vision-learner-using-vision_learner-which-specifies-loss_func-metrics-n_out-num-of-outputs">how to create a vision learner using <code>vision_learner</code> which specifies <code>loss_func</code>, <code>metrics</code>, <code>n_out</code> (num of outputs)</h3>
<p>We’re now ready to create our learner.</p>
<p>There’s just one wrinkle to be aware of. Now that our <code>DataLoaders</code> is returning multiple targets, fastai doesn’t know how many outputs our model will need. Therefore we have to pass <code>n_out</code> when we create our <code>Learner</code> – we need <code>10</code> outputs, one for each possible disease:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'convnext_small_in22k'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, arch, loss_func<span class="op">=</span>disease_loss, metrics<span class="op">=</span>disease_err, n_out<span class="op">=</span><span class="dv">10</span>).to_fp16()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">0.01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_small_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_small_22k_224.pth</code></pre>
</div>
</div>
<p>When we train this model we should get similar results to what we’ve seen with similar models before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>learn.fine_tune(<span class="dv">5</span>, lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>disease_err</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.367007</td>
      <td>0.755765</td>
      <td>0.248919</td>
      <td>02:00</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>disease_err</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.699962</td>
      <td>0.519963</td>
      <td>0.168669</td>
      <td>01:57</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.548859</td>
      <td>0.298034</td>
      <td>0.101874</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.322040</td>
      <td>0.197317</td>
      <td>0.057184</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.209926</td>
      <td>0.137812</td>
      <td>0.041326</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.153729</td>
      <td>0.128756</td>
      <td>0.038443</td>
      <td>01:54</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</section>
</section>
<section id="multi-target-model" class="level2">
<h2 class="anchored" data-anchor-id="multi-target-model">Multi-target model</h2>
<section id="how-to-make-the-vision_learner-to-return-20-outputs-10-for-diseases-10-for-varieties-how-to-use-to_fp16" class="level3">
<h3 class="anchored" data-anchor-id="how-to-make-the-vision_learner-to-return-20-outputs-10-for-diseases-10-for-varieties-how-to-use-to_fp16">how to make the vision_learner to return 20 outputs, 10 for diseases, 10 for varieties; how to use to_fp16</h3>
<p>In order to predict both the probability of each disease, and of each variety, we’ll now need the model to output a tensor of length 20, since there are 10 possible diseases, and 10 possible varieties. We can do this by setting <code>n_out=20</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, arch, n_out<span class="op">=</span><span class="dv">20</span>).to_fp16()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-split-the-inputs-for-creating-entropy-loss-for-disease-and-variety" class="level3">
<h3 class="anchored" data-anchor-id="how-to-split-the-inputs-for-creating-entropy-loss-for-disease-and-variety">how to split the inputs for creating entropy loss for disease and variety</h3>
<p>We can define <code>disease_loss</code> just like we did previously, but with one important change: the input tensor is now length 20, not 10, so it doesn’t match the number of possible diseases. We can pick whatever part of the input we want to be used to predict disease. Let’s use the first 10 values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> disease_loss(inp,disease,variety): <span class="cf">return</span> F.cross_entropy(inp[:,:<span class="dv">10</span>],disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That means we can do the same thing for predicting variety, but use the last 10 values of the input, and set the target to <code>variety</code> instead of <code>disease</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> variety_loss(inp,disease,variety): <span class="cf">return</span> F.cross_entropy(inp[:,<span class="dv">10</span>:],variety)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-combine-both-disease-loss-and-variety-loss-together-to-be-the-model-loss" class="level3">
<h3 class="anchored" data-anchor-id="how-to-combine-both-disease-loss-and-variety-loss-together-to-be-the-model-loss">how to combine both disease loss and variety loss together to be the model loss</h3>
<p>Our overall loss will then be the sum of these two losses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_loss(inp,disease,variety): <span class="cf">return</span> disease_loss(inp,disease,variety)<span class="op">+</span>variety_loss(inp,disease,variety)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-split-the-input-data-to-calc-both-disease-error-rate-and-variety-error-rate" class="level3">
<h3 class="anchored" data-anchor-id="how-to-split-the-input-data-to-calc-both-disease-error-rate-and-variety-error-rate">how to split the input data to calc both disease error rate and variety error rate</h3>
<p>It would be useful to view the error rate for each of the outputs too, so let’s do the same thing for out metrics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> disease_err(inp,disease,variety): <span class="cf">return</span> error_rate(inp[:,:<span class="dv">10</span>],disease)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> variety_err(inp,disease,variety): <span class="cf">return</span> error_rate(inp[:,<span class="dv">10</span>:],variety)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>err_metrics <span class="op">=</span> (disease_err,variety_err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-wrap-all-error-rates-and-losses-into-a-tuple-all_metrics-and-give-it-to-metrics-of-vision_learner" class="level3">
<h3 class="anchored" data-anchor-id="how-to-wrap-all-error-rates-and-losses-into-a-tuple-all_metrics-and-give-it-to-metrics-of-vision_learner">how to wrap all error rates and losses into a tuple <code>all_metrics</code> and give it to <code>metrics</code> of <code>vision_learner</code></h3>
<p>It’s useful to see the loss for each of the outputs too, so we’ll add those as metrics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="op">=</span> err_metrics<span class="op">+</span>(disease_loss,variety_loss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’re now ready to create and train our <code>Learner</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, arch, loss_func<span class="op">=</span>combine_loss, metrics<span class="op">=</span>all_metrics, n_out<span class="op">=</span><span class="dv">20</span>).to_fp16()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>learn.fine_tune(<span class="dv">5</span>, lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>disease_err</th>
      <th>variety_err</th>
      <th>disease_loss</th>
      <th>variety_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2.415001</td>
      <td>1.208315</td>
      <td>0.245074</td>
      <td>0.139356</td>
      <td>0.762428</td>
      <td>0.445887</td>
      <td>01:47</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>disease_err</th>
      <th>variety_err</th>
      <th>disease_loss</th>
      <th>variety_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.095675</td>
      <td>0.736918</td>
      <td>0.169630</td>
      <td>0.081211</td>
      <td>0.507069</td>
      <td>0.229849</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.789853</td>
      <td>0.598383</td>
      <td>0.123018</td>
      <td>0.071600</td>
      <td>0.380146</td>
      <td>0.218237</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.497091</td>
      <td>0.307715</td>
      <td>0.074964</td>
      <td>0.026910</td>
      <td>0.221378</td>
      <td>0.086336</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.300630</td>
      <td>0.225282</td>
      <td>0.049976</td>
      <td>0.022105</td>
      <td>0.164723</td>
      <td>0.060559</td>
      <td>01:53</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.209699</td>
      <td>0.189986</td>
      <td>0.040846</td>
      <td>0.018260</td>
      <td>0.134375</td>
      <td>0.055611</td>
      <td>01:57</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<section id="how-can-multi-target-model-be-useful-to-us" class="level3">
<h3 class="anchored" data-anchor-id="how-can-multi-target-model-be-useful-to-us">how can multi-target model be useful to us</h3>
<p>So, is this useful?</p>
<p>Well… if you actually want a model that predicts multiple things, then yes, definitely! But as to whether it’s going to help us better predict rice disease, I honestly don’t know. I haven’t come across any research that tackles this important question: when can a multi-target model improve the accuracy of the individual targets compared to a single target model? (That doesn’t mean it doesn’t exist of course – perhaps it does and I haven’t found it yet…)</p>
<p>I’ve certainly found in previous projects that there are cases where improvements to single targets can be made by using a multi-target model. I’d guess that it’ll be most useful when you’re having problems with overfitting. So try doing this with more epochs, and let me know how you go!</p>
<p>If you found this notebook useful, please remember to click the little up-arrow at the top to upvote it, since I like to know when people have found my work useful, and it helps others find it too. And if you have any questions or comments, please pop them below – I read every comment I receive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is what I use to push my notebook from my home PC to Kaggle</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> iskaggle:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    push_notebook(<span class="st">'jhoward'</span>, <span class="st">'multi-target-road-to-the-top-part-4'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                  title<span class="op">=</span><span class="st">'Multi-target: Road to the Top, Part 4'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">file</span><span class="op">=</span><span class="st">'11-multitask.ipynb'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                  competition<span class="op">=</span>comp, private<span class="op">=</span><span class="va">False</span>, gpu<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>