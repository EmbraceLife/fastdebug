<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>fastdebug - 0007_fastai_how_random_forests_really_work</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="fastdebug - 0007_fastai_how_random_forests_really_work">
<meta property="og:description" content="We can see that it’s found exactly the same splits as we did!">
<meta property="og:site-name" content="fastdebug">
<meta name="twitter:title" content="fastdebug - 0007_fastai_how_random_forests_really_work">
<meta name="twitter:description" content="We can see that it’s found exactly the same splits as we did!">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">fastdebug</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">0007_fastai_how_random_forests_really_work</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Learning fastai with joy</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Interesting_fastai</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Interesting_fastai/the_origin_of_apl .html" class="sidebar-item-text sidebar-link">0001_The_origin_of_APL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Interesting_fastai/Interesting_things_fastai.html" class="sidebar-item-text sidebar-link">Interesting_things_fastai.html</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">demos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/intro_fastdebug.html" class="sidebar-item-text sidebar-link">Introducing fastdebug</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/tour.html" class="sidebar-item-text sidebar-link">0000_tour</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_meta_delegates.html" class="sidebar-item-text sidebar-link">0001_Fastcore.meta.delegates</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/signature_from_callable.html" class="sidebar-item-text sidebar-link">0002_signature_from_callable</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/explore_document_fixsigmeta_prepostinitmeta_autoinit.html" class="sidebar-item-text sidebar-link">03_FixSigMeta_PrePostInitMeta_AutoInit</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta._rm_self.html" class="sidebar-item-text sidebar-link">04_rm_self</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.test_sig.html" class="sidebar-item-text sidebar-link">05_test_sig</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.newchkmeta.html" class="sidebar-item-text sidebar-link">06_NewChkMeta</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore.meta.bypassnewmeta.html" class="sidebar-item-text sidebar-link">07_BypassNewMeta</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/use_kwargs_dict.html" class="sidebar-item-text sidebar-link">08_use_kwargs_dict</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/funcs_kwargs.html" class="sidebar-item-text sidebar-link">09_method_funcs_kwargs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_meta_summary.html" class="sidebar-item-text sidebar-link">0010_fastcore_meta_summary</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastdb.html" class="sidebar-item-text sidebar-link">0011_Fastdb</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../demos/fastcore_foundation_l.html" class="sidebar-item-text sidebar-link">0012_fastcore_foundation_L</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">fastai_notebooks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_is_it_a_bird.html" class="sidebar-item-text sidebar-link">0001_fastai_Is it a bird? Creating a model from your own data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_saving_a_basic_fastai_model.html" class="sidebar-item-text sidebar-link">0002_fastai_saving_a_basic_fastai_model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_which_image_model_best.html" class="sidebar-item-text sidebar-link">0003_fastai_which_image_model_best</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_how_neuralnet_work.html" class="sidebar-item-text sidebar-link">0004_fastai_how_neuralnet_work</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_linear_neuralnet_scratch.html" class="sidebar-item-text sidebar-link">0005_fastai_linear_neuralnet_scratch</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_why_should_use_framework.html" class="sidebar-item-text sidebar-link">0006_fastai_why_should_use_framework</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_how_random_forests_really_work.html" class="sidebar-item-text sidebar-link active">0007_fastai_how_random_forests_really_work</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_first_steps_road_to_top_part_1.html" class="sidebar-item-text sidebar-link">0008_fastai_first_steps_road_to_top_part_1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_small_models_road_to_the_top_part_2.html" class="sidebar-item-text sidebar-link">0009_fastai_small_models_road_to_the_top_part_2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_scaling_up_road_to_top_part_3.html" class="sidebar-item-text sidebar-link">0010_fastai_scaling_up_road_to_top_part_3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_multi_target_road_to_top_part_4.html" class="sidebar-item-text sidebar-link">0011_fastai_multi_target_road_to_top_part_4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_using_nbdev_export_in_kaggle_notebook.html" class="sidebar-item-text sidebar-link">0012_fastai_using_nbdev_export_in_kaggle_notebook</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/best_vision_models_for_fine_tuning.html" class="sidebar-item-text sidebar-link">0013_best_vision_models_for_fine_tuning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/iterate_like_grandmaster.html" class="sidebar-item-text sidebar-link">0014_iterate_like_grandmaster</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/getting_started_with_nlp_for_absolute_beginner.html" class="sidebar-item-text sidebar-link">0015_getting_started_with_nlp_for_absolute_beginner</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/collaborative_filtering_deep_dive.html" class="sidebar-item-text sidebar-link">0016_collaborative_filtering_deep_dive</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptmatmul.html" class="sidebar-item-text sidebar-link">0017_fastai_pt2_2019_matmul</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptexports.html" class="sidebar-item-text sidebar-link">0018_fastai_pt2_2019_exports</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptlectureintro.html" class="sidebar-item-text sidebar-link">0019_fastai_pt2_2019_lecture1_intro</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptsource_explained.html" class="sidebar-item-text sidebar-link">0020_fastai_pt2_2019_source_explained</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptfully_connected.html" class="sidebar-item-text sidebar-link">0021_fastai_pt2_2019_fully_connected</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fastai_notebooks/fastai_ptwhy_sqrt5.html" class="sidebar-item-text sidebar-link">0022_fastai_pt2_2019_why_sqrt5</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">questions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../questions/question_anno_dict.html" class="sidebar-item-text sidebar-link">00_quesolved_anno_dict</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#why-ensemble-of-decision-trees-such-as-random-forests-and-gradient-boosting-machines" id="toc-why-ensemble-of-decision-trees-such-as-random-forests-and-gradient-boosting-machines" class="nav-link" data-scroll-target="#why-ensemble-of-decision-trees-such-as-random-forests-and-gradient-boosting-machines">why ensemble of decision trees, such as Random Forests and Gradient Boosting Machines</a></li>
  <li><a href="#how-to-set-print-options-for-numpy-and-import-fastai.imports" id="toc-how-to-set-print-options-for-numpy-and-import-fastai.imports" class="nav-link" data-scroll-target="#how-to-set-print-options-for-numpy-and-import-fastai.imports">how to set print options for numpy and import <code>fastai.imports</code></a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data preprocessing</a>
  <ul class="collapse">
  <li><a href="#how-to-get-titanic-dataset-ready-for-creating-a-decision-tree-model" id="toc-how-to-get-titanic-dataset-ready-for-creating-a-decision-tree-model" class="nav-link" data-scroll-target="#how-to-get-titanic-dataset-ready-for-creating-a-decision-tree-model">how to get Titanic dataset ready for creating a decision tree model</a></li>
  </ul></li>
  <li><a href="#binary-splits" id="toc-binary-splits" class="nav-link" data-scroll-target="#binary-splits">Binary splits</a>
  <ul class="collapse">
  <li><a href="#what-is-binary-splits-and-how-does-it-work" id="toc-what-is-binary-splits-and-how-does-it-work" class="nav-link" data-scroll-target="#what-is-binary-splits-and-how-does-it-work">what is binary splits and how does it work</a></li>
  <li><a href="#how-to-plot-barplot-and-countplot-with-seaborn" id="toc-how-to-plot-barplot-and-countplot-with-seaborn" class="nav-link" data-scroll-target="#how-to-plot-barplot-and-countplot-with-seaborn">how to plot barplot and countplot with Seaborn</a></li>
  <li><a href="#create-a-simplest-model-based-on-binary-split" id="toc-create-a-simplest-model-based-on-binary-split" class="nav-link" data-scroll-target="#create-a-simplest-model-based-on-binary-split">Create a simplest model based on binary split</a></li>
  <li><a href="#how-to-do-train-and-test-split-using-sklearn.model_selection.train_test_split" id="toc-how-to-do-train-and-test-split-using-sklearn.model_selection.train_test_split" class="nav-link" data-scroll-target="#how-to-do-train-and-test-split-using-sklearn.model_selection.train_test_split">how to do train and test split using <code>sklearn.model_selection.train_test_split</code></a></li>
  <li><a href="#how-to-access-dependent-and-independent-values-for-both-training-set-and-test-set" id="toc-how-to-access-dependent-and-independent-values-for-both-training-set-and-test-set" class="nav-link" data-scroll-target="#how-to-access-dependent-and-independent-values-for-both-training-set-and-test-set">how to access dependent and independent values for both training set and test set</a></li>
  <li><a href="#calc-the-prediction-the-simplest-so-far" id="toc-calc-the-prediction-the-simplest-so-far" class="nav-link" data-scroll-target="#calc-the-prediction-the-simplest-so-far">calc the prediction (the simplest so far)</a></li>
  <li><a href="#calc-loss-with-mean-absolute-error-using-sklearn.metrics.mean_absolute_error" id="toc-calc-loss-with-mean-absolute-error-using-sklearn.metrics.mean_absolute_error" class="nav-link" data-scroll-target="#calc-loss-with-mean-absolute-error-using-sklearn.metrics.mean_absolute_error">calc loss with mean absolute error using <code>sklearn.metrics.mean_absolute_error</code></a></li>
  <li><a href="#how-to-do-binary-split-on-a-continuous-column-rather-than-category-column" id="toc-how-to-do-binary-split-on-a-continuous-column-rather-than-category-column" class="nav-link" data-scroll-target="#how-to-do-binary-split-on-a-continuous-column-rather-than-category-column">how to do binary split on a continuous column rather than category column</a></li>
  <li><a href="#how-to-plot-a-boxenplot-on-survival-and-non-survival-using-sns.logfare-column-how-to-a-density-plot-with-logfare-using-sns.kdeplot" id="toc-how-to-plot-a-boxenplot-on-survival-and-non-survival-using-sns.logfare-column-how-to-a-density-plot-with-logfare-using-sns.kdeplot" class="nav-link" data-scroll-target="#how-to-plot-a-boxenplot-on-survival-and-non-survival-using-sns.logfare-column-how-to-a-density-plot-with-logfare-using-sns.kdeplot">how to plot a boxenplot on survival and non-survival using <code>sns.logFare</code> column; how to a density plot with logFare using <code>sns.kdeplot</code></a></li>
  <li><a href="#how-to-find-the-binary-split-to-calc-predictions-based-on-logfare-using-the-boxenplot-above" id="toc-how-to-find-the-binary-split-to-calc-predictions-based-on-logfare-using-the-boxenplot-above" class="nav-link" data-scroll-target="#how-to-find-the-binary-split-to-calc-predictions-based-on-logfare-using-the-boxenplot-above">how to find the binary split to calc predictions based on logFare using the boxenplot above</a></li>
  <li><a href="#see-how-good-is-this-model-and-prediction-using-loss-mean-absolute-error" id="toc-see-how-good-is-this-model-and-prediction-using-loss-mean-absolute-error" class="nav-link" data-scroll-target="#see-how-good-is-this-model-and-prediction-using-loss-mean-absolute-error">see how good is this model and prediction using loss (mean absolute error)</a></li>
  <li><a href="#how-does-impurity-measure-the-goodness-of-a-split-how-to-create-impurity-as-a-measure-for-how-good-of-a-split" id="toc-how-does-impurity-measure-the-goodness-of-a-split-how-to-create-impurity-as-a-measure-for-how-good-of-a-split" class="nav-link" data-scroll-target="#how-does-impurity-measure-the-goodness-of-a-split-how-to-create-impurity-as-a-measure-for-how-good-of-a-split">how does impurity measure the goodness of a split; how to create impurity as a measure for how good of a split</a></li>
  <li><a href="#how-to-create-a-score-function-for-a-single-side-of-the-split" id="toc-how-to-create-a-score-function-for-a-single-side-of-the-split" class="nav-link" data-scroll-target="#how-to-create-a-score-function-for-a-single-side-of-the-split">how to create a score function for a single side of the split</a></li>
  <li><a href="#how-to-create-the-score-function-to-measure-the-goodness-of-a-binary-split" id="toc-how-to-create-the-score-function-to-measure-the-goodness-of-a-binary-split" class="nav-link" data-scroll-target="#how-to-create-the-score-function-to-measure-the-goodness-of-a-binary-split">how to create the score function to measure the goodness of a binary split</a></li>
  <li><a href="#calc-the-impurity-score-for-sex-split-and-then-logfare-split" id="toc-calc-the-impurity-score-for-sex-split-and-then-logfare-split" class="nav-link" data-scroll-target="#calc-the-impurity-score-for-sex-split-and-then-logfare-split">calc the impurity score for sex split and then logFare split</a></li>
  <li><a href="#how-to-make-interactive-on-choose-different-split-and-calc-score-on-continuous-columns" id="toc-how-to-make-interactive-on-choose-different-split-and-calc-score-on-continuous-columns" class="nav-link" data-scroll-target="#how-to-make-interactive-on-choose-different-split-and-calc-score-on-continuous-columns">how to make interactive on choose different split and calc score on continuous columns</a></li>
  <li><a href="#how-to-make-interactive-on-choose-different-split-and-calc-score-on-categorical-columns" id="toc-how-to-make-interactive-on-choose-different-split-and-calc-score-on-categorical-columns" class="nav-link" data-scroll-target="#how-to-make-interactive-on-choose-different-split-and-calc-score-on-categorical-columns">how to make interactive on choose different split and calc score on categorical columns</a></li>
  <li><a href="#how-to-make-a-list-of-all-possible-split-points" id="toc-how-to-make-a-list-of-all-possible-split-points" class="nav-link" data-scroll-target="#how-to-make-a-list-of-all-possible-split-points">how to make a list of all possible split points</a></li>
  <li><a href="#how-to-get-the-score-for-all-possible-splits-of-a-particular-column-like-age-how-to-get-the-index-for-the-lowest-core" id="toc-how-to-get-the-score-for-all-possible-splits-of-a-particular-column-like-age-how-to-get-the-index-for-the-lowest-core" class="nav-link" data-scroll-target="#how-to-get-the-score-for-all-possible-splits-of-a-particular-column-like-age-how-to-get-the-index-for-the-lowest-core">how to get the score for all possible splits of a particular column like Age; how to get the index for the lowest core</a></li>
  <li><a href="#how-to-write-a-function-to-return-the-best-split-value-and-its-score-on-a-particular-column-given-the-dataframe-and-the-name-of-the-column" id="toc-how-to-write-a-function-to-return-the-best-split-value-and-its-score-on-a-particular-column-given-the-dataframe-and-the-name-of-the-column" class="nav-link" data-scroll-target="#how-to-write-a-function-to-return-the-best-split-value-and-its-score-on-a-particular-column-given-the-dataframe-and-the-name-of-the-column">how to write a function to return the best split value and its score on a particular column given the dataframe and the name of the column</a></li>
  <li><a href="#how-to-run-this-function-on-all-columns-of-the-dataset" id="toc-how-to-run-this-function-on-all-columns-of-the-dataset" class="nav-link" data-scroll-target="#how-to-run-this-function-on-all-columns-of-the-dataset">how to run this function on all columns of the dataset</a></li>
  <li><a href="#what-is-oner-classifier-why-should-it-be-a-baseline-to-more-sophisiticated-models" id="toc-what-is-oner-classifier-why-should-it-be-a-baseline-to-more-sophisiticated-models" class="nav-link" data-scroll-target="#what-is-oner-classifier-why-should-it-be-a-baseline-to-more-sophisiticated-models">what is OneR classifier; why should it be a baseline to more sophisiticated models</a></li>
  </ul></li>
  <li><a href="#creating-a-decision-tree" id="toc-creating-a-decision-tree" class="nav-link" data-scroll-target="#creating-a-decision-tree">Creating a decision tree</a>
  <ul class="collapse">
  <li><a href="#how-is-to-do-better-than-a-oner-classifier-which-predict-survival-using-sex-how-about-doing-another-oner-upon-the-first-oner-classifier-result-male-group-and-female-group" id="toc-how-is-to-do-better-than-a-oner-classifier-which-predict-survival-using-sex-how-about-doing-another-oner-upon-the-first-oner-classifier-result-male-group-and-female-group" class="nav-link" data-scroll-target="#how-is-to-do-better-than-a-oner-classifier-which-predict-survival-using-sex-how-about-doing-another-oner-upon-the-first-oner-classifier-result-male-group-and-female-group">how is to do better than a OneR classifier which predict survival using sex? how about doing another OneR upon the first OneR classifier result (male group and female group)</a></li>
  <li><a href="#how-to-get-the-dataset-splitted-by-sex-in-pandas-dataframe" id="toc-how-to-get-the-dataset-splitted-by-sex-in-pandas-dataframe" class="nav-link" data-scroll-target="#how-to-get-the-dataset-splitted-by-sex-in-pandas-dataframe">how to get the dataset splitted by sex in pandas dataframe</a></li>
  <li><a href="#how-to-find-the-best-binary-splits-and-score-out-of-all-columns-in-male-dataset-and-then-femal-dataset" id="toc-how-to-find-the-best-binary-splits-and-score-out-of-all-columns-in-male-dataset-and-then-femal-dataset" class="nav-link" data-scroll-target="#how-to-find-the-best-binary-splits-and-score-out-of-all-columns-in-male-dataset-and-then-femal-dataset">how to find the best binary splits and score out of all columns in male dataset and then femal dataset</a></li>
  <li><a href="#what-does-a-decision-tree-mean-when-the-second-binary-split-is-done-here" id="toc-what-does-a-decision-tree-mean-when-the-second-binary-split-is-done-here" class="nav-link" data-scroll-target="#what-does-a-decision-tree-mean-when-the-second-binary-split-is-done-here">what does a decision tree mean when the second binary split is done here</a></li>
  <li><a href="#how-to-do-a-decision-tree-automatically-using-sklearn" id="toc-how-to-do-a-decision-tree-automatically-using-sklearn" class="nav-link" data-scroll-target="#how-to-do-a-decision-tree-automatically-using-sklearn">how to do a decision tree automatically using sklearn</a></li>
  <li><a href="#how-to-visualize-the-decision-tree-above" id="toc-how-to-visualize-the-decision-tree-above" class="nav-link" data-scroll-target="#how-to-visualize-the-decision-tree-above">how to visualize the decision tree above</a></li>
  </ul></li>
  <li><a href="#how-is-gini-different-from-impurity" id="toc-how-is-gini-different-from-impurity" class="nav-link" data-scroll-target="#how-is-gini-different-from-impurity">how is gini different from impurity</a>
  <ul class="collapse">
  <li><a href="#how-to-cacl-gini" id="toc-how-to-cacl-gini" class="nav-link" data-scroll-target="#how-to-cacl-gini">how to cacl gini</a></li>
  <li><a href="#how-to-wrap-the-process-of-preparing-submission-csv-file-for-kaggle" id="toc-how-to-wrap-the-process-of-preparing-submission-csv-file-for-kaggle" class="nav-link" data-scroll-target="#how-to-wrap-the-process-of-preparing-submission-csv-file-for-kaggle">how to wrap the process of preparing submission csv file for kaggle</a></li>
  <li><a href="#why-no-need-to-worry-about-dummy-variables-in-decision-trees" id="toc-why-no-need-to-worry-about-dummy-variables-in-decision-trees" class="nav-link" data-scroll-target="#why-no-need-to-worry-about-dummy-variables-in-decision-trees">why no need to worry about dummy variables in decision trees</a></li>
  </ul></li>
  <li><a href="#the-random-forest" id="toc-the-random-forest" class="nav-link" data-scroll-target="#the-random-forest">The random forest</a>
  <ul class="collapse">
  <li><a href="#what-is-random-forest-what-is-bagging-what-is-the-great-insight-behind-it" id="toc-what-is-random-forest-what-is-bagging-what-is-the-great-insight-behind-it" class="nav-link" data-scroll-target="#what-is-random-forest-what-is-bagging-what-is-the-great-insight-behind-it">what is random forest; what is bagging; what is the great insight behind it</a></li>
  <li><a href="#how-to-create-uncorrelated-trees-using-random-subset-of-data" id="toc-how-to-create-uncorrelated-trees-using-random-subset-of-data" class="nav-link" data-scroll-target="#how-to-create-uncorrelated-trees-using-random-subset-of-data">how to create uncorrelated trees using random subset of data</a></li>
  <li><a href="#how-to-make-prediciton-on-each-tree-and-take-average-on-them-and-then-calc-the-loss" id="toc-how-to-make-prediciton-on-each-tree-and-take-average-on-them-and-then-calc-the-loss" class="nav-link" data-scroll-target="#how-to-make-prediciton-on-each-tree-and-take-average-on-them-and-then-calc-the-loss">how to make prediciton on each tree and take average on them, and then calc the loss</a></li>
  <li><a href="#how-is-sklearns-randomforestclassifier-differ-from-the-forest-from-scratch-above-how-to-do-random-forest-with-sklearn" id="toc-how-is-sklearns-randomforestclassifier-differ-from-the-forest-from-scratch-above-how-to-do-random-forest-with-sklearn" class="nav-link" data-scroll-target="#how-is-sklearns-randomforestclassifier-differ-from-the-forest-from-scratch-above-how-to-do-random-forest-with-sklearn">how is sklearn’s RandomForestClassifier differ from the forest from scratch above; how to do random forest with sklearn</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul class="collapse">
  <li><a href="#how-should-we-think-of-simple-models-like-oner-and-decision-tree-and-randomforest" id="toc-how-should-we-think-of-simple-models-like-oner-and-decision-tree-and-randomforest" class="nav-link" data-scroll-target="#how-should-we-think-of-simple-models-like-oner-and-decision-tree-and-randomforest">how should we think of simple models like OneR and decision tree and randomforest</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/EmbraceLife/fastdebug/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">0007_fastai_how_random_forests_really_work</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="why-ensemble-of-decision-trees-such-as-random-forests-and-gradient-boosting-machines" class="level3">
<h3 class="anchored" data-anchor-id="why-ensemble-of-decision-trees-such-as-random-forests-and-gradient-boosting-machines">why ensemble of decision trees, such as Random Forests and Gradient Boosting Machines</h3>
<p>Previously I’ve shown how to create a <a href="https://www.kaggle.com/code/jhoward/linear-model-and-neural-net-from-scratch">linear model and neural net from scratch</a>, and used it to create a solid submission to Kaggle’s <a href="https://www.kaggle.com/competitions/titanic/">Titanic</a> competition. However, for <em>tabular</em> data (i.e data that looks like spreadsheet or database tables, such as the data for the Titanic competition) it’s more common to see good results by using ensembles of decision trees, such as Random Forests and Gradient Boosting Machines.</p>
<p>In this notebook, we’re going to learn all about Random Forests, by building one from scratch, and using it to submit to the Titanic competition! That might sound like a pretty big stretch, but I think you’ll be surprised to discover how straightforward it actually is.</p>
<p>We’ll start by importing the basic set of libraries we normally need for data science work, and setting numpy to use our display space more efficiently:</p>
</section>
<section id="how-to-set-print-options-for-numpy-and-import-fastai.imports" class="level3">
<h3 class="anchored" data-anchor-id="how-to-set-print-options-for-numpy-and-import-fastai.imports">how to set print options for numpy and import <code>fastai.imports</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.imports <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(linewidth<span class="op">=</span><span class="dv">130</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">Data preprocessing</h2>
<section id="how-to-get-titanic-dataset-ready-for-creating-a-decision-tree-model" class="level3">
<h3 class="anchored" data-anchor-id="how-to-get-titanic-dataset-ready-for-creating-a-decision-tree-model">how to get Titanic dataset ready for creating a decision tree model</h3>
<p>We’ll create <code>DataFrame</code>s from the CSV files just like we did in the “<em>linear model and neural net from scratch</em>” notebook, and do much the same preprocessing (so go back and check that out if you’re not already familiar with the dataset):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>iskaggle <span class="op">=</span> os.environ.get(<span class="st">'KAGGLE_KERNEL_RUN_TYPE'</span>, <span class="st">''</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> iskaggle: path <span class="op">=</span> Path(<span class="st">'../input/titanic'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> zipfile,kaggle</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> Path(<span class="st">'titanic'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    kaggle.api.competition_download_cli(<span class="bu">str</span>(path))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    zipfile.ZipFile(<span class="ss">f'</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.zip'</span>).extractall(path)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'train.csv'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>tst_df <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'test.csv'</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>modes <span class="op">=</span> df.mode().iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: Error: Missing username in configuration.</code></pre>
</div>
</div>
<p>One difference with Random Forests however is that we don’t generally have to create <em>dummy variables</em> like we did for non-numeric columns in the linear models and neural network. Instead, we can just convert those fields to <em>categorical variables</em>, which internally in Pandas makes a list of all the unique values in the column, and replaces each value with a number. The number is just an index for looking up the value in the list of all unique values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> proc_data(df):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'Fare'</span>] <span class="op">=</span> df.Fare.fillna(<span class="dv">0</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    df.fillna(modes, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'LogFare'</span>] <span class="op">=</span> np.log1p(df[<span class="st">'Fare'</span>])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'Embarked'</span>] <span class="op">=</span> pd.Categorical(df.Embarked)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'Sex'</span>] <span class="op">=</span> pd.Categorical(df.Sex)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>proc_data(df)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>proc_data(tst_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df' is not defined</code></pre>
</div>
</div>
<p>We’ll make a list of the continuous, categorical, and dependent variables. Note that we no longer consider <code>Pclass</code> a categorical variable. That’s because it’s <em>ordered</em> (i.e 1st, 2nd, and 3rd class have an order), and decision trees, as we’ll see, only care about order, not about absolute value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cats<span class="op">=</span>[<span class="st">"Sex"</span>,<span class="st">"Embarked"</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>conts<span class="op">=</span>[<span class="st">'Age'</span>, <span class="st">'SibSp'</span>, <span class="st">'Parch'</span>, <span class="st">'LogFare'</span>,<span class="st">"Pclass"</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dep<span class="op">=</span><span class="st">"Survived"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even although we’ve made the <code>cats</code> columns categorical, they are still shown by Pandas as their original values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.Sex.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df' is not defined</code></pre>
</div>
</div>
<p>However behind the scenes they’re now stored as integers, with indices that are looked up in the <code>Categories</code> list shown in the output above. We can view the stored values by looking in the <code>cat.codes</code> attribute:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.Sex.cat.codes.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df' is not defined</code></pre>
</div>
</div>
</section>
</section>
<section id="binary-splits" class="level2">
<h2 class="anchored" data-anchor-id="binary-splits">Binary splits</h2>
<section id="what-is-binary-splits-and-how-does-it-work" class="level3">
<h3 class="anchored" data-anchor-id="what-is-binary-splits-and-how-does-it-work">what is binary splits and how does it work</h3>
<p>Before we create a Random Forest or Gradient Boosting Machine, we’ll first need to learn how to create a <em>decision tree</em>, from which both of these models are built.</p>
<p>And to create a decision tree, we’ll first need to create a <em>binary split</em>, since that’s what a decision tree is built from.</p>
<p>A binary split is where all rows are placed into one of two groups, based on whether they’re above or below some threshold of some column. For example, we could split the rows of our dataset into males and females, by using the threshold <code>0.5</code> and the column <code>Sex</code> (since the values in the column are <code>0</code> for <code>female</code> and <code>1</code> for <code>male</code>). We can use a plot to see how that would split up our data – we’ll use the <a href="https://seaborn.pydata.org/">Seaborn</a> library, which is a layer on top of <a href="https://matplotlib.org/">matplotlib</a> that makes some useful charts easier to create, and more aesthetically pleasing by default:</p>
</section>
<section id="how-to-plot-barplot-and-countplot-with-seaborn" class="level3">
<h3 class="anchored" data-anchor-id="how-to-plot-barplot-and-countplot-with-seaborn">how to plot barplot and countplot with Seaborn</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">5</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>df, y<span class="op">=</span>dep, x<span class="op">=</span><span class="st">"Sex"</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>]).<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Survival rate"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"Sex"</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>]).<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Histogram"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ModuleNotFoundError: No module named 'seaborn'</code></pre>
</div>
</div>
</section>
<section id="create-a-simplest-model-based-on-binary-split" class="level3">
<h3 class="anchored" data-anchor-id="create-a-simplest-model-based-on-binary-split">Create a simplest model based on binary split</h3>
<p>Here we see that (on the left) if we split the data into males and females, we’d have groups that have very different survival rates: &gt;70% for females, and &lt;20% for males. We can also see (on the right) that the split would be reasonably even, with over 300 passengers (out of around 900) in each group.</p>
<p>We could create a very simple “model” which simply says that all females survive, and no males do. To do so, we better first split our data into a training and validation set, to see how accurate this approach turns out to be:</p>
</section>
<section id="how-to-do-train-and-test-split-using-sklearn.model_selection.train_test_split" class="level3">
<h3 class="anchored" data-anchor-id="how-to-do-train-and-test-split-using-sklearn.model_selection.train_test_split">how to do train and test split using <code>sklearn.model_selection.train_test_split</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> random</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>trn_df,val_df <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>trn_df[cats] <span class="op">=</span> trn_df[cats].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.cat.codes)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>val_df[cats] <span class="op">=</span> val_df[cats].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.cat.codes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'df' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-to-access-dependent-and-independent-values-for-both-training-set-and-test-set" class="level3">
<h3 class="anchored" data-anchor-id="how-to-access-dependent-and-independent-values-for-both-training-set-and-test-set">how to access dependent and independent values for both training set and test set</h3>
<p>(In the previous step we also replaced the categorical variables with their integer codes, since some of the models we’ll be building in a moment require that.)</p>
<p>Now we can create our independent variables (the <code>x</code> variables) and dependent (the <code>y</code> variable):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> xs_y(df):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> df[cats<span class="op">+</span>conts].copy()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xs,df[dep] <span class="cf">if</span> dep <span class="kw">in</span> df <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>trn_xs,trn_y <span class="op">=</span> xs_y(trn_df)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>val_xs,val_y <span class="op">=</span> xs_y(val_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calc-the-prediction-the-simplest-so-far" class="level3">
<h3 class="anchored" data-anchor-id="calc-the-prediction-the-simplest-so-far">calc the prediction (the simplest so far)</h3>
<p>Here’s the predictions for our extremely simple model, where <code>female</code> is coded as <code>0</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> val_xs.Sex<span class="op">==</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calc-loss-with-mean-absolute-error-using-sklearn.metrics.mean_absolute_error" class="level3">
<h3 class="anchored" data-anchor-id="calc-loss-with-mean-absolute-error-using-sklearn.metrics.mean_absolute_error">calc loss with mean absolute error using <code>sklearn.metrics.mean_absolute_error</code></h3>
<p>We’ll use mean absolute error to measure how good this model is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-do-binary-split-on-a-continuous-column-rather-than-category-column" class="level3">
<h3 class="anchored" data-anchor-id="how-to-do-binary-split-on-a-continuous-column-rather-than-category-column">how to do binary split on a continuous column rather than category column</h3>
<p>Alternatively, we could try splitting on a continuous column. We have to use a somewhat different chart to see how this might work – here’s an example of how we could look at <code>LogFare</code>:</p>
</section>
<section id="how-to-plot-a-boxenplot-on-survival-and-non-survival-using-sns.logfare-column-how-to-a-density-plot-with-logfare-using-sns.kdeplot" class="level3">
<h3 class="anchored" data-anchor-id="how-to-plot-a-boxenplot-on-survival-and-non-survival-using-sns.logfare-column-how-to-a-density-plot-with-logfare-using-sns.kdeplot">how to plot a boxenplot on survival and non-survival using <code>sns.logFare</code> column; how to a density plot with logFare using <code>sns.kdeplot</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_fare <span class="op">=</span> trn_df[trn_df.LogFare<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">5</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>sns.boxenplot(data<span class="op">=</span>df_fare, x<span class="op">=</span>dep, y<span class="op">=</span><span class="st">"LogFare"</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df_fare, x<span class="op">=</span><span class="st">"LogFare"</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-find-the-binary-split-to-calc-predictions-based-on-logfare-using-the-boxenplot-above" class="level3">
<h3 class="anchored" data-anchor-id="how-to-find-the-binary-split-to-calc-predictions-based-on-logfare-using-the-boxenplot-above">how to find the binary split to calc predictions based on logFare using the boxenplot above</h3>
<p>The <a href="https://seaborn.pydata.org/generated/seaborn.boxenplot.html">boxenplot</a> above shows quantiles of <code>LogFare</code> for each group of <code>Survived==0</code> and <code>Survived==1</code>. It shows that the average <code>LogFare</code> for passengers that didn’t survive is around <code>2.5</code>, and for those that did it’s around <code>3.2</code>. So it seems that people that paid more for their tickets were more likely to get put on a lifeboat.</p>
<p>Let’s create a simple model based on this observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> val_xs.LogFare<span class="op">&gt;</span><span class="fl">2.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="see-how-good-is-this-model-and-prediction-using-loss-mean-absolute-error" class="level3">
<h3 class="anchored" data-anchor-id="see-how-good-is-this-model-and-prediction-using-loss-mean-absolute-error">see how good is this model and prediction using loss (mean absolute error)</h3>
<p>…and test it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'mean_absolute_error' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-does-impurity-measure-the-goodness-of-a-split-how-to-create-impurity-as-a-measure-for-how-good-of-a-split" class="level3">
<h3 class="anchored" data-anchor-id="how-does-impurity-measure-the-goodness-of-a-split-how-to-create-impurity-as-a-measure-for-how-good-of-a-split">how does impurity measure the goodness of a split; how to create impurity as a measure for how good of a split</h3>
<p>This is quite a bit less accurate than our model that used <code>Sex</code> as the single binary split.</p>
<p>Ideally, we’d like some way to try more columns and breakpoints more easily. We could create a function that returns how good our model is, in order to more quickly try out a few different splits. We’ll create a <code>score</code> function to do this. Instead of returning the mean absolute error, we’ll calculate a measure of <em>impurity</em> – that is, how much the binary split creates two groups where the rows in a group are each similar to each other, or dissimilar.</p>
<p>We can measure the similarity of rows inside a group by taking the standard deviation of the dependent variable. If it’s higher, then it means the rows are more different to each other. We’ll then multiply this by the number of rows, since a bigger group as more impact than a smaller group:</p>
</section>
<section id="how-to-create-a-score-function-for-a-single-side-of-the-split" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-a-score-function-for-a-single-side-of-the-split">how to create a score function for a single side of the split</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _side_score(side, y):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    tot <span class="op">=</span> side.<span class="bu">sum</span>()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tot<span class="op">&lt;=</span><span class="dv">1</span>: <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y[side].std()<span class="op">*</span>tot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-create-the-score-function-to-measure-the-goodness-of-a-binary-split" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-the-score-function-to-measure-the-goodness-of-a-binary-split">how to create the score function to measure the goodness of a binary split</h3>
<p>Now we’ve got that written, we can calculate the score for a split by adding up the scores for the “left hand side” (lhs) and “right hand side” (rhs):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score(col, y, split):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    lhs <span class="op">=</span> col<span class="op">&lt;=</span>split</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (_side_score(lhs,y) <span class="op">+</span> _side_score(<span class="op">~</span>lhs,y))<span class="op">/</span><span class="bu">len</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calc-the-impurity-score-for-sex-split-and-then-logfare-split" class="level3">
<h3 class="anchored" data-anchor-id="calc-the-impurity-score-for-sex-split-and-then-logfare-split">calc the impurity score for sex split and then logFare split</h3>
<p>For instance, here’s the impurity score for the split on <code>Sex</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>score(trn_xs[<span class="st">"Sex"</span>], trn_y, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'trn_xs' is not defined</code></pre>
</div>
</div>
<p>…and for <code>LogFare</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>score(trn_xs[<span class="st">"LogFare"</span>], trn_y, <span class="fl">2.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'trn_xs' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-to-make-interactive-on-choose-different-split-and-calc-score-on-continuous-columns" class="level3">
<h3 class="anchored" data-anchor-id="how-to-make-interactive-on-choose-different-split-and-calc-score-on-continuous-columns">how to make interactive on choose different split and calc score on continuous columns</h3>
<p>As we’d expect from our earlier tests, <code>Sex</code> appears to be a better split.</p>
<p>To make it easier to find the best binary split, we can create a simple interactive tool (note that this only works in Kaggle if you click “Copy and Edit” in the top right to open the notebook editor):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iscore(nm, split):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> trn_xs[nm]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score(col, trn_y, split)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>interact(nm<span class="op">=</span>conts, split<span class="op">=</span><span class="fl">15.5</span>)(iscore)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bae4d7b140c741dbb5a1528406abdffa","version_major":2,"version_minor":0}
</script>
</div>
</div>
</section>
<section id="how-to-make-interactive-on-choose-different-split-and-calc-score-on-categorical-columns" class="level3">
<h3 class="anchored" data-anchor-id="how-to-make-interactive-on-choose-different-split-and-calc-score-on-categorical-columns">how to make interactive on choose different split and calc score on categorical columns</h3>
<p>Try selecting different columns and split points using the dropdown and slider above. What splits can you find that increase the purity of the data?</p>
<p>We can do the same thing for the categorical variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>interact(nm<span class="op">=</span>cats, split<span class="op">=</span><span class="dv">2</span>)(iscore)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2f3f6ac75ea04eb3ac248755ffce1d03","version_major":2,"version_minor":0}
</script>
</div>
</div>
</section>
<section id="how-to-make-a-list-of-all-possible-split-points" class="level3">
<h3 class="anchored" data-anchor-id="how-to-make-a-list-of-all-possible-split-points">how to make a list of all possible split points</h3>
<p>That works well enough, but it’s rather slow and fiddly. Perhaps we could get the computer to automatically find the best split point for a column for us? For example, to find the best split point for <code>age</code> we’d first need to make a list of all the possible split points (i.e all the unique values of that field)…:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nm <span class="op">=</span> <span class="st">"Age"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> trn_xs[nm]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>unq <span class="op">=</span> col.unique()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>unq.sort()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>unq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'trn_xs' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-to-get-the-score-for-all-possible-splits-of-a-particular-column-like-age-how-to-get-the-index-for-the-lowest-core" class="level3">
<h3 class="anchored" data-anchor-id="how-to-get-the-score-for-all-possible-splits-of-a-particular-column-like-age-how-to-get-the-index-for-the-lowest-core">how to get the score for all possible splits of a particular column like Age; how to get the index for the lowest core</h3>
<p>…and find which index of those values is where <code>score()</code> is the lowest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> np.array([score(col, trn_y, o) <span class="cf">for</span> o <span class="kw">in</span> unq <span class="cf">if</span> <span class="kw">not</span> np.isnan(o)])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>unq[scores.argmin()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-write-a-function-to-return-the-best-split-value-and-its-score-on-a-particular-column-given-the-dataframe-and-the-name-of-the-column" class="level3">
<h3 class="anchored" data-anchor-id="how-to-write-a-function-to-return-the-best-split-value-and-its-score-on-a-particular-column-given-the-dataframe-and-the-name-of-the-column">how to write a function to return the best split value and its score on a particular column given the dataframe and the name of the column</h3>
<p>Based on this, it looks like, for instance, that for the <code>Age</code> column, <code>6</code> is the optimal cutoff according to our training set.</p>
<p>We can write a little function that implements this idea:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_col(df, nm):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    col,y <span class="op">=</span> df[nm],df[dep]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    unq <span class="op">=</span> col.dropna().unique()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> np.array([score(col, y, o) <span class="cf">for</span> o <span class="kw">in</span> unq <span class="cf">if</span> <span class="kw">not</span> np.isnan(o)])</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> scores.argmin()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unq[idx],scores[idx]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>min_col(trn_df, <span class="st">"Age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-run-this-function-on-all-columns-of-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="how-to-run-this-function-on-all-columns-of-the-dataset">how to run this function on all columns of the dataset</h3>
<p>Let’s try all the columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> cats<span class="op">+</span>conts</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>{o:min_col(trn_df, o) <span class="cf">for</span> o <span class="kw">in</span> cols}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-oner-classifier-why-should-it-be-a-baseline-to-more-sophisiticated-models" class="level3">
<h3 class="anchored" data-anchor-id="what-is-oner-classifier-why-should-it-be-a-baseline-to-more-sophisiticated-models">what is OneR classifier; why should it be a baseline to more sophisiticated models</h3>
<p>According to this, <code>Sex&lt;=0</code> is the best split we can use.</p>
<p>We’ve just re-invented the <a href="https://link.springer.com/article/10.1023/A:1022631118932">OneR</a> classifier (or at least, a minor variant of it), which was found to be one of the most effective classifiers in real-world datasets, compared to the algorithms in use in 1993. Since it’s so simple and surprisingly effective, it makes for a great <em>baseline</em> – that is, a starting point that you can use to compare your more sophisticated models to.</p>
<p>We found earlier that out OneR rule had an error of around <code>0.215</code>, so we’ll keep that in mind as we try out more sophisticated approaches.</p>
</section>
</section>
<section id="creating-a-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-decision-tree">Creating a decision tree</h2>
<section id="how-is-to-do-better-than-a-oner-classifier-which-predict-survival-using-sex-how-about-doing-another-oner-upon-the-first-oner-classifier-result-male-group-and-female-group" class="level3">
<h3 class="anchored" data-anchor-id="how-is-to-do-better-than-a-oner-classifier-which-predict-survival-using-sex-how-about-doing-another-oner-upon-the-first-oner-classifier-result-male-group-and-female-group">how is to do better than a OneR classifier which predict survival using sex? how about doing another OneR upon the first OneR classifier result (male group and female group)</h3>
<p>How can we improve our OneR classifier, which predicts survival based only on <code>Sex</code>?</p>
<p>How about we take each of our two groups, <code>female</code> and <code>male</code>, and create one more binary split for each of them. That is: fine the single best split for females, and the single best split for males. To do this, all we have to do is repeat the previous section’s steps, once for males, and once for females.</p>
<p>First, we’ll remove <code>Sex</code> from the list of possible splits (since we’ve already used it, and there’s only one possible split for that binary column), and create our two groups:</p>
</section>
<section id="how-to-get-the-dataset-splitted-by-sex-in-pandas-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="how-to-get-the-dataset-splitted-by-sex-in-pandas-dataframe">how to get the dataset splitted by sex in pandas dataframe</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>cols.remove(<span class="st">"Sex"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>ismale <span class="op">=</span> trn_df.Sex<span class="op">==</span><span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>males,females <span class="op">=</span> trn_df[ismale],trn_df[<span class="op">~</span>ismale]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'cols' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-to-find-the-best-binary-splits-and-score-out-of-all-columns-in-male-dataset-and-then-femal-dataset" class="level3">
<h3 class="anchored" data-anchor-id="how-to-find-the-best-binary-splits-and-score-out-of-all-columns-in-male-dataset-and-then-femal-dataset">how to find the best binary splits and score out of all columns in male dataset and then femal dataset</h3>
<p>Now let’s find the single best binary split for males…:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>{o:min_col(males, o) <span class="cf">for</span> o <span class="kw">in</span> cols}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'cols' is not defined</code></pre>
</div>
</div>
<p>…and for females:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>{o:min_col(females, o) <span class="cf">for</span> o <span class="kw">in</span> cols}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'cols' is not defined</code></pre>
</div>
</div>
</section>
<section id="what-does-a-decision-tree-mean-when-the-second-binary-split-is-done-here" class="level3">
<h3 class="anchored" data-anchor-id="what-does-a-decision-tree-mean-when-the-second-binary-split-is-done-here">what does a decision tree mean when the second binary split is done here</h3>
<p>We can see that the best next binary split for males is <code>Age&lt;=6</code>, and for females is <code>Pclass&lt;=2</code>.</p>
<p>By adding these rules, we have created a <em>decision tree</em>, where our model will first check whether <code>Sex</code> is female or male, and depending on the result will then check either the above <code>Age</code> or <code>Pclass</code> rules, as appropriate. We could then repeat the process, creating new additional rules for each of the four groups we’ve now created.</p>
<p>Rather than writing that code manually, we can use <code>DecisionTreeClassifier</code>, from <em>sklearn</em>, which does exactly that for us:</p>
</section>
<section id="how-to-do-a-decision-tree-automatically-using-sklearn" class="level3">
<h3 class="anchored" data-anchor-id="how-to-do-a-decision-tree-automatically-using-sklearn">how to do a decision tree automatically using sklearn</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, export_graphviz</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> DecisionTreeClassifier(max_leaf_nodes<span class="op">=</span><span class="dv">4</span>).fit(trn_xs, trn_y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'trn_xs' is not defined</code></pre>
</div>
</div>
</section>
<section id="how-to-visualize-the-decision-tree-above" class="level3">
<h3 class="anchored" data-anchor-id="how-to-visualize-the-decision-tree-above">how to visualize the decision tree above</h3>
<p>One handy feature or this class is that it provides a function for drawing a tree representing the rules:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> graphviz</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_tree(t, df, size<span class="op">=</span><span class="dv">10</span>, ratio<span class="op">=</span><span class="fl">0.6</span>, precision<span class="op">=</span><span class="dv">2</span>, <span class="op">**</span>kwargs):</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>export_graphviz(t, out_file<span class="op">=</span><span class="va">None</span>, feature_names<span class="op">=</span>df.columns, filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                      special_characters<span class="op">=</span><span class="va">True</span>, rotate<span class="op">=</span><span class="va">False</span>, precision<span class="op">=</span>precision, <span class="op">**</span>kwargs)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> graphviz.Source(re.sub(<span class="st">'Tree {'</span>, <span class="ss">f'Tree </span><span class="ch">{{</span><span class="ss"> size=</span><span class="sc">{</span>size<span class="sc">}</span><span class="ss">; ratio=</span><span class="sc">{</span>ratio<span class="sc">}</span><span class="ss">'</span>, s))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>draw_tree(m, trn_xs, size<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="how-is-gini-different-from-impurity" class="level2">
<h2 class="anchored" data-anchor-id="how-is-gini-different-from-impurity">how is gini different from impurity</h2>
<p>We can see that it’s found exactly the same splits as we did!</p>
<p>In this picture, the more orange nodes have a lower survival rate, and blue have higher survival. Each node shows how many rows (“<em>samples</em>”) match that set of rules, and shows how many perish or survive (“<em>values</em>”). There’s also something called “<em>gini</em>”. That’s another measure of impurity, and it’s very similar to the <code>score()</code> we created earlier. It’s defined as follows:</p>
<section id="how-to-cacl-gini" class="level3">
<h3 class="anchored" data-anchor-id="how-to-cacl-gini">how to cacl gini</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gini(cond):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    act <span class="op">=</span> df.loc[cond, dep]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> act.mean()<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>act).mean()<span class="op">**</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What this calculates is the probability that, if you pick two rows from a group, you’ll get the same <code>Survived</code> result each time. If the group is all the same, the probability is <code>1.0</code>, and <code>0.0</code> if they’re all different:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gini(df.Sex<span class="op">==</span><span class="st">'female'</span>), gini(df.Sex<span class="op">==</span><span class="st">'male'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how this model compares to our OneR version:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, m.predict(val_xs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s a tiny bit worse. Since this is such a small dataset (we’ve only got around 200 rows in our validation set) this small difference isn’t really meaningful. Perhaps we’ll see better results if we create a bigger tree:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> DecisionTreeClassifier(min_samples_leaf<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>m.fit(trn_xs, trn_y)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>draw_tree(m, trn_xs, size<span class="op">=</span><span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, m.predict(val_xs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-wrap-the-process-of-preparing-submission-csv-file-for-kaggle" class="level3">
<h3 class="anchored" data-anchor-id="how-to-wrap-the-process-of-preparing-submission-csv-file-for-kaggle">how to wrap the process of preparing submission csv file for kaggle</h3>
<p>It looks like this is an improvement, although again it’s a bit hard to tell with small datasets like this. Let’s try submitting it to Kaggle:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tst_df[cats] <span class="op">=</span> tst_df[cats].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.cat.codes)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>tst_xs,_ <span class="op">=</span> xs_y(tst_df)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> subm(preds, suff):</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    tst_df[<span class="st">'Survived'</span>] <span class="op">=</span> preds</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    sub_df <span class="op">=</span> tst_df[[<span class="st">'PassengerId'</span>,<span class="st">'Survived'</span>]]</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    sub_df.to_csv(<span class="ss">f'sub-</span><span class="sc">{</span>suff<span class="sc">}</span><span class="ss">.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>subm(m.predict(tst_xs), <span class="st">'tree'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="why-no-need-to-worry-about-dummy-variables-in-decision-trees" class="level3">
<h3 class="anchored" data-anchor-id="why-no-need-to-worry-about-dummy-variables-in-decision-trees">why no need to worry about dummy variables in decision trees</h3>
<p>When I submitted this, I got a score of 0.765, which isn’t as good as our linear models or most of our neural nets, but it’s pretty close to those results.</p>
<p>Hopefully you can now see why we didn’t really need to create dummy variables, but instead just converted the labels into numbers using some (potentially arbitary) ordering of categories. For instance, here’s how the first few items of <code>Embarked</code> are labeled:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df.Embarked.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…resulting in these integer codes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.Embarked.cat.codes.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So let’s say we wanted to split into “C” in one group, vs “Q” or “S” in the other group. Then we just have to split on codes <code>&lt;=0</code> (since <code>C</code> is mapped to category <code>0</code>). Note that if we wanted to split into “Q” in one group, we’d need to use two binary splits, first to separate “C” from “Q” and “S”, and then a second split to separate “Q” from “S”. For this reason, sometimes it can still be helpful to use dummy variables for categorical variables with few levels (like this one).</p>
<p>In practice, I often use dummy variables for &lt;4 levels, and numeric codes for &gt;=4 levels.</p>
</section>
</section>
<section id="the-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="the-random-forest">The random forest</h2>
<section id="what-is-random-forest-what-is-bagging-what-is-the-great-insight-behind-it" class="level3">
<h3 class="anchored" data-anchor-id="what-is-random-forest-what-is-bagging-what-is-the-great-insight-behind-it">what is random forest; what is bagging; what is the great insight behind it</h3>
<p>We can’t make the decision tree much bigger than the example above, since some leaf nodes already have only 50 rows in them. That’s not a lot of data to make a prediction.</p>
<p>So how could we use bigger trees? One big insight came from Leo Breiman: what if we create lots of bigger trees, and take the average of their predictions? Taking the average prediction of a bunch of models in this way is known as <a href="https://link.springer.com/article/10.1007/BF00058655">bagging</a>.</p>
<p>The idea is that we want each model’s predictions in the averaged ensemble to be uncorrelated with each other model. That way, if we average the predictions, the average will be equal to the true target value – that’s because the average of lots of uncorrelated random errors is zero. That’s quite an amazing insight!</p>
<p>One way we can create a bunch of uncorrelated models is to train each of them on a different random subset of the data. Here’s how we can create a tree on a random subset of the data:</p>
</section>
<section id="how-to-create-uncorrelated-trees-using-random-subset-of-data" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-uncorrelated-trees-using-random-subset-of-data">how to create uncorrelated trees using random subset of data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_tree(prop<span class="op">=</span><span class="fl">0.75</span>):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(trn_y)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> random.choice(n, <span class="bu">int</span>(n<span class="op">*</span>prop))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> DecisionTreeClassifier(min_samples_leaf<span class="op">=</span><span class="dv">5</span>).fit(trn_xs.iloc[idxs], trn_y.iloc[idxs])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can create as many trees as we want:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>trees <span class="op">=</span> [get_tree() <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-make-prediciton-on-each-tree-and-take-average-on-them-and-then-calc-the-loss" class="level3">
<h3 class="anchored" data-anchor-id="how-to-make-prediciton-on-each-tree-and-take-average-on-them-and-then-calc-the-loss">how to make prediciton on each tree and take average on them, and then calc the loss</h3>
<p>Our prediction will be the average of these trees’ predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>all_probs <span class="op">=</span> [t.predict(val_xs) <span class="cf">for</span> t <span class="kw">in</span> trees]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>avg_probs <span class="op">=</span> np.stack(all_probs).mean(<span class="dv">0</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, avg_probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-is-sklearns-randomforestclassifier-differ-from-the-forest-from-scratch-above-how-to-do-random-forest-with-sklearn" class="level3">
<h3 class="anchored" data-anchor-id="how-is-sklearns-randomforestclassifier-differ-from-the-forest-from-scratch-above-how-to-do-random-forest-with-sklearn">how is sklearn’s RandomForestClassifier differ from the forest from scratch above; how to do random forest with sklearn</h3>
<p>This is nearly identical to what <code>sklearn</code>’s <code>RandomForestClassifier</code> does. The main extra piece in a “real” random forest is that as well as choosing a random sample of data for each tree, it also picks a random subset of columns for each split. Here’s how we repeat the above process with a random forest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="dv">100</span>, min_samples_leaf<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>rf.fit(trn_xs, trn_y)<span class="op">;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(val_y, rf.predict(val_xs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can submit that to Kaggle too:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>subm(rf.predict(tst_xs), <span class="st">'rf'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I found that gave nearly an identical result as our single tree (which, in turn, was slightly lower than our linear and neural net models in the previous notebook).</p>
<p>One particularly nice feature of random forests is they can tell us which independent variables were the most important in the model, using <code>feature_importances_</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(<span class="bu">dict</span>(cols<span class="op">=</span>trn_xs.columns, imp<span class="op">=</span>m.feature_importances_)).plot(<span class="st">'cols'</span>, <span class="st">'imp'</span>, <span class="st">'barh'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that <code>Sex</code> is by far the most important predictor, with <code>Pclass</code> a distant second, and <code>LogFare</code> and <code>Age</code> behind that. In datasets with many columns, I generally recommend creating a feature importance plot as soon as possible, in order to find which columns are worth studying more closely. (Note also that we didn’t really need to take the <code>log()</code> of <code>Fare</code>, since random forests only care about order, and <code>log()</code> doesn’t change the order – we only did it to make our graphs earlier easier to read.)</p>
<p>For details about deriving and understanding feature importances, and the many other important diagnostic tools provided by random forests, take a look at <a href="https://github.com/fastai/fastbook/blob/master/08_collab.ipynb">chapter 8</a> of <a href="https://www.amazon.com/Deep-Learning-Coders-fastai-PyTorch/dp/1492045527">our book</a>.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<section id="how-should-we-think-of-simple-models-like-oner-and-decision-tree-and-randomforest" class="level3">
<h3 class="anchored" data-anchor-id="how-should-we-think-of-simple-models-like-oner-and-decision-tree-and-randomforest">how should we think of simple models like OneR and decision tree and randomforest</h3>
<p>So what can we take away from all this?</p>
<p>I think the first thing I’d note from this is that, clearly, more complex models aren’t always better. Our “OneR” model, consisting of a single binary split, was nearly as good as our more complex models. Perhaps in practice a simple model like this might be much easier to use, and could be worth considering. Our random forest wasn’t an improvement on the single decision tree at all.</p>
<p>So we should always be careful to benchmark simple models, as see if they’re good enough for our needs. In practice, you will often find that simple models will have trouble providing adequate accuracy for more complex tasks, such as recommendation systems, NLP, computer vision, or multivariate time series. But there’s no need to guess – it’s so easy to try a few different models, there’s no reason not to give the simpler ones a go too!</p>
<p>Another thing I think we can take away is that random forests aren’t actually that complicated at all. We were able to implement the key features of them in a notebook quite quickly. And they aren’t sensitive to issues like normalization, interactions, or non-linear transformations, which make them extremely easy to work with, and hard to mess up!</p>
<p>If you found this notebook useful, please remember to click the little up-arrow at the top to upvote it, since I like to know when people have found my work useful, and it helps others find it too. (BTW, be sure you’re looking at my <a href="https://www.kaggle.com/jhoward/how-random-forests-work">original notebook here</a> when you do that, and are not on your own copy of it, otherwise your upvote won’t get counted!) And if you have any questions or comments, please pop them below – I read every comment I receive!</p>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>