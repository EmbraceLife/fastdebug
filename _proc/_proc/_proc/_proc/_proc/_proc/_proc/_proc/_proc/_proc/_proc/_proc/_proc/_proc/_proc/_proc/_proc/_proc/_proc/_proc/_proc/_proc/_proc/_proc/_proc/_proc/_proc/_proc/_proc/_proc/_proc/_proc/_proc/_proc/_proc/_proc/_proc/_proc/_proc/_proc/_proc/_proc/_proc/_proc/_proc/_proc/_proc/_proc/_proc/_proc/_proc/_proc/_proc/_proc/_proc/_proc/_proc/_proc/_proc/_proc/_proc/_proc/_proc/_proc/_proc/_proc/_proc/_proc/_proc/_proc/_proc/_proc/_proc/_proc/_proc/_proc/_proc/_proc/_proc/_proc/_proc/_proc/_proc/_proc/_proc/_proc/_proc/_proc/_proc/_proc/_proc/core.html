<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="the core functionalities of fastdebug">

<title>fastdebug - core</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="fastdebug - core">
<meta property="og:description" content="the core functionalities of fastdebug">
<meta property="og:site-name" content="fastdebug">
<meta name="twitter:title" content="fastdebug - core">
<meta name="twitter:description" content="the core functionalities of fastdebug">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">fastdebug</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EmbraceLife/fastdebug"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">core</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">fastdebug</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link active">core</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FixSigMeta.html" class="sidebar-item-text sidebar-link">FixSigMeta</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#make-life-easier-with-defaults" id="toc-make-life-easier-with-defaults" class="nav-link active" data-scroll-target="#make-life-easier-with-defaults">make life easier with defaults</a></li>
  <li><a href="#globals-and-locals" id="toc-globals-and-locals" class="nav-link" data-scroll-target="#globals-and-locals">globals() and locals()</a></li>
  <li><a href="#execute-strings" id="toc-execute-strings" class="nav-link" data-scroll-target="#execute-strings">Execute strings</a>
  <ul>
  <li><a href="#new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" id="toc-new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" class="nav-link" data-scroll-target="#new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals">new variable or updated variable by exec will only be accessible from locals()</a></li>
  <li><a href="#eval-can-override-its-own-globals-and-locals" id="toc-eval-can-override-its-own-globals-and-locals" class="nav-link" data-scroll-target="#eval-can-override-its-own-globals-and-locals">eval can override its own globals() and locals()</a></li>
  <li><a href="#when-exec-update-existing-functions" id="toc-when-exec-update-existing-functions" class="nav-link" data-scroll-target="#when-exec-update-existing-functions">when exec update existing functions</a></li>
  <li><a href="#when-the-func-to-be-udpated-involve-other-libraries" id="toc-when-the-func-to-be-udpated-involve-other-libraries" class="nav-link" data-scroll-target="#when-the-func-to-be-udpated-involve-other-libraries">when the func to be udpated involve other libraries</a></li>
  <li><a href="#inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" id="toc-inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" class="nav-link" data-scroll-target="#inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace">inside a function, exec() allow won’t give you necessary env from function namespace</a></li>
  <li><a href="#magic-of-execb-globals.updatelocals" id="toc-magic-of-execb-globals.updatelocals" class="nav-link" data-scroll-target="#magic-of-execb-globals.updatelocals">magic of <code>exec(b, globals().update(locals()))</code></a></li>
  <li><a href="#bring-variables-from-a-func-namespace-to-the-sideout-world" id="toc-bring-variables-from-a-func-namespace-to-the-sideout-world" class="nav-link" data-scroll-target="#bring-variables-from-a-func-namespace-to-the-sideout-world">Bring variables from a func namespace to the sideout world</a></li>
  <li><a href="#globals-in-a-cell-vs-globals-in-a-func" id="toc-globals-in-a-cell-vs-globals-in-a-func" class="nav-link" data-scroll-target="#globals-in-a-cell-vs-globals-in-a-func">globals() in a cell vs globals() in a func</a></li>
  </ul></li>
  <li><a href="#make-a-colorful-string" id="toc-make-a-colorful-string" class="nav-link" data-scroll-target="#make-a-colorful-string">make a colorful string</a>
  <ul>
  <li><a href="#dbcolors" id="toc-dbcolors" class="nav-link" data-scroll-target="#dbcolors">dbcolors</a></li>
  <li><a href="#colorize" id="toc-colorize" class="nav-link" data-scroll-target="#colorize">colorize</a></li>
  </ul></li>
  <li><a href="#align-text-to-the-most-right" id="toc-align-text-to-the-most-right" class="nav-link" data-scroll-target="#align-text-to-the-most-right">align text to the most right</a>
  <ul>
  <li><a href="#strip_ansi" id="toc-strip_ansi" class="nav-link" data-scroll-target="#strip_ansi">strip_ansi</a></li>
  <li><a href="#alignright" id="toc-alignright" class="nav-link" data-scroll-target="#alignright">alignright</a></li>
  </ul></li>
  <li><a href="#printsrcwithidx" id="toc-printsrcwithidx" class="nav-link" data-scroll-target="#printsrcwithidx">printsrcwithidx</a>
  <ul>
  <li><a href="#print-the-entire-source-code-with-idx-from-0" id="toc-print-the-entire-source-code-with-idx-from-0" class="nav-link" data-scroll-target="#print-the-entire-source-code-with-idx-from-0">print the entire source code with idx from 0</a></li>
  <li><a href="#print-the-whole-src-with-idx-or-print-them-in-parts" id="toc-print-the-whole-src-with-idx-or-print-them-in-parts" class="nav-link" data-scroll-target="#print-the-whole-src-with-idx-or-print-them-in-parts">print the whole src with idx or print them in parts</a></li>
  <li><a href="#use-cmts-from-dbprint-to-print-out-src-with-comments" id="toc-use-cmts-from-dbprint-to-print-out-src-with-comments" class="nav-link" data-scroll-target="#use-cmts-from-dbprint-to-print-out-src-with-comments">use cmts from dbprint to print out src with comments</a></li>
  <li><a href="#printsrcwithidx-1" id="toc-printsrcwithidx-1" class="nav-link" data-scroll-target="#printsrcwithidx-1">printsrcwithidx</a></li>
  <li><a href="#no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" id="toc-no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" class="nav-link" data-scroll-target="#no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print">no more update for printsrcwithidx, for the latest see Fastdb.print</a></li>
  </ul></li>
  <li><a href="#print-out-src-code" id="toc-print-out-src-code" class="nav-link" data-scroll-target="#print-out-src-code">print out src code</a>
  <ul>
  <li><a href="#basic-version" id="toc-basic-version" class="nav-link" data-scroll-target="#basic-version">basic version</a></li>
  <li><a href="#print-src-with-specific-number-of-lines" id="toc-print-src-with-specific-number-of-lines" class="nav-link" data-scroll-target="#print-src-with-specific-number-of-lines">print src with specific number of lines</a></li>
  <li><a href="#make-the-naming-more-sensible" id="toc-make-the-naming-more-sensible" class="nav-link" data-scroll-target="#make-the-naming-more-sensible">make the naming more sensible</a></li>
  <li><a href="#allow-a-dbline-occur-more-than-once" id="toc-allow-a-dbline-occur-more-than-once" class="nav-link" data-scroll-target="#allow-a-dbline-occur-more-than-once">Allow a dbline occur more than once</a></li>
  <li><a href="#adding-idx-to-the-selected-srclines" id="toc-adding-idx-to-the-selected-srclines" class="nav-link" data-scroll-target="#adding-idx-to-the-selected-srclines">adding idx to the selected srclines</a>
  <ul class="collapse">
  <li><a href="#printsrclinewithidx" id="toc-printsrclinewithidx" class="nav-link" data-scroll-target="#printsrclinewithidx">printsrclinewithidx</a></li>
  </ul></li>
  <li><a href="#printsrclinewithidx-1" id="toc-printsrclinewithidx-1" class="nav-link" data-scroll-target="#printsrclinewithidx-1">printsrclinewithidx</a></li>
  <li><a href="#dblines-can-be-string-of-code-or-idx-number" id="toc-dblines-can-be-string-of-code-or-idx-number" class="nav-link" data-scroll-target="#dblines-can-be-string-of-code-or-idx-number">dblines can be string of code or idx number</a></li>
  <li><a href="#avoid-multi-occurrance-of-the-same-srcline" id="toc-avoid-multi-occurrance-of-the-same-srcline" class="nav-link" data-scroll-target="#avoid-multi-occurrance-of-the-same-srcline">avoid multi-occurrance of the same srcline</a></li>
  <li><a href="#printsrc" id="toc-printsrc" class="nav-link" data-scroll-target="#printsrc">printsrc</a></li>
  </ul></li>
  <li><a href="#dbprint-on-expression" id="toc-dbprint-on-expression" class="nav-link" data-scroll-target="#dbprint-on-expression">dbprint on expression</a>
  <ul>
  <li><a href="#basic-version-1" id="toc-basic-version-1" class="nav-link" data-scroll-target="#basic-version-1">basic version</a></li>
  <li><a href="#insert-dbcode-and-make-a-new-dbfunc" id="toc-insert-dbcode-and-make-a-new-dbfunc" class="nav-link" data-scroll-target="#insert-dbcode-and-make-a-new-dbfunc">insert dbcode and make a new dbfunc</a></li>
  <li><a href="#bring-outside-namespace-variables-into-exec" id="toc-bring-outside-namespace-variables-into-exec" class="nav-link" data-scroll-target="#bring-outside-namespace-variables-into-exec">Bring outside namespace variables into exec()</a></li>
  <li><a href="#bring-what-inside-the-func-namespace-variables-to-the-outside-world" id="toc-bring-what-inside-the-func-namespace-variables-to-the-outside-world" class="nav-link" data-scroll-target="#bring-what-inside-the-func-namespace-variables-to-the-outside-world">Bring what inside the func namespace variables to the outside world</a></li>
  <li><a href="#adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" id="toc-adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" class="nav-link" data-scroll-target="#adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually">Adding g = locals() to dbprintinsert to avoid adding env individually</a></li>
  <li><a href="#enable-srclines-to-be-either-string-or-int" id="toc-enable-srclines-to-be-either-string-or-int" class="nav-link" data-scroll-target="#enable-srclines-to-be-either-string-or-int">enable srclines to be either string or int</a></li>
  <li><a href="#enable-to-be-used-as-assignment-in-codes" id="toc-enable-to-be-used-as-assignment-in-codes" class="nav-link" data-scroll-target="#enable-to-be-used-as-assignment-in-codes">enable = to be used as assignment in codes</a></li>
  <li><a href="#avoid-adding-envg-for-dbprintinsert" id="toc-avoid-adding-envg-for-dbprintinsert" class="nav-link" data-scroll-target="#avoid-adding-envg-for-dbprintinsert">avoid adding “env=g” for dbprintinsert</a></li>
  <li><a href="#collect-cmt-for-later-printsrcwithidx-to-print-comments-together" id="toc-collect-cmt-for-later-printsrcwithidx-to-print-comments-together" class="nav-link" data-scroll-target="#collect-cmt-for-later-printsrcwithidx-to-print-comments-together">collect cmt for later printsrcwithidx to print comments together</a></li>
  <li><a href="#make-sure-only-one-line-with-correct-idx-is-debugged" id="toc-make-sure-only-one-line-with-correct-idx-is-debugged" class="nav-link" data-scroll-target="#make-sure-only-one-line-with-correct-idx-is-debugged">make sure only one line with correct idx is debugged</a></li>
  <li><a href="#dbprint" id="toc-dbprint" class="nav-link" data-scroll-target="#dbprint">dbprint</a></li>
  <li><a href="#avoid-typing-when-there-is-no-codes" id="toc-avoid-typing-when-there-is-no-codes" class="nav-link" data-scroll-target="#avoid-typing-when-there-is-no-codes">avoid typing “” when there is no codes</a></li>
  <li><a href="#no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" id="toc-no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" class="nav-link" data-scroll-target="#no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint">no more update for dbprint, for the latest see Fastdb.dbprint</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" class="nav-link" data-scroll-target="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile">use dbprint to override the original official code without changing its own pyfile</a></li>
  </ul></li>
  <li><a href="#dbprintinsert" id="toc-dbprintinsert" class="nav-link" data-scroll-target="#dbprintinsert">dbprintinsert</a>
  <ul>
  <li><a href="#run-and-display-the-inserted-dbcodes" id="toc-run-and-display-the-inserted-dbcodes" class="nav-link" data-scroll-target="#run-and-display-the-inserted-dbcodes">Run and display the inserted dbcodes</a></li>
  <li><a href="#use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" id="toc-use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" class="nav-link" data-scroll-target="#use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually">use locals() inside the dbsrc code to avoid adding env individually</a></li>
  <li><a href="#enable-dbprintinsert-to-do-exec-on-a-block-of-code" id="toc-enable-dbprintinsert-to-do-exec-on-a-block-of-code" class="nav-link" data-scroll-target="#enable-dbprintinsert-to-do-exec-on-a-block-of-code">enable dbprintinsert to do exec on a block of code</a></li>
  <li><a href="#dbprintinsert-1" id="toc-dbprintinsert-1" class="nav-link" data-scroll-target="#dbprintinsert-1">dbprintinsert</a></li>
  </ul></li>
  <li><a href="#printrunsrclines" id="toc-printrunsrclines" class="nav-link" data-scroll-target="#printrunsrclines">printrunsrclines()</a>
  <ul>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#simple-example" id="toc-simple-example" class="nav-link" data-scroll-target="#simple-example">simple example</a></li>
  <li><a href="#complex-example" id="toc-complex-example" class="nav-link" data-scroll-target="#complex-example">complex example</a></li>
  </ul></li>
  <li><a href="#insert-a-line-after-each-srcline-to-add-idx" id="toc-insert-a-line-after-each-srcline-to-add-idx" class="nav-link" data-scroll-target="#insert-a-line-after-each-srcline-to-add-idx">insert a line after each srcline to add idx</a></li>
  <li><a href="#add-correct-indentation-to-each-inserted-line" id="toc-add-correct-indentation-to-each-inserted-line" class="nav-link" data-scroll-target="#add-correct-indentation-to-each-inserted-line">add correct indentation to each inserted line</a>
  <ul class="collapse">
  <li><a href="#count-the-indentation-for-each-srcline" id="toc-count-the-indentation-for-each-srcline" class="nav-link" data-scroll-target="#count-the-indentation-for-each-srcline">count the indentation for each srcline</a></li>
  </ul></li>
  <li><a href="#indentation-special-case-if-else-for-def" id="toc-indentation-special-case-if-else-for-def" class="nav-link" data-scroll-target="#indentation-special-case-if-else-for-def">indentation special case: if, else, for, def</a></li>
  <li><a href="#remove-pure-comments-or-docs-from-dbsrc" id="toc-remove-pure-comments-or-docs-from-dbsrc" class="nav-link" data-scroll-target="#remove-pure-comments-or-docs-from-dbsrc">remove pure comments or docs from dbsrc</a></li>
  <li><a href="#print-out-the-srclines-which-get-run" id="toc-print-out-the-srclines-which-get-run" class="nav-link" data-scroll-target="#print-out-the-srclines-which-get-run">print out the srclines which get run</a></li>
  <li><a href="#make-sure-all-if-else-for-get-printed" id="toc-make-sure-all-if-else-for-get-printed" class="nav-link" data-scroll-target="#make-sure-all-if-else-for-get-printed">Make sure all if, else, for get printed</a></li>
  <li><a href="#put-all-together-into-the-function-printrunsrclines" id="toc-put-all-together-into-the-function-printrunsrclines" class="nav-link" data-scroll-target="#put-all-together-into-the-function-printrunsrclines">Put all together into the function printrunsrclines()</a>
  <ul class="collapse">
  <li><a href="#no-more-renaming-of-foo" id="toc-no-more-renaming-of-foo" class="nav-link" data-scroll-target="#no-more-renaming-of-foo">no more renaming of foo</a></li>
  <li><a href="#add-example-as-a-param-into-the-function" id="toc-add-example-as-a-param-into-the-function" class="nav-link" data-scroll-target="#add-example-as-a-param-into-the-function">add example as a param into the function</a></li>
  </ul></li>
  <li><a href="#printrunsrclines-1" id="toc-printrunsrclines-1" class="nav-link" data-scroll-target="#printrunsrclines-1">printrunsrclines</a>
  <ul class="collapse">
  <li><a href="#improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" id="toc-improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" class="nav-link" data-scroll-target="#improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples">improve on search for <code>if</code>, else, for, def to avoid errors for more examples</a></li>
  <li><a href="#remove-an-empty-line-with-indentation" id="toc-remove-an-empty-line-with-indentation" class="nav-link" data-scroll-target="#remove-an-empty-line-with-indentation">remove an empty line with indentation</a></li>
  </ul></li>
  <li><a href="#make-it-work" id="toc-make-it-work" class="nav-link" data-scroll-target="#make-it-work">make it work</a></li>
  <li><a href="#printrunsrclines-2" id="toc-printrunsrclines-2" class="nav-link" data-scroll-target="#printrunsrclines-2">printrunsrclines</a></li>
  <li><a href="#more-difficult-examples-to-test-printrunsrc" id="toc-more-difficult-examples-to-test-printrunsrc" class="nav-link" data-scroll-target="#more-difficult-examples-to-test-printrunsrc">more difficult examples to test printrunsrc()</a></li>
  </ul></li>
  <li><a href="#make-fastdebug-a-class" id="toc-make-fastdebug-a-class" class="nav-link" data-scroll-target="#make-fastdebug-a-class">Make fastdebug a class</a>
  <ul>
  <li><a href="#improve-on-the-line-idx-readability" id="toc-improve-on-the-line-idx-readability" class="nav-link" data-scroll-target="#improve-on-the-line-idx-readability">improve on the line idx readability</a></li>
  <li><a href="#collect-cmt-from-dbprint-and-print" id="toc-collect-cmt-from-dbprint-and-print" class="nav-link" data-scroll-target="#collect-cmt-from-dbprint-and-print">collect cmt from dbprint and print</a></li>
  <li><a href="#make-sure-only-the-line-with-correct-idx-is-debugged" id="toc-make-sure-only-the-line-with-correct-idx-is-debugged" class="nav-link" data-scroll-target="#make-sure-only-the-line-with-correct-idx-is-debugged">make sure only the line with correct idx is debugged</a></li>
  <li><a href="#having-or-inside-codes-without-causing-error" id="toc-having-or-inside-codes-without-causing-error" class="nav-link" data-scroll-target="#having-or-inside-codes-without-causing-error">having “” or ” ” inside codes without causing error</a></li>
  <li><a href="#replace-fastdb.printsrcwithdix-with-fastdb.print" id="toc-replace-fastdb.printsrcwithdix-with-fastdb.print" class="nav-link" data-scroll-target="#replace-fastdb.printsrcwithdix-with-fastdb.print">replace Fastdb.printsrcwithdix with Fastdb.print</a></li>
  <li><a href="#add-idx-to-dbsrc-when-showdbsrctrue" id="toc-add-idx-to-dbsrc-when-showdbsrctrue" class="nav-link" data-scroll-target="#add-idx-to-dbsrc-when-showdbsrctrue">add idx to dbsrc when showdbsrc=True</a></li>
  <li><a href="#not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages" id="toc-not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages" class="nav-link" data-scroll-target="#not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages">not load the inner locals() to outenv can prevent mysterious printing of previous db messages</a></li>
  <li><a href="#using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print" id="toc-using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print" class="nav-link" data-scroll-target="#using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print">using <span class="citation" data-cites="patch">@patch</span> to enable docs for instance methods like <code>dbprint</code> and <code>print</code></a></li>
  <li><a href="#fastdb" id="toc-fastdb" class="nav-link" data-scroll-target="#fastdb">Fastdb</a></li>
  <li><a href="#fastdb.dbprint" id="toc-fastdb.dbprint" class="nav-link" data-scroll-target="#fastdb.dbprint">Fastdb.dbprint</a></li>
  <li><a href="#fastdb.print" id="toc-fastdb.print" class="nav-link" data-scroll-target="#fastdb.print">Fastdb.print</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" class="nav-link" data-scroll-target="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1">use dbprint to override the original official code without changing its own pyfile</a></li>
  <li><a href="#use-guide-on-fastdb.dbprint" id="toc-use-guide-on-fastdb.dbprint" class="nav-link" data-scroll-target="#use-guide-on-fastdb.dbprint">use guide on Fastdb.dbprint</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/EmbraceLife/fastdebug/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">core</h1>
</div>

<div>
  <div class="description">
    the core functionalities of fastdebug
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="make-life-easier-with-defaults" class="level2">
<h2 class="anchored" data-anchor-id="make-life-easier-with-defaults">make life easier with defaults</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>defaults <span class="op">=</span> <span class="bu">type</span>(<span class="st">'defaults'</span>, (<span class="bu">object</span>,), {<span class="st">'margin'</span>: <span class="dv">157</span>, <span class="co"># align to the right by 157</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'orisrc'</span>: <span class="va">None</span>, <span class="co"># keep a copy of original official src code</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'outenv'</span>: <span class="bu">globals</span>(), <span class="co"># outside global env</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'cmts'</span>: {} <span class="co"># a dict to store idx and cmt</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># 'eg': None, # examples</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># 'src': None, # official src</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                                       })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="globals-and-locals" class="level2">
<h2 class="anchored" data-anchor-id="globals-and-locals">globals() and locals()</h2>
<p>Interesting behavior of <a href="https://stackoverflow.com/questions/7969949/whats-the-difference-between-globals-locals-and-vars">locals()</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">locals</span>() <span class="op">==</span> <span class="bu">globals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">"functools"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">"inspect"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">"eval"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">"defaults"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">"whatinside"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">"whichversion"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">"whatinside"</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">"whichversion"</span> <span class="kw">in</span> <span class="bu">globals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
</section>
<section id="execute-strings" class="level2">
<h2 class="anchored" data-anchor-id="execute-strings">Execute strings</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span>?</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> eval<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">,</span> globals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> locals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">/</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Evaluate the given source in the context of globals and locals.
The source may be a string representing a Python expression
or a code object as returned by compile().
The globals must be a dictionary and locals can be any mapping,
defaulting to the current globals and locals.
If only globals is given, locals defaults to it.
<span class="ansi-red-fg">Type:</span>      builtin_function_or_method
</pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>?</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> exec<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">,</span> globals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> locals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">/</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Execute the given source in the context of globals and locals.
The source may be a string representing one or more Python statements
or a code object as returned by compile().
The globals must be a dictionary and locals can be any mapping,
defaulting to the current globals and locals.
If only globals is given, locals defaults to it.
<span class="ansi-red-fg">Type:</span>      builtin_function_or_method
</pre>
</div>
</div>
</div>
<section id="new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" class="level3">
<h3 class="anchored" data-anchor-id="new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals">new variable or updated variable by exec will only be accessible from locals()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"1+x"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># x is not in locals() but in globals()</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">eval</span>(a)) </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>test()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'a': '1+x'}"
2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"b = 1+x"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b) <span class="co"># b can't be accessed directly and not use the key b</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'a': 'b = 1+x'}
exec(a): None
{'a': 'b = 1+x', 'b': 2}
name 'b' is not defined</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"b = 1+x"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'b'</span>] <span class="co"># you can't even assign the value to b, otherwise b:value won't be available</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"KeyError: 'b' does not exist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'a': 'b = 1+x'}
exec(a): None
{'a': 'b = 1+x'}
KeyError: 'b' does not exist</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"b = 1+x"</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'b'</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(c)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"KeyError: 'b' does not exist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'a': 'b = 1+x'}
exec(a): None
{'a': 'b = 1+x', 'b': 2}
2
{'a': 'b = 1+x', 'b': 2, 'c': 2}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"b = 1+x"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'b'</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'c = locals()["b"]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(c = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">"c = c + 1"</span>)<span class="sc">}</span><span class="ss">'</span>) <span class="co"># update c won't change anything</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>test()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'a': 'b = 1+x'}
exec(a): None
{'a': 'b = 1+x', 'b': 2}
c = locals()["b"]; c: 2
{'a': 'b = 1+x', 'b': 2, 'c': 2}
exec(c = c + 1): None
{'a': 'b = 1+x', 'b': 2, 'c': 2}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">"b = 1+x"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'b'</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'c = locals()["b"]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(d = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">"d = c + 1"</span>)<span class="sc">}</span><span class="ss">'</span>) <span class="co"># must assign to a different variable, not c anymore</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>test()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'a': 'b = 1+x'}
exec(a): None
{'a': 'b = 1+x', 'b': 2}
c = locals()["b"]; c: 2
{'a': 'b = 1+x', 'b': 2, 'c': 2}
exec(d = c + 1): None
{'a': 'b = 1+x', 'b': 2, 'c': 2, 'd': 3}</code></pre>
</div>
</div>
</section>
<section id="eval-can-override-its-own-globals-and-locals" class="level3">
<h3 class="anchored" data-anchor-id="eval-can-override-its-own-globals-and-locals">eval can override its own globals() and locals()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">"a+1"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'b: </span><span class="sc">{</span><span class="bu">eval</span>(b, {}, {<span class="st">"a"</span>: <span class="dv">2</span>})<span class="sc">}</span><span class="ss">'</span>) <span class="co"># globals() put to empty and locals() to include 'a' with a different value</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>test()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'a': 1, 'b': 'a+1'}"
b: 3
"locals: {'a': 1, 'b': 'a+1'}"</code></pre>
</div>
</div>
</section>
<section id="when-exec-update-existing-functions" class="level3">
<h3 class="anchored" data-anchor-id="when-exec-update-existing-functions">when exec update existing functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">""</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">" + 3</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">"foo"</span>]</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">"foo"</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'func': &lt;function foo at 0x1182fd670&gt;, 'a': 1, 'b': 'def foo(x, y): return x + y\\n', 'newb': 'def foo(x, y): return x + y + 3\\n', 'l': ''}"
exec(newb): None
("locals: {'func': &lt;function foo at 0x1182fd670&gt;, 'a': 1, 'b': 'def foo(x, y): return x + y\\n', 'newb': 'def foo(x, y): return x + y + 3\\n', 'l': '', "
 "'foo': &lt;function foo at 0x1182fd310&gt;}")
13
13
10
10</code></pre>
</div>
</div>
</section>
<section id="when-the-func-to-be-udpated-involve-other-libraries" class="level3">
<h3 class="anchored" data-anchor-id="when-the-func-to-be-udpated-involve-other-libraries">when the func to be udpated involve other libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inspect.signature(foo))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">""</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="st">"return"</span> <span class="kw">not</span> <span class="kw">in</span> l :</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l):</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">" + 3</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">"foo"</span>]</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">"foo"</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>("locals: {'func': &lt;function foo at 0x1182fdd30&gt;, 'a': 1, 'b': 'def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n', 'newb': 'def "
 "foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n', 'l': ''}")
exec(newb): None
("locals: {'func': &lt;function foo at 0x1182fdd30&gt;, 'a': 1, 'b': 'def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n', 'newb': 'def "
 "foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n', 'l': '', 'foo': &lt;function foo at 0x1182fd940&gt;}")
(x, y)
13
(x, y)
13
(x, y)
10
(x, y)
10</code></pre>
</div>
</div>
</section>
<section id="inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" class="level3">
<h3 class="anchored" data-anchor-id="inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace">inside a function, exec() allow won’t give you necessary env from function namespace</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">"def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y"</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b) <span class="co"># create the new add in locals</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'add(5,6): </span><span class="sc">{</span>add(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'add'</span>] <span class="co"># assign a different name, add1</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'add1(5,6): </span><span class="sc">{</span>add1(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">'</span>) <span class="co"># error: lst is not defined, even though lst=[] is right above</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'func': &lt;function add at 0x1182fdf70&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y'}"
("locals: {'func': &lt;function add at 0x1182fdf70&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y', 'add': &lt;function add at "
 '0x1183000d0&gt;}')
add(5,6): 1
name 'lst' is not defined</code></pre>
</div>
</div>
</section>
<section id="magic-of-execb-globals.updatelocals" class="level3">
<h3 class="anchored" data-anchor-id="magic-of-execb-globals.updatelocals">magic of <code>exec(b, globals().update(locals()))</code></h3>
<p>What about <code>exec(b, globals().update(globals()))</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">"def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y"</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">globals</span>())) <span class="co"># update(globals()) won't give us lst above</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'add'</span>] </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"exec(b, globals().update(globals())) won't give us lst in the func namespace"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'func': &lt;function add at 0x1183003a0&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y'}"
("locals: {'func': &lt;function add at 0x1183003a0&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y', 'add': &lt;function add at "
 '0x118300310&gt;}')
exec(b, globals().update(globals())) won't give us lst in the func namespace</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">"def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y"</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'add'</span>] </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(add(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"you can't bring add1 from a function namespace to the outside world"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'func': &lt;function add at 0x118300700&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y'}"
("locals: {'func': &lt;function add at 0x118300700&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y', 'add': &lt;function add at "
 '0x1183008b0&gt;}')
11
("locals: {'func': &lt;function add at 0x118300700&gt;, 'a': 1, 'lst': [5], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y', 'add': &lt;function add at "
 "0x1183008b0&gt;, 'add1': &lt;function add at 0x1183008b0&gt;}")
1
you can't bring add1 from a function namespace to the outside world</code></pre>
</div>
</div>
</section>
<section id="bring-variables-from-a-func-namespace-to-the-sideout-world" class="level3">
<h3 class="anchored" data-anchor-id="bring-variables-from-a-func-namespace-to-the-sideout-world">Bring variables from a func namespace to the sideout world</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">"def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y"</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)    </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'add'</span>] </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    add1(<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f'locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">'</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bring variables inside a func to the outside</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>pprint(add(<span class="dv">5</span>,<span class="dv">6</span>)) <span class="co"># the original add is override by the add from the function's locals()</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>pprint(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"locals: {'func': &lt;function add at 0x118300af0&gt;, 'a': 1, 'lst': [], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y'}"
11
("locals: {'func': &lt;function add at 0x118300af0&gt;, 'a': 1, 'lst': [5, 5], 'b': 'def add(x, y):\\n    lst.append(x)\\n    return x + y', 'add': &lt;function add "
 "at 0x118300700&gt;, 'add1': &lt;function add at 0x118300700&gt;}")
11
11
[5, 5, 5, 5]</code></pre>
</div>
</div>
</section>
<section id="globals-in-a-cell-vs-globals-in-a-func" class="level3">
<h3 class="anchored" data-anchor-id="globals-in-a-cell-vs-globals-in-a-func">globals() in a cell vs globals() in a func</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> tstenv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">globals</span>().keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>87</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">globals</span>()[<span class="st">'__name__'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'__main__'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tstenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>out global env has 20 vars
inner global env has 20 vars
inner local env has 20 vars
['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__file__', '__cached__', '__builtins__', '__all__', 'os']
['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__file__', '__cached__', '__builtins__', '__all__', 'os']
out env['__name__']: fastdebug.utils
inner env['__name__']: fastdebug.utils</code></pre>
</div>
</div>
</section>
</section>
<section id="make-a-colorful-string" class="level2">
<h2 class="anchored" data-anchor-id="make-a-colorful-string">make a colorful string</h2>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L26" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dbcolors" class="level3">
<h3 class="anchored" data-anchor-id="dbcolors">dbcolors</h3>
<blockquote class="blockquote">
<pre><code> dbcolors ()</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L33" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="colorize" class="level3">
<h3 class="anchored" data-anchor-id="colorize">colorize</h3>
<blockquote class="blockquote">
<pre><code> colorize (cmt, color:str=None)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>colorize(<span class="st">"this is me"</span>, <span class="st">"r"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'\x1b[91mthis is me\x1b[0m'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(colorize(<span class="st">"this is me"</span>, <span class="st">"r"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="align-text-to-the-most-right" class="level2">
<h2 class="anchored" data-anchor-id="align-text-to-the-most-right">align text to the most right</h2>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L47" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="strip_ansi" class="level3">
<h3 class="anchored" data-anchor-id="strip_ansi">strip_ansi</h3>
<blockquote class="blockquote">
<pre><code> strip_ansi (source)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> alignright(blocks):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> blocks.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    maxlen <span class="op">=</span> <span class="bu">max</span>(<span class="bu">map</span>(<span class="kw">lambda</span> l : <span class="bu">len</span>(strip_ansi(l)) , lst ))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> defaults.margin <span class="op">-</span> maxlen</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">' '</span><span class="op">*</span>indent <span class="op">+</span> <span class="bu">format</span>(l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L51" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="alignright" class="level3">
<h3 class="anchored" data-anchor-id="alignright">alignright</h3>
<blockquote class="blockquote">
<pre><code> alignright (blocks, margin:int=157)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>alignright(<span class="st">"this is me"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                   this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="printsrcwithidx" class="level2">
<h2 class="anchored" data-anchor-id="printsrcwithidx">printsrcwithidx</h2>
<section id="print-the-entire-source-code-with-idx-from-0" class="level3">
<h3 class="anchored" data-anchor-id="print-the-entire-source-code-with-idx-from-0">print the entire source code with idx from 0</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>        lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="print-the-whole-src-with-idx-or-print-them-in-parts" class="level3">
<h3 class="anchored" data-anchor-id="print-the-whole-src-with-idx-or-print-them-in-parts">print the whole src with idx or print them in parts</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                    maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                    part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-cmts-from-dbprint-to-print-out-src-with-comments" class="level3">
<h3 class="anchored" data-anchor-id="use-cmts-from-dbprint-to-print-out-src-with-comments">use cmts from dbprint to print out src with comments</h3>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L59" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printsrcwithidx-1" class="level3">
<h3 class="anchored" data-anchor-id="printsrcwithidx-1">printsrcwithidx</h3>
<blockquote class="blockquote">
<pre><code> printsrcwithidx (src, maxlines:int=33, part:int=0)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>maxlines</td>
<td>int</td>
<td>33</td>
<td>maximum num of lines per page</td>
</tr>
<tr class="odd">
<td>part</td>
<td>int</td>
<td>0</td>
<td>if the src is more than 33 lines, then divide the src by 33 into a few parts</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(foo)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(pprint)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" class="level3">
<h3 class="anchored" data-anchor-id="no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print">no more update for printsrcwithidx, for the latest see Fastdb.print</h3>
<p>see a <a href="./examples/dbprint.ipynb#test-printsrcwithidx">complex example</a> on printsrcwithidx</p>
</section>
</section>
<section id="print-out-src-code" class="level2">
<h2 class="anchored" data-anchor-id="print-out-src-code">print out src code</h2>
<section id="basic-version" class="level3">
<h3 class="anchored" data-anchor-id="basic-version">basic version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt):</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the title</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:#^157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="st">" srcline under investigation "</span>))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by '\n'</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l))</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>                numsrclines <span class="op">=</span> <span class="bu">len</span>(srclines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>) <span class="co"># colorize the comment</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: </span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">"a = 1 + 1"</span>, <span class="st">"this is comment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
                                                                                                                                              this is comment
    b = a + 1                                                                                                                                                
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">"    a = 1 + 1</span><span class="ch">\n</span><span class="st">    b = a + 1"</span>, <span class="st">"this is comment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
    b = a + 1================================================================================================================================================
                                                                                                                                              this is comment
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
</section>
<section id="print-src-with-specific-number-of-lines" class="level3">
<h3 class="anchored" data-anchor-id="print-src-with-specific-number-of-lines">print src with specific number of lines</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">"    this is a code</span><span class="ch">\n</span><span class="st">this is another code"</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), <span class="st">"    this is a code</span><span class="ch">\n</span><span class="st">    this is another code</span><span class="ch">\n</span><span class="st">   </span><span class="ch">\n</span><span class="st">   "</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by '\n'</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find out the idx of start srclines and end srclines</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    startidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    numsrclines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), srclines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>            startidx <span class="op">=</span> idx</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    endidx <span class="op">=</span> startidx <span class="op">+</span> numsrclines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation with # as padding</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l))</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>                <span class="co"># numsrclines = len(srclines.split("\n"))</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>) <span class="co"># colorize the comment</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startidx <span class="op">-</span> expand:</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> endidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> endidx:</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-the-naming-more-sensible" class="level3">
<h3 class="anchored" data-anchor-id="make-the-naming-more-sensible">make the naming more sensible</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    startdbidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>            startdbidx <span class="op">=</span> idx</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    enddbidx <span class="op">=</span> startdbidx <span class="op">+</span> numdblines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    dbcount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l))</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>            dbcount <span class="op">=</span> dbcount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dbcount <span class="op">==</span> numdblines:</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startdbidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startdbidx <span class="op">-</span> expand:</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) </span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> enddbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> enddbidx:</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="allow-a-dbline-occur-more-than-once" class="level3">
<h3 class="anchored" data-anchor-id="allow-a-dbline-occur-more-than-once">Allow a dbline occur more than once</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'idx: {idx}; and l: {l}') # debugging</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># enddbidx = startdbidx + numdblines - 1</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbcount = 0</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f'idx: {idx}; and l: {l}') # debugging</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l))</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># dbcount = dbcount + 1</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if dbcount == numdblines:</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>)</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx: </span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) </span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx: </span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;157}</span><span class="st">'</span>.<span class="bu">format</span>(l)) </span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=^157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f" The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> "</span>))</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-idx-to-the-selected-srclines" class="level3">
<h3 class="anchored" data-anchor-id="adding-idx-to-the-selected-srclines">adding idx to the selected srclines</h3>
<section id="printsrclinewithidx" class="level4">
<h4 class="anchored" data-anchor-id="printsrclinewithidx">printsrclinewithidx</h4>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L137" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="printsrclinewithidx-1" class="level3">
<h3 class="anchored" data-anchor-id="printsrclinewithidx-1">printsrclinewithidx</h3>
<blockquote class="blockquote">
<pre><code> printsrclinewithidx (idx, l, fill=' ')</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>             dblines,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">"="</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=^157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f" The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> "</span>))</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dblines-can-be-string-of-code-or-idx-number" class="level3">
<h3 class="anchored" data-anchor-id="dblines-can-be-string-of-code-or-idx-number">dblines can be string of code or idx number</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(<span class="bu">int</span>(<span class="st">"120"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>int</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(a) <span class="op">==</span> <span class="bu">int</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>             dbcode, <span class="co"># string of codes or int of code idx number</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    dblines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> lstsrc[dbcode]</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> dbcode</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>        numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))).count(<span class="va">True</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">"="</span>)</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">"r"</span>)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=^157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f" The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> "</span>))</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="avoid-multi-occurrance-of-the-same-srcline" class="level3">
<h3 class="anchored" data-anchor-id="avoid-multi-occurrance-of-the-same-srcline">avoid multi-occurrance of the same srcline</h3>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L144" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printsrc" class="level3">
<h3 class="anchored" data-anchor-id="printsrc">printsrc</h3>
<blockquote class="blockquote">
<pre><code> printsrc (src, dbcode, cmt, expand:int=2)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>name of src code such as foo, or delegates</td>
</tr>
<tr class="even">
<td>dbcode</td>
<td></td>
<td></td>
<td>string of codes or int of code idx number</td>
</tr>
<tr class="odd">
<td>cmt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>expand</td>
<td>int</td>
<td>2</td>
<td>expand the codes around the srcline under investigation</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"this is docs"</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">"else:"</span>, <span class="st">"this is comment"</span>, expand<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:===============================================================================================================================================(6)
                                                                                                                                              this is comment
        "this is docs"                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    "this is docs"                                                                                                                                      (9)
    return a                                                                                                                                            (10)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">"return a"</span>, <span class="st">"this is comment"</span>, expand<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    "this is docs"                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:                                                                                                                                               (6)
        "this is docs"                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    "this is docs"                                                                                                                                      (9)
    return a============================================================================================================================================(10)
                                                                                                                                              this is comment
                                                                                                                                                        (11)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="dv">3</span>, <span class="st">"this is comment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    "this is docs"                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:===========================================================================================================================================(3)
                                                                                                                                              this is comment
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)</code></pre>
</div>
</div>
<p>more <a href="./examples/printsrc.ipynb">complex example</a> on printsrc</p>
</section>
</section>
<section id="dbprint-on-expression" class="level2">
<h2 class="anchored" data-anchor-id="dbprint-on-expression">dbprint on expression</h2>
<section id="basic-version-1" class="level3">
<h3 class="anchored" data-anchor-id="basic-version-1">basic version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>code,   <span class="co"># a number of codes to run, each code is in str, e.g., "a + b", "c = a - b"</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>env</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"debug a srcline with one or more expressions with src printed."</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> code:</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"{c} =&gt; {c} : {eval(c, globals().update(env))}") </span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(output))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(): </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    dbprint(foo, <span class="st">"    a = 1 + 1"</span>, <span class="st">"this is a test"</span>, <span class="st">"1+2"</span>, <span class="st">"str(1+2)"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>foo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo():                                                                                                                                              (0)
    dbprint(foo, "    a = 1 + 1", "this is a test", "1+2", "str(1+2)")                                                                                  (1)
    a = 1 + 1===========================================================================================================================================(2)
                                                                                                                                               this is a test
    pass                                                                                                                                                (3)
                                                                                                                                                        (4)
                                                                                                                                               1+2 =&gt; 1+2 : 3
                                                                                                                                     str(1+2) =&gt; str(1+2) : 3</code></pre>
</div>
</div>
</section>
<section id="insert-dbcode-and-make-a-new-dbfunc" class="level3">
<h3 class="anchored" data-anchor-id="insert-dbcode-and-make-a-new-dbfunc">insert dbcode and make a new dbfunc</h3>
<p>when bringing back splitted lines back, we need add ‘’ back to them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>back <span class="op">=</span> <span class="st">""</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    back <span class="op">=</span> back <span class="op">+</span> l</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>pprint(back, width<span class="op">=</span><span class="dv">157</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'def foo():     dbprint(foo, "    a = 1 + 1", "this is a test", "1+2", "str(1+2)")    a = 1 + 1    pass'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span> <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">","</span></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc) <span class="co"># created new foo and saved inside locals()</span></span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(locals())</span></span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb106-76"><a href="#cb106-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-77"><a href="#cb106-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bring-outside-namespace-variables-into-exec" class="level3">
<h3 class="anchored" data-anchor-id="bring-outside-namespace-variables-into-exec">Bring outside namespace variables into exec()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb107-40"><a href="#cb107-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">","</span></span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb107-67"><a href="#cb107-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc) # created new foo and saved inside locals()</span></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc, globals().update(locals())) # make sure b can access lst from above</span></span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-80"><a href="#cb107-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bring-what-inside-the-func-namespace-variables-to-the-outside-world" class="level3">
<h3 class="anchored" data-anchor-id="bring-what-inside-the-func-namespace-variables-to-the-outside-world">Bring what inside the func namespace variables to the outside world</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">","</span></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>see a <a href="./examples/dbprint.ipynb">complex example</a> on dbprint</p>
</section>
<section id="adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" class="level3">
<h3 class="anchored" data-anchor-id="adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually">Adding g = locals() to dbprintinsert to avoid adding env individually</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">","</span></span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-49"><a href="#cb109-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb109-50"><a href="#cb109-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb109-51"><a href="#cb109-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-61"><a href="#cb109-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb109-62"><a href="#cb109-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb109-63"><a href="#cb109-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-64"><a href="#cb109-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb109-65"><a href="#cb109-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb109-66"><a href="#cb109-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb109-67"><a href="#cb109-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-68"><a href="#cb109-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb109-69"><a href="#cb109-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-70"><a href="#cb109-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb109-71"><a href="#cb109-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb109-72"><a href="#cb109-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb109-73"><a href="#cb109-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-74"><a href="#cb109-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb109-75"><a href="#cb109-75" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb109-76"><a href="#cb109-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-77"><a href="#cb109-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="enable-srclines-to-be-either-string-or-int" class="level3">
<h3 class="anchored" data-anchor-id="enable-srclines-to-be-either-string-or-int">enable srclines to be either string or int</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">in</span> c:</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">","</span></span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"="</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb110-74"><a href="#cb110-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-75"><a href="#cb110-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb110-76"><a href="#cb110-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-77"><a href="#cb110-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb110-78"><a href="#cb110-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb110-79"><a href="#cb110-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb110-80"><a href="#cb110-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-81"><a href="#cb110-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb110-82"><a href="#cb110-82" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb110-83"><a href="#cb110-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-84"><a href="#cb110-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="enable-to-be-used-as-assignment-in-codes" class="level3">
<h3 class="anchored" data-anchor-id="enable-to-be-used-as-assignment-in-codes">enable = to be used as assignment in codes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"env="</span> <span class="kw">in</span> c:</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count == len(codes) and "=" not in c:</span></span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + '"' + c + '"' + ")"</span></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and "=" in c:</span></span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + c + ","</span></span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and "=" not in c:</span></span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-76"><a href="#cb111-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb111-77"><a href="#cb111-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-78"><a href="#cb111-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb111-79"><a href="#cb111-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb111-80"><a href="#cb111-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb111-81"><a href="#cb111-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-82"><a href="#cb111-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb111-83"><a href="#cb111-83" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb111-84"><a href="#cb111-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-85"><a href="#cb111-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="avoid-adding-envg-for-dbprintinsert" class="level3">
<h3 class="anchored" data-anchor-id="avoid-adding-envg-for-dbprintinsert">avoid adding “env=g” for dbprintinsert</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is "" is removed from lst</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l's indentation is enough here, as dbcode is above l</span></span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="co"># don't forget to add the srcline below dbprint</span></span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb112-60"><a href="#cb112-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb112-61"><a href="#cb112-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb112-62"><a href="#cb112-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb112-63"><a href="#cb112-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-64"><a href="#cb112-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb112-65"><a href="#cb112-65" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb112-66"><a href="#cb112-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-67"><a href="#cb112-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb112-68"><a href="#cb112-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split('\n'):</span></span>
<span id="cb112-69"><a href="#cb112-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb112-70"><a href="#cb112-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-71"><a href="#cb112-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb112-72"><a href="#cb112-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-73"><a href="#cb112-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb112-74"><a href="#cb112-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["src"]: {locals()["src"]}')</span></span>
<span id="cb112-75"><a href="#cb112-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'locals()["{src.__name__}"]: {locals()[src.__name__]}')</span></span>
<span id="cb112-76"><a href="#cb112-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-77"><a href="#cb112-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb112-78"><a href="#cb112-78" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb112-79"><a href="#cb112-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-80"><a href="#cb112-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="collect-cmt-for-later-printsrcwithidx-to-print-comments-together" class="level3">
<h3 class="anchored" data-anchor-id="collect-cmt-for-later-printsrcwithidx-to-print-comments-together">collect cmt for later printsrcwithidx to print comments together</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>            env<span class="op">=</span>{}): <span class="co"># out environment</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: defaults.cmts.update({dbcode: cmt})</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-sure-only-one-line-with-correct-idx-is-debugged" class="level3">
<h3 class="anchored" data-anchor-id="make-sure-only-one-line-with-correct-idx-is-debugged">make sure only one line with correct idx is debugged</h3>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L182" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dbprint" class="level3">
<h3 class="anchored" data-anchor-id="dbprint">dbprint</h3>
<blockquote class="blockquote">
<pre><code> dbprint (src, dbcode, cmt:str, *codes, expand:int=2, env={},
          showdbsrc=False)</code></pre>
</blockquote>
<p>Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>the src func name, e.g., foo</td>
</tr>
<tr class="even">
<td>dbcode</td>
<td></td>
<td></td>
<td>the srclines under investigation, can be either string or int</td>
</tr>
<tr class="odd">
<td>cmt</td>
<td>str</td>
<td></td>
<td>comment</td>
</tr>
<tr class="even">
<td>codes</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>expand</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="even">
<td>env</td>
<td>dict</td>
<td>{}</td>
<td></td>
</tr>
<tr class="odd">
<td>showdbsrc</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="avoid-typing-when-there-is-no-codes" class="level3">
<h3 class="anchored" data-anchor-id="avoid-typing-when-there-is-no-codes">avoid typing “” when there is no codes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def dbprint(src, # the src func name, e.g., foo</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcode, # the srclines under investigation, can be either string or int</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">#             cmt:str, # comment</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#             *codes, # a list of dbcodes</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co">#             expand:int=2, # span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             env={}, # out environment</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             showdbsrc=False): # print out dbsrc or not</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     "Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     # make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     if defaults.orisrc == None:</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="co">#         defaults.orisrc = src</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     else: </span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         src = defaults.orisrc</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int: defaults.cmts.update({dbcode: cmt})</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     printsrc(src, dbcode, cmt, expand)</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     dbsrc = ""</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     indent = 4</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     onedbprint = False</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     lst = inspect.getsource(src).split('\n')</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     if not bool(lst[-1]): lst = lst[:-1]</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     srclines = ""</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int:</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = lst[dbcode]</span></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     for idx, l in zip(range(len(lst)), lst):</span></span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         if bool(l.strip()) and l.strip() in srclines:</span></span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a><span class="co">#             numindent = len(l) - len(l.strip())</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcodes = "dbprintinsert("</span></span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a><span class="co">#             count = 1</span></span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a><span class="co">#             for c in codes:</span></span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if count == len(codes):</span></span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + '"' + c + '"' + "," + "env=g" + ")"</span></span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                 else:</span></span>
<span id="cb115-43"><a href="#cb115-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + '"' + c + '"' + ","</span></span>
<span id="cb115-44"><a href="#cb115-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                 count = count + 1</span></span>
<span id="cb115-45"><a href="#cb115-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-46"><a href="#cb115-46" aria-hidden="true" tabindex="-1"></a><span class="co">#             if onedbprint == False:</span></span>
<span id="cb115-47"><a href="#cb115-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + " "*numindent + "g = locals()" + '\n'</span></span>
<span id="cb115-48"><a href="#cb115-48" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + " "*numindent + dbcodes + '\n'</span></span>
<span id="cb115-49"><a href="#cb115-49" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + '\n'</span></span>
<span id="cb115-50"><a href="#cb115-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                 onedbprint = True</span></span>
<span id="cb115-51"><a href="#cb115-51" aria-hidden="true" tabindex="-1"></a><span class="co">#             else:</span></span>
<span id="cb115-52"><a href="#cb115-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + '\n'</span></span>
<span id="cb115-53"><a href="#cb115-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-54"><a href="#cb115-54" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()) and idx + 1 == len(lst):</span></span>
<span id="cb115-55"><a href="#cb115-55" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l</span></span>
<span id="cb115-56"><a href="#cb115-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-57"><a href="#cb115-57" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()): # make sure pure indentation + \n is ignored</span></span>
<span id="cb115-58"><a href="#cb115-58" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l + '\n'</span></span>
<span id="cb115-59"><a href="#cb115-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-60"><a href="#cb115-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     if showdbsrc: # added to debug</span></span>
<span id="cb115-61"><a href="#cb115-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         for l in dbsrc.split('\n'):</span></span>
<span id="cb115-62"><a href="#cb115-62" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(l)</span></span>
<span id="cb115-63"><a href="#cb115-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-64"><a href="#cb115-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     exec(dbsrc, globals().update(env)) # make sure b can access lst from above</span></span>
<span id="cb115-65"><a href="#cb115-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-66"><a href="#cb115-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     env.update(locals())</span></span>
<span id="cb115-67"><a href="#cb115-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-68"><a href="#cb115-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[defaults.orisrc.__name__]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" class="level3">
<h3 class="anchored" data-anchor-id="no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint">no more update for dbprint, for the latest see Fastdb.dbprint</h3>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" class="level3">
<h3 class="anchored" data-anchor-id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile">use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>sfc <span class="op">=</span> dbprint(_signature_from_callable, <span class="st">"if isinstance(obj, type):"</span>, <span class="st">"this is comment"</span>, <span class="op">\</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"locals()"</span>, <span class="st">"isinstance(obj, type)"</span>, <span class="st">"env=g"</span>, <span class="op">\</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>              expand<span class="op">=</span><span class="dv">1</span>, env<span class="op">=</span>g)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># overriding the original official source with our dbsrc, even though rewriting _signature_from_callable inside inspect.py ######################</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> _signature_from_callable</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>inspect.signature(Foo) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="dbprintinsert" class="level2">
<h2 class="anchored" data-anchor-id="dbprintinsert">dbprintinsert</h2>
<section id="run-and-display-the-inserted-dbcodes" class="level3">
<h3 class="anchored" data-anchor-id="run-and-display-the-inserted-dbcodes">Run and display the inserted dbcodes</h3>
<p>for each srcline under investigation, used inside dbprint</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, <span class="op">**</span>env): </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"{c} =&gt; {c} : {eval(c, globals().update(env))}") </span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(output))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> a<span class="op">*</span><span class="dv">2</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> a <span class="op">*</span> b</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">"   "</span>.strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, "b = a + 1", "comment", "a", "a + 1", env=g)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'types.SimpleNamespace' object has no attribute 'orisrc'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, "b = a + 1", "comment", "a", "a + 1", env=g)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co">#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, "c = a * b", "comment", "b", "b * a", expand=3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" class="level3">
<h3 class="anchored" data-anchor-id="use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually">use locals() inside the dbsrc code to avoid adding env individually</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, env<span class="op">=</span>{}): </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"{c} =&gt; {c} : {eval(c, globals().update(env))}") </span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(output))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="enable-dbprintinsert-to-do-exec-on-a-block-of-code" class="level3">
<h3 class="anchored" data-anchor-id="enable-dbprintinsert-to-do-exec-on-a-block-of-code">enable dbprintinsert to do exec on a block of code</h3>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L254" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dbprintinsert-1" class="level3">
<h3 class="anchored" data-anchor-id="dbprintinsert-1">dbprintinsert</h3>
<blockquote class="blockquote">
<pre><code> dbprintinsert (*codes, env={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "a", "a + 1")</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "a", "a + 1", "pprint(a)", "if a &gt; 2:\\n    print('I am here')")</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "for i in range(3):\\n    print(f'I am {i}')")</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "for i in range(3): print(f'I am {i}')")</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "pprint(locals())")</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, "b = a + 1", "comment", "pprint(locals(), width=157)") # width=157 can cause error</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> delegates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> inspect.getsource(delegates).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> ls[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="printrunsrclines" class="level2">
<h2 class="anchored" data-anchor-id="printrunsrclines">printrunsrclines()</h2>
<p>It can print out only srclines which actually ran</p>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<section id="simple-example" class="level4">
<h4 class="anchored" data-anchor-id="simple-example">simple example</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def foo(a):</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     if a &gt; 1:</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         a = 1 + 1</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         b = a + 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="complex-example" class="level4">
<h4 class="anchored" data-anchor-id="complex-example">complex example</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"this is docs"</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="insert-a-line-after-each-srcline-to-add-idx" class="level3">
<h3 class="anchored" data-anchor-id="insert-a-line-after-each-srcline-to-add-idx">insert a line after each srcline to add idx</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if "if" in l or "else" in l or "for" in l:</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">    srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="ss">"</span> <span class="co"># add srcidx.append(idx) to each line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-correct-indentation-to-each-inserted-line" class="level3">
<h3 class="anchored" data-anchor-id="add-correct-indentation-to-each-inserted-line">add correct indentation to each inserted line</h3>
<section id="count-the-indentation-for-each-srcline" class="level4">
<h4 class="anchored" data-anchor-id="count-the-indentation-for-each-srcline">count the indentation for each srcline</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">"    a = 1"</span>) <span class="op">-</span> <span class="bu">len</span>(<span class="st">"    a = 1"</span>.strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>   <span class="co"># add srcidx.append(idx) to each line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="indentation-special-case-if-else-for-def" class="level3">
<h3 class="anchored" data-anchor-id="indentation-special-case-if-else-for-def">indentation special case: if, else, for, def</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def"</span> <span class="kw">in</span> l:</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-pure-comments-or-docs-from-dbsrc" class="level3">
<h3 class="anchored" data-anchor-id="remove-pure-comments-or-docs-from-dbsrc">remove pure comments or docs from dbsrc</h3>
<p>Do not insert line for pure comment or pure “”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> srclines:</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>    pprint(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">"# this is a comment"</span>.startswith(<span class="st">"#"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">"a = 1 # this is comment"</span>.startswith(<span class="st">"#"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def"</span> <span class="kw">in</span> l:</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l): <span class="co"># ignore pure '\n'</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def"</span> <span class="kw">in</span> l:</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">'#'</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">'"'</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">'"'</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>): <span class="co"># now the dbsrc has no pure comment and pure docs</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>(dbsrc) <span class="co"># give life to dbsrc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>srcidx <span class="op">=</span> [] <span class="co">#used outside the srcode</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co"># run the example using dbsrc</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo(-1) # run the example using dbsrc</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>srcidx <span class="co"># Now it should have all the idx whose srclines have run</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="print-out-the-srclines-which-get-run" class="level3">
<h3 class="anchored" data-anchor-id="print-out-the-srclines-which-get-run">print out the srclines which get run</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx:</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-sure-all-if-else-for-get-printed" class="level3">
<h3 class="anchored" data-anchor-id="make-sure-all-if-else-for-get-printed">Make sure all if, else, for get printed</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l:</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="put-all-together-into-the-function-printrunsrclines" class="level3">
<h3 class="anchored" data-anchor-id="put-all-together-into-the-function-printrunsrclines">Put all together into the function printrunsrclines()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"this is docs"</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"this is docs"</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def"</span> <span class="kw">in</span> l:</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">'#'</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">'"'</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">'"'</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>    fool <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">'foo'</span>]</span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>    pprint(fool(<span class="dv">3</span>))</span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run = "foo(3)"</span></span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">"fool(3)"</span>)</span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb164-28"><a href="#cb164-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l:</span>
<span id="cb164-29"><a href="#cb164-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="no-more-renaming-of-foo" class="level4">
<h4 class="anchored" data-anchor-id="no-more-renaming-of-foo">no more renaming of foo</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def"</span> <span class="kw">in</span> l:</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">'#'</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">'"'</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">'"'</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">"foo(3)"</span>) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l:</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-example-as-a-param-into-the-function" class="level4">
<h4 class="anchored" data-anchor-id="add-example-as-a-param-into-the-function">add example as a param into the function</h4>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L411" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="printrunsrclines-1" class="level3">
<h3 class="anchored" data-anchor-id="printrunsrclines-1">printrunsrclines</h3>
<blockquote class="blockquote">
<pre><code> printrunsrclines (func, example)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">"foo(-1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">"foo(2)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" class="level4">
<h4 class="anchored" data-anchor-id="improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples">improve on search for <code>if</code>, else, for, def to avoid errors for more examples</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"if "</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else:"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for "</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def "</span> <span class="kw">in</span> l:</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">'#'</span>) <span class="op">\</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">'"'</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">'"'</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l:</span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">'alignright("this is me")'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-an-empty-line-with-indentation" class="level4">
<h4 class="anchored" data-anchor-id="remove-an-empty-line-with-indentation">remove an empty line with indentation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span><span class="ch">\n\</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="st">     </span><span class="ch">\n\</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">bool</span>(l.strip()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip()) <span class="co"># how to strip only the left not the right?????</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f"srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"if "</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else:"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"for "</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"def "</span> <span class="kw">in</span> l:</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">'#'</span>) <span class="op">\</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">'"'</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">'"'</span>)): </span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">"for"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"if"</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">"else"</span> <span class="kw">in</span> l:</span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">'alignright("this is me")'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>pprint(inspect.getsource(printsrc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co">", "</span> <span class="kw">in</span> <span class="st">"    env, "</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="make-it-work" class="level3">
<h3 class="anchored" data-anchor-id="make-it-work">make it work</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>[]</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>a.append([<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L411" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printrunsrclines-2" class="level3">
<h3 class="anchored" data-anchor-id="printrunsrclines-2">printrunsrclines</h3>
<blockquote class="blockquote">
<pre><code> printrunsrclines (src, example, env)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> <span class="op">*</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.imports <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(delegates, <span class="st">''</span>, env<span class="op">=</span>g) <span class="co"># make sure to use \\n not \n</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(delegates)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-difficult-examples-to-test-printrunsrc" class="level3">
<h3 class="anchored" data-anchor-id="more-difficult-examples-to-test-printrunsrc">more difficult examples to test printrunsrc()</h3>
</section>
</section>
<section id="make-fastdebug-a-class" class="level2">
<h2 class="anchored" data-anchor-id="make-fastdebug-a-class">Make fastdebug a class</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb185-28"><a href="#cb185-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb185-29"><a href="#cb185-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-30"><a href="#cb185-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb185-31"><a href="#cb185-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb185-32"><a href="#cb185-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb185-33"><a href="#cb185-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb185-34"><a href="#cb185-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb185-35"><a href="#cb185-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-36"><a href="#cb185-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb185-37"><a href="#cb185-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb185-38"><a href="#cb185-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-39"><a href="#cb185-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb185-40"><a href="#cb185-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb185-41"><a href="#cb185-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb185-42"><a href="#cb185-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb185-43"><a href="#cb185-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">"env="</span> <span class="kw">in</span> c:</span>
<span id="cb185-44"><a href="#cb185-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb185-45"><a href="#cb185-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb185-46"><a href="#cb185-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb185-47"><a href="#cb185-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb185-48"><a href="#cb185-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-49"><a href="#cb185-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb185-50"><a href="#cb185-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb185-51"><a href="#cb185-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb185-52"><a href="#cb185-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb185-53"><a href="#cb185-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb185-54"><a href="#cb185-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb185-55"><a href="#cb185-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb185-56"><a href="#cb185-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-57"><a href="#cb185-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb185-58"><a href="#cb185-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb185-59"><a href="#cb185-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-60"><a href="#cb185-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb185-61"><a href="#cb185-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb185-62"><a href="#cb185-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-63"><a href="#cb185-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb185-64"><a href="#cb185-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-65"><a href="#cb185-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb185-66"><a href="#cb185-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-67"><a href="#cb185-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb185-68"><a href="#cb185-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb185-69"><a href="#cb185-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb185-70"><a href="#cb185-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb185-71"><a href="#cb185-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb185-72"><a href="#cb185-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb185-73"><a href="#cb185-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb185-74"><a href="#cb185-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb185-75"><a href="#cb185-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb185-76"><a href="#cb185-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb185-77"><a href="#cb185-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-78"><a href="#cb185-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb185-79"><a href="#cb185-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb185-80"><a href="#cb185-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb185-81"><a href="#cb185-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb185-82"><a href="#cb185-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb185-83"><a href="#cb185-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb185-84"><a href="#cb185-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb185-85"><a href="#cb185-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-86"><a href="#cb185-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb185-87"><a href="#cb185-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb185-88"><a href="#cb185-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb185-89"><a href="#cb185-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-90"><a href="#cb185-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb185-91"><a href="#cb185-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb185-92"><a href="#cb185-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb186-35"><a href="#cb186-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-36"><a href="#cb186-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb186-37"><a href="#cb186-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb186-38"><a href="#cb186-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-39"><a href="#cb186-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb186-40"><a href="#cb186-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb186-41"><a href="#cb186-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb186-42"><a href="#cb186-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb186-43"><a href="#cb186-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb186-44"><a href="#cb186-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb186-45"><a href="#cb186-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb186-46"><a href="#cb186-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb186-47"><a href="#cb186-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb186-48"><a href="#cb186-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-49"><a href="#cb186-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb186-50"><a href="#cb186-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb186-51"><a href="#cb186-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb186-52"><a href="#cb186-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb186-53"><a href="#cb186-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb186-54"><a href="#cb186-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb186-55"><a href="#cb186-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb186-56"><a href="#cb186-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-57"><a href="#cb186-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb186-58"><a href="#cb186-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb186-59"><a href="#cb186-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-60"><a href="#cb186-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb186-61"><a href="#cb186-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb186-62"><a href="#cb186-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-63"><a href="#cb186-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb186-64"><a href="#cb186-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-65"><a href="#cb186-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb186-66"><a href="#cb186-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-67"><a href="#cb186-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb186-68"><a href="#cb186-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-69"><a href="#cb186-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-70"><a href="#cb186-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb186-71"><a href="#cb186-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb186-72"><a href="#cb186-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb186-73"><a href="#cb186-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb186-74"><a href="#cb186-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb186-75"><a href="#cb186-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb186-76"><a href="#cb186-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb186-77"><a href="#cb186-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-78"><a href="#cb186-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb186-79"><a href="#cb186-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb186-80"><a href="#cb186-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb186-81"><a href="#cb186-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb186-82"><a href="#cb186-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb186-83"><a href="#cb186-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb186-84"><a href="#cb186-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb186-85"><a href="#cb186-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-86"><a href="#cb186-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb186-87"><a href="#cb186-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb186-88"><a href="#cb186-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb186-89"><a href="#cb186-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-90"><a href="#cb186-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb186-91"><a href="#cb186-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb186-92"><a href="#cb186-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="improve-on-the-line-idx-readability" class="level3">
<h3 class="anchored" data-anchor-id="improve-on-the-line-idx-readability">improve on the line idx readability</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-27"><a href="#cb187-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb187-28"><a href="#cb187-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb187-29"><a href="#cb187-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-30"><a href="#cb187-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb187-31"><a href="#cb187-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb187-32"><a href="#cb187-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb187-33"><a href="#cb187-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb187-34"><a href="#cb187-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb187-35"><a href="#cb187-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-36"><a href="#cb187-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb187-37"><a href="#cb187-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb187-38"><a href="#cb187-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-39"><a href="#cb187-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb187-40"><a href="#cb187-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb187-41"><a href="#cb187-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb187-42"><a href="#cb187-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb187-43"><a href="#cb187-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb187-44"><a href="#cb187-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb187-45"><a href="#cb187-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb187-46"><a href="#cb187-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb187-47"><a href="#cb187-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb187-48"><a href="#cb187-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-49"><a href="#cb187-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb187-50"><a href="#cb187-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb187-51"><a href="#cb187-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb187-52"><a href="#cb187-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb187-53"><a href="#cb187-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb187-54"><a href="#cb187-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb187-55"><a href="#cb187-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb187-56"><a href="#cb187-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-57"><a href="#cb187-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb187-58"><a href="#cb187-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb187-59"><a href="#cb187-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-60"><a href="#cb187-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb187-61"><a href="#cb187-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb187-62"><a href="#cb187-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-63"><a href="#cb187-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb187-64"><a href="#cb187-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-65"><a href="#cb187-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb187-66"><a href="#cb187-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-67"><a href="#cb187-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb187-68"><a href="#cb187-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-69"><a href="#cb187-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-70"><a href="#cb187-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb187-71"><a href="#cb187-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb187-72"><a href="#cb187-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb187-73"><a href="#cb187-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb187-74"><a href="#cb187-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb187-75"><a href="#cb187-75" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb187-76"><a href="#cb187-76" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb187-77"><a href="#cb187-77" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb187-78"><a href="#cb187-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-79"><a href="#cb187-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb187-80"><a href="#cb187-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb187-81"><a href="#cb187-81" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb187-82"><a href="#cb187-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb187-83"><a href="#cb187-83" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb187-84"><a href="#cb187-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb187-85"><a href="#cb187-85" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb187-86"><a href="#cb187-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb187-87"><a href="#cb187-87" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))</span>
<span id="cb187-88"><a href="#cb187-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb187-89"><a href="#cb187-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb187-90"><a href="#cb187-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb187-91"><a href="#cb187-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-92"><a href="#cb187-92" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb187-93"><a href="#cb187-93" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb187-94"><a href="#cb187-94" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb187-95"><a href="#cb187-95" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb187-96"><a href="#cb187-96" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb187-97"><a href="#cb187-97" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb187-98"><a href="#cb187-98" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb187-99"><a href="#cb187-99" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:=&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))</span>
<span id="cb187-100"><a href="#cb187-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-101"><a href="#cb187-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb187-102"><a href="#cb187-102" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb187-103"><a href="#cb187-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="collect-cmt-from-dbprint-and-print" class="level3">
<h3 class="anchored" data-anchor-id="collect-cmt-from-dbprint-and-print">collect cmt from dbprint and print</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-25"><a href="#cb188-25" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb188-26"><a href="#cb188-26" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb188-27"><a href="#cb188-27" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb188-28"><a href="#cb188-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-29"><a href="#cb188-29" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb188-30"><a href="#cb188-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb188-31"><a href="#cb188-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-32"><a href="#cb188-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb188-33"><a href="#cb188-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb188-34"><a href="#cb188-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb188-35"><a href="#cb188-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb188-36"><a href="#cb188-36" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb188-37"><a href="#cb188-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-38"><a href="#cb188-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb188-39"><a href="#cb188-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb188-40"><a href="#cb188-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-41"><a href="#cb188-41" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb188-42"><a href="#cb188-42" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb188-43"><a href="#cb188-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb188-44"><a href="#cb188-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb188-45"><a href="#cb188-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb188-46"><a href="#cb188-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb188-47"><a href="#cb188-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb188-48"><a href="#cb188-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb188-49"><a href="#cb188-49" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb188-50"><a href="#cb188-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-51"><a href="#cb188-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb188-52"><a href="#cb188-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb188-53"><a href="#cb188-53" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb188-54"><a href="#cb188-54" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb188-55"><a href="#cb188-55" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb188-56"><a href="#cb188-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb188-57"><a href="#cb188-57" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb188-58"><a href="#cb188-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-59"><a href="#cb188-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb188-60"><a href="#cb188-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb188-61"><a href="#cb188-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-62"><a href="#cb188-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb188-63"><a href="#cb188-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb188-64"><a href="#cb188-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-65"><a href="#cb188-65" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb188-66"><a href="#cb188-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb188-67"><a href="#cb188-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-68"><a href="#cb188-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb188-69"><a href="#cb188-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-70"><a href="#cb188-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb188-71"><a href="#cb188-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb188-72"><a href="#cb188-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb188-73"><a href="#cb188-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb188-74"><a href="#cb188-74" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb188-75"><a href="#cb188-75" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb188-76"><a href="#cb188-76" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb188-77"><a href="#cb188-77" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb188-78"><a href="#cb188-78" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb188-79"><a href="#cb188-79" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb188-80"><a href="#cb188-80" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb188-81"><a href="#cb188-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb188-82"><a href="#cb188-82" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb188-83"><a href="#cb188-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb188-84"><a href="#cb188-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb188-85"><a href="#cb188-85" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb188-86"><a href="#cb188-86" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb188-87"><a href="#cb188-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb188-88"><a href="#cb188-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-89"><a href="#cb188-89" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb188-90"><a href="#cb188-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb188-91"><a href="#cb188-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb188-92"><a href="#cb188-92" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb188-93"><a href="#cb188-93" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb188-94"><a href="#cb188-94" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-95"><a href="#cb188-95" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb188-96"><a href="#cb188-96" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-97"><a href="#cb188-97" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb188-98"><a href="#cb188-98" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-99"><a href="#cb188-99" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb188-100"><a href="#cb188-100" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb188-101"><a href="#cb188-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-102"><a href="#cb188-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-103"><a href="#cb188-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb188-104"><a href="#cb188-104" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb188-105"><a href="#cb188-105" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb188-106"><a href="#cb188-106" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb188-107"><a href="#cb188-107" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb188-108"><a href="#cb188-108" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb188-109"><a href="#cb188-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-110"><a href="#cb188-110" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb188-111"><a href="#cb188-111" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb188-112"><a href="#cb188-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb188-113"><a href="#cb188-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb188-114"><a href="#cb188-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb188-115"><a href="#cb188-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-116"><a href="#cb188-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb188-117"><a href="#cb188-117" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb188-118"><a href="#cb188-118" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb188-119"><a href="#cb188-119" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-120"><a href="#cb188-120" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb188-121"><a href="#cb188-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb188-122"><a href="#cb188-122" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb188-123"><a href="#cb188-123" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb188-124"><a href="#cb188-124" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-125"><a href="#cb188-125" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb188-126"><a href="#cb188-126" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-127"><a href="#cb188-127" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb188-128"><a href="#cb188-128" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb188-129"><a href="#cb188-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-130"><a href="#cb188-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-131"><a href="#cb188-131" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb188-132"><a href="#cb188-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-133"><a href="#cb188-133" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb188-134"><a href="#cb188-134" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb188-135"><a href="#cb188-135" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb188-136"><a href="#cb188-136" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb188-137"><a href="#cb188-137" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb188-138"><a href="#cb188-138" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb188-139"><a href="#cb188-139" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb188-140"><a href="#cb188-140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb188-141"><a href="#cb188-141" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb188-142"><a href="#cb188-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-143"><a href="#cb188-143" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb188-144"><a href="#cb188-144" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb188-145"><a href="#cb188-145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-sure-only-the-line-with-correct-idx-is-debugged" class="level3">
<h3 class="anchored" data-anchor-id="make-sure-only-the-line-with-correct-idx-is-debugged">make sure only the line with correct idx is debugged</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb189-38"><a href="#cb189-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-39"><a href="#cb189-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb189-40"><a href="#cb189-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure the line with correct idx is debugged</span></span>
<span id="cb189-41"><a href="#cb189-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb189-42"><a href="#cb189-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-43"><a href="#cb189-43" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb189-44"><a href="#cb189-44" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb189-45"><a href="#cb189-45" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb189-46"><a href="#cb189-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb189-47"><a href="#cb189-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb189-48"><a href="#cb189-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb189-49"><a href="#cb189-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb189-50"><a href="#cb189-50" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb189-51"><a href="#cb189-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb189-52"><a href="#cb189-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-53"><a href="#cb189-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if onedbprint == False:</span></span>
<span id="cb189-54"><a href="#cb189-54" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + " "*numindent + "g = locals()" + '\n'</span></span>
<span id="cb189-55"><a href="#cb189-55" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + " "*numindent + dbcodes + '\n'</span></span>
<span id="cb189-56"><a href="#cb189-56" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + '\n'</span></span>
<span id="cb189-57"><a href="#cb189-57" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     onedbprint = True</span></span>
<span id="cb189-58"><a href="#cb189-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else:</span></span>
<span id="cb189-59"><a href="#cb189-59" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + '\n'</span></span>
<span id="cb189-60"><a href="#cb189-60" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb189-61"><a href="#cb189-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb189-62"><a href="#cb189-62" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb189-63"><a href="#cb189-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb189-64"><a href="#cb189-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-65"><a href="#cb189-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb189-66"><a href="#cb189-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb189-67"><a href="#cb189-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-68"><a href="#cb189-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb189-69"><a href="#cb189-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb189-70"><a href="#cb189-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb189-71"><a href="#cb189-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb189-72"><a href="#cb189-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb189-73"><a href="#cb189-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb189-74"><a href="#cb189-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb189-75"><a href="#cb189-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb189-76"><a href="#cb189-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-77"><a href="#cb189-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb189-78"><a href="#cb189-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-79"><a href="#cb189-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb189-80"><a href="#cb189-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb189-81"><a href="#cb189-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb189-82"><a href="#cb189-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb189-83"><a href="#cb189-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb189-84"><a href="#cb189-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb189-85"><a href="#cb189-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb189-86"><a href="#cb189-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb189-87"><a href="#cb189-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb189-88"><a href="#cb189-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb189-89"><a href="#cb189-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb189-90"><a href="#cb189-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb189-91"><a href="#cb189-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb189-92"><a href="#cb189-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb189-93"><a href="#cb189-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb189-94"><a href="#cb189-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb189-95"><a href="#cb189-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb189-96"><a href="#cb189-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb189-97"><a href="#cb189-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-98"><a href="#cb189-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb189-99"><a href="#cb189-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb189-100"><a href="#cb189-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb189-101"><a href="#cb189-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb189-102"><a href="#cb189-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb189-103"><a href="#cb189-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-104"><a href="#cb189-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb189-105"><a href="#cb189-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-106"><a href="#cb189-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb189-107"><a href="#cb189-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-108"><a href="#cb189-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb189-109"><a href="#cb189-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb189-110"><a href="#cb189-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-111"><a href="#cb189-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-112"><a href="#cb189-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb189-113"><a href="#cb189-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb189-114"><a href="#cb189-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb189-115"><a href="#cb189-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb189-116"><a href="#cb189-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb189-117"><a href="#cb189-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb189-118"><a href="#cb189-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-119"><a href="#cb189-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb189-120"><a href="#cb189-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb189-121"><a href="#cb189-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb189-122"><a href="#cb189-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb189-123"><a href="#cb189-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb189-124"><a href="#cb189-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-125"><a href="#cb189-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb189-126"><a href="#cb189-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb189-127"><a href="#cb189-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb189-128"><a href="#cb189-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-129"><a href="#cb189-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb189-130"><a href="#cb189-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb189-131"><a href="#cb189-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb189-132"><a href="#cb189-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb189-133"><a href="#cb189-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-134"><a href="#cb189-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb189-135"><a href="#cb189-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-136"><a href="#cb189-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb189-137"><a href="#cb189-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb189-138"><a href="#cb189-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-139"><a href="#cb189-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-140"><a href="#cb189-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb189-141"><a href="#cb189-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-142"><a href="#cb189-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb189-143"><a href="#cb189-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb189-144"><a href="#cb189-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb189-145"><a href="#cb189-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb189-146"><a href="#cb189-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb189-147"><a href="#cb189-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb189-148"><a href="#cb189-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb189-149"><a href="#cb189-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb189-150"><a href="#cb189-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb189-151"><a href="#cb189-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-152"><a href="#cb189-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb189-153"><a href="#cb189-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb189-154"><a href="#cb189-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="having-or-inside-codes-without-causing-error" class="level3">
<h3 class="anchored" data-anchor-id="having-or-inside-codes-without-causing-error">having “” or ” ” inside codes without causing error</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>([<span class="st">"   "</span>][<span class="dv">0</span>].strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">"   "</span>.strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="st">"..."</span>, <span class="st">""</span>, <span class="st">"  "</span>, <span class="st">""</span>]</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>newlst <span class="op">=</span> []</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> lst: </span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>newlst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-26"><a href="#cb193-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb193-27"><a href="#cb193-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb193-28"><a href="#cb193-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb193-29"><a href="#cb193-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-30"><a href="#cb193-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb193-31"><a href="#cb193-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb193-32"><a href="#cb193-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb193-33"><a href="#cb193-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb193-34"><a href="#cb193-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is "" or "  " in the front or in the middle of codes</span></span>
<span id="cb193-35"><a href="#cb193-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb193-36"><a href="#cb193-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb193-37"><a href="#cb193-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-38"><a href="#cb193-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb193-39"><a href="#cb193-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb193-40"><a href="#cb193-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb193-41"><a href="#cb193-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb193-42"><a href="#cb193-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb193-43"><a href="#cb193-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-44"><a href="#cb193-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb193-45"><a href="#cb193-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-46"><a href="#cb193-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb193-47"><a href="#cb193-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-48"><a href="#cb193-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb193-49"><a href="#cb193-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb193-50"><a href="#cb193-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb193-51"><a href="#cb193-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb193-52"><a href="#cb193-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb193-53"><a href="#cb193-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb193-54"><a href="#cb193-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb193-55"><a href="#cb193-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb193-56"><a href="#cb193-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb193-57"><a href="#cb193-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb193-58"><a href="#cb193-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-59"><a href="#cb193-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb193-60"><a href="#cb193-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb193-61"><a href="#cb193-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-62"><a href="#cb193-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb193-63"><a href="#cb193-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb193-64"><a href="#cb193-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-65"><a href="#cb193-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb193-66"><a href="#cb193-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb193-67"><a href="#cb193-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-68"><a href="#cb193-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb193-69"><a href="#cb193-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb193-70"><a href="#cb193-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb193-71"><a href="#cb193-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb193-72"><a href="#cb193-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb193-73"><a href="#cb193-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb193-74"><a href="#cb193-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb193-75"><a href="#cb193-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb193-76"><a href="#cb193-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-77"><a href="#cb193-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb193-78"><a href="#cb193-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-79"><a href="#cb193-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb193-80"><a href="#cb193-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-81"><a href="#cb193-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb193-82"><a href="#cb193-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb193-83"><a href="#cb193-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb193-84"><a href="#cb193-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb193-85"><a href="#cb193-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb193-86"><a href="#cb193-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb193-87"><a href="#cb193-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb193-88"><a href="#cb193-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb193-89"><a href="#cb193-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb193-90"><a href="#cb193-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb193-91"><a href="#cb193-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb193-92"><a href="#cb193-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb193-93"><a href="#cb193-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb193-94"><a href="#cb193-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb193-95"><a href="#cb193-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb193-96"><a href="#cb193-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb193-97"><a href="#cb193-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-98"><a href="#cb193-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb193-99"><a href="#cb193-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb193-100"><a href="#cb193-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb193-101"><a href="#cb193-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb193-102"><a href="#cb193-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb193-103"><a href="#cb193-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-104"><a href="#cb193-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb193-105"><a href="#cb193-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-106"><a href="#cb193-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb193-107"><a href="#cb193-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-108"><a href="#cb193-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb193-109"><a href="#cb193-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb193-110"><a href="#cb193-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-111"><a href="#cb193-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-112"><a href="#cb193-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb193-113"><a href="#cb193-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb193-114"><a href="#cb193-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb193-115"><a href="#cb193-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb193-116"><a href="#cb193-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb193-117"><a href="#cb193-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb193-118"><a href="#cb193-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-119"><a href="#cb193-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb193-120"><a href="#cb193-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb193-121"><a href="#cb193-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb193-122"><a href="#cb193-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb193-123"><a href="#cb193-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb193-124"><a href="#cb193-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-125"><a href="#cb193-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb193-126"><a href="#cb193-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb193-127"><a href="#cb193-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb193-128"><a href="#cb193-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-129"><a href="#cb193-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb193-130"><a href="#cb193-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb193-131"><a href="#cb193-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb193-132"><a href="#cb193-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb193-133"><a href="#cb193-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-134"><a href="#cb193-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb193-135"><a href="#cb193-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-136"><a href="#cb193-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb193-137"><a href="#cb193-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb193-138"><a href="#cb193-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-139"><a href="#cb193-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-140"><a href="#cb193-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb193-141"><a href="#cb193-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-142"><a href="#cb193-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb193-143"><a href="#cb193-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb193-144"><a href="#cb193-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb193-145"><a href="#cb193-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb193-146"><a href="#cb193-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb193-147"><a href="#cb193-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb193-148"><a href="#cb193-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb193-149"><a href="#cb193-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb193-150"><a href="#cb193-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb193-151"><a href="#cb193-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-152"><a href="#cb193-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb193-153"><a href="#cb193-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb193-154"><a href="#cb193-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="replace-fastdb.printsrcwithdix-with-fastdb.print" class="level3">
<h3 class="anchored" data-anchor-id="replace-fastdb.printsrcwithdix-with-fastdb.print">replace Fastdb.printsrcwithdix with Fastdb.print</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb194-29"><a href="#cb194-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-30"><a href="#cb194-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb194-34"><a href="#cb194-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is "" or "  " in the front or in the middle of codes</span></span>
<span id="cb194-35"><a href="#cb194-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb194-36"><a href="#cb194-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb194-37"><a href="#cb194-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-38"><a href="#cb194-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb194-39"><a href="#cb194-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb194-40"><a href="#cb194-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb194-41"><a href="#cb194-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb194-42"><a href="#cb194-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb194-43"><a href="#cb194-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-44"><a href="#cb194-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb194-45"><a href="#cb194-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-46"><a href="#cb194-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb194-47"><a href="#cb194-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-48"><a href="#cb194-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb194-49"><a href="#cb194-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb194-50"><a href="#cb194-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb194-51"><a href="#cb194-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb194-52"><a href="#cb194-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb194-53"><a href="#cb194-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb194-54"><a href="#cb194-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb194-55"><a href="#cb194-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb194-56"><a href="#cb194-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb194-57"><a href="#cb194-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb194-58"><a href="#cb194-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-59"><a href="#cb194-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb194-60"><a href="#cb194-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb194-61"><a href="#cb194-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>     </span>
<span id="cb194-62"><a href="#cb194-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb194-63"><a href="#cb194-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb194-64"><a href="#cb194-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-65"><a href="#cb194-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb194-66"><a href="#cb194-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb194-67"><a href="#cb194-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-68"><a href="#cb194-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb194-69"><a href="#cb194-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb194-70"><a href="#cb194-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb194-71"><a href="#cb194-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb194-72"><a href="#cb194-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>):</span>
<span id="cb194-73"><a href="#cb194-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb194-74"><a href="#cb194-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb194-75"><a href="#cb194-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb194-76"><a href="#cb194-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-77"><a href="#cb194-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb194-78"><a href="#cb194-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-79"><a href="#cb194-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb194-80"><a href="#cb194-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-81"><a href="#cb194-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-82"><a href="#cb194-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb194-83"><a href="#cb194-83" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb194-84"><a href="#cb194-84" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb194-85"><a href="#cb194-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb194-86"><a href="#cb194-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb194-87"><a href="#cb194-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb194-88"><a href="#cb194-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb194-89"><a href="#cb194-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb194-90"><a href="#cb194-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb194-91"><a href="#cb194-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb194-92"><a href="#cb194-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb194-93"><a href="#cb194-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb194-94"><a href="#cb194-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb194-95"><a href="#cb194-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb194-96"><a href="#cb194-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb194-97"><a href="#cb194-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-98"><a href="#cb194-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb194-99"><a href="#cb194-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb194-100"><a href="#cb194-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb194-101"><a href="#cb194-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb194-102"><a href="#cb194-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb194-103"><a href="#cb194-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-104"><a href="#cb194-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb194-105"><a href="#cb194-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-106"><a href="#cb194-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb194-107"><a href="#cb194-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-108"><a href="#cb194-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb194-109"><a href="#cb194-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb194-110"><a href="#cb194-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-111"><a href="#cb194-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-112"><a href="#cb194-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb194-113"><a href="#cb194-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb194-114"><a href="#cb194-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb194-115"><a href="#cb194-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb194-116"><a href="#cb194-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb194-117"><a href="#cb194-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb194-118"><a href="#cb194-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-119"><a href="#cb194-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb194-120"><a href="#cb194-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb194-121"><a href="#cb194-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb194-122"><a href="#cb194-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb194-123"><a href="#cb194-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb194-124"><a href="#cb194-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-125"><a href="#cb194-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb194-126"><a href="#cb194-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb194-127"><a href="#cb194-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb194-128"><a href="#cb194-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-129"><a href="#cb194-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb194-130"><a href="#cb194-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb194-131"><a href="#cb194-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb194-132"><a href="#cb194-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb194-133"><a href="#cb194-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-134"><a href="#cb194-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb194-135"><a href="#cb194-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-136"><a href="#cb194-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb194-137"><a href="#cb194-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb194-138"><a href="#cb194-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-139"><a href="#cb194-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-140"><a href="#cb194-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb194-141"><a href="#cb194-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-142"><a href="#cb194-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb194-143"><a href="#cb194-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb194-144"><a href="#cb194-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb194-145"><a href="#cb194-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb194-146"><a href="#cb194-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb194-147"><a href="#cb194-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb194-148"><a href="#cb194-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb194-149"><a href="#cb194-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb194-150"><a href="#cb194-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb194-151"><a href="#cb194-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-152"><a href="#cb194-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb194-153"><a href="#cb194-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb194-154"><a href="#cb194-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-idx-to-dbsrc-when-showdbsrctrue" class="level3">
<h3 class="anchored" data-anchor-id="add-idx-to-dbsrc-when-showdbsrctrue">add idx to dbsrc when showdbsrc=True</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one"</span></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is "" or "  " in the front or in the middle of codes</span></span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb195-43"><a href="#cb195-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-44"><a href="#cb195-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb195-45"><a href="#cb195-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-46"><a href="#cb195-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb195-47"><a href="#cb195-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-48"><a href="#cb195-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb195-49"><a href="#cb195-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb195-50"><a href="#cb195-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb195-51"><a href="#cb195-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb195-52"><a href="#cb195-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb195-53"><a href="#cb195-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb195-54"><a href="#cb195-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb195-55"><a href="#cb195-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb195-56"><a href="#cb195-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb195-57"><a href="#cb195-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb195-58"><a href="#cb195-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-59"><a href="#cb195-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb195-60"><a href="#cb195-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb195-61"><a href="#cb195-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>     </span>
<span id="cb195-62"><a href="#cb195-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb195-63"><a href="#cb195-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb195-64"><a href="#cb195-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-65"><a href="#cb195-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb195-66"><a href="#cb195-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb195-67"><a href="#cb195-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-68"><a href="#cb195-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb195-69"><a href="#cb195-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb195-70"><a href="#cb195-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb195-71"><a href="#cb195-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb195-72"><a href="#cb195-72" aria-hidden="true" tabindex="-1"></a>            totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb195-73"><a href="#cb195-73" aria-hidden="true" tabindex="-1"></a>            lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb195-74"><a href="#cb195-74" aria-hidden="true" tabindex="-1"></a>            dblst <span class="op">=</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb195-75"><a href="#cb195-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb195-76"><a href="#cb195-76" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb195-77"><a href="#cb195-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">"dbprintinsert"</span> <span class="kw">in</span> l: </span>
<span id="cb195-78"><a href="#cb195-78" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"(db)"</span>)</span>
<span id="cb195-79"><a href="#cb195-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb195-80"><a href="#cb195-80" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-81"><a href="#cb195-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb195-82"><a href="#cb195-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb195-83"><a href="#cb195-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-84"><a href="#cb195-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb195-85"><a href="#cb195-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-86"><a href="#cb195-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb195-87"><a href="#cb195-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-88"><a href="#cb195-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-89"><a href="#cb195-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb195-90"><a href="#cb195-90" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb195-91"><a href="#cb195-91" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb195-92"><a href="#cb195-92" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb195-93"><a href="#cb195-93" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb195-94"><a href="#cb195-94" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb195-95"><a href="#cb195-95" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb195-96"><a href="#cb195-96" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb195-97"><a href="#cb195-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb195-98"><a href="#cb195-98" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb195-99"><a href="#cb195-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb195-100"><a href="#cb195-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb195-101"><a href="#cb195-101" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb195-102"><a href="#cb195-102" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb195-103"><a href="#cb195-103" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb195-104"><a href="#cb195-104" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-105"><a href="#cb195-105" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb195-106"><a href="#cb195-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb195-107"><a href="#cb195-107" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb195-108"><a href="#cb195-108" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb195-109"><a href="#cb195-109" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb195-110"><a href="#cb195-110" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-111"><a href="#cb195-111" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb195-112"><a href="#cb195-112" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-113"><a href="#cb195-113" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb195-114"><a href="#cb195-114" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-115"><a href="#cb195-115" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb195-116"><a href="#cb195-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb195-117"><a href="#cb195-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-118"><a href="#cb195-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-119"><a href="#cb195-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb195-120"><a href="#cb195-120" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb195-121"><a href="#cb195-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb195-122"><a href="#cb195-122" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb195-123"><a href="#cb195-123" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb195-124"><a href="#cb195-124" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb195-125"><a href="#cb195-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-126"><a href="#cb195-126" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb195-127"><a href="#cb195-127" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb195-128"><a href="#cb195-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-129"><a href="#cb195-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb195-130"><a href="#cb195-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb195-131"><a href="#cb195-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-132"><a href="#cb195-132" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb195-133"><a href="#cb195-133" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb195-134"><a href="#cb195-134" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb195-135"><a href="#cb195-135" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-136"><a href="#cb195-136" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb195-137"><a href="#cb195-137" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb195-138"><a href="#cb195-138" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb195-139"><a href="#cb195-139" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb195-140"><a href="#cb195-140" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-141"><a href="#cb195-141" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb195-142"><a href="#cb195-142" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-143"><a href="#cb195-143" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb195-144"><a href="#cb195-144" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb195-145"><a href="#cb195-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-146"><a href="#cb195-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-147"><a href="#cb195-147" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb195-148"><a href="#cb195-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-149"><a href="#cb195-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb195-150"><a href="#cb195-150" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb195-151"><a href="#cb195-151" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb195-152"><a href="#cb195-152" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb195-153"><a href="#cb195-153" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb195-154"><a href="#cb195-154" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb195-155"><a href="#cb195-155" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb195-156"><a href="#cb195-156" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb195-157"><a href="#cb195-157" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb195-158"><a href="#cb195-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-159"><a href="#cb195-159" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb195-160"><a href="#cb195-160" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb195-161"><a href="#cb195-161" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages" class="level3">
<h3 class="anchored" data-anchor-id="not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages">not load the inner locals() to outenv can prevent mysterious printing of previous db messages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Create a Fastdebug class which has two functionalities: dbprint and print."</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>                dbcode:<span class="bu">int</span>, <span class="co"># a srcline under investigation, can be either string or int</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating"</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is "" or "  " in the front or in the middle of codes</span></span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb196-55"><a href="#cb196-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb196-56"><a href="#cb196-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb196-57"><a href="#cb196-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb196-58"><a href="#cb196-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-59"><a href="#cb196-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb196-60"><a href="#cb196-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb196-61"><a href="#cb196-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>     </span>
<span id="cb196-62"><a href="#cb196-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb196-63"><a href="#cb196-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb196-64"><a href="#cb196-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-65"><a href="#cb196-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb196-66"><a href="#cb196-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb196-67"><a href="#cb196-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-68"><a href="#cb196-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb196-69"><a href="#cb196-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb196-70"><a href="#cb196-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb196-71"><a href="#cb196-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb196-72"><a href="#cb196-72" aria-hidden="true" tabindex="-1"></a>            totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb196-73"><a href="#cb196-73" aria-hidden="true" tabindex="-1"></a>            lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb196-74"><a href="#cb196-74" aria-hidden="true" tabindex="-1"></a>            dblst <span class="op">=</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb196-75"><a href="#cb196-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb196-76"><a href="#cb196-76" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb196-77"><a href="#cb196-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">"dbprintinsert"</span> <span class="kw">in</span> l: </span>
<span id="cb196-78"><a href="#cb196-78" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"(db)"</span>)</span>
<span id="cb196-79"><a href="#cb196-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb196-80"><a href="#cb196-80" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-81"><a href="#cb196-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb196-82"><a href="#cb196-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb196-83"><a href="#cb196-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-84"><a href="#cb196-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.outenv.update(locals())</span></span>
<span id="cb196-85"><a href="#cb196-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.outenv.update({self.orisrc.__name__: locals()[self.orisrc.__name__]})</span></span>
<span id="cb196-86"><a href="#cb196-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-87"><a href="#cb196-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb196-88"><a href="#cb196-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-89"><a href="#cb196-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-90"><a href="#cb196-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb196-91"><a href="#cb196-91" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb196-92"><a href="#cb196-92" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb196-93"><a href="#cb196-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Print the source code in whole or parts with idx and comments you added with dbprint along the way."</span></span>
<span id="cb196-94"><a href="#cb196-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb196-95"><a href="#cb196-95" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb196-96"><a href="#cb196-96" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb196-97"><a href="#cb196-97" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb196-98"><a href="#cb196-98" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb196-99"><a href="#cb196-99" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb196-100"><a href="#cb196-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:"this is me", 111:"this is me", 14:"this is you this is you this is you this is you this is you this is you this is you this is you "}</span></span>
<span id="cb196-101"><a href="#cb196-101" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb196-102"><a href="#cb196-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb196-103"><a href="#cb196-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb196-104"><a href="#cb196-104" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb196-105"><a href="#cb196-105" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb196-106"><a href="#cb196-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb196-107"><a href="#cb196-107" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-108"><a href="#cb196-108" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb196-109"><a href="#cb196-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb196-110"><a href="#cb196-110" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb196-111"><a href="#cb196-111" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb196-112"><a href="#cb196-112" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb196-113"><a href="#cb196-113" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-114"><a href="#cb196-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb196-115"><a href="#cb196-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-116"><a href="#cb196-116" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb196-117"><a href="#cb196-117" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-118"><a href="#cb196-118" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb196-119"><a href="#cb196-119" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb196-120"><a href="#cb196-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-121"><a href="#cb196-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-122"><a href="#cb196-122" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb196-123"><a href="#cb196-123" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb196-124"><a href="#cb196-124" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb196-125"><a href="#cb196-125" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb196-126"><a href="#cb196-126" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb196-127"><a href="#cb196-127" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb196-128"><a href="#cb196-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-129"><a href="#cb196-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb196-130"><a href="#cb196-130" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb196-131"><a href="#cb196-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb196-132"><a href="#cb196-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb196-133"><a href="#cb196-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb196-134"><a href="#cb196-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-135"><a href="#cb196-135" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb196-136"><a href="#cb196-136" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb196-137"><a href="#cb196-137" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb196-138"><a href="#cb196-138" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-139"><a href="#cb196-139" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb196-140"><a href="#cb196-140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb196-141"><a href="#cb196-141" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb196-142"><a href="#cb196-142" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb196-143"><a href="#cb196-143" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-144"><a href="#cb196-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb196-145"><a href="#cb196-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-146"><a href="#cb196-146" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb196-147"><a href="#cb196-147" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb196-148"><a href="#cb196-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-149"><a href="#cb196-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-150"><a href="#cb196-150" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb196-151"><a href="#cb196-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-152"><a href="#cb196-152" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb196-153"><a href="#cb196-153" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb196-154"><a href="#cb196-154" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb196-155"><a href="#cb196-155" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb196-156"><a href="#cb196-156" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb196-157"><a href="#cb196-157" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb196-158"><a href="#cb196-158" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb196-159"><a href="#cb196-159" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb196-160"><a href="#cb196-160" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb196-161"><a href="#cb196-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-162"><a href="#cb196-162" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb196-163"><a href="#cb196-163" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb196-164"><a href="#cb196-164" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print" class="level3">
<h3 class="anchored" data-anchor-id="using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print">using <span class="citation" data-cites="patch">@patch</span> to enable docs for instance methods like <a href="https://EmbraceLife.github.io/fastdebug/core.html#dbprint"><code>dbprint</code></a> and <code>print</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Create a Fastdebug class which has two functionalities: dbprint and print."</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code you are exploring</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env variables needed for exploring the source code, e.g., g = globals()</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L482" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb" class="level3">
<h3 class="anchored" data-anchor-id="fastdb">Fastdb</h3>
<blockquote class="blockquote">
<pre><code> Fastdb (src, env)</code></pre>
</blockquote>
<p>Create a Fastdebug class which has two functionalities: dbprint and print.</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 84%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td>name of src code you are exploring</td>
</tr>
<tr class="even">
<td>env</td>
<td>env variables needed for exploring the source code, e.g., g = globals()</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># a srcline under investigation, can be either string or int</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating"</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">""</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is "" or "  " in the front or in the middle of codes</span></span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">""</span></span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb199-38"><a href="#cb199-38" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb199-39"><a href="#cb199-39" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">"dbprintinsert("</span></span>
<span id="cb199-40"><a href="#cb199-40" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb199-41"><a href="#cb199-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb199-42"><a href="#cb199-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb199-43"><a href="#cb199-43" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> <span class="st">"env=g"</span> <span class="op">+</span> <span class="st">")"</span></span>
<span id="cb199-44"><a href="#cb199-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb199-45"><a href="#cb199-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">'"'</span> <span class="op">+</span> <span class="st">","</span></span>
<span id="cb199-46"><a href="#cb199-46" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb199-47"><a href="#cb199-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-48"><a href="#cb199-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">"g = locals()"</span> <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb199-49"><a href="#cb199-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb199-50"><a href="#cb199-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>     </span>
<span id="cb199-51"><a href="#cb199-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb199-52"><a href="#cb199-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>                </span>
<span id="cb199-53"><a href="#cb199-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-54"><a href="#cb199-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb199-55"><a href="#cb199-55" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb199-56"><a href="#cb199-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-57"><a href="#cb199-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb199-58"><a href="#cb199-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb199-59"><a href="#cb199-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-60"><a href="#cb199-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb199-61"><a href="#cb199-61" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb199-62"><a href="#cb199-62" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb199-63"><a href="#cb199-63" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb199-64"><a href="#cb199-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb199-65"><a href="#cb199-65" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb199-66"><a href="#cb199-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"dbprintinsert"</span> <span class="kw">in</span> l: </span>
<span id="cb199-67"><a href="#cb199-67" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"(db)"</span>)</span>
<span id="cb199-68"><a href="#cb199-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb199-69"><a href="#cb199-69" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb199-70"><a href="#cb199-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-71"><a href="#cb199-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb199-72"><a href="#cb199-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-73"><a href="#cb199-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L494" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb.dbprint" class="level3">
<h3 class="anchored" data-anchor-id="fastdb.dbprint">Fastdb.dbprint</h3>
<blockquote class="blockquote">
<pre><code> Fastdb.dbprint (dbcode:int, cmt:str, *codes, expand:int=2,
                 showdbsrc:bool=False)</code></pre>
</blockquote>
<p>Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dbcode</td>
<td>int</td>
<td></td>
<td>a srcline under investigation, can be either string or int</td>
</tr>
<tr class="even">
<td>cmt</td>
<td>str</td>
<td></td>
<td>comment added to the srcline</td>
</tr>
<tr class="odd">
<td>codes</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>expand</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="odd">
<td>showdbsrc</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>:Fastdb, </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>            maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>            part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Print the source code in whole or parts with idx and comments you added with dbprint along the way."</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>    lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>    cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>: </span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb201-36"><a href="#cb201-36" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb201-37"><a href="#cb201-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb201-38"><a href="#cb201-38" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                      </span>
<span id="cb201-39"><a href="#cb201-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-40"><a href="#cb201-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb201-41"><a href="#cb201-41" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                 </span>
<span id="cb201-42"><a href="#cb201-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-43"><a href="#cb201-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb201-44"><a href="#cb201-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb201-45"><a href="#cb201-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-46"><a href="#cb201-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb201-47"><a href="#cb201-47" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb201-48"><a href="#cb201-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb201-49"><a href="#cb201-49" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-50"><a href="#cb201-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb201-51"><a href="#cb201-51" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb201-52"><a href="#cb201-52" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb201-53"><a href="#cb201-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb201-54"><a href="#cb201-54" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-55"><a href="#cb201-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb201-56"><a href="#cb201-56" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-57"><a href="#cb201-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb201-58"><a href="#cb201-58" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">" "</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">"("</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">")"</span>)</span>
<span id="cb201-59"><a href="#cb201-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-60"><a href="#cb201-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-61"><a href="#cb201-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb201-62"><a href="#cb201-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-63"><a href="#cb201-63" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb201-64"><a href="#cb201-64" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb201-65"><a href="#cb201-65" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb201-66"><a href="#cb201-66" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span> <span class="op">+</span> <span class="st">" # "</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb201-67"><a href="#cb201-67" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb201-68"><a href="#cb201-68" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                                                          </span>
<span id="cb201-69"><a href="#cb201-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-70"><a href="#cb201-70" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb201-71"><a href="#cb201-71" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&lt;100}</span><span class="st">'</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">"="</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f"(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)"</span>))                      </span>
<span id="cb201-72"><a href="#cb201-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-73"><a href="#cb201-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb201-74"><a href="#cb201-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'</span><span class="sc">{:&gt;157}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="ss">f"part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts"</span>))</span>
<span id="cb201-75"><a href="#cb201-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L570" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb.print" class="level3">
<h3 class="anchored" data-anchor-id="fastdb.print">Fastdb.print</h3>
<blockquote class="blockquote">
<pre><code> Fastdb.print (maxlines:int=33, part:int=0)</code></pre>
</blockquote>
<p>Print the source code in whole or parts with idx and comments you added with dbprint along the way.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>maxlines</td>
<td>int</td>
<td>33</td>
<td>maximum num of lines per page</td>
</tr>
<tr class="even">
<td>part</td>
<td>int</td>
<td>0</td>
<td>if the src is more than 33 lines, then divide the src by 33 into a few parts</td>
</tr>
</tbody>
</table>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" class="level3">
<h3 class="anchored" data-anchor-id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1">use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>dbsig <span class="op">=</span> sig.dbprint(<span class="dv">29</span>, <span class="st">"why has to unwrap?"</span>, <span class="st">"hasattr(obj, '__signature__')"</span>)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> dbsig</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>pprint(inspect.signature(Foo))</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>sig.<span class="bu">print</span>(part<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="use-guide-on-fastdb.dbprint" class="level3">
<h3 class="anchored" data-anchor-id="use-guide-on-fastdb.dbprint">use guide on Fastdb.dbprint</h3>
<ol type="1">
<li>don’t use for the line start with <code>elif</code>, as putting <a href="https://EmbraceLife.github.io/fastdebug/core.html#dbprintinsert"><code>dbprintinsert</code></a> above <code>elif</code> without indentation will cause syntax error. I am not sure whether I need to fix it now.</li>
</ol>
<p>see example <a href="./examples/Fastdb.html">here</a></p>
<p>test it with example <a href="./examples/print.html">here</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>