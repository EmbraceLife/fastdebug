<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.1.189" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="description" content="the core functionalities of fastdebug" />

<title>fastdebug – core</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">fastdebug</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EmbraceLife/fastdebug"><i 
  class="bi bi-github" 
  role="img" 
>
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" 
        data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
  >
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" 
        class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">fastdebug</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/core.html" class="sidebar-item-text sidebar-link active">core</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/FixSigMeta.html" class="sidebar-item-text sidebar-link">FixSigMeta</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">core</h1>
</div>

<div>
  <div class="description">
    the core functionalities of fastdebug
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#make-life-easier-with-defaults" id="toc-make-life-easier-with-defaults">make life easier with defaults</a></li>
  <li><a href="#globals-and-locals" id="toc-globals-and-locals">globals() and locals()</a></li>
  <li><a href="#execute-strings" id="toc-execute-strings">Execute strings</a>
  <ul>
  <li><a href="#new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" id="toc-new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals">new variable or updated variable by exec will only be accessible from locals()</a></li>
  <li><a href="#eval-can-override-its-own-globals-and-locals" id="toc-eval-can-override-its-own-globals-and-locals">eval can override its own globals() and locals()</a></li>
  <li><a href="#when-exec-update-existing-functions" id="toc-when-exec-update-existing-functions">when exec update existing functions</a></li>
  <li><a href="#when-the-func-to-be-udpated-involve-other-libraries" id="toc-when-the-func-to-be-udpated-involve-other-libraries">when the func to be udpated involve other libraries</a></li>
  <li><a href="#inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" id="toc-inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace">inside a function, exec() allow won’t give you necessary env from function namespace</a></li>
  <li><a href="#magic-of-execb-globals.updatelocals" id="toc-magic-of-execb-globals.updatelocals">magic of <code>exec(b, globals().update(locals()))</code></a></li>
  <li><a href="#bring-variables-from-a-func-namespace-to-the-sideout-world" id="toc-bring-variables-from-a-func-namespace-to-the-sideout-world">Bring variables from a func namespace to the sideout world</a></li>
  <li><a href="#globals-in-a-cell-vs-globals-in-a-func" id="toc-globals-in-a-cell-vs-globals-in-a-func">globals() in a cell vs globals() in a func</a></li>
  </ul></li>
  <li><a href="#make-a-colorful-string" id="toc-make-a-colorful-string">make a colorful string</a>
  <ul>
  <li><a href="#dbcolors" id="toc-dbcolors">dbcolors</a></li>
  <li><a href="#colorize" id="toc-colorize">colorize</a></li>
  </ul></li>
  <li><a href="#align-text-to-the-most-right" id="toc-align-text-to-the-most-right">align text to the most right</a>
  <ul>
  <li><a href="#strip_ansi" id="toc-strip_ansi">strip_ansi</a></li>
  <li><a href="#alignright" id="toc-alignright">alignright</a></li>
  </ul></li>
  <li><a href="#printsrcwithidx" id="toc-printsrcwithidx">printsrcwithidx</a>
  <ul>
  <li><a href="#print-the-entire-source-code-with-idx-from-0" id="toc-print-the-entire-source-code-with-idx-from-0">print the entire source code with idx from 0</a></li>
  <li><a href="#print-the-whole-src-with-idx-or-print-them-in-parts" id="toc-print-the-whole-src-with-idx-or-print-them-in-parts">print the whole src with idx or print them in parts</a></li>
  <li><a href="#use-cmts-from-dbprint-to-print-out-src-with-comments" id="toc-use-cmts-from-dbprint-to-print-out-src-with-comments">use cmts from dbprint to print out src with comments</a></li>
  <li><a href="#printsrcwithidx-1" id="toc-printsrcwithidx-1">printsrcwithidx</a></li>
  <li><a href="#no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" id="toc-no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print">no more update for printsrcwithidx, for the latest see Fastdb.print</a></li>
  </ul></li>
  <li><a href="#print-out-src-code" id="toc-print-out-src-code">print out src code</a>
  <ul>
  <li><a href="#basic-version" id="toc-basic-version">basic version</a></li>
  <li><a href="#print-src-with-specific-number-of-lines" id="toc-print-src-with-specific-number-of-lines">print src with specific number of lines</a></li>
  <li><a href="#make-the-naming-more-sensible" id="toc-make-the-naming-more-sensible">make the naming more sensible</a></li>
  <li><a href="#allow-a-dbline-occur-more-than-once" id="toc-allow-a-dbline-occur-more-than-once">Allow a dbline occur more than once</a></li>
  <li><a href="#adding-idx-to-the-selected-srclines" id="toc-adding-idx-to-the-selected-srclines">adding idx to the selected srclines</a>
  <ul>
  <li><a href="#printsrclinewithidx" id="toc-printsrclinewithidx">printsrclinewithidx</a></li>
  </ul></li>
  <li><a href="#printsrclinewithidx-1" id="toc-printsrclinewithidx-1">printsrclinewithidx</a></li>
  <li><a href="#dblines-can-be-string-of-code-or-idx-number" id="toc-dblines-can-be-string-of-code-or-idx-number">dblines can be string of code or idx number</a></li>
  <li><a href="#avoid-multi-occurrance-of-the-same-srcline" id="toc-avoid-multi-occurrance-of-the-same-srcline">avoid multi-occurrance of the same srcline</a></li>
  <li><a href="#printsrc" id="toc-printsrc">printsrc</a></li>
  </ul></li>
  <li><a href="#dbprint-on-expression" id="toc-dbprint-on-expression">dbprint on expression</a>
  <ul>
  <li><a href="#basic-version-1" id="toc-basic-version-1">basic version</a></li>
  <li><a href="#insert-dbcode-and-make-a-new-dbfunc" id="toc-insert-dbcode-and-make-a-new-dbfunc">insert dbcode and make a new dbfunc</a></li>
  <li><a href="#bring-outside-namespace-variables-into-exec" id="toc-bring-outside-namespace-variables-into-exec">Bring outside namespace variables into exec()</a></li>
  <li><a href="#bring-what-inside-the-func-namespace-variables-to-the-outside-world" id="toc-bring-what-inside-the-func-namespace-variables-to-the-outside-world">Bring what inside the func namespace variables to the outside world</a></li>
  <li><a href="#adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" id="toc-adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually">Adding g = locals() to dbprintinsert to avoid adding env individually</a></li>
  <li><a href="#enable-srclines-to-be-either-string-or-int" id="toc-enable-srclines-to-be-either-string-or-int">enable srclines to be either string or int</a></li>
  <li><a href="#enable-to-be-used-as-assignment-in-codes" id="toc-enable-to-be-used-as-assignment-in-codes">enable = to be used as assignment in codes</a></li>
  <li><a href="#avoid-adding-envg-for-dbprintinsert" id="toc-avoid-adding-envg-for-dbprintinsert">avoid adding “env=g” for dbprintinsert</a></li>
  <li><a href="#collect-cmt-for-later-printsrcwithidx-to-print-comments-together" id="toc-collect-cmt-for-later-printsrcwithidx-to-print-comments-together">collect cmt for later printsrcwithidx to print comments together</a></li>
  <li><a href="#make-sure-only-one-line-with-correct-idx-is-debugged" id="toc-make-sure-only-one-line-with-correct-idx-is-debugged">make sure only one line with correct idx is debugged</a></li>
  <li><a href="#dbprint" id="toc-dbprint">dbprint</a></li>
  <li><a href="#avoid-typing-when-there-is-no-codes" id="toc-avoid-typing-when-there-is-no-codes">avoid typing “” when there is no codes</a></li>
  <li><a href="#no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" id="toc-no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint">no more update for dbprint, for the latest see Fastdb.dbprint</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile">use dbprint to override the original official code without changing its own pyfile</a></li>
  </ul></li>
  <li><a href="#dbprintinsert" id="toc-dbprintinsert">dbprintinsert</a>
  <ul>
  <li><a href="#run-and-display-the-inserted-dbcodes" id="toc-run-and-display-the-inserted-dbcodes">Run and display the inserted dbcodes</a></li>
  <li><a href="#use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" id="toc-use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually">use locals() inside the dbsrc code to avoid adding env individually</a></li>
  <li><a href="#enable-dbprintinsert-to-do-exec-on-a-block-of-code" id="toc-enable-dbprintinsert-to-do-exec-on-a-block-of-code">enable dbprintinsert to do exec on a block of code</a></li>
  <li><a href="#dbprintinsert-1" id="toc-dbprintinsert-1">dbprintinsert</a></li>
  </ul></li>
  <li><a href="#printrunsrclines" id="toc-printrunsrclines">printrunsrclines()</a>
  <ul>
  <li><a href="#examples" id="toc-examples">Examples</a>
  <ul>
  <li><a href="#simple-example" id="toc-simple-example">simple example</a></li>
  <li><a href="#complex-example" id="toc-complex-example">complex example</a></li>
  </ul></li>
  <li><a href="#insert-a-line-after-each-srcline-to-add-idx" id="toc-insert-a-line-after-each-srcline-to-add-idx">insert a line after each srcline to add idx</a></li>
  <li><a href="#add-correct-indentation-to-each-inserted-line" id="toc-add-correct-indentation-to-each-inserted-line">add correct indentation to each inserted line</a>
  <ul>
  <li><a href="#count-the-indentation-for-each-srcline" id="toc-count-the-indentation-for-each-srcline">count the indentation for each srcline</a></li>
  </ul></li>
  <li><a href="#indentation-special-case-if-else-for-def" id="toc-indentation-special-case-if-else-for-def">indentation special case: if, else, for, def</a></li>
  <li><a href="#remove-pure-comments-or-docs-from-dbsrc" id="toc-remove-pure-comments-or-docs-from-dbsrc">remove pure comments or docs from dbsrc</a></li>
  <li><a href="#print-out-the-srclines-which-get-run" id="toc-print-out-the-srclines-which-get-run">print out the srclines which get run</a></li>
  <li><a href="#make-sure-all-if-else-for-get-printed" id="toc-make-sure-all-if-else-for-get-printed">Make sure all if, else, for get printed</a></li>
  <li><a href="#put-all-together-into-the-function-printrunsrclines" id="toc-put-all-together-into-the-function-printrunsrclines">Put all together into the function printrunsrclines()</a>
  <ul>
  <li><a href="#no-more-renaming-of-foo" id="toc-no-more-renaming-of-foo">no more renaming of foo</a></li>
  <li><a href="#add-example-as-a-param-into-the-function" id="toc-add-example-as-a-param-into-the-function">add example as a param into the function</a></li>
  </ul></li>
  <li><a href="#printrunsrclines-1" id="toc-printrunsrclines-1">printrunsrclines</a>
  <ul>
  <li><a href="#improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" id="toc-improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples">improve on search for <code>if</code>, else, for, def to avoid errors for more examples</a></li>
  <li><a href="#remove-an-empty-line-with-indentation" id="toc-remove-an-empty-line-with-indentation">remove an empty line with indentation</a></li>
  </ul></li>
  <li><a href="#make-it-work" id="toc-make-it-work">make it work</a></li>
  <li><a href="#printrunsrclines-2" id="toc-printrunsrclines-2">printrunsrclines</a></li>
  <li><a href="#more-difficult-examples-to-test-printrunsrc" id="toc-more-difficult-examples-to-test-printrunsrc">more difficult examples to test printrunsrc()</a></li>
  </ul></li>
  <li><a href="#make-fastdebug-a-class" id="toc-make-fastdebug-a-class">Make fastdebug a class</a>
  <ul>
  <li><a href="#improve-on-the-line-idx-readability" id="toc-improve-on-the-line-idx-readability">improve on the line idx readability</a></li>
  <li><a href="#collect-cmt-from-dbprint-and-print" id="toc-collect-cmt-from-dbprint-and-print">collect cmt from dbprint and print</a></li>
  <li><a href="#make-sure-only-the-line-with-correct-idx-is-debugged" id="toc-make-sure-only-the-line-with-correct-idx-is-debugged">make sure only the line with correct idx is debugged</a></li>
  <li><a href="#having-or-inside-codes-without-causing-error" id="toc-having-or-inside-codes-without-causing-error">having “” or ” ” inside codes without causing error</a></li>
  <li><a href="#replace-fastdb.printsrcwithdix-with-fastdb.print" id="toc-replace-fastdb.printsrcwithdix-with-fastdb.print">replace Fastdb.printsrcwithdix with Fastdb.print</a></li>
  <li><a href="#add-idx-to-dbsrc-when-showdbsrctrue" id="toc-add-idx-to-dbsrc-when-showdbsrctrue">add idx to dbsrc when showdbsrc=True</a></li>
  <li><a href="#fastdb" id="toc-fastdb">Fastdb</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1">use dbprint to override the original official code without changing its own pyfile</a></li>
  <li><a href="#use-guide-on-fastdb.dbprint" id="toc-use-guide-on-fastdb.dbprint">use guide on Fastdb.dbprint</a></li>
  </ul></li>
  </ul>
</nav>
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="make-life-easier-with-defaults" class="level2">
<h2>make life easier with defaults</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>defaults <span class="op">=</span> <span class="bu">type</span>(<span class="st">&#39;defaults&#39;</span>, (<span class="bu">object</span>,), {<span class="st">&#39;margin&#39;</span>: <span class="dv">157</span>, <span class="co"># align to the right by 157</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;orisrc&#39;</span>: <span class="va">None</span>, <span class="co"># keep a copy of original official src code</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;outenv&#39;</span>: <span class="bu">globals</span>(), <span class="co"># outside global env</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;cmts&#39;</span>: {} <span class="co"># a dict to store idx and cmt</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># &#39;eg&#39;: None, # examples</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># &#39;src&#39;: None, # official src</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                                       })</span></code></pre></div>
</div>
</section>
<section id="globals-and-locals" class="level2">
<h2>globals() and locals()</h2>
<p>Interesting behavior of <a href="https://stackoverflow.com/questions/7969949/whats-the-difference-between-globals-locals-and-vars">locals()</a></p>
<div class="cell" data-execution_count="4">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">locals</span>() <span class="op">==</span> <span class="bu">globals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;functools&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;inspect&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;eval&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;defaults&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whatinside&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whichversion&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whatinside&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whichversion&quot;</span> <span class="kw">in</span> <span class="bu">globals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>True</code></pre>
</div>
</div>
</section>
<section id="execute-strings" class="level2">
<h2>Execute strings</h2>
<div class="cell" data-execution_count="14">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span>?</span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> eval<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">,</span> globals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> locals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">/</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Evaluate the given source in the context of globals and locals.
The source may be a string representing a Python expression
or a code object as returned by compile().
The globals must be a dictionary and locals can be any mapping,
defaulting to the current globals and locals.
If only globals is given, locals defaults to it.
<span class="ansi-red-fg">Type:</span>      builtin_function_or_method
</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>?</span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> exec<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">,</span> globals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> locals<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">/</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span>
Execute the given source in the context of globals and locals.
The source may be a string representing one or more Python statements
or a code object as returned by compile().
The globals must be a dictionary and locals can be any mapping,
defaulting to the current globals and locals.
If only globals is given, locals defaults to it.
<span class="ansi-red-fg">Type:</span>      builtin_function_or_method
</pre>
</div>
</div>
</div>
<section id="new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" class="level3">
<h3>new variable or updated variable by exec will only be accessible from locals()</h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;1+x&quot;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># x is not in locals() but in globals()</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">eval</span>(a)) </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;a&#39;: &#39;1+x&#39;}&quot;
2</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b) <span class="co"># b can&#39;t be accessed directly and not use the key b</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
name &#39;b&#39; is not defined</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># you can&#39;t even assign the value to b, otherwise b:value won&#39;t be available</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;KeyError: &#39;b&#39; does not exist&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;}
KeyError: &#39;b&#39; does not exist</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(c)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;KeyError: &#39;b&#39; does not exist&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;c = locals()[&quot;b&quot;]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(c = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">&quot;c = c + 1&quot;</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># update c won&#39;t change anything</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
c = locals()[&quot;b&quot;]; c: 2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}
exec(c = c + 1): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;c = locals()[&quot;b&quot;]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(d = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">&quot;d = c + 1&quot;</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># must assign to a different variable, not c anymore</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
c = locals()[&quot;b&quot;]; c: 2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}
exec(d = c + 1): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2, &#39;d&#39;: 3}</code></pre>
</div>
</div>
</section>
<section id="eval-can-override-its-own-globals-and-locals" class="level3">
<h3>eval can override its own globals() and locals()</h3>
<div class="cell" data-execution_count="23">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;a+1&quot;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;b: </span><span class="sc">{</span><span class="bu">eval</span>(b, {}, {<span class="st">&quot;a&quot;</span>: <span class="dv">2</span>})<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># globals() put to empty and locals() to include &#39;a&#39; with a different value</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;a&#39;: 1, &#39;b&#39;: &#39;a+1&#39;}&quot;
b: 3
&quot;locals: {&#39;a&#39;: 1, &#39;b&#39;: &#39;a+1&#39;}&quot;</code></pre>
</div>
</div>
</section>
<section id="when-exec-update-existing-functions" class="level3">
<h3>when exec update existing functions</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">&quot; + 3</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>]</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function foo at 0x11843c700&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): return x + y\\n&#39;, &#39;newb&#39;: &#39;def foo(x, y): return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;}&quot;
exec(newb): None
(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x11843c700&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): return x + y\\n&#39;, &#39;newb&#39;: &#39;def foo(x, y): return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;, &quot;
 &quot;&#39;foo&#39;: &lt;function foo at 0x11843c4c0&gt;}&quot;)
13
13
10
10</code></pre>
</div>
</div>
</section>
<section id="when-the-func-to-be-udpated-involve-other-libraries" class="level3">
<h3>when the func to be udpated involve other libraries</h3>
<div class="cell" data-execution_count="26">
<div class="sourceCode" id="cb39"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span></code></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode" id="cb40"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inspect.signature(foo))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="st">&quot;return&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l :</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l):</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">&quot; + 3</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>]</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x11843cca0&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n&#39;, &#39;newb&#39;: &#39;def &quot;
 &quot;foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;}&quot;)
exec(newb): None
(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x11843cca0&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n&#39;, &#39;newb&#39;: &#39;def &quot;
 &quot;foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;, &#39;foo&#39;: &lt;function foo at 0x11843ca60&gt;}&quot;)
(x, y)
13
(x, y)
13
(x, y)
10
(x, y)
10</code></pre>
</div>
</div>
</section>
<section id="inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" class="level3">
<h3>inside a function, exec() allow won’t give you necessary env from function namespace</h3>
<div class="cell" data-execution_count="28">
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b) <span class="co"># create the new add in locals</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;add(5,6): </span><span class="sc">{</span>add(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] <span class="co"># assign a different name, add1</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;add1(5,6): </span><span class="sc">{</span>add1(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># error: lst is not defined, even though lst=[] is right above</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x11843cf70&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x11843cf70&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x11845a0d0&gt;}&#39;)
add(5,6): 1
name &#39;lst&#39; is not defined</code></pre>
</div>
</div>
</section>
<section id="magic-of-execb-globals.updatelocals" class="level3">
<h3>magic of <code>exec(b, globals().update(locals()))</code></h3>
<p>What about <code>exec(b, globals().update(globals()))</code></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">globals</span>())) <span class="co"># update(globals()) won&#39;t give us lst above</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;exec(b, globals().update(globals())) won&#39;t give us lst in the func namespace&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845a4c0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845a4c0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x11845a430&gt;}&#39;)
exec(b, globals().update(globals())) won&#39;t give us lst in the func namespace</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(add(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;you can&#39;t bring add1 from a function namespace to the outside world&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845a790&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845a790&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x11845a940&gt;}&#39;)
11
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845a790&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [5], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &quot;0x11845a940&gt;, &#39;add1&#39;: &lt;function add at 0x11845a940&gt;}&quot;)
1
you can&#39;t bring add1 from a function namespace to the outside world</code></pre>
</div>
</div>
</section>
<section id="bring-variables-from-a-func-namespace-to-the-sideout-world" class="level3">
<h3>Bring variables from a func namespace to the sideout world</h3>
<div class="cell" data-execution_count="31">
<div class="sourceCode" id="cb48"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)    </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    add1(<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bring variables inside a func to the outside</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>pprint(add(<span class="dv">5</span>,<span class="dv">6</span>)) <span class="co"># the original add is override by the add from the function&#39;s locals()</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>pprint(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845ab80&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
11
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x11845ab80&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [5, 5], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add &quot;
 &quot;at 0x11845a790&gt;, &#39;add1&#39;: &lt;function add at 0x11845a790&gt;}&quot;)
11
11
[5, 5, 5, 5]</code></pre>
</div>
</div>
</section>
<section id="globals-in-a-cell-vs-globals-in-a-func" class="level3">
<h3>globals() in a cell vs globals() in a func</h3>
<div class="cell" data-execution_count="32">
<div class="sourceCode" id="cb50"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> tstenv</span></code></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode" id="cb51"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">globals</span>().keys())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>87</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">globals</span>()[<span class="st">&#39;__name__&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>&#39;__main__&#39;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tstenv()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>out global env has 20 vars
inner global env has 20 vars
inner local env has 20 vars
[&#39;__name__&#39;, &#39;__doc__&#39;, &#39;__package__&#39;, &#39;__loader__&#39;, &#39;__spec__&#39;, &#39;__file__&#39;, &#39;__cached__&#39;, &#39;__builtins__&#39;, &#39;__all__&#39;, &#39;os&#39;]
[&#39;__name__&#39;, &#39;__doc__&#39;, &#39;__package__&#39;, &#39;__loader__&#39;, &#39;__spec__&#39;, &#39;__file__&#39;, &#39;__cached__&#39;, &#39;__builtins__&#39;, &#39;__all__&#39;, &#39;os&#39;]
out env[&#39;__name__&#39;]: fastdebug.utils
inner env[&#39;__name__&#39;]: fastdebug.utils</code></pre>
</div>
</div>
</section>
</section>
<section id="make-a-colorful-string" class="level2">
<h2>make a colorful string</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L23" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dbcolors" class="level3">
<h3>dbcolors</h3>
<blockquote>
<pre><code> dbcolors ()</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L30" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="colorize" class="level3">
<h3>colorize</h3>
<blockquote>
<pre><code> colorize (cmt, color:str=None)</code></pre>
</blockquote>
<div class="cell" data-execution_count="38">
<div class="sourceCode" id="cb59"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>colorize(<span class="st">&quot;this is me&quot;</span>, <span class="st">&quot;r&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>&#39;\x1b[91mthis is me\x1b[0m&#39;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(colorize(<span class="st">&quot;this is me&quot;</span>, <span class="st">&quot;r&quot;</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="align-text-to-the-most-right" class="level2">
<h2>align text to the most right</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L44" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="strip_ansi" class="level3">
<h3>strip_ansi</h3>
<blockquote>
<pre><code> strip_ansi (source)</code></pre>
</blockquote>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L48" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="alignright" class="level3">
<h3>alignright</h3>
<blockquote>
<pre><code> alignright (blocks)</code></pre>
</blockquote>
<div class="cell" data-execution_count="43">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>alignright(<span class="st">&quot;this is me&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                   this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="printsrcwithidx" class="level2">
<h2>printsrcwithidx</h2>
<section id="print-the-entire-source-code-with-idx-from-0" class="level3">
<h3>print the entire source code with idx from 0</h3>
<div class="cell" data-execution_count="44">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="print-the-whole-src-with-idx-or-print-them-in-parts" class="level3">
<h3>print the whole src with idx or print them in parts</h3>
<div class="cell" data-execution_count="45">
<div class="sourceCode" id="cb68"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                    maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                    part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="use-cmts-from-dbprint-to-print-out-src-with-comments" class="level3">
<h3>use cmts from dbprint to print out src with comments</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L56" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printsrcwithidx-1" class="level3">
<h3>printsrcwithidx</h3>
<blockquote>
<pre><code> printsrcwithidx (src, maxlines:int=33, part:int=0)</code></pre>
</blockquote>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>maxlines</td>
<td>int</td>
<td>33</td>
<td>maximum num of lines per page</td>
</tr>
<tr class="odd">
<td>part</td>
<td>int</td>
<td>0</td>
<td>if the src is more than 33 lines, then divide the src by 33 into a few parts</td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="47">
<div class="sourceCode" id="cb70"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>printsrcwithidx(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(x, y): ===========================================================================(0)       
    print(inspect.signature(foo))=========================================================(1)       
    return x + y==========================================================================(2)       
                                                                                                                                                        (3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode" id="cb72"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>printsrcwithidx(pprint)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def pprint(object, stream=None, indent=1, width=80, depth=None, *,========================(0)       
           compact=False, sort_dicts=True):===============================================(1)       
    &quot;&quot;&quot;Pretty-print a Python object to a stream [default is sys.stdout].&quot;&quot;&quot;===============(2)       
    printer = PrettyPrinter(==============================================================(3)       
        stream=stream, indent=indent, width=width, depth=depth,===========================(4)       
        compact=compact, sort_dicts=sort_dicts)===========================================(5)       
    printer.pprint(object)================================================================(6)       
                                                                                                                                                        (7)</code></pre>
</div>
</div>
</section>
<section id="no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" class="level3">
<h3>no more update for printsrcwithidx, for the latest see Fastdb.print</h3>
<p>see a <a href="./examples/dbprint.ipynb#test-printsrcwithidx">complex example</a> on printsrcwithidx</p>
</section>
</section>
<section id="print-out-src-code" class="level2">
<h2>print out src code</h2>
<section id="basic-version" class="level3">
<h3>basic version</h3>
<div class="cell" data-execution_count="50">
<div class="sourceCode" id="cb74"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the title</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:#^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="st">&quot; srcline under investigation &quot;</span>))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by &#39;\n&#39;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>                numsrclines <span class="op">=</span> <span class="bu">len</span>(srclines.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>) <span class="co"># colorize the comment</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: </span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode" id="cb75"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode" id="cb76"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;a = 1 + 1&quot;</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
                                                                                                                                              this is comment
    b = a + 1                                                                                                                                                
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode" id="cb78"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;    a = 1 + 1</span><span class="ch">\n</span><span class="st">    b = a + 1&quot;</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
    b = a + 1================================================================================================================================================
                                                                                                                                              this is comment
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
</section>
<section id="print-src-with-specific-number-of-lines" class="level3">
<h3>print src with specific number of lines</h3>
<div class="cell" data-execution_count="54">
<div class="sourceCode" id="cb80"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&quot;    this is a code</span><span class="ch">\n</span><span class="st">this is another code&quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), <span class="st">&quot;    this is a code</span><span class="ch">\n</span><span class="st">    this is another code</span><span class="ch">\n</span><span class="st">   </span><span class="ch">\n</span><span class="st">   &quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode" id="cb82"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by &#39;\n&#39;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find out the idx of start srclines and end srclines</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    startidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    numsrclines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), srclines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>            startidx <span class="op">=</span> idx</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    endidx <span class="op">=</span> startidx <span class="op">+</span> numsrclines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation with # as padding</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>                <span class="co"># numsrclines = len(srclines.split(&quot;\n&quot;))</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>) <span class="co"># colorize the comment</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startidx <span class="op">-</span> expand:</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> endidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> endidx:</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span></code></pre></div>
</div>
</section>
<section id="make-the-naming-more-sensible" class="level3">
<h3>make the naming more sensible</h3>
<div class="cell" data-execution_count="56">
<div class="sourceCode" id="cb83"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    startdbidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>            startdbidx <span class="op">=</span> idx</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    enddbidx <span class="op">=</span> startdbidx <span class="op">+</span> numdblines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    dbcount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>            dbcount <span class="op">=</span> dbcount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dbcount <span class="op">==</span> numdblines:</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startdbidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startdbidx <span class="op">-</span> expand:</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> enddbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> enddbidx:</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span></code></pre></div>
</div>
</section>
<section id="allow-a-dbline-occur-more-than-once" class="level3">
<h3>Allow a dbline occur more than once</h3>
<div class="cell" data-execution_count="57">
<div class="sourceCode" id="cb84"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f&#39;idx: {idx}; and l: {l}&#39;) # debugging</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># enddbidx = startdbidx + numdblines - 1</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbcount = 0</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f&#39;idx: {idx}; and l: {l}&#39;) # debugging</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># dbcount = dbcount + 1</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if dbcount == numdblines:</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx: </span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx: </span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="adding-idx-to-the-selected-srclines" class="level3">
<h3>adding idx to the selected srclines</h3>
<section id="printsrclinewithidx" class="level4">
<h4>printsrclinewithidx</h4>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L134" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="printsrclinewithidx-1" class="level3">
<h3>printsrclinewithidx</h3>
<blockquote>
<pre><code> printsrclinewithidx (idx, l, fill=&#39; &#39;)</code></pre>
</blockquote>
<div class="cell" data-execution_count="59">
<div class="sourceCode" id="cb86"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>             dblines,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">&quot;=&quot;</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="dblines-can-be-string-of-code-or-idx-number" class="level3">
<h3>dblines can be string of code or idx number</h3>
<div class="cell" data-execution_count="60">
<div class="sourceCode" id="cb87"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(<span class="bu">int</span>(<span class="st">&quot;120&quot;</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>int</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode" id="cb89"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(a) <span class="op">==</span> <span class="bu">int</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode" id="cb91"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>             dbcode, <span class="co"># string of codes or int of code idx number</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    dblines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> lstsrc[dbcode]</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> dbcode</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>        numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">&quot;=&quot;</span>)</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="avoid-multi-occurrance-of-the-same-srcline" class="level3">
<h3>avoid multi-occurrance of the same srcline</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L141" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printsrc" class="level3">
<h3>printsrc</h3>
<blockquote>
<pre><code> printsrc (src, dbcode, cmt, expand:int=2)</code></pre>
</blockquote>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>name of src code such as foo, or delegates</td>
</tr>
<tr class="even">
<td>dbcode</td>
<td></td>
<td></td>
<td>string of codes or int of code idx number</td>
</tr>
<tr class="odd">
<td>cmt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>expand</td>
<td>int</td>
<td>2</td>
<td>expand the codes around the srcline under investigation</td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="64">
<div class="sourceCode" id="cb93"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode" id="cb94"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;else:&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, expand<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:===============================================================================================================================================(6)
                                                                                                                                              this is comment
        &quot;this is docs&quot;                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    &quot;this is docs&quot;                                                                                                                                      (9)
    return a                                                                                                                                            (10)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode" id="cb96"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;return a&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, expand<span class="op">=</span><span class="dv">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    &quot;this is docs&quot;                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:                                                                                                                                               (6)
        &quot;this is docs&quot;                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    &quot;this is docs&quot;                                                                                                                                      (9)
    return a============================================================================================================================================(10)
                                                                                                                                              this is comment
                                                                                                                                                        (11)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode" id="cb98"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="dv">3</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    &quot;this is docs&quot;                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:===========================================================================================================================================(3)
                                                                                                                                              this is comment
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)</code></pre>
</div>
</div>
<p>more <a href="./examples/printsrc.ipynb">complex example</a> on printsrc</p>
</section>
</section>
<section id="dbprint-on-expression" class="level2">
<h2>dbprint on expression</h2>
<section id="basic-version-1" class="level3">
<h3>basic version</h3>
<div class="cell" data-execution_count="68">
<div class="sourceCode" id="cb100"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>code,   <span class="co"># a number of codes to run, each code is in str, e.g., &quot;a + b&quot;, &quot;c = a - b&quot;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>env</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;debug a srcline with one or more expressions with src printed.&quot;</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> code:</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode" id="cb101"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode" id="cb102"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(): </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    dbprint(foo, <span class="st">&quot;    a = 1 + 1&quot;</span>, <span class="st">&quot;this is a test&quot;</span>, <span class="st">&quot;1+2&quot;</span>, <span class="st">&quot;str(1+2)&quot;</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode" id="cb103"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>foo()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo():                                                                                                                                              (0)
    dbprint(foo, &quot;    a = 1 + 1&quot;, &quot;this is a test&quot;, &quot;1+2&quot;, &quot;str(1+2)&quot;)                                                                                  (1)
    a = 1 + 1===========================================================================================================================================(2)
                                                                                                                                               this is a test
    pass                                                                                                                                                (3)
                                                                                                                                                        (4)
                                                                                                                                               1+2 =&gt; 1+2 : 3
                                                                                                                                     str(1+2) =&gt; str(1+2) : 3</code></pre>
</div>
</div>
</section>
<section id="insert-dbcode-and-make-a-new-dbfunc" class="level3">
<h3>insert dbcode and make a new dbfunc</h3>
<p>when bringing back splitted lines back, we need add ‘’ back to them</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode" id="cb105"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>back <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    back <span class="op">=</span> back <span class="op">+</span> l</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>pprint(back, width<span class="op">=</span><span class="dv">157</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&#39;def foo():     dbprint(foo, &quot;    a = 1 + 1&quot;, &quot;this is a test&quot;, &quot;1+2&quot;, &quot;str(1+2)&quot;)    a = 1 + 1    pass&#39;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode" id="cb107"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span> <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb107-40"><a href="#cb107-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-67"><a href="#cb107-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc) <span class="co"># created new foo and saved inside locals()</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(locals())</span></span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="bring-outside-namespace-variables-into-exec" class="level3">
<h3>Bring outside namespace variables into exec()</h3>
<div class="cell" data-execution_count="74">
<div class="sourceCode" id="cb108"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc) # created new foo and saved inside locals()</span></span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc, globals().update(locals())) # make sure b can access lst from above</span></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="bring-what-inside-the-func-namespace-variables-to-the-outside-world" class="level3">
<h3>Bring what inside the func namespace variables to the outside world</h3>
<div class="cell" data-execution_count="75">
<div class="sourceCode" id="cb109"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-49"><a href="#cb109-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb109-50"><a href="#cb109-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb109-51"><a href="#cb109-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb109-61"><a href="#cb109-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-62"><a href="#cb109-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb109-63"><a href="#cb109-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-64"><a href="#cb109-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb109-65"><a href="#cb109-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-66"><a href="#cb109-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb109-67"><a href="#cb109-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb109-68"><a href="#cb109-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb109-69"><a href="#cb109-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-70"><a href="#cb109-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb109-71"><a href="#cb109-71" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb109-72"><a href="#cb109-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-73"><a href="#cb109-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
<p>see a <a href="./examples/dbprint.ipynb">complex example</a> on dbprint</p>
</section>
<section id="adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" class="level3">
<h3>Adding g = locals() to dbprintinsert to avoid adding env individually</h3>
<div class="cell" data-execution_count="76">
<div class="sourceCode" id="cb110"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-74"><a href="#cb110-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb110-75"><a href="#cb110-75" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb110-76"><a href="#cb110-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-77"><a href="#cb110-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="enable-srclines-to-be-either-string-or-int" class="level3">
<h3>enable srclines to be either string or int</h3>
<div class="cell" data-execution_count="77">
<div class="sourceCode" id="cb111"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb111-76"><a href="#cb111-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-77"><a href="#cb111-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb111-78"><a href="#cb111-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb111-79"><a href="#cb111-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb111-80"><a href="#cb111-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-81"><a href="#cb111-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb111-82"><a href="#cb111-82" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb111-83"><a href="#cb111-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-84"><a href="#cb111-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="enable-to-be-used-as-assignment-in-codes" class="level3">
<h3>enable = to be used as assignment in codes</h3>
<div class="cell" data-execution_count="78">
<div class="sourceCode" id="cb112"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;env=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count == len(codes) and &quot;=&quot; not in c:</span></span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;)&quot;</span></span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and &quot;=&quot; in c:</span></span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + c + &quot;,&quot;</span></span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and &quot;=&quot; not in c:</span></span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb112-60"><a href="#cb112-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-61"><a href="#cb112-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb112-62"><a href="#cb112-62" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb112-63"><a href="#cb112-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb112-64"><a href="#cb112-64" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-65"><a href="#cb112-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb112-66"><a href="#cb112-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb112-67"><a href="#cb112-67" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb112-68"><a href="#cb112-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-69"><a href="#cb112-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb112-70"><a href="#cb112-70" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-71"><a href="#cb112-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-72"><a href="#cb112-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb112-73"><a href="#cb112-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb112-74"><a href="#cb112-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb112-75"><a href="#cb112-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-76"><a href="#cb112-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb112-77"><a href="#cb112-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-78"><a href="#cb112-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb112-79"><a href="#cb112-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb112-80"><a href="#cb112-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb112-81"><a href="#cb112-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-82"><a href="#cb112-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb112-83"><a href="#cb112-83" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb112-84"><a href="#cb112-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-85"><a href="#cb112-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="avoid-adding-envg-for-dbprintinsert" class="level3">
<h3>avoid adding “env=g” for dbprintinsert</h3>
<div class="cell" data-execution_count="79">
<div class="sourceCode" id="cb113"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-66"><a href="#cb113-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-67"><a href="#cb113-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb113-68"><a href="#cb113-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb113-69"><a href="#cb113-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb113-70"><a href="#cb113-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-71"><a href="#cb113-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb113-72"><a href="#cb113-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-73"><a href="#cb113-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb113-74"><a href="#cb113-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb113-75"><a href="#cb113-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb113-76"><a href="#cb113-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-77"><a href="#cb113-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb113-78"><a href="#cb113-78" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb113-79"><a href="#cb113-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-80"><a href="#cb113-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="collect-cmt-for-later-printsrcwithidx-to-print-comments-together" class="level3">
<h3>collect cmt for later printsrcwithidx to print comments together</h3>
<div class="cell" data-execution_count="80">
<div class="sourceCode" id="cb114"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>            env<span class="op">=</span>{}): <span class="co"># out environment</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: defaults.cmts.update({dbcode: cmt})</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb114-55"><a href="#cb114-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-56"><a href="#cb114-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb114-57"><a href="#cb114-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-58"><a href="#cb114-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-59"><a href="#cb114-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb114-60"><a href="#cb114-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-61"><a href="#cb114-61" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb114-62"><a href="#cb114-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-63"><a href="#cb114-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="make-sure-only-one-line-with-correct-idx-is-debugged" class="level3">
<h3>make sure only one line with correct idx is debugged</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L179" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dbprint" class="level3">
<h3>dbprint</h3>
<blockquote>
<pre><code> dbprint (src, dbcode, cmt:str, *codes, expand:int=2, env={},
          showdbsrc=False)</code></pre>
</blockquote>
<p>Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>the src func name, e.g., foo</td>
</tr>
<tr class="even">
<td>dbcode</td>
<td></td>
<td></td>
<td>the srclines under investigation, can be either string or int</td>
</tr>
<tr class="odd">
<td>cmt</td>
<td>str</td>
<td></td>
<td>comment</td>
</tr>
<tr class="even">
<td>codes</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>expand</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="even">
<td>env</td>
<td>dict</td>
<td>{}</td>
<td></td>
</tr>
<tr class="odd">
<td>showdbsrc</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="avoid-typing-when-there-is-no-codes" class="level3">
<h3>avoid typing “” when there is no codes</h3>
<div class="cell" data-execution_count="82">
<div class="sourceCode" id="cb116"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def dbprint(src, # the src func name, e.g., foo</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcode, # the srclines under investigation, can be either string or int</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co">#             cmt:str, # comment</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">#             *codes, # a list of dbcodes</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">#             expand:int=2, # span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             env={}, # out environment</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             showdbsrc=False): # print out dbsrc or not</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     # make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     if defaults.orisrc == None:</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="co">#         defaults.orisrc = src</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     else: </span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         src = defaults.orisrc</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int: defaults.cmts.update({dbcode: cmt})</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     printsrc(src, dbcode, cmt, expand)</span></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     dbsrc = &quot;&quot;</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     indent = 4</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     onedbprint = False</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     lst = inspect.getsource(src).split(&#39;\n&#39;)</span></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     if not bool(lst[-1]): lst = lst[:-1]</span></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     srclines = &quot;&quot;</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int:</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = lst[dbcode]</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     for idx, l in zip(range(len(lst)), lst):</span></span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         if bool(l.strip()) and l.strip() in srclines:</span></span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a><span class="co">#             numindent = len(l) - len(l.strip())</span></span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcodes = &quot;dbprintinsert(&quot;</span></span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a><span class="co">#             count = 1</span></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a><span class="co">#             for c in codes:</span></span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if count == len(codes):</span></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;,&quot; + &quot;env=g&quot; + &quot;)&quot;</span></span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                 else:</span></span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;,&quot;</span></span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                 count = count + 1</span></span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a><span class="co">#             if onedbprint == False:</span></span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + &quot; &quot;*numindent + &quot;g = locals()&quot; + &#39;\n&#39;</span></span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + &quot; &quot;*numindent + dbcodes + &#39;\n&#39;</span></span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                 onedbprint = True</span></span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a><span class="co">#             else:</span></span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()) and idx + 1 == len(lst):</span></span>
<span id="cb116-55"><a href="#cb116-55" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l</span></span>
<span id="cb116-56"><a href="#cb116-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-57"><a href="#cb116-57" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()): # make sure pure indentation + \n is ignored</span></span>
<span id="cb116-58"><a href="#cb116-58" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb116-59"><a href="#cb116-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-60"><a href="#cb116-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     if showdbsrc: # added to debug</span></span>
<span id="cb116-61"><a href="#cb116-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb116-62"><a href="#cb116-62" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(l)</span></span>
<span id="cb116-63"><a href="#cb116-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-64"><a href="#cb116-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     exec(dbsrc, globals().update(env)) # make sure b can access lst from above</span></span>
<span id="cb116-65"><a href="#cb116-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-66"><a href="#cb116-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     env.update(locals())</span></span>
<span id="cb116-67"><a href="#cb116-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-68"><a href="#cb116-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[defaults.orisrc.__name__]</span></span></code></pre></div>
</div>
</section>
<section id="no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" class="level3">
<h3>no more update for dbprint, for the latest see Fastdb.dbprint</h3>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" class="level3">
<h3>use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>sfc <span class="op">=</span> dbprint(_signature_from_callable, <span class="st">&quot;if isinstance(obj, type):&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, <span class="op">\</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;locals()&quot;</span>, <span class="st">&quot;isinstance(obj, type)&quot;</span>, <span class="st">&quot;env=g&quot;</span>, <span class="op">\</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>              expand<span class="op">=</span><span class="dv">1</span>, env<span class="op">=</span>g)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co"># overriding the original official source with our dbsrc, even though rewriting _signature_from_callable inside inspect.py ######################</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> _signature_from_callable</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>inspect.signature(Foo) </span></code></pre></div>
</section>
</section>
<section id="dbprintinsert" class="level2">
<h2>dbprintinsert</h2>
<section id="run-and-display-the-inserted-dbcodes" class="level3">
<h3>Run and display the inserted dbcodes</h3>
<p>for each srcline under investigation, used inside dbprint</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode" id="cb118"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, <span class="op">**</span>env): </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode" id="cb119"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> a<span class="op">*</span><span class="dv">2</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> a <span class="op">*</span> b</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span></code></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode" id="cb120"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;   &quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode" id="cb122"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode" id="cb123"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a + 1&quot;</span>, env<span class="op">=</span>g)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>&lt;function __main__.foo(a)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode" id="cb126"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a + 1&quot;</span>, env<span class="op">=</span>g)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>&lt;function __main__.foo(a)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode" id="cb129"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co">#</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode" id="cb131"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>dbprint(foo, <span class="st">&quot;c = a * b&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;b * a&quot;</span>, expand<span class="op">=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1                                                                                                                                           (2)
    c = a * b===========================================================================================================================================(3)
                                                                                                                                                      comment
    return c                                                                                                                                            (4)
                                                                                                                                                        (5)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>&lt;function __main__.foo(a)&gt;</code></pre>
</div>
</div>
</section>
<section id="use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" class="level3">
<h3>use locals() inside the dbsrc code to avoid adding env individually</h3>
<div class="cell" data-execution_count="91">
<div class="sourceCode" id="cb134"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, env<span class="op">=</span>{}): </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
</section>
<section id="enable-dbprintinsert-to-do-exec-on-a-block-of-code" class="level3">
<h3>enable dbprintinsert to do exec on a block of code</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L251" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dbprintinsert-1" class="level3">
<h3>dbprintinsert</h3>
<blockquote>
<pre><code> dbprintinsert (*codes, env={})</code></pre>
</blockquote>
<div class="cell" data-execution_count="94">
<div class="sourceCode" id="cb136"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode" id="cb137"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a + 1&quot;</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode" id="cb140"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a + 1&quot;</span>, <span class="st">&quot;pprint(a)&quot;</span>, <span class="st">&quot;if a &gt; 2:</span><span class="ch">\\</span><span class="st">n    print(&#39;I am here&#39;)&quot;</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode" id="cb143"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;for i in range(3):</span><span class="ch">\\</span><span class="st">n    print(f&#39;I am </span><span class="sc">{i}</span><span class="st">&#39;)&quot;</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode" id="cb146"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;for i in range(3): print(f&#39;I am </span><span class="sc">{i}</span><span class="st">&#39;)&quot;</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode" id="cb149"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;pprint(locals())&quot;</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode" id="cb152"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>foo1 <span class="op">=</span> dbprint(foo, <span class="st">&quot;b = a + 1&quot;</span>, <span class="st">&quot;comment&quot;</span>, <span class="st">&quot;pprint(locals(), width=157)&quot;</span>) <span class="co"># width=157 can cause error</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>foo1(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    a = a*2                                                                                                                                             (1)
    b = a + 1===========================================================================================================================================(2)
                                                                                                                                                      comment
    c = a * b                                                                                                                                           (3)
    return c                                                                                                                                            (4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode" id="cb155"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> delegates</span></code></pre></div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode" id="cb156"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> inspect.getsource(delegates).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> ls[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>ls</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>[&#39;def delegates(to:FunctionType=None, # Delegatee&#39;,
 &#39;              keep=False, # Keep `kwargs` in decorated function?&#39;,
 &#39;              but:list=None): # Exclude these parameters from signature&#39;,
 &#39;    &quot;Decorator: replace `**kwargs` in signature with params from `to`&quot;&#39;,
 &#39;    if but is None: but = []&#39;,
 &#39;    def _f(f):&#39;,
 &#39;        if to is None: to_f,from_f = f.__base__.__init__,f.__init__&#39;,
 &#39;        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f&#39;,
 &quot;        from_f = getattr(from_f,&#39;__func__&#39;,from_f)&quot;,
 &quot;        to_f = getattr(to_f,&#39;__func__&#39;,to_f)&quot;,
 &quot;        if hasattr(from_f,&#39;__delwrap__&#39;): return f&quot;,
 &#39;        sig = inspect.signature(from_f)&#39;,
 &#39;        sigd = dict(sig.parameters)&#39;,
 &quot;        k = sigd.pop(&#39;kwargs&#39;)&quot;,
 &#39;        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()&#39;,
 &#39;              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}&#39;,
 &#39;        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}&#39;,
 &#39;        sigd.update(s2)&#39;,
 &quot;        if keep: sigd[&#39;kwargs&#39;] = k&quot;,
 &#39;        else: from_f.__delwrap__ = to_f&#39;,
 &#39;        from_f.__signature__ = sig.replace(parameters=sigd.values())&#39;,
 &quot;        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)&quot;,
 &#39;        return f&#39;,
 &#39;    return _f&#39;]</code></pre>
</div>
</div>
</section>
</section>
<section id="printrunsrclines" class="level2">
<h2>printrunsrclines()</h2>
<p>It can print out only srclines which actually ran</p>
<section id="examples" class="level3">
<h3>Examples</h3>
<section id="simple-example" class="level4">
<h4>simple example</h4>
<div class="cell" data-execution_count="103">
<div class="sourceCode" id="cb158"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def foo(a):</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     if a &gt; 1:</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         a = 1 + 1</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         b = a + 1</span></span></code></pre></div>
</div>
</section>
<section id="complex-example" class="level4">
<h4>complex example</h4>
<div class="cell" data-execution_count="104">
<div class="sourceCode" id="cb159"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode" id="cb160"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>3</code></pre>
</div>
</div>
</section>
</section>
<section id="insert-a-line-after-each-srcline-to-add-idx" class="level3">
<h3>insert a line after each srcline to add idx</h3>
<div class="cell" data-execution_count="106">
<div class="sourceCode" id="cb162"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if &quot;if&quot; in l or &quot;else&quot; in l or &quot;for&quot; in l:</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">    srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="ss">&quot;</span> <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode" id="cb163"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
    srcidx.append(3)
        for i in range(3):
    srcidx.append(4)
            a = i + 1
    srcidx.append(5)
    else:
    srcidx.append(6)
        &quot;this is docs&quot;
    srcidx.append(7)
        b = a + 1
    srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

    srcidx.append(11)
</code></pre>
</div>
</div>
</section>
<section id="add-correct-indentation-to-each-inserted-line" class="level3">
<h3>add correct indentation to each inserted line</h3>
<section id="count-the-indentation-for-each-srcline" class="level4">
<h4>count the indentation for each srcline</h4>
<div class="cell" data-execution_count="108">
<div class="sourceCode" id="cb165"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&quot;    a = 1&quot;</span>) <span class="op">-</span> <span class="bu">len</span>(<span class="st">&quot;    a = 1&quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode" id="cb167"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>   <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode" id="cb168"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
    srcidx.append(3)
        for i in range(3):
        srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
    srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

srcidx.append(11)
</code></pre>
</div>
</div>
</section>
</section>
<section id="indentation-special-case-if-else-for-def" class="level3">
<h3>indentation special case: if, else, for, def</h3>
<div class="cell" data-execution_count="111">
<div class="sourceCode" id="cb170"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="112">
<div class="sourceCode" id="cb171"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

srcidx.append(11)
</code></pre>
</div>
</div>
</section>
<section id="remove-pure-comments-or-docs-from-dbsrc" class="level3">
<h3>remove pure comments or docs from dbsrc</h3>
<p>Do not insert line for pure comment or pure “”</p>
<div class="cell" data-execution_count="113">
<div class="sourceCode" id="cb173"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span></code></pre></div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode" id="cb174"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> srclines:</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>    pprint(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&#39;def foo(a):&#39;
&#39;    &quot;this is docs&quot;&#39;
&#39;    # this is a pure comment&#39;
&#39;    if a &gt; 1:&#39;
&#39;        for i in range(3):&#39;
&#39;            a = i + 1&#39;
&#39;    else:&#39;
&#39;        &quot;this is docs&quot;&#39;
&#39;        b = a + 1&#39;
&#39;    &quot;this is docs&quot;&#39;
&#39;    return a&#39;
&#39;&#39;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode" id="cb176"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;# this is a comment&quot;</span>.startswith(<span class="st">&quot;#&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode" id="cb178"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;a = 1 # this is comment&quot;</span>.startswith(<span class="st">&quot;#&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode" id="cb180"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l): <span class="co"># ignore pure &#39;\n&#39;</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode" id="cb181"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode" id="cb183"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode" id="cb184"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>): <span class="co"># now the dbsrc has no pure comment and pure docs</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        b = a + 1
        srcidx.append(8)
    return a
    srcidx.append(10)
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode" id="cb186"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> foo<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Source:</span>   
<span class="ansi-green-fg">def</span> foo<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
    <span class="ansi-blue-fg">"this is docs"</span>
    <span class="ansi-red-fg"># this is a pure comment</span>
    <span class="ansi-green-fg">if</span> a <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
            a <span class="ansi-blue-fg">=</span> i <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span>
    <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-blue-fg">"this is docs"</span>
        b <span class="ansi-blue-fg">=</span> a <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span>
    <span class="ansi-blue-fg">"this is docs"</span>
    <span class="ansi-green-fg">return</span> a
<span class="ansi-red-fg">File:</span>      /var/folders/gz/ch3n2mp51m9386sytqf97s6w0000gn/T/ipykernel_50368/3208300118.py
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode" id="cb187"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>(dbsrc) <span class="co"># give life to dbsrc</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode" id="cb188"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> foo<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span> &lt;no docstring&gt;
<span class="ansi-red-fg">File:</span>      Dynamically generated function. No source code available.
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode" id="cb189"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>srcidx <span class="op">=</span> [] <span class="co">#used outside the srcode</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode" id="cb190"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co"># run the example using dbsrc</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo(-1) # run the example using dbsrc</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>srcidx <span class="co"># Now it should have all the idx whose srclines have run</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>[0, 3, 4, 5, 4, 5, 4, 5]</code></pre>
</div>
</div>
</section>
<section id="print-out-the-srclines-which-get-run" class="level3">
<h3>print out the srclines which get run</h3>
<div class="cell" data-execution_count="126">
<div class="sourceCode" id="cb192"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx:</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1</code></pre>
</div>
</div>
</section>
<section id="make-sure-all-if-else-for-get-printed" class="level3">
<h3>Make sure all if, else, for get printed</h3>
<div class="cell" data-execution_count="127">
<div class="sourceCode" id="cb194"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
</section>
<section id="put-all-together-into-the-function-printrunsrclines" class="level3">
<h3>Put all together into the function printrunsrclines()</h3>
<div class="cell" data-execution_count="128">
<div class="sourceCode" id="cb196"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode" id="cb197"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))</span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>    fool <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;foo&#39;</span>]</span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>    pprint(fool(<span class="dv">3</span>))</span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run = &quot;foo(3)&quot;</span></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">&quot;fool(3)&quot;</span>)</span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode" id="cb198"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3
{&#39;addline&#39;: &#39;srcidx.append(11)&#39;,
 &#39;dbsrc&#39;: &#39;def foo(a):\n&#39;
          &#39;    srcidx.append(0)\n&#39;
          &#39;    if a &gt; 1:\n&#39;
          &#39;        srcidx.append(3)\n&#39;
          &#39;        for i in range(3):\n&#39;
          &#39;            srcidx.append(4)\n&#39;
          &#39;            a = i + 1\n&#39;
          &#39;            srcidx.append(5)\n&#39;
          &#39;    else:\n&#39;
          &#39;        srcidx.append(6)\n&#39;
          &#39;        b = a + 1\n&#39;
          &#39;        srcidx.append(8)\n&#39;
          &#39;    return a\n&#39;
          &#39;    srcidx.append(10)\n&#39;,
 &#39;foo&#39;: &lt;function foo at 0x11850fee0&gt;,
 &#39;fool&#39;: &lt;function foo at 0x11850fee0&gt;,
 &#39;func&#39;: &lt;function foo at 0x11850f8b0&gt;,
 &#39;idx&#39;: 11,
 &#39;indent&#39;: 4,
 &#39;l&#39;: &#39;&#39;,
 &#39;numindent&#39;: 0,
 &#39;srcidx&#39;: [0, 3, 4, 5, 4, 5, 4, 5],
 &#39;srclines&#39;: [&#39;def foo(a):&#39;,
              &#39;    &quot;this is docs&quot;&#39;,
              &#39;    # this is a pure comment&#39;,
              &#39;    if a &gt; 1:&#39;,
              &#39;        for i in range(3):&#39;,
              &#39;            a = i + 1&#39;,
              &#39;    else:&#39;,
              &#39;        &quot;this is docs&quot;&#39;,
              &#39;        b = a + 1&#39;,
              &#39;    &quot;this is docs&quot;&#39;,
              &#39;    return a&#39;,
              &#39;&#39;]}
[0, 3, 4, 5, 4, 5, 4, 5, 0, 3, 4, 5, 4, 5, 4, 5]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
<section id="no-more-renaming-of-foo" class="level4">
<h4>no more renaming of foo</h4>
<div class="cell" data-execution_count="131">
<div class="sourceCode" id="cb200"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">&quot;foo(3)&quot;</span>) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode" id="cb201"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode" id="cb202"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 2, 3, 4, 3, 4, 3, 4]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
</section>
<section id="add-example-as-a-param-into-the-function" class="level4">
<h4>add example as a param into the function</h4>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L408" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="printrunsrclines-1" class="level3">
<h3>printrunsrclines</h3>
<blockquote>
<pre><code> printrunsrclines (func, example)</code></pre>
</blockquote>
<div class="cell" data-execution_count="135">
<div class="sourceCode" id="cb205"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">&quot;foo(-1)&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def foo(a):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &#39;    if a &gt; 1:\n&#39;
 &#39;        srcidx.append(2)\n&#39;
 &#39;        for i in range(3):\n&#39;
 &#39;            srcidx.append(3)\n&#39;
 &#39;            a = i + 1\n&#39;
 &#39;            srcidx.append(4)\n&#39;
 &#39;    else:\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        b = a + 1\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;    return a\n&#39;
 &#39;    srcidx.append(7)\n&#39;)
[0, 5, 6]
def foo(a):
    if a &gt; 1:
        for i in range(3):
    else:
        b = a + 1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="136">
<div class="sourceCode" id="cb207"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">&quot;foo(2)&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def foo(a):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &#39;    if a &gt; 1:\n&#39;
 &#39;        srcidx.append(2)\n&#39;
 &#39;        for i in range(3):\n&#39;
 &#39;            srcidx.append(3)\n&#39;
 &#39;            a = i + 1\n&#39;
 &#39;            srcidx.append(4)\n&#39;
 &#39;    else:\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        b = a + 1\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;    return a\n&#39;
 &#39;    srcidx.append(7)\n&#39;)
[0, 2, 3, 4, 3, 4, 3, 4]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
<section id="improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" class="level4">
<h4>improve on search for <code>if</code>, else, for, def to avoid errors for more examples</h4>
<div class="cell" data-execution_count="137">
<div class="sourceCode" id="cb209"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else:&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def &quot;</span> <span class="kw">in</span> l:</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="op">\</span></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-23"><a href="#cb209-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb209-24"><a href="#cb209-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb209-25"><a href="#cb209-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode" id="cb210"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">&#39;alignright(&quot;this is me&quot;)&#39;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def alignright(blocks):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &quot;    lst = blocks.split(&#39;\\n&#39;)\n&quot;
 &#39;    srcidx.append(1)\n&#39;
 &#39;    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))\n&#39;
 &#39;    srcidx.append(2)\n&#39;
 &#39;    indent = defaults.margin - maxlen\n&#39;
 &#39;    srcidx.append(3)\n&#39;
 &#39;    for l in lst:\n&#39;
 &#39;        srcidx.append(4)\n&#39;
 &quot;        print(&#39; &#39;*indent + format(l))\n&quot;
 &#39;        srcidx.append(5)\n&#39;)
                                                                                                                                                   this is me
[0, 1, 2, 3, 4, 5]
def alignright(blocks):
    lst = blocks.split(&#39;\n&#39;)
    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))
    indent = defaults.margin - maxlen
    for l in lst:
        print(&#39; &#39;*indent + format(l))</code></pre>
</div>
</div>
</section>
<section id="remove-an-empty-line-with-indentation" class="level4">
<h4>remove an empty line with indentation</h4>
<div class="cell" data-execution_count="139">
<div class="sourceCode" id="cb212"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span><span class="ch">\n\</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="st">     </span><span class="ch">\n\</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">bool</span>(l.strip()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[&#39;&#39;, &#39;this is code&#39;, &#39;     &#39;, &#39;this is code&#39;, &#39;&#39;]
False
True
False
True
False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode" id="cb214"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip()) <span class="co"># how to strip only the left not the right?????</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else:&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def &quot;</span> <span class="kw">in</span> l:</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="op">\</span></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): </span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb214-24"><a href="#cb214-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb214-25"><a href="#cb214-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode" id="cb215"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">&#39;alignright(&quot;this is me&quot;)&#39;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def alignright(blocks):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &quot;    lst = blocks.split(&#39;\\n&#39;)\n&quot;
 &#39;    srcidx.append(1)\n&#39;
 &#39;    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))\n&#39;
 &#39;    srcidx.append(2)\n&#39;
 &#39;    indent = defaults.margin - maxlen\n&#39;
 &#39;    srcidx.append(3)\n&#39;
 &#39;    for l in lst:\n&#39;
 &#39;        srcidx.append(4)\n&#39;
 &quot;        print(&#39; &#39;*indent + format(l))\n&quot;
 &#39;        srcidx.append(5)\n&#39;)
                                                                                                                                                   this is me
[0, 1, 2, 3, 4, 5]
def alignright(blocks):
    lst = blocks.split(&#39;\n&#39;)
    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))
    indent = defaults.margin - maxlen
    for l in lst:
        print(&#39; &#39;*indent + format(l))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode" id="cb217"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>pprint(inspect.getsource(printsrc))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def printsrc(src, # name of src code such as foo, or delegates\n&#39;
 &#39;             dbcode, # string of codes or int of code idx number\n&#39;
 &#39;             cmt,\n&#39;
 &#39;             expand:int=2): # expand the codes around the srcline under &#39;
 &#39;investigation\n&#39;
 &#39;    \n&#39;
 &quot;    lstsrc = inspect.getsource(src).split(&#39;\\n&#39;)\n&quot;
 &#39;    \n&#39;
 &#39;    dblines = &quot;&quot;\n&#39;
 &#39;    if type(dbcode) == int:\n&#39;
 &#39;        dblines = lstsrc[dbcode]\n&#39;
 &#39;    else:\n&#39;
 &#39;        dblines = dbcode\n&#39;
 &#39;        numdblines = list(map(lambda x: bool(x.strip()), &#39;
 &quot;dblines.split(&#39;\\n&#39;))).count(True)\n&quot;
 &#39;    \n&#39;
 &#39;    \n&#39;
 &#39;    dblineidx = []\n&#39;
 &#39;    for idx, l in zip(range(len(lstsrc)), lstsrc):\n&#39;
 &#39;        if bool(l) and l.strip() in dblines:\n&#39;
 &#39;            dblineidx.append(idx)\n&#39;
 &#39;\n&#39;
 &#39;    for idx, l in zip(range(len(lstsrc)), lstsrc):\n&#39;
 &#39;        \n&#39;
 &#39;        srcidx = dbcode if type(dbcode) == int else dblineidx[0]\n&#39;
 &#39;        \n&#39;
 &#39;        if bool(l) and l.strip() in dblines and idx == srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l, fill=&quot;=&quot;)\n&#39;
 &#39;\n&#39;
 &#39;            if bool(cmt):\n&#39;
 &#39;                colcmt = colorize(cmt, &quot;r&quot;)\n&#39;
 &#39;                alignright(colcmt) # also print the comment\n&#39;
 &#39;\n&#39;
 &#39;        if idx &gt;= srcidx - expand and idx &lt; srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l)\n&#39;
 &#39;        elif idx &lt;= srcidx + expand and idx &gt; srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l)\n&#39;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode" id="cb219"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;, &quot;</span> <span class="kw">in</span> <span class="st">&quot;    env, &quot;</span>.strip()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>False</code></pre>
</div>
</div>
</section>
</section>
<section id="make-it-work" class="level3">
<h3>make it work</h3>
<div class="cell" data-execution_count="144">
<div class="sourceCode" id="cb221"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>[]</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>a.append([<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<pre><code>[[1, 2]]</code></pre>
</div>
</div>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L408" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printrunsrclines-2" class="level3">
<h3>printrunsrclines</h3>
<blockquote>
<pre><code> printrunsrclines (src, example, env)</code></pre>
</blockquote>
<div class="cell" data-execution_count="146">
<div class="sourceCode" id="cb224"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> <span class="op">*</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.imports <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode" id="cb225"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode" id="cb226"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(delegates, <span class="st">&#39;&#39;</span>, env<span class="op">=</span>g) <span class="co"># make sure to use \\n not \n</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def delegates(to:FunctionType=None, # Delegatee\n&#39;
 &#39;              keep=False, # Keep `kwargs` in decorated function?\n&#39;
 &#39;              but:list=None): # Exclude these parameters from signature\n&#39;
 &#39;    &quot;Decorator: replace `**kwargs` in signature with params from `to`&quot;\n&#39;
 &#39;    if but is None: but = []\n&#39;
 &#39;    srcidx.append(4)\n&#39;
 &#39;    def _f(f):\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        if to is None: to_f,from_f = f.__base__.__init__,f.__init__\n&#39;
 &#39;        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;        srcidx.append(7)\n&#39;
 &quot;        from_f = getattr(from_f,&#39;__func__&#39;,from_f)\n&quot;
 &#39;        srcidx.append(8)\n&#39;
 &quot;        to_f = getattr(to_f,&#39;__func__&#39;,to_f)\n&quot;
 &#39;        srcidx.append(9)\n&#39;
 &quot;        if hasattr(from_f,&#39;__delwrap__&#39;): return f\n&quot;
 &#39;        srcidx.append(10)\n&#39;
 &#39;        sig = inspect.signature(from_f)\n&#39;
 &#39;        srcidx.append(11)\n&#39;
 &#39;        sigd = dict(sig.parameters)\n&#39;
 &#39;        srcidx.append(12)\n&#39;
 &quot;        k = sigd.pop(&#39;kwargs&#39;)\n&quot;
 &#39;        srcidx.append(13)\n&#39;
 &#39;        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()\n&#39;
 &#39;              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}\n&#39;
 &#39;        srcidx.append(14)\n&#39;
 &#39;        srcidx.append(15)\n&#39;
 &#39;        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}\n&#39;
 &#39;        srcidx.append(16)\n&#39;
 &#39;        sigd.update(s2)\n&#39;
 &#39;        srcidx.append(17)\n&#39;
 &quot;        if keep: sigd[&#39;kwargs&#39;] = k\n&quot;
 &#39;        else: from_f.__delwrap__ = to_f\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;        srcidx.append(7)\n&#39;
 &#39;        srcidx.append(18)\n&#39;
 &#39;        srcidx.append(19)\n&#39;
 &#39;        from_f.__signature__ = sig.replace(parameters=sigd.values())\n&#39;
 &#39;        srcidx.append(20)\n&#39;
 &quot;        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)\n&quot;
 &#39;        srcidx.append(21)\n&#39;
 &#39;        return f\n&#39;
 &#39;        srcidx.append(22)\n&#39;
 &#39;    return _f\n&#39;
 &#39;    srcidx.append(23)\n&#39;
 &#39;\n&#39;)
[]
    if but is None: but = []
        if to is None: to_f,from_f = f.__base__.__init__,f.__init__
        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f
        if hasattr(from_f,&#39;__delwrap__&#39;): return f
        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()
              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}
        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}
        if keep: sigd[&#39;kwargs&#39;] = k
        else: from_f.__delwrap__ = to_f
        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode" id="cb228"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>printsrcwithidx(delegates)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def delegates(to:FunctionType=None, # Delegatee===========================================(0)       
              keep=False, # Keep `kwargs` in decorated function?==========================(1)       
              but:list=None): # Exclude these parameters from signature===================(2)       
    &quot;Decorator: replace `**kwargs` in signature with params from `to`&quot;====================(3)       
    if but is None: but = []==============================================================(4)       
    def _f(f):============================================================================(5)       
        if to is None: to_f,from_f = f.__base__.__init__,f.__init__=======================(6)       
        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f=========(7)       
        from_f = getattr(from_f,&#39;__func__&#39;,from_f)========================================(8)       
        to_f = getattr(to_f,&#39;__func__&#39;,to_f)==============================================(9)       
        if hasattr(from_f,&#39;__delwrap__&#39;): return f========================================(10)      
        sig = inspect.signature(from_f)===================================================(11)      
        sigd = dict(sig.parameters)=======================================================(12)      
        k = sigd.pop(&#39;kwargs&#39;)============================================================(13)      
        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()                                    (14)
              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}=(15)      
        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}                                          (16)
        sigd.update(s2)===================================================================(17)      
        if keep: sigd[&#39;kwargs&#39;] = k=======================================================(18)      
        else: from_f.__delwrap__ = to_f===================================================(19)      
        from_f.__signature__ = sig.replace(parameters=sigd.values())======================(20)      
        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)========(21)      
        return f==========================================================================(22)      
    return _f=============================================================================(23)      
                                                                                                                                                        (24)</code></pre>
</div>
</div>
</section>
<section id="more-difficult-examples-to-test-printrunsrc" class="level3">
<h3>more difficult examples to test printrunsrc()</h3>
</section>
</section>
<section id="make-fastdebug-a-class" class="level2">
<h2>Make fastdebug a class</h2>
<div class="cell" data-execution_count="150">
<div class="sourceCode" id="cb230"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb230-37"><a href="#cb230-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb230-38"><a href="#cb230-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-39"><a href="#cb230-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb230-40"><a href="#cb230-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb230-41"><a href="#cb230-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb230-42"><a href="#cb230-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb230-43"><a href="#cb230-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;env=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb230-44"><a href="#cb230-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb230-45"><a href="#cb230-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb230-46"><a href="#cb230-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb230-47"><a href="#cb230-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb230-48"><a href="#cb230-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-49"><a href="#cb230-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb230-50"><a href="#cb230-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb230-51"><a href="#cb230-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb230-52"><a href="#cb230-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb230-53"><a href="#cb230-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb230-54"><a href="#cb230-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb230-55"><a href="#cb230-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb230-56"><a href="#cb230-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-57"><a href="#cb230-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb230-58"><a href="#cb230-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb230-59"><a href="#cb230-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-60"><a href="#cb230-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb230-61"><a href="#cb230-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb230-62"><a href="#cb230-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-63"><a href="#cb230-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb230-64"><a href="#cb230-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-65"><a href="#cb230-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb230-66"><a href="#cb230-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-67"><a href="#cb230-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb230-68"><a href="#cb230-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb230-69"><a href="#cb230-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb230-70"><a href="#cb230-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb230-71"><a href="#cb230-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb230-72"><a href="#cb230-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb230-73"><a href="#cb230-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb230-74"><a href="#cb230-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb230-75"><a href="#cb230-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb230-76"><a href="#cb230-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb230-77"><a href="#cb230-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-78"><a href="#cb230-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb230-79"><a href="#cb230-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb230-80"><a href="#cb230-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb230-81"><a href="#cb230-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb230-82"><a href="#cb230-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb230-83"><a href="#cb230-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb230-84"><a href="#cb230-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb230-85"><a href="#cb230-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-86"><a href="#cb230-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb230-87"><a href="#cb230-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb230-88"><a href="#cb230-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb230-89"><a href="#cb230-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-90"><a href="#cb230-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb230-91"><a href="#cb230-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb230-92"><a href="#cb230-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode" id="cb231"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-27"><a href="#cb231-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb231-28"><a href="#cb231-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb231-29"><a href="#cb231-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-30"><a href="#cb231-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb231-31"><a href="#cb231-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb231-32"><a href="#cb231-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb231-33"><a href="#cb231-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb231-34"><a href="#cb231-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb231-35"><a href="#cb231-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-36"><a href="#cb231-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb231-37"><a href="#cb231-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb231-38"><a href="#cb231-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-39"><a href="#cb231-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb231-40"><a href="#cb231-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb231-41"><a href="#cb231-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb231-42"><a href="#cb231-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb231-43"><a href="#cb231-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb231-44"><a href="#cb231-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb231-45"><a href="#cb231-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb231-46"><a href="#cb231-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb231-47"><a href="#cb231-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb231-48"><a href="#cb231-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-49"><a href="#cb231-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb231-50"><a href="#cb231-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb231-51"><a href="#cb231-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb231-52"><a href="#cb231-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb231-53"><a href="#cb231-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb231-54"><a href="#cb231-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb231-55"><a href="#cb231-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb231-56"><a href="#cb231-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-57"><a href="#cb231-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb231-58"><a href="#cb231-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb231-59"><a href="#cb231-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-60"><a href="#cb231-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb231-61"><a href="#cb231-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb231-62"><a href="#cb231-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-63"><a href="#cb231-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb231-64"><a href="#cb231-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-65"><a href="#cb231-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb231-66"><a href="#cb231-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-67"><a href="#cb231-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb231-68"><a href="#cb231-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb231-69"><a href="#cb231-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb231-70"><a href="#cb231-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb231-71"><a href="#cb231-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb231-72"><a href="#cb231-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb231-73"><a href="#cb231-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb231-74"><a href="#cb231-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb231-75"><a href="#cb231-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb231-76"><a href="#cb231-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb231-77"><a href="#cb231-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-78"><a href="#cb231-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb231-79"><a href="#cb231-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb231-80"><a href="#cb231-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb231-81"><a href="#cb231-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb231-82"><a href="#cb231-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb231-83"><a href="#cb231-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb231-84"><a href="#cb231-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb231-85"><a href="#cb231-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-86"><a href="#cb231-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb231-87"><a href="#cb231-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb231-88"><a href="#cb231-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb231-89"><a href="#cb231-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-90"><a href="#cb231-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb231-91"><a href="#cb231-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb231-92"><a href="#cb231-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
<section id="improve-on-the-line-idx-readability" class="level3">
<h3>improve on the line idx readability</h3>
<div class="cell" data-execution_count="152">
<div class="sourceCode" id="cb232"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-23"><a href="#cb232-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb232-24"><a href="#cb232-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb232-25"><a href="#cb232-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb232-26"><a href="#cb232-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-27"><a href="#cb232-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb232-28"><a href="#cb232-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb232-29"><a href="#cb232-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-30"><a href="#cb232-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb232-31"><a href="#cb232-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb232-32"><a href="#cb232-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb232-33"><a href="#cb232-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb232-34"><a href="#cb232-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb232-35"><a href="#cb232-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-36"><a href="#cb232-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb232-37"><a href="#cb232-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb232-38"><a href="#cb232-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-39"><a href="#cb232-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb232-40"><a href="#cb232-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb232-41"><a href="#cb232-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb232-42"><a href="#cb232-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb232-43"><a href="#cb232-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb232-44"><a href="#cb232-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb232-45"><a href="#cb232-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb232-46"><a href="#cb232-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb232-47"><a href="#cb232-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb232-48"><a href="#cb232-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-49"><a href="#cb232-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb232-50"><a href="#cb232-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-51"><a href="#cb232-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-52"><a href="#cb232-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-53"><a href="#cb232-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb232-54"><a href="#cb232-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb232-55"><a href="#cb232-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-56"><a href="#cb232-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-57"><a href="#cb232-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb232-58"><a href="#cb232-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb232-59"><a href="#cb232-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-60"><a href="#cb232-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb232-61"><a href="#cb232-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-62"><a href="#cb232-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-63"><a href="#cb232-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb232-64"><a href="#cb232-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-65"><a href="#cb232-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb232-66"><a href="#cb232-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-67"><a href="#cb232-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb232-68"><a href="#cb232-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-69"><a href="#cb232-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-70"><a href="#cb232-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb232-71"><a href="#cb232-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb232-72"><a href="#cb232-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb232-73"><a href="#cb232-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb232-74"><a href="#cb232-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb232-75"><a href="#cb232-75" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb232-76"><a href="#cb232-76" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb232-77"><a href="#cb232-77" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb232-78"><a href="#cb232-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-79"><a href="#cb232-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb232-80"><a href="#cb232-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb232-81"><a href="#cb232-81" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb232-82"><a href="#cb232-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb232-83"><a href="#cb232-83" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb232-84"><a href="#cb232-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb232-85"><a href="#cb232-85" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb232-86"><a href="#cb232-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb232-87"><a href="#cb232-87" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))</span>
<span id="cb232-88"><a href="#cb232-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb232-89"><a href="#cb232-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb232-90"><a href="#cb232-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb232-91"><a href="#cb232-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-92"><a href="#cb232-92" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb232-93"><a href="#cb232-93" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb232-94"><a href="#cb232-94" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb232-95"><a href="#cb232-95" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb232-96"><a href="#cb232-96" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb232-97"><a href="#cb232-97" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb232-98"><a href="#cb232-98" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb232-99"><a href="#cb232-99" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))</span>
<span id="cb232-100"><a href="#cb232-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-101"><a href="#cb232-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb232-102"><a href="#cb232-102" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb232-103"><a href="#cb232-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="collect-cmt-from-dbprint-and-print" class="level3">
<h3>collect cmt from dbprint and print</h3>
<div class="cell" data-execution_count="153">
<div class="sourceCode" id="cb233"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb233-34"><a href="#cb233-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb233-35"><a href="#cb233-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb233-36"><a href="#cb233-36" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb233-37"><a href="#cb233-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-38"><a href="#cb233-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb233-39"><a href="#cb233-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb233-40"><a href="#cb233-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-41"><a href="#cb233-41" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb233-42"><a href="#cb233-42" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb233-43"><a href="#cb233-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb233-44"><a href="#cb233-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb233-45"><a href="#cb233-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb233-46"><a href="#cb233-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb233-47"><a href="#cb233-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb233-48"><a href="#cb233-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb233-49"><a href="#cb233-49" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb233-50"><a href="#cb233-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-51"><a href="#cb233-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb233-52"><a href="#cb233-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-53"><a href="#cb233-53" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-54"><a href="#cb233-54" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-55"><a href="#cb233-55" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb233-56"><a href="#cb233-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb233-57"><a href="#cb233-57" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-58"><a href="#cb233-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-59"><a href="#cb233-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb233-60"><a href="#cb233-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb233-61"><a href="#cb233-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-62"><a href="#cb233-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb233-63"><a href="#cb233-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-64"><a href="#cb233-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-65"><a href="#cb233-65" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb233-66"><a href="#cb233-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb233-67"><a href="#cb233-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-68"><a href="#cb233-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb233-69"><a href="#cb233-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-70"><a href="#cb233-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb233-71"><a href="#cb233-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb233-72"><a href="#cb233-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb233-73"><a href="#cb233-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb233-74"><a href="#cb233-74" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb233-75"><a href="#cb233-75" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb233-76"><a href="#cb233-76" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb233-77"><a href="#cb233-77" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb233-78"><a href="#cb233-78" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb233-79"><a href="#cb233-79" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb233-80"><a href="#cb233-80" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb233-81"><a href="#cb233-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb233-82"><a href="#cb233-82" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb233-83"><a href="#cb233-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb233-84"><a href="#cb233-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb233-85"><a href="#cb233-85" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb233-86"><a href="#cb233-86" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb233-87"><a href="#cb233-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb233-88"><a href="#cb233-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-89"><a href="#cb233-89" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb233-90"><a href="#cb233-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb233-91"><a href="#cb233-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb233-92"><a href="#cb233-92" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb233-93"><a href="#cb233-93" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb233-94"><a href="#cb233-94" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-95"><a href="#cb233-95" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb233-96"><a href="#cb233-96" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-97"><a href="#cb233-97" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb233-98"><a href="#cb233-98" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-99"><a href="#cb233-99" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb233-100"><a href="#cb233-100" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb233-101"><a href="#cb233-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-102"><a href="#cb233-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-103"><a href="#cb233-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb233-104"><a href="#cb233-104" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb233-105"><a href="#cb233-105" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb233-106"><a href="#cb233-106" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb233-107"><a href="#cb233-107" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb233-108"><a href="#cb233-108" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb233-109"><a href="#cb233-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-110"><a href="#cb233-110" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb233-111"><a href="#cb233-111" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb233-112"><a href="#cb233-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb233-113"><a href="#cb233-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb233-114"><a href="#cb233-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb233-115"><a href="#cb233-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-116"><a href="#cb233-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb233-117"><a href="#cb233-117" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb233-118"><a href="#cb233-118" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb233-119"><a href="#cb233-119" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-120"><a href="#cb233-120" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb233-121"><a href="#cb233-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb233-122"><a href="#cb233-122" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb233-123"><a href="#cb233-123" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb233-124"><a href="#cb233-124" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-125"><a href="#cb233-125" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb233-126"><a href="#cb233-126" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-127"><a href="#cb233-127" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb233-128"><a href="#cb233-128" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-129"><a href="#cb233-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-130"><a href="#cb233-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-131"><a href="#cb233-131" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb233-132"><a href="#cb233-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-133"><a href="#cb233-133" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb233-134"><a href="#cb233-134" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb233-135"><a href="#cb233-135" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb233-136"><a href="#cb233-136" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb233-137"><a href="#cb233-137" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb233-138"><a href="#cb233-138" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb233-139"><a href="#cb233-139" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb233-140"><a href="#cb233-140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb233-141"><a href="#cb233-141" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb233-142"><a href="#cb233-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-143"><a href="#cb233-143" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb233-144"><a href="#cb233-144" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb233-145"><a href="#cb233-145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="make-sure-only-the-line-with-correct-idx-is-debugged" class="level3">
<h3>make sure only the line with correct idx is debugged</h3>
<div class="cell" data-execution_count="154">
<div class="sourceCode" id="cb234"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb234-38"><a href="#cb234-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-39"><a href="#cb234-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb234-40"><a href="#cb234-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure the line with correct idx is debugged</span></span>
<span id="cb234-41"><a href="#cb234-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb234-42"><a href="#cb234-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-43"><a href="#cb234-43" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb234-44"><a href="#cb234-44" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb234-45"><a href="#cb234-45" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb234-46"><a href="#cb234-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb234-47"><a href="#cb234-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb234-48"><a href="#cb234-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb234-49"><a href="#cb234-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb234-50"><a href="#cb234-50" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb234-51"><a href="#cb234-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb234-52"><a href="#cb234-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-53"><a href="#cb234-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if onedbprint == False:</span></span>
<span id="cb234-54"><a href="#cb234-54" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + &quot; &quot;*numindent + &quot;g = locals()&quot; + &#39;\n&#39;</span></span>
<span id="cb234-55"><a href="#cb234-55" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + &quot; &quot;*numindent + dbcodes + &#39;\n&#39;</span></span>
<span id="cb234-56"><a href="#cb234-56" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb234-57"><a href="#cb234-57" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     onedbprint = True</span></span>
<span id="cb234-58"><a href="#cb234-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else:</span></span>
<span id="cb234-59"><a href="#cb234-59" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb234-60"><a href="#cb234-60" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb234-61"><a href="#cb234-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-62"><a href="#cb234-62" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-63"><a href="#cb234-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb234-64"><a href="#cb234-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-65"><a href="#cb234-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb234-66"><a href="#cb234-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb234-67"><a href="#cb234-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-68"><a href="#cb234-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb234-69"><a href="#cb234-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-70"><a href="#cb234-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb234-71"><a href="#cb234-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb234-72"><a href="#cb234-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb234-73"><a href="#cb234-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb234-74"><a href="#cb234-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb234-75"><a href="#cb234-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb234-76"><a href="#cb234-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-77"><a href="#cb234-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb234-78"><a href="#cb234-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-79"><a href="#cb234-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb234-80"><a href="#cb234-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb234-81"><a href="#cb234-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb234-82"><a href="#cb234-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb234-83"><a href="#cb234-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb234-84"><a href="#cb234-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb234-85"><a href="#cb234-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb234-86"><a href="#cb234-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb234-87"><a href="#cb234-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb234-88"><a href="#cb234-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb234-89"><a href="#cb234-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb234-90"><a href="#cb234-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb234-91"><a href="#cb234-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb234-92"><a href="#cb234-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb234-93"><a href="#cb234-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb234-94"><a href="#cb234-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb234-95"><a href="#cb234-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb234-96"><a href="#cb234-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb234-97"><a href="#cb234-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-98"><a href="#cb234-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb234-99"><a href="#cb234-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb234-100"><a href="#cb234-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb234-101"><a href="#cb234-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb234-102"><a href="#cb234-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb234-103"><a href="#cb234-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-104"><a href="#cb234-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb234-105"><a href="#cb234-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-106"><a href="#cb234-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb234-107"><a href="#cb234-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-108"><a href="#cb234-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb234-109"><a href="#cb234-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb234-110"><a href="#cb234-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-111"><a href="#cb234-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-112"><a href="#cb234-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb234-113"><a href="#cb234-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb234-114"><a href="#cb234-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb234-115"><a href="#cb234-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb234-116"><a href="#cb234-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb234-117"><a href="#cb234-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb234-118"><a href="#cb234-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-119"><a href="#cb234-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb234-120"><a href="#cb234-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb234-121"><a href="#cb234-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb234-122"><a href="#cb234-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb234-123"><a href="#cb234-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb234-124"><a href="#cb234-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-125"><a href="#cb234-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb234-126"><a href="#cb234-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb234-127"><a href="#cb234-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb234-128"><a href="#cb234-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-129"><a href="#cb234-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb234-130"><a href="#cb234-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb234-131"><a href="#cb234-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb234-132"><a href="#cb234-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb234-133"><a href="#cb234-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-134"><a href="#cb234-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb234-135"><a href="#cb234-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-136"><a href="#cb234-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb234-137"><a href="#cb234-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-138"><a href="#cb234-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-139"><a href="#cb234-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-140"><a href="#cb234-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb234-141"><a href="#cb234-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-142"><a href="#cb234-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb234-143"><a href="#cb234-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb234-144"><a href="#cb234-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb234-145"><a href="#cb234-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb234-146"><a href="#cb234-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb234-147"><a href="#cb234-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb234-148"><a href="#cb234-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb234-149"><a href="#cb234-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb234-150"><a href="#cb234-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb234-151"><a href="#cb234-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-152"><a href="#cb234-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb234-153"><a href="#cb234-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb234-154"><a href="#cb234-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="having-or-inside-codes-without-causing-error" class="level3">
<h3>having “” or ” ” inside codes without causing error</h3>
<div class="cell" data-execution_count="155">
<div class="sourceCode" id="cb235"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>([<span class="st">&quot;   &quot;</span>][<span class="dv">0</span>].strip())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="156">
<div class="sourceCode" id="cb237"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;   &quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="157">
<div class="sourceCode" id="cb239"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="st">&quot;...&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;  &quot;</span>, <span class="st">&quot;&quot;</span>]</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>newlst <span class="op">=</span> []</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> lst: </span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>newlst</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>[&#39;...&#39;]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode" id="cb241"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-27"><a href="#cb241-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb241-28"><a href="#cb241-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb241-29"><a href="#cb241-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-30"><a href="#cb241-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb241-31"><a href="#cb241-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb241-32"><a href="#cb241-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb241-33"><a href="#cb241-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb241-34"><a href="#cb241-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb241-35"><a href="#cb241-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb241-36"><a href="#cb241-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb241-37"><a href="#cb241-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-38"><a href="#cb241-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-39"><a href="#cb241-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb241-40"><a href="#cb241-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb241-41"><a href="#cb241-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb241-42"><a href="#cb241-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb241-43"><a href="#cb241-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-44"><a href="#cb241-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb241-45"><a href="#cb241-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-46"><a href="#cb241-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb241-47"><a href="#cb241-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-48"><a href="#cb241-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb241-49"><a href="#cb241-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb241-50"><a href="#cb241-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb241-51"><a href="#cb241-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb241-52"><a href="#cb241-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb241-53"><a href="#cb241-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb241-54"><a href="#cb241-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb241-55"><a href="#cb241-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb241-56"><a href="#cb241-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb241-57"><a href="#cb241-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb241-58"><a href="#cb241-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-59"><a href="#cb241-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-60"><a href="#cb241-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-61"><a href="#cb241-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-62"><a href="#cb241-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb241-63"><a href="#cb241-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb241-64"><a href="#cb241-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-65"><a href="#cb241-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb241-66"><a href="#cb241-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb241-67"><a href="#cb241-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-68"><a href="#cb241-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb241-69"><a href="#cb241-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-70"><a href="#cb241-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb241-71"><a href="#cb241-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb241-72"><a href="#cb241-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb241-73"><a href="#cb241-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb241-74"><a href="#cb241-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb241-75"><a href="#cb241-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb241-76"><a href="#cb241-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-77"><a href="#cb241-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb241-78"><a href="#cb241-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-79"><a href="#cb241-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb241-80"><a href="#cb241-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-81"><a href="#cb241-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-82"><a href="#cb241-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb241-83"><a href="#cb241-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb241-84"><a href="#cb241-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb241-85"><a href="#cb241-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb241-86"><a href="#cb241-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb241-87"><a href="#cb241-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb241-88"><a href="#cb241-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb241-89"><a href="#cb241-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb241-90"><a href="#cb241-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb241-91"><a href="#cb241-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb241-92"><a href="#cb241-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb241-93"><a href="#cb241-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb241-94"><a href="#cb241-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb241-95"><a href="#cb241-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb241-96"><a href="#cb241-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb241-97"><a href="#cb241-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-98"><a href="#cb241-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb241-99"><a href="#cb241-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb241-100"><a href="#cb241-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb241-101"><a href="#cb241-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb241-102"><a href="#cb241-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb241-103"><a href="#cb241-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-104"><a href="#cb241-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb241-105"><a href="#cb241-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-106"><a href="#cb241-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb241-107"><a href="#cb241-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-108"><a href="#cb241-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb241-109"><a href="#cb241-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb241-110"><a href="#cb241-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-111"><a href="#cb241-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-112"><a href="#cb241-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb241-113"><a href="#cb241-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb241-114"><a href="#cb241-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb241-115"><a href="#cb241-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb241-116"><a href="#cb241-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb241-117"><a href="#cb241-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb241-118"><a href="#cb241-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-119"><a href="#cb241-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb241-120"><a href="#cb241-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb241-121"><a href="#cb241-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb241-122"><a href="#cb241-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb241-123"><a href="#cb241-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb241-124"><a href="#cb241-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-125"><a href="#cb241-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb241-126"><a href="#cb241-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb241-127"><a href="#cb241-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb241-128"><a href="#cb241-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-129"><a href="#cb241-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb241-130"><a href="#cb241-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb241-131"><a href="#cb241-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb241-132"><a href="#cb241-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb241-133"><a href="#cb241-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-134"><a href="#cb241-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb241-135"><a href="#cb241-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-136"><a href="#cb241-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb241-137"><a href="#cb241-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-138"><a href="#cb241-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-139"><a href="#cb241-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-140"><a href="#cb241-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb241-141"><a href="#cb241-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-142"><a href="#cb241-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb241-143"><a href="#cb241-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb241-144"><a href="#cb241-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb241-145"><a href="#cb241-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb241-146"><a href="#cb241-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb241-147"><a href="#cb241-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb241-148"><a href="#cb241-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb241-149"><a href="#cb241-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb241-150"><a href="#cb241-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb241-151"><a href="#cb241-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-152"><a href="#cb241-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb241-153"><a href="#cb241-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb241-154"><a href="#cb241-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="replace-fastdb.printsrcwithdix-with-fastdb.print" class="level3">
<h3>replace Fastdb.printsrcwithdix with Fastdb.print</h3>
<div class="cell" data-execution_count="159">
<div class="sourceCode" id="cb242"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb242-35"><a href="#cb242-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb242-36"><a href="#cb242-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb242-37"><a href="#cb242-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-38"><a href="#cb242-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-39"><a href="#cb242-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb242-40"><a href="#cb242-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb242-41"><a href="#cb242-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb242-42"><a href="#cb242-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb242-43"><a href="#cb242-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-44"><a href="#cb242-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb242-45"><a href="#cb242-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-46"><a href="#cb242-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb242-47"><a href="#cb242-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-48"><a href="#cb242-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb242-49"><a href="#cb242-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb242-50"><a href="#cb242-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb242-51"><a href="#cb242-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb242-52"><a href="#cb242-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb242-53"><a href="#cb242-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb242-54"><a href="#cb242-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb242-55"><a href="#cb242-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb242-56"><a href="#cb242-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb242-57"><a href="#cb242-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb242-58"><a href="#cb242-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-59"><a href="#cb242-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-60"><a href="#cb242-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-61"><a href="#cb242-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb242-62"><a href="#cb242-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb242-63"><a href="#cb242-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb242-64"><a href="#cb242-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-65"><a href="#cb242-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb242-66"><a href="#cb242-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb242-67"><a href="#cb242-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-68"><a href="#cb242-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb242-69"><a href="#cb242-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-70"><a href="#cb242-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb242-71"><a href="#cb242-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb242-72"><a href="#cb242-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb242-73"><a href="#cb242-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb242-74"><a href="#cb242-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb242-75"><a href="#cb242-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb242-76"><a href="#cb242-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-77"><a href="#cb242-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb242-78"><a href="#cb242-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-79"><a href="#cb242-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb242-80"><a href="#cb242-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-81"><a href="#cb242-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-82"><a href="#cb242-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb242-83"><a href="#cb242-83" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb242-84"><a href="#cb242-84" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb242-85"><a href="#cb242-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb242-86"><a href="#cb242-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb242-87"><a href="#cb242-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb242-88"><a href="#cb242-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb242-89"><a href="#cb242-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb242-90"><a href="#cb242-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb242-91"><a href="#cb242-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb242-92"><a href="#cb242-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb242-93"><a href="#cb242-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb242-94"><a href="#cb242-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb242-95"><a href="#cb242-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb242-96"><a href="#cb242-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb242-97"><a href="#cb242-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-98"><a href="#cb242-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb242-99"><a href="#cb242-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb242-100"><a href="#cb242-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb242-101"><a href="#cb242-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb242-102"><a href="#cb242-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb242-103"><a href="#cb242-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-104"><a href="#cb242-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb242-105"><a href="#cb242-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-106"><a href="#cb242-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb242-107"><a href="#cb242-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-108"><a href="#cb242-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb242-109"><a href="#cb242-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb242-110"><a href="#cb242-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-111"><a href="#cb242-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-112"><a href="#cb242-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb242-113"><a href="#cb242-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb242-114"><a href="#cb242-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb242-115"><a href="#cb242-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb242-116"><a href="#cb242-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb242-117"><a href="#cb242-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb242-118"><a href="#cb242-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-119"><a href="#cb242-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb242-120"><a href="#cb242-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb242-121"><a href="#cb242-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb242-122"><a href="#cb242-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb242-123"><a href="#cb242-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb242-124"><a href="#cb242-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-125"><a href="#cb242-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb242-126"><a href="#cb242-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb242-127"><a href="#cb242-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb242-128"><a href="#cb242-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-129"><a href="#cb242-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb242-130"><a href="#cb242-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb242-131"><a href="#cb242-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb242-132"><a href="#cb242-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb242-133"><a href="#cb242-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-134"><a href="#cb242-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb242-135"><a href="#cb242-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-136"><a href="#cb242-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb242-137"><a href="#cb242-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-138"><a href="#cb242-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-139"><a href="#cb242-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-140"><a href="#cb242-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb242-141"><a href="#cb242-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-142"><a href="#cb242-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb242-143"><a href="#cb242-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb242-144"><a href="#cb242-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb242-145"><a href="#cb242-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb242-146"><a href="#cb242-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb242-147"><a href="#cb242-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb242-148"><a href="#cb242-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb242-149"><a href="#cb242-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb242-150"><a href="#cb242-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb242-151"><a href="#cb242-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-152"><a href="#cb242-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb242-153"><a href="#cb242-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb242-154"><a href="#cb242-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="add-idx-to-dbsrc-when-showdbsrctrue" class="level3">
<h3>add idx to dbsrc when showdbsrc=True</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L479" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb" class="level3">
<h3>Fastdb</h3>
<blockquote>
<pre><code> Fastdb (src, env)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td>name of src code</td>
</tr>
<tr class="even">
<td>env</td>
<td>env = g, as g = globals()</td>
</tr>
</tbody>
</table>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" class="level3">
<h3>use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>sfc <span class="op">=</span> dbprint(_signature_from_callable, <span class="st">&quot;if isinstance(obj, type):&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, <span class="op">\</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;locals()&quot;</span>, <span class="st">&quot;isinstance(obj, type)&quot;</span>, <span class="st">&quot;env=g&quot;</span>, <span class="op">\</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>              expand<span class="op">=</span><span class="dv">1</span>, env<span class="op">=</span>g)</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="co"># overriding the original official source with our dbsrc, even though rewriting _signature_from_callable inside inspect.py ######################</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> _signature_from_callable</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>inspect.signature(Foo) </span></code></pre></div>
</section>
<section id="use-guide-on-fastdb.dbprint" class="level3">
<h3>use guide on Fastdb.dbprint</h3>
<ol type="1">
<li>don’t use for the line start with <code>elif</code>, as putting <a href="https://EmbraceLife.github.io/fastdebug/core.html#dbprintinsert"><code>dbprintinsert</code></a> above <code>elif</code> without indentation will cause syntax error. I am not sure whether I need to fix it now.</li>
</ol>
<p>see example <a href="./examples/Fastdb.ipynb">here</a></p>
<p>test it with example <a href="./examples/print.ipynb">here</a></p>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">fastdebug</span> <span class="hidden" data-render-id="quarto-int-navbar-title">fastdebug</span> <span class="hidden" data-render-id="quarto-int-next">FixSigMeta</span> <span class="hidden" data-render-id="quarto-int-prev">fastdebug</span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.html">fastdebug</span> <span class="hidden" data-render-id="quarto-int-sidebar:/core.html">core</span> <span class="hidden" data-render-id="quarto-int-sidebar:/FixSigMeta.html">FixSigMeta</span> <span class="hidden" data-render-id="quarto-int-sidebar:/utils.html">Utils</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-twittercardtitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-ogcardtitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-metasitename">fastdebug</span> <span class="hidden" data-render-id="quarto-metadesc">the core functionalities of fastdebug</span></p>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->

</body>

</html>