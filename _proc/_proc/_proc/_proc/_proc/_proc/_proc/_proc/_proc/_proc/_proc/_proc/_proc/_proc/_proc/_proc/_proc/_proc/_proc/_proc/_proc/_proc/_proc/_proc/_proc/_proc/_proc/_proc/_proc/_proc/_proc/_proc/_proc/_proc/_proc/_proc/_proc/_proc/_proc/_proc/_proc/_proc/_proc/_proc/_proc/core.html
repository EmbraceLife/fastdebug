<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.1.189" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="description" content="the core functionalities of fastdebug" />

<title>fastdebug – core</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">fastdebug</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EmbraceLife/fastdebug"><i 
  class="bi bi-github" 
  role="img" 
>
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" 
        data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
  >
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" 
        class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">fastdebug</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/core.html" class="sidebar-item-text sidebar-link active">core</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">core</h1>
</div>

<div>
  <div class="description">
    the core functionalities of fastdebug
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#make-life-easier-with-defaults" id="toc-make-life-easier-with-defaults">make life easier with defaults</a></li>
  <li><a href="#globals-and-locals" id="toc-globals-and-locals">globals() and locals()</a></li>
  <li><a href="#execute-strings" id="toc-execute-strings">Execute strings</a>
  <ul>
  <li><a href="#new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" id="toc-new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals">new variable or updated variable by exec will only be accessible from locals()</a></li>
  <li><a href="#eval-can-override-its-own-globals-and-locals" id="toc-eval-can-override-its-own-globals-and-locals">eval can override its own globals() and locals()</a></li>
  <li><a href="#when-exec-update-existing-functions" id="toc-when-exec-update-existing-functions">when exec update existing functions</a></li>
  <li><a href="#when-the-func-to-be-udpated-involve-other-libraries" id="toc-when-the-func-to-be-udpated-involve-other-libraries">when the func to be udpated involve other libraries</a></li>
  <li><a href="#inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" id="toc-inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace">inside a function, exec() allow won’t give you necessary env from function namespace</a></li>
  <li><a href="#magic-of-execb-globals.updatelocals" id="toc-magic-of-execb-globals.updatelocals">magic of <code>exec(b, globals().update(locals()))</code></a></li>
  <li><a href="#bring-variables-from-a-func-namespace-to-the-sideout-world" id="toc-bring-variables-from-a-func-namespace-to-the-sideout-world">Bring variables from a func namespace to the sideout world</a></li>
  <li><a href="#globals-in-a-cell-vs-globals-in-a-func" id="toc-globals-in-a-cell-vs-globals-in-a-func">globals() in a cell vs globals() in a func</a></li>
  </ul></li>
  <li><a href="#make-a-colorful-string" id="toc-make-a-colorful-string">make a colorful string</a>
  <ul>
  <li><a href="#dbcolors" id="toc-dbcolors">dbcolors</a></li>
  <li><a href="#colorize" id="toc-colorize">colorize</a></li>
  </ul></li>
  <li><a href="#align-text-to-the-most-right" id="toc-align-text-to-the-most-right">align text to the most right</a>
  <ul>
  <li><a href="#strip_ansi" id="toc-strip_ansi">strip_ansi</a></li>
  <li><a href="#alignright" id="toc-alignright">alignright</a></li>
  </ul></li>
  <li><a href="#printsrcwithidx" id="toc-printsrcwithidx">printsrcwithidx</a>
  <ul>
  <li><a href="#print-the-entire-source-code-with-idx-from-0" id="toc-print-the-entire-source-code-with-idx-from-0">print the entire source code with idx from 0</a></li>
  <li><a href="#print-the-whole-src-with-idx-or-print-them-in-parts" id="toc-print-the-whole-src-with-idx-or-print-them-in-parts">print the whole src with idx or print them in parts</a></li>
  <li><a href="#use-cmts-from-dbprint-to-print-out-src-with-comments" id="toc-use-cmts-from-dbprint-to-print-out-src-with-comments">use cmts from dbprint to print out src with comments</a></li>
  <li><a href="#no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" id="toc-no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print">no more update for printsrcwithidx, for the latest see Fastdb.print</a></li>
  </ul></li>
  <li><a href="#print-out-src-code" id="toc-print-out-src-code">print out src code</a>
  <ul>
  <li><a href="#basic-version" id="toc-basic-version">basic version</a></li>
  <li><a href="#print-src-with-specific-number-of-lines" id="toc-print-src-with-specific-number-of-lines">print src with specific number of lines</a></li>
  <li><a href="#make-the-naming-more-sensible" id="toc-make-the-naming-more-sensible">make the naming more sensible</a></li>
  <li><a href="#allow-a-dbline-occur-more-than-once" id="toc-allow-a-dbline-occur-more-than-once">Allow a dbline occur more than once</a></li>
  <li><a href="#adding-idx-to-the-selected-srclines" id="toc-adding-idx-to-the-selected-srclines">adding idx to the selected srclines</a>
  <ul>
  <li><a href="#printsrclinewithidx" id="toc-printsrclinewithidx">printsrclinewithidx</a></li>
  </ul></li>
  <li><a href="#printsrclinewithidx-1" id="toc-printsrclinewithidx-1">printsrclinewithidx</a></li>
  <li><a href="#dblines-can-be-string-of-code-or-idx-number" id="toc-dblines-can-be-string-of-code-or-idx-number">dblines can be string of code or idx number</a></li>
  <li><a href="#avoid-multi-occurrance-of-the-same-srcline" id="toc-avoid-multi-occurrance-of-the-same-srcline">avoid multi-occurrance of the same srcline</a></li>
  <li><a href="#printsrc" id="toc-printsrc">printsrc</a></li>
  </ul></li>
  <li><a href="#dbprint-on-expression" id="toc-dbprint-on-expression">dbprint on expression</a>
  <ul>
  <li><a href="#basic-version-1" id="toc-basic-version-1">basic version</a></li>
  <li><a href="#insert-dbcode-and-make-a-new-dbfunc" id="toc-insert-dbcode-and-make-a-new-dbfunc">insert dbcode and make a new dbfunc</a></li>
  <li><a href="#bring-outside-namespace-variables-into-exec" id="toc-bring-outside-namespace-variables-into-exec">Bring outside namespace variables into exec()</a></li>
  <li><a href="#bring-what-inside-the-func-namespace-variables-to-the-outside-world" id="toc-bring-what-inside-the-func-namespace-variables-to-the-outside-world">Bring what inside the func namespace variables to the outside world</a></li>
  <li><a href="#adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" id="toc-adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually">Adding g = locals() to dbprintinsert to avoid adding env individually</a></li>
  <li><a href="#enable-srclines-to-be-either-string-or-int" id="toc-enable-srclines-to-be-either-string-or-int">enable srclines to be either string or int</a></li>
  <li><a href="#enable-to-be-used-as-assignment-in-codes" id="toc-enable-to-be-used-as-assignment-in-codes">enable = to be used as assignment in codes</a></li>
  <li><a href="#avoid-adding-envg-for-dbprintinsert" id="toc-avoid-adding-envg-for-dbprintinsert">avoid adding “env=g” for dbprintinsert</a></li>
  <li><a href="#collect-cmt-for-later-printsrcwithidx-to-print-comments-together" id="toc-collect-cmt-for-later-printsrcwithidx-to-print-comments-together">collect cmt for later printsrcwithidx to print comments together</a></li>
  <li><a href="#make-sure-only-one-line-with-correct-idx-is-debugged" id="toc-make-sure-only-one-line-with-correct-idx-is-debugged">make sure only one line with correct idx is debugged</a></li>
  <li><a href="#avoid-typing-when-there-is-no-codes" id="toc-avoid-typing-when-there-is-no-codes">avoid typing “” when there is no codes</a></li>
  <li><a href="#no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" id="toc-no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint">no more update for dbprint, for the latest see Fastdb.dbprint</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile">use dbprint to override the original official code without changing its own pyfile</a></li>
  </ul></li>
  <li><a href="#dbprintinsert" id="toc-dbprintinsert">dbprintinsert</a>
  <ul>
  <li><a href="#run-and-display-the-inserted-dbcodes" id="toc-run-and-display-the-inserted-dbcodes">Run and display the inserted dbcodes</a></li>
  <li><a href="#use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" id="toc-use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually">use locals() inside the dbsrc code to avoid adding env individually</a></li>
  <li><a href="#enable-dbprintinsert-to-do-exec-on-a-block-of-code" id="toc-enable-dbprintinsert-to-do-exec-on-a-block-of-code">enable dbprintinsert to do exec on a block of code</a></li>
  <li><a href="#dbprintinsert-1" id="toc-dbprintinsert-1">dbprintinsert</a></li>
  </ul></li>
  <li><a href="#printrunsrclines" id="toc-printrunsrclines">printrunsrclines()</a>
  <ul>
  <li><a href="#examples" id="toc-examples">Examples</a>
  <ul>
  <li><a href="#simple-example" id="toc-simple-example">simple example</a></li>
  <li><a href="#complex-example" id="toc-complex-example">complex example</a></li>
  </ul></li>
  <li><a href="#insert-a-line-after-each-srcline-to-add-idx" id="toc-insert-a-line-after-each-srcline-to-add-idx">insert a line after each srcline to add idx</a></li>
  <li><a href="#add-correct-indentation-to-each-inserted-line" id="toc-add-correct-indentation-to-each-inserted-line">add correct indentation to each inserted line</a>
  <ul>
  <li><a href="#count-the-indentation-for-each-srcline" id="toc-count-the-indentation-for-each-srcline">count the indentation for each srcline</a></li>
  </ul></li>
  <li><a href="#indentation-special-case-if-else-for-def" id="toc-indentation-special-case-if-else-for-def">indentation special case: if, else, for, def</a></li>
  <li><a href="#remove-pure-comments-or-docs-from-dbsrc" id="toc-remove-pure-comments-or-docs-from-dbsrc">remove pure comments or docs from dbsrc</a></li>
  <li><a href="#print-out-the-srclines-which-get-run" id="toc-print-out-the-srclines-which-get-run">print out the srclines which get run</a></li>
  <li><a href="#make-sure-all-if-else-for-get-printed" id="toc-make-sure-all-if-else-for-get-printed">Make sure all if, else, for get printed</a></li>
  <li><a href="#put-all-together-into-the-function-printrunsrclines" id="toc-put-all-together-into-the-function-printrunsrclines">Put all together into the function printrunsrclines()</a>
  <ul>
  <li><a href="#no-more-renaming-of-foo" id="toc-no-more-renaming-of-foo">no more renaming of foo</a></li>
  <li><a href="#add-example-as-a-param-into-the-function" id="toc-add-example-as-a-param-into-the-function">add example as a param into the function</a></li>
  <li><a href="#improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" id="toc-improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples">improve on search for <code>if</code>, else, for, def to avoid errors for more examples</a></li>
  <li><a href="#remove-an-empty-line-with-indentation" id="toc-remove-an-empty-line-with-indentation">remove an empty line with indentation</a></li>
  </ul></li>
  <li><a href="#make-it-work" id="toc-make-it-work">make it work</a></li>
  <li><a href="#more-difficult-examples-to-test-printrunsrc" id="toc-more-difficult-examples-to-test-printrunsrc">more difficult examples to test printrunsrc()</a></li>
  </ul></li>
  <li><a href="#make-fastdebug-a-class" id="toc-make-fastdebug-a-class">Make fastdebug a class</a>
  <ul>
  <li><a href="#improve-on-the-line-idx-readability" id="toc-improve-on-the-line-idx-readability">improve on the line idx readability</a></li>
  <li><a href="#collect-cmt-from-dbprint-and-print" id="toc-collect-cmt-from-dbprint-and-print">collect cmt from dbprint and print</a></li>
  <li><a href="#make-sure-only-the-line-with-correct-idx-is-debugged" id="toc-make-sure-only-the-line-with-correct-idx-is-debugged">make sure only the line with correct idx is debugged</a></li>
  <li><a href="#having-or-inside-codes-without-causing-error" id="toc-having-or-inside-codes-without-causing-error">having “” or ” ” inside codes without causing error</a></li>
  <li><a href="#replace-fastdb.printsrcwithdix-with-fastdb.print" id="toc-replace-fastdb.printsrcwithdix-with-fastdb.print">replace Fastdb.printsrcwithdix with Fastdb.print</a></li>
  <li><a href="#add-idx-to-dbsrc-when-showdbsrctrue" id="toc-add-idx-to-dbsrc-when-showdbsrctrue">add idx to dbsrc when showdbsrc=True</a></li>
  <li><a href="#not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages" id="toc-not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages">not load the inner locals() to outenv can prevent mysterious printing of previous db messages</a></li>
  <li><a href="#using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print" id="toc-using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print">using <span class="citation" data-cites="patch">@patch</span> to enable docs for instance methods like <code>dbprint</code> and <code>print</code></a></li>
  <li><a href="#move-param-env-into-__init__" id="toc-move-param-env-into-__init__">move param env into <code>__init__</code></a></li>
  <li><a href="#add-example-to-the-obj" id="toc-add-example-to-the-obj">Add example to the obj</a></li>
  <li><a href="#fastdb" id="toc-fastdb">Fastdb</a></li>
  <li><a href="#make-sure-showdbsrctrue-give-us-the-line-starting-with-dbprintinsert" id="toc-make-sure-showdbsrctrue-give-us-the-line-starting-with-dbprintinsert">Make sure <code>showdbsrc=True</code> give us the line starting with ‘dbprintinsert’</a></li>
  <li><a href="#make-sure-showdbsrctrue-give-us-info-on-changes-in-g-or-outenv" id="toc-make-sure-showdbsrctrue-give-us-info-on-changes-in-g-or-outenv">Make sure <code>showdbsrc=True</code> give us info on changes in g or outenv</a></li>
  <li><a href="#exit-and-print-a-warning-message-idx-has-to-be-int" id="toc-exit-and-print-a-warning-message-idx-has-to-be-int">exit and print a warning message: idx has to be int</a></li>
  <li><a href="#handle-errors-by-codes-with-trailing-spaces" id="toc-handle-errors-by-codes-with-trailing-spaces">handle errors by codes with trailing spaces</a></li>
  <li><a href="#showdbsrctrue-check-whether-fastdb.dbprint-and-fdb.dbprint-are-same-object-using-is" id="toc-showdbsrctrue-check-whether-fastdb.dbprint-and-fdb.dbprint-are-same-object-using-is">showdbsrc=True, check whether Fastdb.dbprint and fdb.dbprint are same object using <code>is</code></a></li>
  <li><a href="#remove-unnecessary-db-printout-when-showdbsrctrue-and-add-printout-to-display-sections" id="toc-remove-unnecessary-db-printout-when-showdbsrctrue-and-add-printout-to-display-sections">remove unnecessary db printout when showdbsrc=True and add printout to display sections</a></li>
  <li><a href="#raise-typeerror-when-decode-are-not-integer-and-showdbsrctrue-working-on-both-method-and-function" id="toc-raise-typeerror-when-decode-are-not-integer-and-showdbsrctrue-working-on-both-method-and-function">raise TypeError when decode are not integer and showdbsrc=true working on both method and function</a></li>
  <li><a href="#when-debugging-dbprint-make-sure-dbsrc-is-printed-with-the-same-idx-as-original" id="toc-when-debugging-dbprint-make-sure-dbsrc-is-printed-with-the-same-idx-as-original">when debugging dbprint, make sure dbsrc is printed with the same idx as original</a></li>
  <li><a href="#update-dbsrc-to-the-global-env" id="toc-update-dbsrc-to-the-global-env">update dbsrc to the global env</a></li>
  <li><a href="#go-back-to-normal-before-running-dbprint-again" id="toc-go-back-to-normal-before-running-dbprint-again">go back to normal before running dbprint again</a></li>
  <li><a href="#auto-print-src-with-cmt-and-idx-as-the-ending-part-of-dbprint" id="toc-auto-print-src-with-cmt-and-idx-as-the-ending-part-of-dbprint">auto print src with cmt and idx as the ending part of dbprint</a></li>
  <li><a href="#to-mark-my-explorations-expressions-to-evaluate-to-stand-out" id="toc-to-mark-my-explorations-expressions-to-evaluate-to-stand-out">to mark my explorations (expressions to evaluate) to stand out</a></li>
  <li><a href="#add-the-print-of-src-with-idx-and-comments-at-the-end-of-dbsrc" id="toc-add-the-print-of-src-with-idx-and-comments-at-the-end-of-dbsrc">Add the print of src with idx and comments at the end of dbsrc</a></li>
  <li><a href="#embed-example-and-autoprint-to-shorten-the-code-to-type" id="toc-embed-example-and-autoprint-to-shorten-the-code-to-type">embed example and autoprint to shorten the code to type</a></li>
  <li><a href="#fastdb.dbprint" id="toc-fastdb.dbprint">Fastdb.dbprint</a></li>
  <li><a href="#fastdb.autoprint" id="toc-fastdb.autoprint">Fastdb.autoprint</a></li>
  </ul></li>
  <li><a href="#take-an-example-and-its-env-into-fastdb-obj" id="toc-take-an-example-and-its-env-into-fastdb-obj">Take an example and its env into Fastdb obj</a>
  <ul>
  <li><a href="#fastdb.takexample" id="toc-fastdb.takexample">Fastdb.takExample</a></li>
  </ul></li>
  <li><a href="#print-src-with-idx-and-cmt-in-whole-or-parts" id="toc-print-src-with-idx-and-cmt-in-whole-or-parts">print src with idx and cmt in whole or parts</a>
  <ul>
  <li><a href="#fastdb.print" id="toc-fastdb.print">Fastdb.print</a></li>
  </ul></li>
  <li><a href="#goback" id="toc-goback">goback</a>
  <ul>
  <li><a href="#fastdb.goback" id="toc-fastdb.goback">Fastdb.goback</a></li>
  </ul></li>
  <li><a href="#fastdb.explore" id="toc-fastdb.explore">Fastdb.explore</a>
  <ul>
  <li><a href="#adding-one-breakpoint-with-comment" id="toc-adding-one-breakpoint-with-comment">adding one breakpoint with comment</a></li>
  <li><a href="#adding-multiple-breakpoints-by-multiple-set_trace" id="toc-adding-multiple-breakpoints-by-multiple-set_trace">Adding multiple breakpoints by multiple set_trace()</a></li>
  <li><a href="#go-back-to-normal-before-running-explore-again" id="toc-go-back-to-normal-before-running-explore-again">Go back to normal before running explore again</a></li>
  <li><a href="#make-a-copy-of-orisrc-and-update-whatinside-and-fu.whatinside-both-into-dbsrc" id="toc-make-a-copy-of-orisrc-and-update-whatinside-and-fu.whatinside-both-into-dbsrc">make a copy of orisrc and update whatinside and fu.whatinside both into dbsrc</a></li>
  <li><a href="#fastdb.explore-1" id="toc-fastdb.explore-1">Fastdb.explore</a></li>
  <li><a href="#use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" id="toc-use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1">use dbprint to override the original official code without changing its own pyfile</a></li>
  <li><a href="#use-guide-on-fastdb.dbprint" id="toc-use-guide-on-fastdb.dbprint">use guide on Fastdb.dbprint</a></li>
  </ul></li>
  <li><a href="#reliveonce" id="toc-reliveonce">reliveonce</a>
  <ul>
  <li><a href="#reliveonce-1" id="toc-reliveonce-1">reliveonce</a></li>
  </ul></li>
  </ul>
</nav>
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell" data-execution_count="2">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, HTML</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="st">&quot;&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;&quot;</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<style>.container { width:100% !important; }</style>
</div>
</div>
<p>This notebook records the history of how I built this library from scratch. Well, not exactly from the scratch, because there is a <a href="https://github.com/EmbraceLife/debuggable">first version</a> of this library where many difficulties have been already handled.</p>
<p>If you want to see the latest functions of this module, just <code>cmd/ctrl + f</code> to search ‘#| export’ and check them out this way.</p>
<section id="make-life-easier-with-defaults" class="level2">
<h2>make life easier with defaults</h2>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>defaults <span class="op">=</span> <span class="bu">type</span>(<span class="st">&#39;defaults&#39;</span>, (<span class="bu">object</span>,), {<span class="st">&#39;margin&#39;</span>: <span class="dv">157</span>, <span class="co"># align to the right by 157</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;orisrc&#39;</span>: <span class="va">None</span>, <span class="co"># keep a copy of original official src code</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;outenv&#39;</span>: <span class="bu">globals</span>(), <span class="co"># outside global env</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;cmts&#39;</span>: {} <span class="co"># a dict to store idx and cmt</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># &#39;eg&#39;: None, # examples</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># &#39;src&#39;: None, # official src</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                       })</span></code></pre></div>
</div>
</section>
<section id="globals-and-locals" class="level2">
<h2>globals() and locals()</h2>
<p>Interesting behavior of <a href="https://stackoverflow.com/questions/7969949/whats-the-difference-between-globals-locals-and-vars">locals()</a></p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">locals</span>() <span class="op">==</span> <span class="bu">globals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;functools&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;inspect&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;eval&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;defaults&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whatinside&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whichversion&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whatinside&quot;</span> <span class="kw">in</span> <span class="bu">locals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;whichversion&quot;</span> <span class="kw">in</span> <span class="bu">globals</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
</section>
<section id="execute-strings" class="level2">
<h2>Execute strings</h2>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span>?</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>?</span></code></pre></div>
</div>
<section id="new-variable-or-updated-variable-by-exec-will-only-be-accessible-from-locals" class="level3">
<h3>new variable or updated variable by exec will only be accessible from locals()</h3>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;1+x&quot;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># x is not in locals() but in globals()</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">eval</span>(a)) </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;a&#39;: &#39;1+x&#39;}&quot;
2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b) <span class="co"># b can&#39;t be accessed directly and not use the key b</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
name &#39;b&#39; is not defined</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># you can&#39;t even assign the value to b, otherwise b:value won&#39;t be available</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(b)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;KeyError: &#39;b&#39; does not exist&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;}
KeyError: &#39;b&#39; does not exist</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(c)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># test()</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    test()</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;KeyError: &#39;b&#39; does not exist&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;c = locals()[&quot;b&quot;]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(c = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">&quot;c = c + 1&quot;</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># update c won&#39;t change anything</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
c = locals()[&quot;b&quot;]; c: 2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}
exec(c = c + 1): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&quot;b = 1+x&quot;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(a): </span><span class="sc">{</span><span class="bu">exec</span>(a)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;b&#39;</span>] <span class="co"># if assign to a different name, then b is available</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;c = locals()[&quot;b&quot;]; c: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(d = c + 1): </span><span class="sc">{</span><span class="bu">exec</span>(<span class="st">&quot;d = c + 1&quot;</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># must assign to a different variable, not c anymore</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;a&#39;: &#39;b = 1+x&#39;}
exec(a): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2}
c = locals()[&quot;b&quot;]; c: 2
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2}
exec(d = c + 1): None
{&#39;a&#39;: &#39;b = 1+x&#39;, &#39;b&#39;: 2, &#39;c&#39;: 2, &#39;d&#39;: 3}</code></pre>
</div>
</div>
</section>
<section id="eval-can-override-its-own-globals-and-locals" class="level3">
<h3>eval can override its own globals() and locals()</h3>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;a+1&quot;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;b: </span><span class="sc">{</span><span class="bu">eval</span>(b, {}, {<span class="st">&quot;a&quot;</span>: <span class="dv">2</span>})<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># globals() put to empty and locals() to include &#39;a&#39; with a different value</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>test()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;a&#39;: 1, &#39;b&#39;: &#39;a+1&#39;}&quot;
b: 3
&quot;locals: {&#39;a&#39;: 1, &#39;b&#39;: &#39;a+1&#39;}&quot;</code></pre>
</div>
</div>
</section>
<section id="when-exec-update-existing-functions" class="level3">
<h3>when exec update existing functions</h3>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l):</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">&quot; + 3</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>] <span class="co"># to use it, must assign to a different name</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function foo at 0x10f99df70&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): return x + y\\n&#39;, &#39;newb&#39;: &#39;def foo(x, y): return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;}&quot;
exec(newb): None
(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x10f99df70&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): return x + y\\n&#39;, &#39;newb&#39;: &#39;def foo(x, y): return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;, &quot;
 &quot;&#39;foo&#39;: &lt;function foo at 0x10f9a0ee0&gt;}&quot;)
13
13
10
10</code></pre>
</div>
</div>
</section>
<section id="when-the-func-to-be-udpated-involve-other-libraries" class="level3">
<h3>when the func to be udpated involve other libraries</h3>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(x, y): </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inspect.signature(foo))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> inspect.getsource(func)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> b.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="st">&quot;return&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l :</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l):</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>            newb <span class="op">=</span> newb <span class="op">+</span> l</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    newb <span class="op">=</span> newb <span class="op">+</span> <span class="st">&quot; + 3</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># foo is not available in locals()</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;exec(newb): </span><span class="sc">{</span><span class="bu">exec</span>(newb)<span class="sc">}</span><span class="ss">&#39;</span>) </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>) <span class="co"># a foo is available in locals(), but which one is it</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    newfoo <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>]</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(newfoo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">locals</span>()[<span class="st">&quot;foo&quot;</span>](<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(func(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(foo(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>test(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x10f99dd30&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n&#39;, &#39;newb&#39;: &#39;def &quot;
 &quot;foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;}&quot;)
exec(newb): None
(&quot;locals: {&#39;func&#39;: &lt;function foo at 0x10f99dd30&gt;, &#39;a&#39;: 1, &#39;b&#39;: &#39;def foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y\\n&#39;, &#39;newb&#39;: &#39;def &quot;
 &quot;foo(x, y): \\n    print(inspect.signature(foo))\\n    return x + y + 3\\n&#39;, &#39;l&#39;: &#39;&#39;, &#39;foo&#39;: &lt;function foo at 0x10f9ac040&gt;}&quot;)
(x, y)
13
(x, y)
13
(x, y)
10
(x, y)
10</code></pre>
</div>
</div>
</section>
<section id="inside-a-function-exec-allow-wont-give-you-necessary-env-from-function-namespace" class="level3">
<h3>inside a function, exec() allow won’t give you necessary env from function namespace</h3>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b) <span class="co"># create the new add in locals</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;add(5,6): </span><span class="sc">{</span>add(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] <span class="co"># assign a different name, add1</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;add1(5,6): </span><span class="sc">{</span>add1(<span class="dv">5</span>,<span class="dv">6</span>)<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># error: lst is not defined, even though lst=[] is right above</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span> <span class="im">as</span> e:</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(e)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99d940&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99d940&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x106816550&gt;}&#39;)
add(5,6): 1
name &#39;lst&#39; is not defined</code></pre>
</div>
</div>
</section>
<section id="magic-of-execb-globals.updatelocals" class="level3">
<h3>magic of <code>exec(b, globals().update(locals()))</code></h3>
<p>What about <code>exec(b, globals().update(globals()))</code></p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">globals</span>())) <span class="co"># update(globals()) won&#39;t give us lst above</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    test(add)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;exec(b, globals().update(globals())) won&#39;t give us lst in the func namespace&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f9a0dc0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f9a0dc0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x10f99ddc0&gt;}&#39;)
exec(b, globals().update(globals())) won&#39;t give us lst in the func namespace</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(add(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>: </span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;you can&#39;t bring add1 from a function namespace to the outside world&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99ddc0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99ddc0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &#39;0x10f99daf0&gt;}&#39;)
11
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99ddc0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [5], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add at &quot;
 &quot;0x10f99daf0&gt;, &#39;add1&#39;: &lt;function add at 0x10f99daf0&gt;}&quot;)
1
you can&#39;t bring add1 from a function namespace to the outside world</code></pre>
</div>
</div>
</section>
<section id="bring-variables-from-a-func-namespace-to-the-sideout-world" class="level3">
<h3>Bring variables from a func namespace to the sideout world</h3>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y): <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(func):</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&quot;def add(x, y):</span><span class="ch">\n</span><span class="st">    lst.append(x)</span><span class="ch">\n</span><span class="st">    return x + y&quot;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)    </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(b, <span class="bu">globals</span>().update(<span class="bu">locals</span>())) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    add1 <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;add&#39;</span>] </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    add1(<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="ss">f&#39;locals: </span><span class="sc">{</span><span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&#39;</span>, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bring variables inside a func to the outside</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>test(add)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>pprint(add(<span class="dv">5</span>,<span class="dv">6</span>)) <span class="co"># the original add is override by the add from the function&#39;s locals()</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>pprint(add1(<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99daf0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;}&quot;
11
(&quot;locals: {&#39;func&#39;: &lt;function add at 0x10f99daf0&gt;, &#39;a&#39;: 1, &#39;lst&#39;: [5, 5], &#39;b&#39;: &#39;def add(x, y):\\n    lst.append(x)\\n    return x + y&#39;, &#39;add&#39;: &lt;function add &quot;
 &quot;at 0x10f9ac310&gt;, &#39;add1&#39;: &lt;function add at 0x10f9ac310&gt;}&quot;)
11
11
[5, 5, 5, 5]</code></pre>
</div>
</div>
</section>
<section id="globals-in-a-cell-vs-globals-in-a-func" class="level3">
<h3>globals() in a cell vs globals() in a func</h3>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastdebug.utils <span class="im">import</span> tstenv</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">globals</span>().keys())</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>91</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">globals</span>()[<span class="st">&#39;__name__&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&#39;__main__&#39;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tstenv??</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tstenv()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>out global env has 20 vars
inner global env has 20 vars
inner local env has 20 vars
[&#39;__name__&#39;, &#39;__doc__&#39;, &#39;__package__&#39;, &#39;__loader__&#39;, &#39;__spec__&#39;, &#39;__file__&#39;, &#39;__cached__&#39;, &#39;__builtins__&#39;, &#39;__all__&#39;, &#39;os&#39;]
[&#39;__name__&#39;, &#39;__doc__&#39;, &#39;__package__&#39;, &#39;__loader__&#39;, &#39;__spec__&#39;, &#39;__file__&#39;, &#39;__cached__&#39;, &#39;__builtins__&#39;, &#39;__all__&#39;, &#39;os&#39;]
out env[&#39;__name__&#39;]: fastdebug.utils
inner env[&#39;__name__&#39;]: fastdebug.utils</code></pre>
</div>
</div>
</section>
</section>
<section id="make-a-colorful-string" class="level2">
<h2>make a colorful string</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L26" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dbcolors" class="level3">
<h3>dbcolors</h3>
<blockquote>
<pre><code> dbcolors ()</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L33" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="colorize" class="level3">
<h3>colorize</h3>
<blockquote>
<pre><code> colorize (cmt, color:str=None)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>colorize(<span class="st">&quot;this is me&quot;</span>, <span class="st">&quot;r&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&#39;\x1b[91mthis is me\x1b[0m&#39;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(colorize(<span class="st">&quot;this is me&quot;</span>, <span class="st">&quot;r&quot;</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="align-text-to-the-most-right" class="level2">
<h2>align text to the most right</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L47" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="strip_ansi" class="level3">
<h3>strip_ansi</h3>
<blockquote>
<pre><code> strip_ansi (source)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> alignright(blocks):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> blocks.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    maxlen <span class="op">=</span> <span class="bu">max</span>(<span class="bu">map</span>(<span class="kw">lambda</span> l : <span class="bu">len</span>(strip_ansi(l)) , lst ))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> defaults.margin <span class="op">-</span> maxlen</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39; &#39;</span><span class="op">*</span>indent <span class="op">+</span> <span class="bu">format</span>(l))</span></code></pre></div>
</div>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L51" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="alignright" class="level3">
<h3>alignright</h3>
<blockquote>
<pre><code> alignright (blocks, margin:int=157)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>alignright(<span class="st">&quot;this is me&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                   this is me</code></pre>
</div>
</div>
</section>
</section>
<section id="printsrcwithidx" class="level2">
<h2>printsrcwithidx</h2>
<section id="print-the-entire-source-code-with-idx-from-0" class="level3">
<h3>print the entire source code with idx from 0</h3>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>        lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="print-the-whole-src-with-idx-or-print-them-in-parts" class="level3">
<h3>print the whole src with idx or print them in parts</h3>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                    maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                    part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="use-cmts-from-dbprint-to-print-out-src-with-comments" class="level3">
<h3>use cmts from dbprint to print out src with comments</h3>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrcwithidx(src, </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                    maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                    part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    cmts <span class="op">=</span> defaults.cmts</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>: </span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(foo)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(pprint)</span></span></code></pre></div>
</div>
</section>
<section id="no-more-update-for-printsrcwithidx-for-the-latest-see-fastdb.print" class="level3">
<h3>no more update for printsrcwithidx, for the latest see Fastdb.print</h3>
<p>see a <a href="./examples/dbprint.ipynb#test-printsrcwithidx">complex example</a> on printsrcwithidx</p>
</section>
</section>
<section id="print-out-src-code" class="level2">
<h2>print out src code</h2>
<section id="basic-version" class="level3">
<h3>basic version</h3>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the title</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:#^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="st">&quot; srcline under investigation &quot;</span>))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by &#39;\n&#39;</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>                numsrclines <span class="op">=</span> <span class="bu">len</span>(srclines.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>) <span class="co"># colorize the comment</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: </span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;a = 1 + 1&quot;</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
                                                                                                                                              this is comment
    b = a + 1                                                                                                                                                
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;    a = 1 + 1</span><span class="ch">\n</span><span class="st">    b = a + 1&quot;</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

################################################################ srcline under investigation ################################################################


def foo():                                                                                                                                                   
    a = 1 + 1================================================================================================================================================
    b = a + 1================================================================================================================================================
                                                                                                                                              this is comment
    pass                                                                                                                                                     
                                                                                                                                                             </code></pre>
</div>
</div>
</section>
<section id="print-src-with-specific-number-of-lines" class="level3">
<h3>print src with specific number of lines</h3>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&quot;    this is a code</span><span class="ch">\n</span><span class="st">this is another code&quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), <span class="st">&quot;    this is a code</span><span class="ch">\n</span><span class="st">    this is another code</span><span class="ch">\n</span><span class="st">   </span><span class="ch">\n</span><span class="st">   &quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, srclines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the source code of the function into a list of strings splitted by &#39;\n&#39;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find out the idx of start srclines and end srclines</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    startidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    numsrclines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), srclines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>            startidx <span class="op">=</span> idx</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    endidx <span class="op">=</span> startidx <span class="op">+</span> numsrclines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    ccount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:<span class="co"># print out the srcline under investigation with # as padding</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>            ccount <span class="op">=</span> ccount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): <span class="co"># print out comment at the end of the srclines under investigation</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>                <span class="co"># numsrclines = len(srclines.split(&quot;\n&quot;))</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ccount <span class="op">==</span> numsrclines:</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>) <span class="co"># colorize the comment</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># put the comment to the most right</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startidx <span class="op">-</span> expand:</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> endidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> endidx:</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) <span class="co"># print out the rest of source code to the most left</span></span></code></pre></div>
</div>
</section>
<section id="make-the-naming-more-sensible" class="level3">
<h3>make the naming more sensible</h3>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    startdbidx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>            startdbidx <span class="op">=</span> idx</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    enddbidx <span class="op">=</span> startdbidx <span class="op">+</span> numdblines <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    dbcount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>            dbcount <span class="op">=</span> dbcount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dbcount <span class="op">==</span> numdblines:</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;</span> startdbidx <span class="kw">and</span> idx <span class="op">&gt;=</span> startdbidx <span class="op">-</span> expand:</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> enddbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> enddbidx:</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span></code></pre></div>
</div>
</section>
<section id="allow-a-dbline-occur-more-than-once" class="level3">
<h3>Allow a dbline occur more than once</h3>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, dblines, cmt, expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f&#39;idx: {idx}; and l: {l}&#39;) # debugging</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># enddbidx = startdbidx + numdblines - 1</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbcount = 0</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(f&#39;idx: {idx}; and l: {l}&#39;) # debugging</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l))</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># dbcount = dbcount + 1</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt): </span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if dbcount == numdblines:</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>                    colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>                    alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx: </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx: </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l)) </span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="adding-idx-to-the-selected-srclines" class="level3">
<h3>adding idx to the selected srclines</h3>
<section id="printsrclinewithidx" class="level4">
<h4>printsrclinewithidx</h4>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L62" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="printsrclinewithidx-1" class="level3">
<h3>printsrclinewithidx</h3>
<blockquote>
<pre><code> printsrclinewithidx (idx, l, fill=&#39; &#39;)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>             dblines,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">&quot;=&quot;</span>)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="dblines-can-be-string-of-code-or-idx-number" class="level3">
<h3>dblines can be string of code or idx number</h3>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(<span class="bu">int</span>(<span class="st">&quot;120&quot;</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>int</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(a) <span class="op">==</span> <span class="bu">int</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printsrc(src, <span class="co"># name of src code such as foo, or delegates</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>             dbcode, <span class="co"># string of codes or int of code idx number</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>             cmt,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>             expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># expand the codes around the srcline under investigation</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    dblines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> lstsrc[dbcode]</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        dblines <span class="op">=</span> dbcode</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        numdblines <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(x.strip()), dblines.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))).count(<span class="va">True</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    dblineidx <span class="op">=</span> []</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>            dblineidx.append(idx)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> l.strip() <span class="kw">in</span> dblines:</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>            printsrclinewithidx(idx, l, fill<span class="op">=</span><span class="st">&quot;=&quot;</span>)</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(cmt):</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>                colcmt <span class="op">=</span> colorize(cmt, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>                alignright(colcmt) <span class="co"># also print the comment</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> o, dbidx <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblineidx)), dblineidx):</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> idx <span class="op">&gt;=</span> dbidx <span class="op">-</span> expand <span class="kw">and</span> idx <span class="op">&lt;</span> dbidx:</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> idx <span class="op">&lt;=</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> idx <span class="op">&gt;</span> dbidx:</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>                printsrclinewithidx(idx, l)</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> dbidx <span class="op">+</span> expand <span class="kw">and</span> <span class="bu">len</span>(dblineidx)<span class="op">&gt;=</span><span class="dv">2</span>:</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=^157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot; The occurance </span><span class="sc">{</span>o<span class="sc">}</span><span class="ss"> &quot;</span>))</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="avoid-multi-occurrance-of-the-same-srcline" class="level3">
<h3>avoid multi-occurrance of the same srcline</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L69" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="printsrc" class="level3">
<h3>printsrc</h3>
<blockquote>
<pre><code> printsrc (src, dbcode, cmt, expand:int=2)</code></pre>
</blockquote>
<p>print the seleted srcline with comment, idx and specified num of expanding srclines</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>name of src code such as foo, or delegates</td>
</tr>
<tr class="even">
<td>dbcode</td>
<td></td>
<td></td>
<td>string of codes or int of code idx number</td>
</tr>
<tr class="odd">
<td>cmt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>expand</td>
<td>int</td>
<td>2</td>
<td>expand the codes around the srcline under investigation</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;else:&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, expand<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:===============================================================================================================================================(6)
                                                                                                                                              this is comment
        &quot;this is docs&quot;                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    &quot;this is docs&quot;                                                                                                                                      (9)
    return a                                                                                                                                            (10)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="st">&quot;return a&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, expand<span class="op">=</span><span class="dv">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):                                                                                                                                             (0)
    &quot;this is docs&quot;                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:                                                                                                                                           (3)
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)
    else:                                                                                                                                               (6)
        &quot;this is docs&quot;                                                                                                                                  (7)
        b = a + 1                                                                                                                                       (8)
    &quot;this is docs&quot;                                                                                                                                      (9)
    return a============================================================================================================================================(10)
                                                                                                                                              this is comment
                                                                                                                                                        (11)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>printsrc(foo, <span class="dv">3</span>, <span class="st">&quot;this is comment&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    &quot;this is docs&quot;                                                                                                                                      (1)
    # this is a pure comment                                                                                                                            (2)
    if a &gt; 1:===========================================================================================================================================(3)
                                                                                                                                              this is comment
        for i in range(3):                                                                                                                              (4)
            a = i + 1                                                                                                                                   (5)</code></pre>
</div>
</div>
<p>more <a href="./examples/printsrc.ipynb">complex example</a> on printsrc</p>
</section>
</section>
<section id="dbprint-on-expression" class="level2">
<h2>dbprint on expression</h2>
<section id="basic-version-1" class="level3">
<h3>basic version</h3>
<div class="cell">
<div class="sourceCode" id="cb102"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>code,   <span class="co"># a number of codes to run, each code is in str, e.g., &quot;a + b&quot;, &quot;c = a - b&quot;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>env</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;debug a srcline with one or more expressions with src printed.&quot;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> code:</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():     </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(): </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    dbprint(foo, <span class="st">&quot;    a = 1 + 1&quot;</span>, <span class="st">&quot;this is a test&quot;</span>, <span class="st">&quot;1+2&quot;</span>, <span class="st">&quot;str(1+2)&quot;</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>foo()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo():                                                                                                                                              (0)
    dbprint(foo, &quot;    a = 1 + 1&quot;, &quot;this is a test&quot;, &quot;1+2&quot;, &quot;str(1+2)&quot;)                                                                                  (1)
    a = 1 + 1===========================================================================================================================================(2)
                                                                                                                                               this is a test
    pass                                                                                                                                                (3)
                                                                                                                                                        (4)
                                                                                                                                               1+2 =&gt; 1+2 : 3
                                                                                                                                     str(1+2) =&gt; str(1+2) : 3</code></pre>
</div>
</div>
</section>
<section id="insert-dbcode-and-make-a-new-dbfunc" class="level3">
<h3>insert dbcode and make a new dbfunc</h3>
<p>when bringing back splitted lines back, we need add ‘’ back to them</p>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>back <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    back <span class="op">=</span> back <span class="op">+</span> l</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>pprint(back, width<span class="op">=</span><span class="dv">157</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&#39;def foo():     dbprint(foo, &quot;    a = 1 + 1&quot;, &quot;this is a test&quot;, &quot;1+2&quot;, &quot;str(1+2)&quot;)    a = 1 + 1    pass&#39;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span> <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb109-49"><a href="#cb109-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb109-50"><a href="#cb109-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-51"><a href="#cb109-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb109-61"><a href="#cb109-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb109-62"><a href="#cb109-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-63"><a href="#cb109-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb109-64"><a href="#cb109-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb109-65"><a href="#cb109-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb109-66"><a href="#cb109-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-67"><a href="#cb109-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb109-68"><a href="#cb109-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc) <span class="co"># created new foo and saved inside locals()</span></span>
<span id="cb109-69"><a href="#cb109-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-70"><a href="#cb109-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-71"><a href="#cb109-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb109-72"><a href="#cb109-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(locals())</span></span>
<span id="cb109-73"><a href="#cb109-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-74"><a href="#cb109-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb109-75"><a href="#cb109-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb109-76"><a href="#cb109-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-77"><a href="#cb109-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="bring-outside-namespace-variables-into-exec" class="level3">
<h3>Bring outside namespace variables into exec()</h3>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec the dbsrc to replace the official source code</span></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc) # created new foo and saved inside locals()</span></span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># exec(dbsrc, globals().update(locals())) # make sure b can access lst from above</span></span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb110-74"><a href="#cb110-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb110-75"><a href="#cb110-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb110-76"><a href="#cb110-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-77"><a href="#cb110-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move this new foo into globals, so that outside the cell we can still use it</span></span>
<span id="cb110-78"><a href="#cb110-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">globals</span>().update(<span class="bu">locals</span>())</span>
<span id="cb110-79"><a href="#cb110-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-80"><a href="#cb110-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="bring-what-inside-the-func-namespace-variables-to-the-outside-world" class="level3">
<h3>Bring what inside the func namespace variables to the outside world</h3>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> <span class="bu">globals</span>() <span class="co"># outer env</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
<p>see a <a href="./examples/dbprint.ipynb">complex example</a> on dbprint</p>
</section>
<section id="adding-g-locals-to-dbprintinsert-to-avoid-adding-env-individually" class="level3">
<h3>Adding g = locals() to dbprintinsert to avoid adding env individually</h3>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>            srclines:<span class="bu">str</span>, <span class="co"># the srclines under investigation</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, srclines, cmt, expand)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb112-60"><a href="#cb112-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb112-61"><a href="#cb112-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb112-62"><a href="#cb112-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb112-63"><a href="#cb112-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-64"><a href="#cb112-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb112-65"><a href="#cb112-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb112-66"><a href="#cb112-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb112-67"><a href="#cb112-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-68"><a href="#cb112-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb112-69"><a href="#cb112-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-70"><a href="#cb112-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb112-71"><a href="#cb112-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb112-72"><a href="#cb112-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb112-73"><a href="#cb112-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-74"><a href="#cb112-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb112-75"><a href="#cb112-75" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb112-76"><a href="#cb112-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-77"><a href="#cb112-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="enable-srclines-to-be-either-string-or-int" class="level3">
<h3>enable srclines to be either string or int</h3>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> count <span class="op">!=</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;=&quot;</span> <span class="kw">not</span> <span class="kw">in</span> c:</span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb113-66"><a href="#cb113-66" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb113-67"><a href="#cb113-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb113-68"><a href="#cb113-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb113-69"><a href="#cb113-69" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb113-70"><a href="#cb113-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-71"><a href="#cb113-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb113-72"><a href="#cb113-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb113-73"><a href="#cb113-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb113-74"><a href="#cb113-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-75"><a href="#cb113-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb113-76"><a href="#cb113-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-77"><a href="#cb113-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb113-78"><a href="#cb113-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb113-79"><a href="#cb113-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb113-80"><a href="#cb113-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-81"><a href="#cb113-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb113-82"><a href="#cb113-82" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb113-83"><a href="#cb113-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-84"><a href="#cb113-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="enable-to-be-used-as-assignment-in-codes" class="level3">
<h3>enable = to be used as assignment in codes</h3>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;env=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count == len(codes) and &quot;=&quot; not in c:</span></span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;)&quot;</span></span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and &quot;=&quot; in c:</span></span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbcodes = dbcodes + c + &quot;,&quot;</span></span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif count != len(codes) and &quot;=&quot; not in c:</span></span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb114-55"><a href="#cb114-55" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb114-56"><a href="#cb114-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-57"><a href="#cb114-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb114-58"><a href="#cb114-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb114-59"><a href="#cb114-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb114-60"><a href="#cb114-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-61"><a href="#cb114-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb114-62"><a href="#cb114-62" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb114-63"><a href="#cb114-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb114-64"><a href="#cb114-64" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-65"><a href="#cb114-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb114-66"><a href="#cb114-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb114-67"><a href="#cb114-67" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb114-68"><a href="#cb114-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb114-69"><a href="#cb114-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb114-70"><a href="#cb114-70" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb114-71"><a href="#cb114-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-72"><a href="#cb114-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb114-73"><a href="#cb114-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb114-74"><a href="#cb114-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb114-75"><a href="#cb114-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-76"><a href="#cb114-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb114-77"><a href="#cb114-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-78"><a href="#cb114-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb114-79"><a href="#cb114-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb114-80"><a href="#cb114-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb114-81"><a href="#cb114-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-82"><a href="#cb114-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb114-83"><a href="#cb114-83" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb114-84"><a href="#cb114-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-85"><a href="#cb114-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="avoid-adding-envg-for-dbprintinsert" class="level3">
<h3>avoid adding “env=g” for dbprintinsert</h3>
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>            env <span class="op">=</span> {} <span class="co"># outer env</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>           ):  <span class="co"># a number of stuff needed to run the code, e.g. var1 = var1, func1 = func1</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out src code: the basic version</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># insert the dbcodes from *code into the original official srcode</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the last line which is &quot;&quot; is removed from lst</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dbprint is enabled to accept both string or int</span></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># express and insert the dbcode after the srcline under investigation</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current l&#39;s indentation is enough here, as dbcode is above l</span></span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># attach dbcode above the l under investigation</span></span>
<span id="cb115-43"><a href="#cb115-43" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb115-44"><a href="#cb115-44" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb115-45"><a href="#cb115-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb115-46"><a href="#cb115-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb115-47"><a href="#cb115-47" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb115-48"><a href="#cb115-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb115-49"><a href="#cb115-49" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb115-50"><a href="#cb115-50" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb115-51"><a href="#cb115-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-52"><a href="#cb115-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure dbprint only written once for multi-srclines under investigation</span></span>
<span id="cb115-53"><a href="#cb115-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb115-54"><a href="#cb115-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># adding this line above dbprint line</span></span>
<span id="cb115-55"><a href="#cb115-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb115-56"><a href="#cb115-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span> <span class="co"># don&#39;t forget to add the srcline below dbprint</span></span>
<span id="cb115-57"><a href="#cb115-57" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb115-58"><a href="#cb115-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb115-59"><a href="#cb115-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb115-60"><a href="#cb115-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-61"><a href="#cb115-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst): <span class="co"># handle the last line of srcode</span></span>
<span id="cb115-62"><a href="#cb115-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb115-63"><a href="#cb115-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-64"><a href="#cb115-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb115-65"><a href="#cb115-65" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb115-66"><a href="#cb115-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-67"><a href="#cb115-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print out the new srcode</span></span>
<span id="cb115-68"><a href="#cb115-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb115-69"><a href="#cb115-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(l)</span></span>
<span id="cb115-70"><a href="#cb115-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-71"><a href="#cb115-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb115-72"><a href="#cb115-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-73"><a href="#cb115-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check to see whether the new srcode is created</span></span>
<span id="cb115-74"><a href="#cb115-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;src&quot;]: {locals()[&quot;src&quot;]}&#39;)</span></span>
<span id="cb115-75"><a href="#cb115-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&#39;locals()[&quot;{src.__name__}&quot;]: {locals()[src.__name__]}&#39;)</span></span>
<span id="cb115-76"><a href="#cb115-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-77"><a href="#cb115-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is crucial to bring what inside a func namespace into the outside world</span></span>
<span id="cb115-78"><a href="#cb115-78" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb115-79"><a href="#cb115-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-80"><a href="#cb115-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="collect-cmt-for-later-printsrcwithidx-to-print-comments-together" class="level3">
<h3>collect cmt for later printsrcwithidx to print comments together</h3>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>            env<span class="op">=</span>{}): <span class="co"># out environment</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: defaults.cmts.update({dbcode: cmt})</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a>                onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb116-55"><a href="#cb116-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-56"><a href="#cb116-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb116-57"><a href="#cb116-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb116-58"><a href="#cb116-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-59"><a href="#cb116-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb116-60"><a href="#cb116-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-61"><a href="#cb116-61" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb116-62"><a href="#cb116-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-63"><a href="#cb116-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="make-sure-only-one-line-with-correct-idx-is-debugged" class="level3">
<h3>make sure only one line with correct idx is debugged</h3>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(src, <span class="co"># the src func name, e.g., foo</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>            dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>            env<span class="op">=</span>{}, <span class="co"># out environment</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># print out dbsrc or not</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> defaults.orisrc <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>        defaults.orisrc <span class="op">=</span> src</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> defaults.orisrc</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: defaults.cmts.update({dbcode: cmt})</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># make sure the line with correct idx is debugged</span></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>  </span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-57"><a href="#cb117-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-58"><a href="#cb117-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb117-59"><a href="#cb117-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb117-60"><a href="#cb117-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span>
<span id="cb117-61"><a href="#cb117-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-62"><a href="#cb117-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb117-63"><a href="#cb117-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-64"><a href="#cb117-64" aria-hidden="true" tabindex="-1"></a>    env.update(<span class="bu">locals</span>())</span>
<span id="cb117-65"><a href="#cb117-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-66"><a href="#cb117-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[defaults.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="avoid-typing-when-there-is-no-codes" class="level3">
<h3>avoid typing “” when there is no codes</h3>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def dbprint(src, # the src func name, e.g., foo</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcode, # the srclines under investigation, can be either string or int</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co">#             cmt:str, # comment</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#             *codes, # a list of dbcodes</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#             expand:int=2, # span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             env={}, # out environment</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             showdbsrc=False): # print out dbsrc or not</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     # make sure the original official src is kept safe and used whenever dbprint is used</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     if defaults.orisrc == None:</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="co">#         defaults.orisrc = src</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     else: </span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         src = defaults.orisrc</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int: defaults.cmts.update({dbcode: cmt})</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     printsrc(src, dbcode, cmt, expand)</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     dbsrc = &quot;&quot;</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     indent = 4</span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     onedbprint = False</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     lst = inspect.getsource(src).split(&#39;\n&#39;)</span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     if not bool(lst[-1]): lst = lst[:-1]</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     srclines = &quot;&quot;</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     if type(dbcode) == int:</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = lst[dbcode]</span></span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     for idx, l in zip(range(len(lst)), lst):</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         if bool(l.strip()) and l.strip() in srclines:</span></span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a><span class="co">#             numindent = len(l) - len(l.strip())</span></span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbcodes = &quot;dbprintinsert(&quot;</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a><span class="co">#             count = 1</span></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a><span class="co">#             for c in codes:</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if count == len(codes):</span></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;,&quot; + &quot;env=g&quot; + &quot;)&quot;</span></span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                 else:</span></span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                     dbcodes = dbcodes + &#39;&quot;&#39; + c + &#39;&quot;&#39; + &quot;,&quot;</span></span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                 count = count + 1</span></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a><span class="co">#             if onedbprint == False:</span></span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + &quot; &quot;*numindent + &quot;g = locals()&quot; + &#39;\n&#39;</span></span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + &quot; &quot;*numindent + dbcodes + &#39;\n&#39;</span></span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                 onedbprint = True</span></span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a><span class="co">#             else:</span></span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()) and idx + 1 == len(lst):</span></span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l</span></span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a><span class="co">#         elif bool(l.strip()): # make sure pure indentation + \n is ignored</span></span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a><span class="co">#             dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     if showdbsrc: # added to debug</span></span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         for l in dbsrc.split(&#39;\n&#39;):</span></span>
<span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(l)</span></span>
<span id="cb118-63"><a href="#cb118-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     exec(dbsrc, globals().update(env)) # make sure b can access lst from above</span></span>
<span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     env.update(locals())</span></span>
<span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[defaults.orisrc.__name__]</span></span></code></pre></div>
</div>
</section>
<section id="no-more-update-for-dbprint-for-the-latest-see-fastdb.dbprint" class="level3">
<h3>no more update for dbprint, for the latest see Fastdb.dbprint</h3>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile" class="level3">
<h3>use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>sfc <span class="op">=</span> dbprint(_signature_from_callable, <span class="st">&quot;if isinstance(obj, type):&quot;</span>, <span class="st">&quot;this is comment&quot;</span>, <span class="op">\</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;locals()&quot;</span>, <span class="st">&quot;isinstance(obj, type)&quot;</span>, <span class="st">&quot;env=g&quot;</span>, <span class="op">\</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>              expand<span class="op">=</span><span class="dv">1</span>, env<span class="op">=</span>g)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co"># overriding the original official source with our dbsrc, even though rewriting _signature_from_callable inside inspect.py ######################</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> _signature_from_callable</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>inspect.signature(Foo) </span></code></pre></div>
</section>
</section>
<section id="dbprintinsert" class="level2">
<h2>dbprintinsert</h2>
<section id="run-and-display-the-inserted-dbcodes" class="level3">
<h3>Run and display the inserted dbcodes</h3>
<p>for each srcline under investigation, used inside dbprint</p>
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, <span class="op">**</span>env): </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> a<span class="op">*</span><span class="dv">2</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> a <span class="op">*</span> b</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;   &quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;a&quot;, &quot;a + 1&quot;, env=g)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;a&quot;, &quot;a + 1&quot;, env=g)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb127"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co">#</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbprint(foo, &quot;c = a * b&quot;, &quot;comment&quot;, &quot;b&quot;, &quot;b * a&quot;, expand=3)</span></span></code></pre></div>
</div>
</section>
<section id="use-locals-inside-the-dbsrc-code-to-avoid-adding-env-individually" class="level3">
<h3>use locals() inside the dbsrc code to avoid adding env individually</h3>
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprintinsert(<span class="op">*</span>codes, env<span class="op">=</span>{}): </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f&quot;{c} =&gt; {c} : {eval(c, globals().update(env))}&quot;) </span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> =&gt; </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="bu">eval</span>(c, <span class="bu">globals</span>().update(env))<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output))</span></code></pre></div>
</div>
</section>
<section id="enable-dbprintinsert-to-do-exec-on-a-block-of-code" class="level3">
<h3>enable dbprintinsert to do exec on a block of code</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L110" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dbprintinsert-1" class="level3">
<h3>dbprintinsert</h3>
<blockquote>
<pre><code> dbprintinsert (*codes, env={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb133"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;a&quot;, &quot;a + 1&quot;)</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb134"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;a&quot;, &quot;a + 1&quot;, &quot;pprint(a)&quot;, &quot;if a &gt; 2:\\n    print(&#39;I am here&#39;)&quot;)</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;for i in range(3):\\n    print(f&#39;I am {i}&#39;)&quot;)</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;for i in range(3): print(f&#39;I am {i}&#39;)&quot;)</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb137"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;pprint(locals())&quot;)</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb138"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1 = dbprint(foo, &quot;b = a + 1&quot;, &quot;comment&quot;, &quot;pprint(locals(), width=157)&quot;) # width=157 can cause error</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo1(3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> delegates</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> inspect.getsource(delegates).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> ls[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>ls</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[&#39;def delegates(to:FunctionType=None, # Delegatee&#39;,
 &#39;              keep=False, # Keep `kwargs` in decorated function?&#39;,
 &#39;              but:list=None): # Exclude these parameters from signature&#39;,
 &#39;    &quot;Decorator: replace `**kwargs` in signature with params from `to`&quot;&#39;,
 &#39;    if but is None: but = []&#39;,
 &#39;    def _f(f):&#39;,
 &#39;        if to is None: to_f,from_f = f.__base__.__init__,f.__init__&#39;,
 &#39;        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f&#39;,
 &quot;        from_f = getattr(from_f,&#39;__func__&#39;,from_f)&quot;,
 &quot;        to_f = getattr(to_f,&#39;__func__&#39;,to_f)&quot;,
 &quot;        if hasattr(from_f,&#39;__delwrap__&#39;): return f&quot;,
 &#39;        sig = inspect.signature(from_f)&#39;,
 &#39;        sigd = dict(sig.parameters)&#39;,
 &quot;        k = sigd.pop(&#39;kwargs&#39;)&quot;,
 &#39;        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()&#39;,
 &#39;              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}&#39;,
 &#39;        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}&#39;,
 &#39;        sigd.update(s2)&#39;,
 &quot;        if keep: sigd[&#39;kwargs&#39;] = k&quot;,
 &#39;        else: from_f.__delwrap__ = to_f&#39;,
 &#39;        from_f.__signature__ = sig.replace(parameters=sigd.values())&#39;,
 &quot;        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)&quot;,
 &#39;        return f&#39;,
 &#39;    return _f&#39;]</code></pre>
</div>
</div>
</section>
</section>
<section id="printrunsrclines" class="level2">
<h2>printrunsrclines()</h2>
<p>It can print out only srclines which actually ran</p>
<section id="examples" class="level3">
<h3>Examples</h3>
<section id="simple-example" class="level4">
<h4>simple example</h4>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># def foo(a):</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     if a &gt; 1:</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         a = 1 + 1</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         b = a + 1</span></span></code></pre></div>
</div>
</section>
<section id="complex-example" class="level4">
<h4>complex example</h4>
<div class="cell">
<div class="sourceCode" id="cb143"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb144"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
</section>
</section>
<section id="insert-a-line-after-each-srcline-to-add-idx" class="level3">
<h3>insert a line after each srcline to add idx</h3>
<div class="cell">
<div class="sourceCode" id="cb146"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if &quot;if&quot; in l or &quot;else&quot; in l or &quot;for&quot; in l:</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">    srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="ss">&quot;</span> <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb147"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
    srcidx.append(3)
        for i in range(3):
    srcidx.append(4)
            a = i + 1
    srcidx.append(5)
    else:
    srcidx.append(6)
        &quot;this is docs&quot;
    srcidx.append(7)
        b = a + 1
    srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

    srcidx.append(11)
</code></pre>
</div>
</div>
</section>
<section id="add-correct-indentation-to-each-inserted-line" class="level3">
<h3>add correct indentation to each inserted line</h3>
<section id="count-the-indentation-for-each-srcline" class="level4">
<h4>count the indentation for each srcline</h4>
<div class="cell">
<div class="sourceCode" id="cb149"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="st">&quot;    a = 1&quot;</span>) <span class="op">-</span> <span class="bu">len</span>(<span class="st">&quot;    a = 1&quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb151"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>   <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
    srcidx.append(3)
        for i in range(3):
        srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
    srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

srcidx.append(11)
</code></pre>
</div>
</div>
</section>
</section>
<section id="indentation-special-case-if-else-for-def" class="level3">
<h3>indentation special case: if, else, for, def</h3>
<div class="cell">
<div class="sourceCode" id="cb154"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)

srcidx.append(11)
</code></pre>
</div>
</div>
</section>
<section id="remove-pure-comments-or-docs-from-dbsrc" class="level3">
<h3>remove pure comments or docs from dbsrc</h3>
<p>Do not insert line for pure comment or pure “”</p>
<div class="cell">
<div class="sourceCode" id="cb157"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb158"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> srclines:</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    pprint(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&#39;def foo(a):&#39;
&#39;    &quot;this is docs&quot;&#39;
&#39;    # this is a pure comment&#39;
&#39;    if a &gt; 1:&#39;
&#39;        for i in range(3):&#39;
&#39;            a = i + 1&#39;
&#39;    else:&#39;
&#39;        &quot;this is docs&quot;&#39;
&#39;        b = a + 1&#39;
&#39;    &quot;this is docs&quot;&#39;
&#39;    return a&#39;
&#39;&#39;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb160"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;# this is a comment&quot;</span>.startswith(<span class="st">&quot;#&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb162"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;a = 1 # this is comment&quot;</span>.startswith(<span class="st">&quot;#&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb164"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l): <span class="co"># ignore pure &#39;\n&#39;</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb165"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    &quot;this is docs&quot;
    srcidx.append(1)
    # this is a pure comment
    srcidx.append(2)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        &quot;this is docs&quot;
        srcidx.append(7)
        b = a + 1
        srcidx.append(8)
    &quot;this is docs&quot;
    srcidx.append(9)
    return a
    srcidx.append(10)
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb167"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>srclines <span class="op">=</span> inspect.getsource(foo).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>    addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb168"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>): <span class="co"># now the dbsrc has no pure comment and pure docs</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    srcidx.append(0)
    if a &gt; 1:
        srcidx.append(3)
        for i in range(3):
            srcidx.append(4)
            a = i + 1
            srcidx.append(5)
    else:
        srcidx.append(6)
        b = a + 1
        srcidx.append(8)
    return a
    srcidx.append(10)
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb170"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb171"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span>(dbsrc) <span class="co"># give life to dbsrc</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb172"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>foo??</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb173"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>srcidx <span class="op">=</span> [] <span class="co">#used outside the srcode</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb174"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>foo(<span class="dv">3</span>) <span class="co"># run the example using dbsrc</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># foo(-1) # run the example using dbsrc</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>srcidx <span class="co"># Now it should have all the idx whose srclines have run</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[0, 3, 4, 5, 4, 5, 4, 5]</code></pre>
</div>
</div>
</section>
<section id="print-out-the-srclines-which-get-run" class="level3">
<h3>print out the srclines which get run</h3>
<div class="cell">
<div class="sourceCode" id="cb176"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx:</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1</code></pre>
</div>
</div>
</section>
<section id="make-sure-all-if-else-for-get-printed" class="level3">
<h3>Make sure all if, else, for get printed</h3>
<div class="cell">
<div class="sourceCode" id="cb178"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(l)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
</section>
<section id="put-all-together-into-the-function-printrunsrclines" class="level3">
<h3>Put all together into the function printrunsrclines()</h3>
<div class="cell">
<div class="sourceCode" id="cb180"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a pure comment</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;this is docs&quot;</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb181"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>    fool <span class="op">=</span> <span class="bu">locals</span>()[<span class="st">&#39;foo&#39;</span>]</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>    pprint(fool(<span class="dv">3</span>))</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>    pprint(<span class="bu">locals</span>())</span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run = &quot;foo(3)&quot;</span></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">&quot;fool(3)&quot;</span>)</span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb182"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3
{&#39;addline&#39;: &#39;srcidx.append(11)&#39;,
 &#39;dbsrc&#39;: &#39;def foo(a):\n&#39;
          &#39;    srcidx.append(0)\n&#39;
          &#39;    if a &gt; 1:\n&#39;
          &#39;        srcidx.append(3)\n&#39;
          &#39;        for i in range(3):\n&#39;
          &#39;            srcidx.append(4)\n&#39;
          &#39;            a = i + 1\n&#39;
          &#39;            srcidx.append(5)\n&#39;
          &#39;    else:\n&#39;
          &#39;        srcidx.append(6)\n&#39;
          &#39;        b = a + 1\n&#39;
          &#39;        srcidx.append(8)\n&#39;
          &#39;    return a\n&#39;
          &#39;    srcidx.append(10)\n&#39;,
 &#39;foo&#39;: &lt;function foo at 0x10fa67160&gt;,
 &#39;fool&#39;: &lt;function foo at 0x10fa67160&gt;,
 &#39;func&#39;: &lt;function foo at 0x10fa67b80&gt;,
 &#39;idx&#39;: 11,
 &#39;indent&#39;: 4,
 &#39;l&#39;: &#39;&#39;,
 &#39;numindent&#39;: 0,
 &#39;srcidx&#39;: [0, 3, 4, 5, 4, 5, 4, 5],
 &#39;srclines&#39;: [&#39;def foo(a):&#39;,
              &#39;    &quot;this is docs&quot;&#39;,
              &#39;    # this is a pure comment&#39;,
              &#39;    if a &gt; 1:&#39;,
              &#39;        for i in range(3):&#39;,
              &#39;            a = i + 1&#39;,
              &#39;    else:&#39;,
              &#39;        &quot;this is docs&quot;&#39;,
              &#39;        b = a + 1&#39;,
              &#39;    &quot;this is docs&quot;&#39;,
              &#39;    return a&#39;,
              &#39;&#39;]}
[0, 3, 4, 5, 4, 5, 4, 5, 0, 3, 4, 5, 4, 5, 4, 5]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
<section id="no-more-renaming-of-foo" class="level4">
<h4>no more renaming of foo</h4>
<div class="cell">
<div class="sourceCode" id="cb184"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func):</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(<span class="st">&quot;foo(3)&quot;</span>) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb185"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(a):</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> a <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb186"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 2, 3, 4, 3, 4, 3, 4]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
</section>
<section id="add-example-as-a-param-into-the-function" class="level4">
<h4>add example as a param into the function</h4>
<div class="cell">
<div class="sourceCode" id="cb188"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb189"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">&quot;foo(-1)&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def foo(a):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &#39;    if a &gt; 1:\n&#39;
 &#39;        srcidx.append(2)\n&#39;
 &#39;        for i in range(3):\n&#39;
 &#39;            srcidx.append(3)\n&#39;
 &#39;            a = i + 1\n&#39;
 &#39;            srcidx.append(4)\n&#39;
 &#39;    else:\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        b = a + 1\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;    return a\n&#39;
 &#39;    srcidx.append(7)\n&#39;)
[0, 5, 6]
def foo(a):
    if a &gt; 1:
        for i in range(3):
    else:
        b = a + 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb191"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(foo, <span class="st">&quot;foo(2)&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def foo(a):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &#39;    if a &gt; 1:\n&#39;
 &#39;        srcidx.append(2)\n&#39;
 &#39;        for i in range(3):\n&#39;
 &#39;            srcidx.append(3)\n&#39;
 &#39;            a = i + 1\n&#39;
 &#39;            srcidx.append(4)\n&#39;
 &#39;    else:\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        b = a + 1\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;    return a\n&#39;
 &#39;    srcidx.append(7)\n&#39;)
[0, 2, 3, 4, 3, 4, 3, 4]
def foo(a):
    if a &gt; 1:
        for i in range(3):
            a = i + 1
    else:</code></pre>
</div>
</div>
</section>
<section id="improve-on-search-for-if-else-for-def-to-avoid-errors-for-more-examples" class="level4">
<h4>improve on search for <code>if</code>, else, for, def to avoid errors for more examples</h4>
<div class="cell">
<div class="sourceCode" id="cb193"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else:&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def &quot;</span> <span class="kw">in</span> l:</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="op">\</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): <span class="co"># ignore/remove pure quotations or docs</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb194"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">&#39;alignright(&quot;this is me&quot;)&#39;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def alignright(blocks, margin:int=157):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &quot;    lst = blocks.split(&#39;\\n&#39;)\n&quot;
 &#39;    srcidx.append(1)\n&#39;
 &#39;    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))\n&#39;
 &#39;    srcidx.append(2)\n&#39;
 &#39;    indent = margin - maxlen\n&#39;
 &#39;    srcidx.append(3)\n&#39;
 &#39;    for l in lst:\n&#39;
 &#39;        srcidx.append(4)\n&#39;
 &quot;        print(&#39; &#39;*indent + format(l))\n&quot;
 &#39;        srcidx.append(5)\n&#39;)
                                                                                                                                                   this is me
[0, 1, 2, 3, 4, 5]
def alignright(blocks, margin:int=157):
    lst = blocks.split(&#39;\n&#39;)
    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))
    indent = margin - maxlen
    for l in lst:
        print(&#39; &#39;*indent + format(l))</code></pre>
</div>
</div>
</section>
<section id="remove-an-empty-line-with-indentation" class="level4">
<h4>remove an empty line with indentation</h4>
<div class="cell">
<div class="sourceCode" id="cb196"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span><span class="ch">\n\</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="st">     </span><span class="ch">\n\</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="st">this is code</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span>.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lst)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lst:</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">bool</span>(l.strip()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[&#39;&#39;, &#39;this is code&#39;, &#39;     &#39;, &#39;this is code&#39;, &#39;&#39;]
False
True
False
True
False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb198"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(func, example):</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> inspect.getsource(func).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip()) <span class="co"># how to strip only the left not the right?????</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&quot;if &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else:&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;for &quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;def &quot;</span> <span class="kw">in</span> l:</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="op">\</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)): </span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc)</span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="bu">locals</span>()))    </span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclines)), srclines):</span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(alignright, <span class="st">&#39;alignright(&quot;this is me&quot;)&#39;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def alignright(blocks, margin:int=157):\n&#39;
 &#39;    srcidx.append(0)\n&#39;
 &quot;    lst = blocks.split(&#39;\\n&#39;)\n&quot;
 &#39;    srcidx.append(1)\n&#39;
 &#39;    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))\n&#39;
 &#39;    srcidx.append(2)\n&#39;
 &#39;    indent = margin - maxlen\n&#39;
 &#39;    srcidx.append(3)\n&#39;
 &#39;    for l in lst:\n&#39;
 &#39;        srcidx.append(4)\n&#39;
 &quot;        print(&#39; &#39;*indent + format(l))\n&quot;
 &#39;        srcidx.append(5)\n&#39;)
                                                                                                                                                   this is me
[0, 1, 2, 3, 4, 5]
def alignright(blocks, margin:int=157):
    lst = blocks.split(&#39;\n&#39;)
    maxlen = max(map(lambda l : len(strip_ansi(l)) , lst ))
    indent = margin - maxlen
    for l in lst:
        print(&#39; &#39;*indent + format(l))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb201"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>pprint(inspect.getsource(printsrc))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def printsrc(src, # name of src code such as foo, or delegates\n&#39;
 &#39;             dbcode, # string of codes or int of code idx number\n&#39;
 &#39;             cmt,\n&#39;
 &#39;             expand:int=2): # expand the codes around the srcline under &#39;
 &#39;investigation\n&#39;
 &#39;    &quot;print the seleted srcline with comment, idx and specified num of &#39;
 &#39;expanding srclines&quot;\n&#39;
 &quot;    lstsrc = inspect.getsource(src).split(&#39;\\n&#39;)\n&quot;
 &#39;    \n&#39;
 &#39;    dblines = &quot;&quot;\n&#39;
 &#39;    if type(dbcode) == int:\n&#39;
 &#39;        dblines = lstsrc[dbcode]\n&#39;
 &#39;    else:\n&#39;
 &#39;        dblines = dbcode\n&#39;
 &#39;        numdblines = list(map(lambda x: bool(x.strip()), &#39;
 &quot;dblines.split(&#39;\\n&#39;))).count(True)\n&quot;
 &#39;    \n&#39;
 &#39;    \n&#39;
 &#39;    dblineidx = []\n&#39;
 &#39;    for idx, l in zip(range(len(lstsrc)), lstsrc):\n&#39;
 &#39;        if bool(l) and l.strip() in dblines:\n&#39;
 &#39;            dblineidx.append(idx)\n&#39;
 &#39;\n&#39;
 &#39;    for idx, l in zip(range(len(lstsrc)), lstsrc):\n&#39;
 &#39;        \n&#39;
 &#39;        srcidx = dbcode if type(dbcode) == int else dblineidx[0]\n&#39;
 &#39;        \n&#39;
 &#39;        if bool(l) and l.strip() in dblines and idx == srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l, fill=&quot;=&quot;)\n&#39;
 &#39;\n&#39;
 &#39;            if bool(cmt):\n&#39;
 &#39;                colcmt = colorize(cmt, &quot;r&quot;)\n&#39;
 &#39;                alignright(colcmt) # also print the comment\n&#39;
 &#39;\n&#39;
 &#39;        if idx &gt;= srcidx - expand and idx &lt; srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l)\n&#39;
 &#39;        elif idx &lt;= srcidx + expand and idx &gt; srcidx:\n&#39;
 &#39;            printsrclinewithidx(idx, l)\n&#39;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb203"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;, &quot;</span> <span class="kw">in</span> <span class="st">&quot;    env, &quot;</span>.strip()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
</section>
</section>
<section id="make-it-work" class="level3">
<h3>make it work</h3>
<div class="cell">
<div class="sourceCode" id="cb205"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>[]</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>a.append([<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[1, 2]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb207"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> printrunsrclines(src, example, env):</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>    srclst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>    bracketidx <span class="op">=</span> []</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>    bracketindent <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>    ifelseidx <span class="op">=</span> []</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>    ifelseindent <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclst)), srclst):</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>        numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip()) <span class="co"># how to strip only the left not the right?????</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>        addline <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="st">&quot;if &quot;</span> <span class="kw">in</span> l <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;:&#39;</span>)) <span class="kw">or</span> l.strip().endswith(<span class="st">&quot;else:&quot;</span>) <span class="kw">or</span> (<span class="st">&quot;elif &quot;</span> <span class="kw">in</span> l <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;:&#39;</span>)) <span class="op">\</span></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">or</span>  (l.strip().endswith(<span class="st">&#39;:&#39;</span>) <span class="kw">and</span> <span class="st">&quot;for &quot;</span> <span class="kw">in</span> l) <span class="kw">or</span> (<span class="st">&quot;def &quot;</span> <span class="kw">in</span> l <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;:&#39;</span>)):</span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> numindent <span class="op">+</span> indent</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> l.strip().startswith(<span class="st">&#39;&quot;&quot;&quot;&#39;</span>):</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> srclst[idx <span class="op">-</span> <span class="dv">1</span>].strip().startswith(<span class="st">&#39;&quot;&quot;&quot;&#39;</span>) <span class="kw">and</span> <span class="st">&#39;&quot;&quot;&quot;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> l.strip():</span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> idx <span class="op">&lt;=</span> <span class="bu">len</span>(srclst) <span class="op">-</span> <span class="dv">2</span> <span class="kw">and</span> srclst[idx <span class="op">+</span> <span class="dv">1</span>].strip().startswith(<span class="st">&#39;&quot;&quot;&quot;&#39;</span>) <span class="kw">and</span> <span class="st">&#39;&quot;&quot;&quot;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> l.strip():</span>
<span id="cb207-25"><a href="#cb207-25" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb207-26"><a href="#cb207-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb207-27"><a href="#cb207-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&quot;{&quot;</span> <span class="kw">in</span> l <span class="kw">and</span> <span class="st">&quot;}&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l:</span>
<span id="cb207-28"><a href="#cb207-28" aria-hidden="true" tabindex="-1"></a>            bracketidx.append(idx)</span>
<span id="cb207-29"><a href="#cb207-29" aria-hidden="true" tabindex="-1"></a>            bracketindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb207-30"><a href="#cb207-30" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb207-31"><a href="#cb207-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&quot;}&quot;</span> <span class="kw">in</span> l <span class="kw">and</span> <span class="st">&quot;{&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l: </span>
<span id="cb207-32"><a href="#cb207-32" aria-hidden="true" tabindex="-1"></a>            bracketidx.append(idx)</span>
<span id="cb207-33"><a href="#cb207-33" aria-hidden="true" tabindex="-1"></a>            addup <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb207-34"><a href="#cb207-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> bracketidx:</span>
<span id="cb207-35"><a href="#cb207-35" aria-hidden="true" tabindex="-1"></a>                line <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb207-36"><a href="#cb207-36" aria-hidden="true" tabindex="-1"></a>                addup <span class="op">=</span> addup <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>bracketindent <span class="op">+</span> line <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb207-37"><a href="#cb207-37" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> addup</span>
<span id="cb207-38"><a href="#cb207-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb207-39"><a href="#cb207-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> (l.strip().startswith(<span class="st">&quot;if&quot;</span>) <span class="kw">or</span> l.strip().startswith(<span class="st">&quot;elif&quot;</span>)) <span class="kw">and</span> <span class="st">&quot;:&quot;</span> <span class="kw">in</span> l <span class="kw">and</span> <span class="kw">not</span> l.strip().endswith(<span class="st">&quot;:&quot;</span>) <span class="kw">and</span> <span class="st">&quot;: #&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l <span class="op">\</span></span>
<span id="cb207-40"><a href="#cb207-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> (<span class="st">&quot;elif&quot;</span> <span class="kw">in</span> srclst[idx <span class="op">+</span> <span class="dv">1</span>] <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> srclst[idx <span class="op">+</span> <span class="dv">1</span>]):</span>
<span id="cb207-41"><a href="#cb207-41" aria-hidden="true" tabindex="-1"></a>            ifelseidx.append(idx)</span>
<span id="cb207-42"><a href="#cb207-42" aria-hidden="true" tabindex="-1"></a>            ifelseindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb207-43"><a href="#cb207-43" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb207-44"><a href="#cb207-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> l.strip().startswith(<span class="st">&quot;else&quot;</span>) <span class="kw">and</span> <span class="st">&quot;:&quot;</span> <span class="kw">in</span> l <span class="kw">and</span> <span class="kw">not</span> l.strip().endswith(<span class="st">&quot;:&quot;</span>) <span class="kw">and</span> <span class="st">&quot;: #&quot;</span> <span class="kw">not</span> <span class="kw">in</span> l:</span>
<span id="cb207-45"><a href="#cb207-45" aria-hidden="true" tabindex="-1"></a>            ifelseidx.append(idx)</span>
<span id="cb207-46"><a href="#cb207-46" aria-hidden="true" tabindex="-1"></a>            addup <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb207-47"><a href="#cb207-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> ifelseidx:</span>
<span id="cb207-48"><a href="#cb207-48" aria-hidden="true" tabindex="-1"></a>                line <span class="op">=</span> <span class="ss">f&quot;srcidx.append(</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb207-49"><a href="#cb207-49" aria-hidden="true" tabindex="-1"></a>                addup <span class="op">=</span> addup <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>ifelseindent <span class="op">+</span> line <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb207-50"><a href="#cb207-50" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> addup            </span>
<span id="cb207-51"><a href="#cb207-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb207-52"><a href="#cb207-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb207-53"><a href="#cb207-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="kw">not</span> l.strip().startswith(<span class="st">&#39;#&#39;</span>) <span class="op">\</span></span>
<span id="cb207-54"><a href="#cb207-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().startswith(<span class="st">&#39;&quot;&#39;</span>) <span class="kw">and</span> l.strip().endswith(<span class="st">&#39;&quot;&#39;</span>)) <span class="op">\</span></span>
<span id="cb207-55"><a href="#cb207-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> <span class="kw">not</span> (l.strip().endswith(<span class="st">&#39;,&#39;</span>) <span class="kw">or</span> <span class="st">&#39;, #&#39;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&#39;): #&#39;</span> <span class="kw">in</span> l): </span>
<span id="cb207-56"><a href="#cb207-56" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> addline <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>  <span class="co"># add srcidx.append(idx) to each line</span></span>
<span id="cb207-57"><a href="#cb207-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: </span>
<span id="cb207-58"><a href="#cb207-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>            </span>
<span id="cb207-59"><a href="#cb207-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-60"><a href="#cb207-60" aria-hidden="true" tabindex="-1"></a>    pprint(dbsrc, width<span class="op">=</span><span class="dv">157</span>)</span>
<span id="cb207-61"><a href="#cb207-61" aria-hidden="true" tabindex="-1"></a>    srcidx <span class="op">=</span> [] </span>
<span id="cb207-62"><a href="#cb207-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(env), <span class="bu">locals</span>())    </span>
<span id="cb207-63"><a href="#cb207-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(example) <span class="co"># now we can use foo as the new foo </span></span>
<span id="cb207-64"><a href="#cb207-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(srcidx)</span>
<span id="cb207-65"><a href="#cb207-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-66"><a href="#cb207-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pprint(srclines)</span></span>
<span id="cb207-67"><a href="#cb207-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(srclst)), srclst):</span>
<span id="cb207-68"><a href="#cb207-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">in</span> srcidx <span class="kw">or</span> <span class="st">&quot;for&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;if&quot;</span> <span class="kw">in</span> l <span class="kw">or</span> <span class="st">&quot;else&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb207-69"><a href="#cb207-69" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(l)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb208"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.meta <span class="im">import</span> <span class="op">*</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.imports <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="bu">globals</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb210"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>printrunsrclines(delegates, <span class="st">&#39;&#39;</span>, env<span class="op">=</span>g) <span class="co"># make sure to use \\n not \n</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(&#39;def delegates(to:FunctionType=None, # Delegatee\n&#39;
 &#39;              keep=False, # Keep `kwargs` in decorated function?\n&#39;
 &#39;              but:list=None): # Exclude these parameters from signature\n&#39;
 &#39;    &quot;Decorator: replace `**kwargs` in signature with params from `to`&quot;\n&#39;
 &#39;    if but is None: but = []\n&#39;
 &#39;    srcidx.append(4)\n&#39;
 &#39;    def _f(f):\n&#39;
 &#39;        srcidx.append(5)\n&#39;
 &#39;        if to is None: to_f,from_f = f.__base__.__init__,f.__init__\n&#39;
 &#39;        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;        srcidx.append(7)\n&#39;
 &quot;        from_f = getattr(from_f,&#39;__func__&#39;,from_f)\n&quot;
 &#39;        srcidx.append(8)\n&#39;
 &quot;        to_f = getattr(to_f,&#39;__func__&#39;,to_f)\n&quot;
 &#39;        srcidx.append(9)\n&#39;
 &quot;        if hasattr(from_f,&#39;__delwrap__&#39;): return f\n&quot;
 &#39;        srcidx.append(10)\n&#39;
 &#39;        sig = inspect.signature(from_f)\n&#39;
 &#39;        srcidx.append(11)\n&#39;
 &#39;        sigd = dict(sig.parameters)\n&#39;
 &#39;        srcidx.append(12)\n&#39;
 &quot;        k = sigd.pop(&#39;kwargs&#39;)\n&quot;
 &#39;        srcidx.append(13)\n&#39;
 &#39;        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()\n&#39;
 &#39;              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}\n&#39;
 &#39;        srcidx.append(14)\n&#39;
 &#39;        srcidx.append(15)\n&#39;
 &#39;        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}\n&#39;
 &#39;        srcidx.append(16)\n&#39;
 &#39;        sigd.update(s2)\n&#39;
 &#39;        srcidx.append(17)\n&#39;
 &quot;        if keep: sigd[&#39;kwargs&#39;] = k\n&quot;
 &#39;        else: from_f.__delwrap__ = to_f\n&#39;
 &#39;        srcidx.append(6)\n&#39;
 &#39;        srcidx.append(7)\n&#39;
 &#39;        srcidx.append(18)\n&#39;
 &#39;        srcidx.append(19)\n&#39;
 &#39;        from_f.__signature__ = sig.replace(parameters=sigd.values())\n&#39;
 &#39;        srcidx.append(20)\n&#39;
 &quot;        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)\n&quot;
 &#39;        srcidx.append(21)\n&#39;
 &#39;        return f\n&#39;
 &#39;        srcidx.append(22)\n&#39;
 &#39;    return _f\n&#39;
 &#39;    srcidx.append(23)\n&#39;
 &#39;\n&#39;)
[]
    if but is None: but = []
        if to is None: to_f,from_f = f.__base__.__init__,f.__init__
        else:          to_f,from_f = to.__init__ if isinstance(to,type) else to,f
        if hasattr(from_f,&#39;__delwrap__&#39;): return f
        s2 = {k:v.replace(kind=inspect.Parameter.KEYWORD_ONLY) for k,v in inspect.signature(to_f).parameters.items()
              if v.default != inspect.Parameter.empty and k not in sigd and k not in but}
        anno = {k:v for k,v in getattr(to_f, &quot;__annotations__&quot;, {}).items() if k not in sigd and k not in but}
        if keep: sigd[&#39;kwargs&#39;] = k
        else: from_f.__delwrap__ = to_f
        if hasattr(from_f, &#39;__annotations__&#39;): from_f.__annotations__.update(anno)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb212"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printsrcwithidx(delegates)</span></span></code></pre></div>
</div>
</section>
<section id="more-difficult-examples-to-test-printrunsrc" class="level3">
<h3>more difficult examples to test printrunsrc()</h3>
</section>
</section>
<section id="make-fastdebug-a-class" class="level2">
<h2>Make fastdebug a class</h2>
<div class="cell">
<div class="sourceCode" id="cb213"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb213-31"><a href="#cb213-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb213-32"><a href="#cb213-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb213-33"><a href="#cb213-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb213-34"><a href="#cb213-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb213-35"><a href="#cb213-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-36"><a href="#cb213-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb213-37"><a href="#cb213-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb213-38"><a href="#cb213-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-39"><a href="#cb213-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb213-40"><a href="#cb213-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb213-41"><a href="#cb213-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb213-42"><a href="#cb213-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb213-43"><a href="#cb213-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes) <span class="kw">and</span> <span class="st">&quot;env=&quot;</span> <span class="kw">in</span> c:</span>
<span id="cb213-44"><a href="#cb213-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> c <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb213-45"><a href="#cb213-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb213-46"><a href="#cb213-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb213-47"><a href="#cb213-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb213-48"><a href="#cb213-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-49"><a href="#cb213-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb213-50"><a href="#cb213-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb213-51"><a href="#cb213-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb213-52"><a href="#cb213-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb213-53"><a href="#cb213-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb213-54"><a href="#cb213-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb213-55"><a href="#cb213-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb213-56"><a href="#cb213-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-57"><a href="#cb213-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb213-58"><a href="#cb213-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb213-59"><a href="#cb213-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-60"><a href="#cb213-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb213-61"><a href="#cb213-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb213-62"><a href="#cb213-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-63"><a href="#cb213-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb213-64"><a href="#cb213-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-65"><a href="#cb213-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb213-66"><a href="#cb213-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-67"><a href="#cb213-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb213-68"><a href="#cb213-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb213-69"><a href="#cb213-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb213-70"><a href="#cb213-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb213-71"><a href="#cb213-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb213-72"><a href="#cb213-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb213-73"><a href="#cb213-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb213-74"><a href="#cb213-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb213-75"><a href="#cb213-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb213-76"><a href="#cb213-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb213-77"><a href="#cb213-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-78"><a href="#cb213-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb213-79"><a href="#cb213-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb213-80"><a href="#cb213-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb213-81"><a href="#cb213-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb213-82"><a href="#cb213-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb213-83"><a href="#cb213-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb213-84"><a href="#cb213-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb213-85"><a href="#cb213-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-86"><a href="#cb213-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb213-87"><a href="#cb213-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb213-88"><a href="#cb213-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb213-89"><a href="#cb213-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-90"><a href="#cb213-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb213-91"><a href="#cb213-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb213-92"><a href="#cb213-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb214"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb214-24"><a href="#cb214-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb214-25"><a href="#cb214-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb214-26"><a href="#cb214-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-27"><a href="#cb214-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb214-28"><a href="#cb214-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb214-29"><a href="#cb214-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-30"><a href="#cb214-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb214-31"><a href="#cb214-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb214-32"><a href="#cb214-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb214-33"><a href="#cb214-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb214-34"><a href="#cb214-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb214-35"><a href="#cb214-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-36"><a href="#cb214-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb214-37"><a href="#cb214-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb214-38"><a href="#cb214-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-39"><a href="#cb214-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb214-40"><a href="#cb214-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb214-41"><a href="#cb214-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb214-42"><a href="#cb214-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb214-43"><a href="#cb214-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb214-44"><a href="#cb214-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb214-45"><a href="#cb214-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb214-46"><a href="#cb214-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb214-47"><a href="#cb214-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb214-48"><a href="#cb214-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-49"><a href="#cb214-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb214-50"><a href="#cb214-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb214-51"><a href="#cb214-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb214-52"><a href="#cb214-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb214-53"><a href="#cb214-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb214-54"><a href="#cb214-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb214-55"><a href="#cb214-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb214-56"><a href="#cb214-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-57"><a href="#cb214-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb214-58"><a href="#cb214-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb214-59"><a href="#cb214-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-60"><a href="#cb214-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb214-61"><a href="#cb214-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb214-62"><a href="#cb214-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-63"><a href="#cb214-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb214-64"><a href="#cb214-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-65"><a href="#cb214-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb214-66"><a href="#cb214-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-67"><a href="#cb214-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb214-68"><a href="#cb214-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb214-69"><a href="#cb214-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb214-70"><a href="#cb214-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb214-71"><a href="#cb214-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb214-72"><a href="#cb214-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb214-73"><a href="#cb214-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb214-74"><a href="#cb214-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb214-75"><a href="#cb214-75" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb214-76"><a href="#cb214-76" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb214-77"><a href="#cb214-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-78"><a href="#cb214-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb214-79"><a href="#cb214-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb214-80"><a href="#cb214-80" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb214-81"><a href="#cb214-81" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb214-82"><a href="#cb214-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb214-83"><a href="#cb214-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb214-84"><a href="#cb214-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb214-85"><a href="#cb214-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-86"><a href="#cb214-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb214-87"><a href="#cb214-87" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb214-88"><a href="#cb214-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb214-89"><a href="#cb214-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-90"><a href="#cb214-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb214-91"><a href="#cb214-91" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb214-92"><a href="#cb214-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
<section id="improve-on-the-line-idx-readability" class="level3">
<h3>improve on the line idx readability</h3>
<div class="cell">
<div class="sourceCode" id="cb215"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-30"><a href="#cb215-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb215-31"><a href="#cb215-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb215-32"><a href="#cb215-32" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb215-33"><a href="#cb215-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb215-34"><a href="#cb215-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb215-35"><a href="#cb215-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-36"><a href="#cb215-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb215-37"><a href="#cb215-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb215-38"><a href="#cb215-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-39"><a href="#cb215-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb215-40"><a href="#cb215-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb215-41"><a href="#cb215-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb215-42"><a href="#cb215-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb215-43"><a href="#cb215-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb215-44"><a href="#cb215-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb215-45"><a href="#cb215-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb215-46"><a href="#cb215-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb215-47"><a href="#cb215-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb215-48"><a href="#cb215-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-49"><a href="#cb215-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb215-50"><a href="#cb215-50" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb215-51"><a href="#cb215-51" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb215-52"><a href="#cb215-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb215-53"><a href="#cb215-53" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb215-54"><a href="#cb215-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb215-55"><a href="#cb215-55" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb215-56"><a href="#cb215-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-57"><a href="#cb215-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb215-58"><a href="#cb215-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb215-59"><a href="#cb215-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-60"><a href="#cb215-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb215-61"><a href="#cb215-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb215-62"><a href="#cb215-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-63"><a href="#cb215-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb215-64"><a href="#cb215-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-65"><a href="#cb215-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb215-66"><a href="#cb215-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-67"><a href="#cb215-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb215-68"><a href="#cb215-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb215-69"><a href="#cb215-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb215-70"><a href="#cb215-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb215-71"><a href="#cb215-71" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb215-72"><a href="#cb215-72" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb215-73"><a href="#cb215-73" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb215-74"><a href="#cb215-74" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb215-75"><a href="#cb215-75" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb215-76"><a href="#cb215-76" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb215-77"><a href="#cb215-77" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb215-78"><a href="#cb215-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-79"><a href="#cb215-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb215-80"><a href="#cb215-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb215-81"><a href="#cb215-81" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb215-82"><a href="#cb215-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb215-83"><a href="#cb215-83" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb215-84"><a href="#cb215-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb215-85"><a href="#cb215-85" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb215-86"><a href="#cb215-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb215-87"><a href="#cb215-87" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))</span>
<span id="cb215-88"><a href="#cb215-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb215-89"><a href="#cb215-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb215-90"><a href="#cb215-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb215-91"><a href="#cb215-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-92"><a href="#cb215-92" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb215-93"><a href="#cb215-93" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb215-94"><a href="#cb215-94" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb215-95"><a href="#cb215-95" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb215-96"><a href="#cb215-96" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb215-97"><a href="#cb215-97" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb215-98"><a href="#cb215-98" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb215-99"><a href="#cb215-99" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))</span>
<span id="cb215-100"><a href="#cb215-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-101"><a href="#cb215-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb215-102"><a href="#cb215-102" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb215-103"><a href="#cb215-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="collect-cmt-from-dbprint-and-print" class="level3">
<h3>collect cmt from dbprint and print</h3>
<div class="cell">
<div class="sourceCode" id="cb216"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>): <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines:</span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-41"><a href="#cb216-41" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb216-42"><a href="#cb216-42" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb216-43"><a href="#cb216-43" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb216-44"><a href="#cb216-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb216-45"><a href="#cb216-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb216-46"><a href="#cb216-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb216-47"><a href="#cb216-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb216-48"><a href="#cb216-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb216-49"><a href="#cb216-49" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb216-50"><a href="#cb216-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-51"><a href="#cb216-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> onedbprint <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb216-52"><a href="#cb216-52" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb216-53"><a href="#cb216-53" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb216-54"><a href="#cb216-54" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb216-55"><a href="#cb216-55" aria-hidden="true" tabindex="-1"></a>                    onedbprint <span class="op">=</span> <span class="va">True</span></span>
<span id="cb216-56"><a href="#cb216-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb216-57"><a href="#cb216-57" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb216-58"><a href="#cb216-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-59"><a href="#cb216-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb216-60"><a href="#cb216-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb216-61"><a href="#cb216-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-62"><a href="#cb216-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb216-63"><a href="#cb216-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb216-64"><a href="#cb216-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-65"><a href="#cb216-65" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb216-66"><a href="#cb216-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb216-67"><a href="#cb216-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-68"><a href="#cb216-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb216-69"><a href="#cb216-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-70"><a href="#cb216-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb216-71"><a href="#cb216-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb216-72"><a href="#cb216-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb216-73"><a href="#cb216-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb216-74"><a href="#cb216-74" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb216-75"><a href="#cb216-75" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb216-76"><a href="#cb216-76" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb216-77"><a href="#cb216-77" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb216-78"><a href="#cb216-78" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb216-79"><a href="#cb216-79" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb216-80"><a href="#cb216-80" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb216-81"><a href="#cb216-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb216-82"><a href="#cb216-82" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb216-83"><a href="#cb216-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb216-84"><a href="#cb216-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb216-85"><a href="#cb216-85" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb216-86"><a href="#cb216-86" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb216-87"><a href="#cb216-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb216-88"><a href="#cb216-88" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-89"><a href="#cb216-89" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb216-90"><a href="#cb216-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb216-91"><a href="#cb216-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb216-92"><a href="#cb216-92" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb216-93"><a href="#cb216-93" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb216-94"><a href="#cb216-94" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-95"><a href="#cb216-95" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb216-96"><a href="#cb216-96" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-97"><a href="#cb216-97" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb216-98"><a href="#cb216-98" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-99"><a href="#cb216-99" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb216-100"><a href="#cb216-100" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb216-101"><a href="#cb216-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-102"><a href="#cb216-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-103"><a href="#cb216-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb216-104"><a href="#cb216-104" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb216-105"><a href="#cb216-105" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb216-106"><a href="#cb216-106" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb216-107"><a href="#cb216-107" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb216-108"><a href="#cb216-108" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb216-109"><a href="#cb216-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-110"><a href="#cb216-110" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb216-111"><a href="#cb216-111" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb216-112"><a href="#cb216-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb216-113"><a href="#cb216-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb216-114"><a href="#cb216-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb216-115"><a href="#cb216-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-116"><a href="#cb216-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb216-117"><a href="#cb216-117" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb216-118"><a href="#cb216-118" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb216-119"><a href="#cb216-119" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-120"><a href="#cb216-120" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb216-121"><a href="#cb216-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb216-122"><a href="#cb216-122" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb216-123"><a href="#cb216-123" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb216-124"><a href="#cb216-124" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-125"><a href="#cb216-125" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb216-126"><a href="#cb216-126" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-127"><a href="#cb216-127" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb216-128"><a href="#cb216-128" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb216-129"><a href="#cb216-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-130"><a href="#cb216-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-131"><a href="#cb216-131" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb216-132"><a href="#cb216-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-133"><a href="#cb216-133" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb216-134"><a href="#cb216-134" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb216-135"><a href="#cb216-135" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb216-136"><a href="#cb216-136" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb216-137"><a href="#cb216-137" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb216-138"><a href="#cb216-138" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb216-139"><a href="#cb216-139" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb216-140"><a href="#cb216-140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb216-141"><a href="#cb216-141" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb216-142"><a href="#cb216-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-143"><a href="#cb216-143" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb216-144"><a href="#cb216-144" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb216-145"><a href="#cb216-145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="make-sure-only-the-line-with-correct-idx-is-debugged" class="level3">
<h3>make sure only the line with correct idx is debugged</h3>
<div class="cell">
<div class="sourceCode" id="cb217"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-24"><a href="#cb217-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb217-25"><a href="#cb217-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-26"><a href="#cb217-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb217-27"><a href="#cb217-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb217-28"><a href="#cb217-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb217-29"><a href="#cb217-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-30"><a href="#cb217-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb217-31"><a href="#cb217-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb217-32"><a href="#cb217-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-33"><a href="#cb217-33" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb217-34"><a href="#cb217-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb217-35"><a href="#cb217-35" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb217-36"><a href="#cb217-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb217-37"><a href="#cb217-37" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb217-38"><a href="#cb217-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-39"><a href="#cb217-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb217-40"><a href="#cb217-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make sure the line with correct idx is debugged</span></span>
<span id="cb217-41"><a href="#cb217-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb217-42"><a href="#cb217-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-43"><a href="#cb217-43" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb217-44"><a href="#cb217-44" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb217-45"><a href="#cb217-45" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb217-46"><a href="#cb217-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb217-47"><a href="#cb217-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb217-48"><a href="#cb217-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb217-49"><a href="#cb217-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb217-50"><a href="#cb217-50" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb217-51"><a href="#cb217-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb217-52"><a href="#cb217-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-53"><a href="#cb217-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if onedbprint == False:</span></span>
<span id="cb217-54"><a href="#cb217-54" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + &quot; &quot;*numindent + &quot;g = locals()&quot; + &#39;\n&#39;</span></span>
<span id="cb217-55"><a href="#cb217-55" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + &quot; &quot;*numindent + dbcodes + &#39;\n&#39;</span></span>
<span id="cb217-56"><a href="#cb217-56" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb217-57"><a href="#cb217-57" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     onedbprint = True</span></span>
<span id="cb217-58"><a href="#cb217-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else:</span></span>
<span id="cb217-59"><a href="#cb217-59" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dbsrc = dbsrc + l + &#39;\n&#39;</span></span>
<span id="cb217-60"><a href="#cb217-60" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb217-61"><a href="#cb217-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb217-62"><a href="#cb217-62" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb217-63"><a href="#cb217-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb217-64"><a href="#cb217-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-65"><a href="#cb217-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb217-66"><a href="#cb217-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb217-67"><a href="#cb217-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-68"><a href="#cb217-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb217-69"><a href="#cb217-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb217-70"><a href="#cb217-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb217-71"><a href="#cb217-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb217-72"><a href="#cb217-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb217-73"><a href="#cb217-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb217-74"><a href="#cb217-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb217-75"><a href="#cb217-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb217-76"><a href="#cb217-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-77"><a href="#cb217-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb217-78"><a href="#cb217-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-79"><a href="#cb217-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb217-80"><a href="#cb217-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb217-81"><a href="#cb217-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb217-82"><a href="#cb217-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb217-83"><a href="#cb217-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb217-84"><a href="#cb217-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb217-85"><a href="#cb217-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb217-86"><a href="#cb217-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb217-87"><a href="#cb217-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb217-88"><a href="#cb217-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb217-89"><a href="#cb217-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb217-90"><a href="#cb217-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb217-91"><a href="#cb217-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb217-92"><a href="#cb217-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb217-93"><a href="#cb217-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb217-94"><a href="#cb217-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb217-95"><a href="#cb217-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb217-96"><a href="#cb217-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb217-97"><a href="#cb217-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-98"><a href="#cb217-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb217-99"><a href="#cb217-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb217-100"><a href="#cb217-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb217-101"><a href="#cb217-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb217-102"><a href="#cb217-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb217-103"><a href="#cb217-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-104"><a href="#cb217-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb217-105"><a href="#cb217-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-106"><a href="#cb217-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb217-107"><a href="#cb217-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-108"><a href="#cb217-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb217-109"><a href="#cb217-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb217-110"><a href="#cb217-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-111"><a href="#cb217-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-112"><a href="#cb217-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb217-113"><a href="#cb217-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb217-114"><a href="#cb217-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb217-115"><a href="#cb217-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb217-116"><a href="#cb217-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb217-117"><a href="#cb217-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb217-118"><a href="#cb217-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-119"><a href="#cb217-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb217-120"><a href="#cb217-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb217-121"><a href="#cb217-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb217-122"><a href="#cb217-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb217-123"><a href="#cb217-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb217-124"><a href="#cb217-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-125"><a href="#cb217-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb217-126"><a href="#cb217-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb217-127"><a href="#cb217-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb217-128"><a href="#cb217-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-129"><a href="#cb217-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb217-130"><a href="#cb217-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb217-131"><a href="#cb217-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb217-132"><a href="#cb217-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb217-133"><a href="#cb217-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-134"><a href="#cb217-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb217-135"><a href="#cb217-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-136"><a href="#cb217-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb217-137"><a href="#cb217-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb217-138"><a href="#cb217-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-139"><a href="#cb217-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-140"><a href="#cb217-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb217-141"><a href="#cb217-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-142"><a href="#cb217-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb217-143"><a href="#cb217-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb217-144"><a href="#cb217-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb217-145"><a href="#cb217-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb217-146"><a href="#cb217-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb217-147"><a href="#cb217-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb217-148"><a href="#cb217-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb217-149"><a href="#cb217-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb217-150"><a href="#cb217-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb217-151"><a href="#cb217-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-152"><a href="#cb217-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb217-153"><a href="#cb217-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb217-154"><a href="#cb217-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="having-or-inside-codes-without-causing-error" class="level3">
<h3>having “” or ” ” inside codes without causing error</h3>
<div class="cell">
<div class="sourceCode" id="cb218"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>([<span class="st">&quot;   &quot;</span>][<span class="dv">0</span>].strip())</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span>(<span class="st">&quot;   &quot;</span>.strip())</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb222"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="st">&quot;...&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;  &quot;</span>, <span class="st">&quot;&quot;</span>]</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>newlst <span class="op">=</span> []</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> lst: </span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>newlst</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[&#39;...&#39;]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb224"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb224-32"><a href="#cb224-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb224-33"><a href="#cb224-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb224-37"><a href="#cb224-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-38"><a href="#cb224-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb224-39"><a href="#cb224-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb224-40"><a href="#cb224-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb224-41"><a href="#cb224-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb224-42"><a href="#cb224-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb224-43"><a href="#cb224-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-44"><a href="#cb224-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb224-45"><a href="#cb224-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-46"><a href="#cb224-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb224-47"><a href="#cb224-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-48"><a href="#cb224-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb224-49"><a href="#cb224-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb224-50"><a href="#cb224-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb224-51"><a href="#cb224-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb224-52"><a href="#cb224-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb224-53"><a href="#cb224-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb224-54"><a href="#cb224-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb224-55"><a href="#cb224-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb224-56"><a href="#cb224-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb224-57"><a href="#cb224-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb224-58"><a href="#cb224-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-59"><a href="#cb224-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb224-60"><a href="#cb224-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb224-61"><a href="#cb224-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-62"><a href="#cb224-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb224-63"><a href="#cb224-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb224-64"><a href="#cb224-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-65"><a href="#cb224-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb224-66"><a href="#cb224-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb224-67"><a href="#cb224-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-68"><a href="#cb224-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb224-69"><a href="#cb224-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb224-70"><a href="#cb224-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb224-71"><a href="#cb224-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb224-72"><a href="#cb224-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb224-73"><a href="#cb224-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb224-74"><a href="#cb224-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb224-75"><a href="#cb224-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb224-76"><a href="#cb224-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-77"><a href="#cb224-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb224-78"><a href="#cb224-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-79"><a href="#cb224-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb224-80"><a href="#cb224-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-81"><a href="#cb224-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-82"><a href="#cb224-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printsrcwithidx(<span class="va">self</span>, </span>
<span id="cb224-83"><a href="#cb224-83" aria-hidden="true" tabindex="-1"></a>                        maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb224-84"><a href="#cb224-84" aria-hidden="true" tabindex="-1"></a>                        part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb224-85"><a href="#cb224-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb224-86"><a href="#cb224-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb224-87"><a href="#cb224-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb224-88"><a href="#cb224-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb224-89"><a href="#cb224-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb224-90"><a href="#cb224-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb224-91"><a href="#cb224-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb224-92"><a href="#cb224-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb224-93"><a href="#cb224-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb224-94"><a href="#cb224-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb224-95"><a href="#cb224-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb224-96"><a href="#cb224-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb224-97"><a href="#cb224-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-98"><a href="#cb224-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb224-99"><a href="#cb224-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb224-100"><a href="#cb224-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb224-101"><a href="#cb224-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb224-102"><a href="#cb224-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb224-103"><a href="#cb224-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-104"><a href="#cb224-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb224-105"><a href="#cb224-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-106"><a href="#cb224-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb224-107"><a href="#cb224-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-108"><a href="#cb224-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb224-109"><a href="#cb224-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb224-110"><a href="#cb224-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-111"><a href="#cb224-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-112"><a href="#cb224-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb224-113"><a href="#cb224-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb224-114"><a href="#cb224-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb224-115"><a href="#cb224-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb224-116"><a href="#cb224-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb224-117"><a href="#cb224-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb224-118"><a href="#cb224-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-119"><a href="#cb224-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb224-120"><a href="#cb224-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb224-121"><a href="#cb224-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb224-122"><a href="#cb224-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb224-123"><a href="#cb224-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb224-124"><a href="#cb224-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-125"><a href="#cb224-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb224-126"><a href="#cb224-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb224-127"><a href="#cb224-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb224-128"><a href="#cb224-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-129"><a href="#cb224-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb224-130"><a href="#cb224-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb224-131"><a href="#cb224-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb224-132"><a href="#cb224-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb224-133"><a href="#cb224-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-134"><a href="#cb224-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb224-135"><a href="#cb224-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-136"><a href="#cb224-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb224-137"><a href="#cb224-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb224-138"><a href="#cb224-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-139"><a href="#cb224-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-140"><a href="#cb224-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb224-141"><a href="#cb224-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-142"><a href="#cb224-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb224-143"><a href="#cb224-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb224-144"><a href="#cb224-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb224-145"><a href="#cb224-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb224-146"><a href="#cb224-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb224-147"><a href="#cb224-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb224-148"><a href="#cb224-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb224-149"><a href="#cb224-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb224-150"><a href="#cb224-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb224-151"><a href="#cb224-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-152"><a href="#cb224-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb224-153"><a href="#cb224-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb224-154"><a href="#cb224-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="replace-fastdb.printsrcwithdix-with-fastdb.print" class="level3">
<h3>replace Fastdb.printsrcwithdix with Fastdb.print</h3>
<div class="cell">
<div class="sourceCode" id="cb225"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-26"><a href="#cb225-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb225-27"><a href="#cb225-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb225-28"><a href="#cb225-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb225-29"><a href="#cb225-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-30"><a href="#cb225-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb225-31"><a href="#cb225-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb225-32"><a href="#cb225-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb225-33"><a href="#cb225-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb225-34"><a href="#cb225-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb225-35"><a href="#cb225-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb225-36"><a href="#cb225-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb225-37"><a href="#cb225-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-38"><a href="#cb225-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb225-39"><a href="#cb225-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb225-40"><a href="#cb225-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb225-41"><a href="#cb225-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb225-42"><a href="#cb225-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb225-43"><a href="#cb225-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-44"><a href="#cb225-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb225-45"><a href="#cb225-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-46"><a href="#cb225-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb225-47"><a href="#cb225-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-48"><a href="#cb225-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb225-49"><a href="#cb225-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb225-50"><a href="#cb225-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb225-51"><a href="#cb225-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb225-52"><a href="#cb225-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb225-53"><a href="#cb225-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb225-54"><a href="#cb225-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb225-55"><a href="#cb225-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb225-56"><a href="#cb225-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb225-57"><a href="#cb225-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb225-58"><a href="#cb225-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-59"><a href="#cb225-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb225-60"><a href="#cb225-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb225-61"><a href="#cb225-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb225-62"><a href="#cb225-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb225-63"><a href="#cb225-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb225-64"><a href="#cb225-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-65"><a href="#cb225-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb225-66"><a href="#cb225-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb225-67"><a href="#cb225-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-68"><a href="#cb225-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb225-69"><a href="#cb225-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb225-70"><a href="#cb225-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb225-71"><a href="#cb225-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb225-72"><a href="#cb225-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb225-73"><a href="#cb225-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l)</span>
<span id="cb225-74"><a href="#cb225-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb225-75"><a href="#cb225-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb225-76"><a href="#cb225-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-77"><a href="#cb225-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb225-78"><a href="#cb225-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-79"><a href="#cb225-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb225-80"><a href="#cb225-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb225-81"><a href="#cb225-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb225-82"><a href="#cb225-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb225-83"><a href="#cb225-83" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb225-84"><a href="#cb225-84" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb225-85"><a href="#cb225-85" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb225-86"><a href="#cb225-86" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb225-87"><a href="#cb225-87" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb225-88"><a href="#cb225-88" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb225-89"><a href="#cb225-89" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb225-90"><a href="#cb225-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb225-91"><a href="#cb225-91" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb225-92"><a href="#cb225-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb225-93"><a href="#cb225-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb225-94"><a href="#cb225-94" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb225-95"><a href="#cb225-95" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb225-96"><a href="#cb225-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb225-97"><a href="#cb225-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-98"><a href="#cb225-98" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb225-99"><a href="#cb225-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb225-100"><a href="#cb225-100" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb225-101"><a href="#cb225-101" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb225-102"><a href="#cb225-102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb225-103"><a href="#cb225-103" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-104"><a href="#cb225-104" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb225-105"><a href="#cb225-105" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-106"><a href="#cb225-106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb225-107"><a href="#cb225-107" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-108"><a href="#cb225-108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb225-109"><a href="#cb225-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb225-110"><a href="#cb225-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-111"><a href="#cb225-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-112"><a href="#cb225-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb225-113"><a href="#cb225-113" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb225-114"><a href="#cb225-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb225-115"><a href="#cb225-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb225-116"><a href="#cb225-116" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb225-117"><a href="#cb225-117" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb225-118"><a href="#cb225-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-119"><a href="#cb225-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb225-120"><a href="#cb225-120" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb225-121"><a href="#cb225-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb225-122"><a href="#cb225-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb225-123"><a href="#cb225-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb225-124"><a href="#cb225-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-125"><a href="#cb225-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb225-126"><a href="#cb225-126" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb225-127"><a href="#cb225-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb225-128"><a href="#cb225-128" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-129"><a href="#cb225-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb225-130"><a href="#cb225-130" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb225-131"><a href="#cb225-131" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb225-132"><a href="#cb225-132" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb225-133"><a href="#cb225-133" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-134"><a href="#cb225-134" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb225-135"><a href="#cb225-135" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-136"><a href="#cb225-136" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb225-137"><a href="#cb225-137" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb225-138"><a href="#cb225-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-139"><a href="#cb225-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-140"><a href="#cb225-140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb225-141"><a href="#cb225-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-142"><a href="#cb225-142" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb225-143"><a href="#cb225-143" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb225-144"><a href="#cb225-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb225-145"><a href="#cb225-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb225-146"><a href="#cb225-146" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb225-147"><a href="#cb225-147" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb225-148"><a href="#cb225-148" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb225-149"><a href="#cb225-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb225-150"><a href="#cb225-150" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb225-151"><a href="#cb225-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-152"><a href="#cb225-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb225-153"><a href="#cb225-153" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb225-154"><a href="#cb225-154" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="add-idx-to-dbsrc-when-showdbsrctrue" class="level3">
<h3>add idx to dbsrc when showdbsrc=True</h3>
<div class="cell">
<div class="sourceCode" id="cb226"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>                dbcode, <span class="co"># the srclines under investigation, can be either string or int</span></span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of dbcodes</span></span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc<span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc or not</span></span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Insert dbcodes under srclines under investigation, and create a new dbsrc function to replace the official one&quot;</span></span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb226-25"><a href="#cb226-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-26"><a href="#cb226-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb226-27"><a href="#cb226-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb226-28"><a href="#cb226-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb226-29"><a href="#cb226-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-30"><a href="#cb226-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb226-31"><a href="#cb226-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb226-32"><a href="#cb226-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb226-33"><a href="#cb226-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb226-34"><a href="#cb226-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb226-35"><a href="#cb226-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb226-36"><a href="#cb226-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb226-37"><a href="#cb226-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-38"><a href="#cb226-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb226-39"><a href="#cb226-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb226-40"><a href="#cb226-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb226-41"><a href="#cb226-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb226-42"><a href="#cb226-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb226-43"><a href="#cb226-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-44"><a href="#cb226-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb226-45"><a href="#cb226-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-46"><a href="#cb226-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb226-47"><a href="#cb226-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-48"><a href="#cb226-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb226-49"><a href="#cb226-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb226-50"><a href="#cb226-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb226-51"><a href="#cb226-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb226-52"><a href="#cb226-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb226-53"><a href="#cb226-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb226-54"><a href="#cb226-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb226-55"><a href="#cb226-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb226-56"><a href="#cb226-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb226-57"><a href="#cb226-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb226-58"><a href="#cb226-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-59"><a href="#cb226-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb226-60"><a href="#cb226-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb226-61"><a href="#cb226-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb226-62"><a href="#cb226-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb226-63"><a href="#cb226-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb226-64"><a href="#cb226-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-65"><a href="#cb226-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb226-66"><a href="#cb226-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb226-67"><a href="#cb226-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-68"><a href="#cb226-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb226-69"><a href="#cb226-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb226-70"><a href="#cb226-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb226-71"><a href="#cb226-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb226-72"><a href="#cb226-72" aria-hidden="true" tabindex="-1"></a>            totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb226-73"><a href="#cb226-73" aria-hidden="true" tabindex="-1"></a>            lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb226-74"><a href="#cb226-74" aria-hidden="true" tabindex="-1"></a>            dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb226-75"><a href="#cb226-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb226-76"><a href="#cb226-76" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb226-77"><a href="#cb226-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&quot;dbprintinsert&quot;</span> <span class="kw">in</span> l: </span>
<span id="cb226-78"><a href="#cb226-78" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb226-79"><a href="#cb226-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb226-80"><a href="#cb226-80" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-81"><a href="#cb226-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb226-82"><a href="#cb226-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb226-83"><a href="#cb226-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-84"><a href="#cb226-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv.update(<span class="bu">locals</span>())</span>
<span id="cb226-85"><a href="#cb226-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-86"><a href="#cb226-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb226-87"><a href="#cb226-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb226-88"><a href="#cb226-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb226-89"><a href="#cb226-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb226-90"><a href="#cb226-90" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb226-91"><a href="#cb226-91" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb226-92"><a href="#cb226-92" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb226-93"><a href="#cb226-93" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb226-94"><a href="#cb226-94" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb226-95"><a href="#cb226-95" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb226-96"><a href="#cb226-96" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb226-97"><a href="#cb226-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb226-98"><a href="#cb226-98" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb226-99"><a href="#cb226-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb226-100"><a href="#cb226-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb226-101"><a href="#cb226-101" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb226-102"><a href="#cb226-102" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb226-103"><a href="#cb226-103" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb226-104"><a href="#cb226-104" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-105"><a href="#cb226-105" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb226-106"><a href="#cb226-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb226-107"><a href="#cb226-107" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb226-108"><a href="#cb226-108" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb226-109"><a href="#cb226-109" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb226-110"><a href="#cb226-110" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-111"><a href="#cb226-111" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb226-112"><a href="#cb226-112" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-113"><a href="#cb226-113" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb226-114"><a href="#cb226-114" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-115"><a href="#cb226-115" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb226-116"><a href="#cb226-116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb226-117"><a href="#cb226-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-118"><a href="#cb226-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-119"><a href="#cb226-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb226-120"><a href="#cb226-120" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb226-121"><a href="#cb226-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb226-122"><a href="#cb226-122" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb226-123"><a href="#cb226-123" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb226-124"><a href="#cb226-124" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb226-125"><a href="#cb226-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-126"><a href="#cb226-126" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb226-127"><a href="#cb226-127" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb226-128"><a href="#cb226-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb226-129"><a href="#cb226-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb226-130"><a href="#cb226-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb226-131"><a href="#cb226-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-132"><a href="#cb226-132" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb226-133"><a href="#cb226-133" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb226-134"><a href="#cb226-134" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb226-135"><a href="#cb226-135" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-136"><a href="#cb226-136" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb226-137"><a href="#cb226-137" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb226-138"><a href="#cb226-138" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb226-139"><a href="#cb226-139" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb226-140"><a href="#cb226-140" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-141"><a href="#cb226-141" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb226-142"><a href="#cb226-142" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-143"><a href="#cb226-143" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb226-144"><a href="#cb226-144" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb226-145"><a href="#cb226-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-146"><a href="#cb226-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-147"><a href="#cb226-147" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb226-148"><a href="#cb226-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-149"><a href="#cb226-149" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb226-150"><a href="#cb226-150" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb226-151"><a href="#cb226-151" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb226-152"><a href="#cb226-152" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb226-153"><a href="#cb226-153" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb226-154"><a href="#cb226-154" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb226-155"><a href="#cb226-155" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb226-156"><a href="#cb226-156" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb226-157"><a href="#cb226-157" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb226-158"><a href="#cb226-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-159"><a href="#cb226-159" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb226-160"><a href="#cb226-160" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb226-161"><a href="#cb226-161" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="not-load-the-inner-locals-to-outenv-can-prevent-mysterious-printing-of-previous-db-messages" class="level3">
<h3>not load the inner locals() to outenv can prevent mysterious printing of previous db messages</h3>
<div class="cell">
<div class="sourceCode" id="cb227"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Create a Fastdebug class which has two functionalities: dbprint and print.&quot;</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env = g, as g = globals()</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dbprint(<span class="va">self</span>, </span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a>                <span class="co"># src, # the src func name, e.g., foo</span></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a>                dbcode:<span class="bu">int</span>, <span class="co"># a srcline under investigation, can be either string or int</span></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a>                cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a>                expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb227-18"><a href="#cb227-18" aria-hidden="true" tabindex="-1"></a>                showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb227-19"><a href="#cb227-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb227-20"><a href="#cb227-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-21"><a href="#cb227-21" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb227-22"><a href="#cb227-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb227-23"><a href="#cb227-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-24"><a href="#cb227-24" aria-hidden="true" tabindex="-1"></a>        printsrc(src, dbcode, cmt, expand)</span>
<span id="cb227-25"><a href="#cb227-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-26"><a href="#cb227-26" aria-hidden="true" tabindex="-1"></a>        dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb227-27"><a href="#cb227-27" aria-hidden="true" tabindex="-1"></a>        indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb227-28"><a href="#cb227-28" aria-hidden="true" tabindex="-1"></a>        onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb227-29"><a href="#cb227-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-30"><a href="#cb227-30" aria-hidden="true" tabindex="-1"></a>        lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb227-31"><a href="#cb227-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb227-32"><a href="#cb227-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb227-33"><a href="#cb227-33" aria-hidden="true" tabindex="-1"></a>        newlst <span class="op">=</span> []</span>
<span id="cb227-34"><a href="#cb227-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb227-35"><a href="#cb227-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb227-36"><a href="#cb227-36" aria-hidden="true" tabindex="-1"></a>        codes <span class="op">=</span> newlst</span>
<span id="cb227-37"><a href="#cb227-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-38"><a href="#cb227-38" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb227-39"><a href="#cb227-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb227-40"><a href="#cb227-40" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb227-41"><a href="#cb227-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb227-42"><a href="#cb227-42" aria-hidden="true" tabindex="-1"></a>            srclines <span class="op">=</span> dbcode</span>
<span id="cb227-43"><a href="#cb227-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-44"><a href="#cb227-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb227-45"><a href="#cb227-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-46"><a href="#cb227-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb227-47"><a href="#cb227-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-48"><a href="#cb227-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb227-49"><a href="#cb227-49" aria-hidden="true" tabindex="-1"></a>                    numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb227-50"><a href="#cb227-50" aria-hidden="true" tabindex="-1"></a>                    dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb227-51"><a href="#cb227-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb227-52"><a href="#cb227-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb227-53"><a href="#cb227-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb227-54"><a href="#cb227-54" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb227-55"><a href="#cb227-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb227-56"><a href="#cb227-56" aria-hidden="true" tabindex="-1"></a>                            dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb227-57"><a href="#cb227-57" aria-hidden="true" tabindex="-1"></a>                        count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb227-58"><a href="#cb227-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-59"><a href="#cb227-59" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb227-60"><a href="#cb227-60" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb227-61"><a href="#cb227-61" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb227-62"><a href="#cb227-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb227-63"><a href="#cb227-63" aria-hidden="true" tabindex="-1"></a>                    dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb227-64"><a href="#cb227-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-65"><a href="#cb227-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb227-66"><a href="#cb227-66" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb227-67"><a href="#cb227-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-68"><a href="#cb227-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb227-69"><a href="#cb227-69" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb227-70"><a href="#cb227-70" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb227-71"><a href="#cb227-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb227-72"><a href="#cb227-72" aria-hidden="true" tabindex="-1"></a>            totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb227-73"><a href="#cb227-73" aria-hidden="true" tabindex="-1"></a>            lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb227-74"><a href="#cb227-74" aria-hidden="true" tabindex="-1"></a>            dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb227-75"><a href="#cb227-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb227-76"><a href="#cb227-76" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb227-77"><a href="#cb227-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&quot;dbprintinsert&quot;</span> <span class="kw">in</span> l: </span>
<span id="cb227-78"><a href="#cb227-78" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb227-79"><a href="#cb227-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb227-80"><a href="#cb227-80" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-81"><a href="#cb227-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb227-82"><a href="#cb227-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb227-83"><a href="#cb227-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-84"><a href="#cb227-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.outenv.update(locals())</span></span>
<span id="cb227-85"><a href="#cb227-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.outenv.update({self.orisrc.__name__: locals()[self.orisrc.__name__]})</span></span>
<span id="cb227-86"><a href="#cb227-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-87"><a href="#cb227-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span>
<span id="cb227-88"><a href="#cb227-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb227-89"><a href="#cb227-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb227-90"><a href="#cb227-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>, </span>
<span id="cb227-91"><a href="#cb227-91" aria-hidden="true" tabindex="-1"></a>                maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb227-92"><a href="#cb227-92" aria-hidden="true" tabindex="-1"></a>                part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb227-93"><a href="#cb227-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;Print the source code in whole or parts with idx and comments you added with dbprint along the way.&quot;</span></span>
<span id="cb227-94"><a href="#cb227-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb227-95"><a href="#cb227-95" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb227-96"><a href="#cb227-96" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb227-97"><a href="#cb227-97" aria-hidden="true" tabindex="-1"></a>        lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb227-98"><a href="#cb227-98" aria-hidden="true" tabindex="-1"></a>        lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb227-99"><a href="#cb227-99" aria-hidden="true" tabindex="-1"></a>        numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb227-100"><a href="#cb227-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cmts = {5:&quot;this is me&quot;, 111:&quot;this is me&quot;, 14:&quot;this is you this is you this is you this is you this is you this is you this is you this is you &quot;}</span></span>
<span id="cb227-101"><a href="#cb227-101" aria-hidden="true" tabindex="-1"></a>        cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb227-102"><a href="#cb227-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb227-103"><a href="#cb227-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb227-104"><a href="#cb227-104" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb227-105"><a href="#cb227-105" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb227-106"><a href="#cb227-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb227-107"><a href="#cb227-107" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-108"><a href="#cb227-108" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb227-109"><a href="#cb227-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb227-110"><a href="#cb227-110" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb227-111"><a href="#cb227-111" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb227-112"><a href="#cb227-112" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb227-113"><a href="#cb227-113" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-114"><a href="#cb227-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb227-115"><a href="#cb227-115" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-116"><a href="#cb227-116" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb227-117"><a href="#cb227-117" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-118"><a href="#cb227-118" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb227-119"><a href="#cb227-119" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb227-120"><a href="#cb227-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-121"><a href="#cb227-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-122"><a href="#cb227-122" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb227-123"><a href="#cb227-123" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb227-124"><a href="#cb227-124" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb227-125"><a href="#cb227-125" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb227-126"><a href="#cb227-126" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb227-127"><a href="#cb227-127" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb227-128"><a href="#cb227-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-129"><a href="#cb227-129" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb227-130"><a href="#cb227-130" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb227-131"><a href="#cb227-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb227-132"><a href="#cb227-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb227-133"><a href="#cb227-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb227-134"><a href="#cb227-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-135"><a href="#cb227-135" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb227-136"><a href="#cb227-136" aria-hidden="true" tabindex="-1"></a>                    lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb227-137"><a href="#cb227-137" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb227-138"><a href="#cb227-138" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-139"><a href="#cb227-139" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb227-140"><a href="#cb227-140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb227-141"><a href="#cb227-141" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb227-142"><a href="#cb227-142" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb227-143"><a href="#cb227-143" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-144"><a href="#cb227-144" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb227-145"><a href="#cb227-145" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-146"><a href="#cb227-146" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>: </span>
<span id="cb227-147"><a href="#cb227-147" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb227-148"><a href="#cb227-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-149"><a href="#cb227-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-150"><a href="#cb227-150" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb227-151"><a href="#cb227-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-152"><a href="#cb227-152" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb227-153"><a href="#cb227-153" aria-hidden="true" tabindex="-1"></a>                            cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb227-154"><a href="#cb227-154" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb227-155"><a href="#cb227-155" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb227-156"><a href="#cb227-156" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb227-157"><a href="#cb227-157" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb227-158"><a href="#cb227-158" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb227-159"><a href="#cb227-159" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb227-160"><a href="#cb227-160" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb227-161"><a href="#cb227-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-162"><a href="#cb227-162" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb227-163"><a href="#cb227-163" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb227-164"><a href="#cb227-164" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span></code></pre></div>
</div>
</section>
<section id="using-patch-to-enable-docs-for-instance-methods-like-dbprint-and-print" class="level3">
<h3>using <span class="citation" data-cites="patch">@patch</span> to enable docs for instance methods like <code>dbprint</code> and <code>print</code></h3>
<div class="cell">
<div class="sourceCode" id="cb228"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Create a Fastdebug class which has two functionalities: dbprint and print.&quot;</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code you are exploring</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>                 env): <span class="co"># env variables needed for exploring the source code, e.g., g = globals()</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> env</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span></code></pre></div>
</div>
</section>
<section id="move-param-env-into-__init__" class="level3">
<h3>move param env into <code>__init__</code></h3>
<div class="cell" data-code_folding="[1]">
<div class="sourceCode" id="cb229"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Create a Fastdebug class which has two functionalities: dbprint and print.&quot;</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code you are exploring</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>                 db<span class="op">=</span><span class="va">False</span>): <span class="co"># db=True will run some debugging prints</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> src.__globals__</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> db:</span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="add-example-to-the-obj" class="level3">
<h3>Add example to the obj</h3>
<div class="cell">
<div class="sourceCode" id="cb230"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Fastdb():</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Create a Fastdebug class which has two functionalities: dbprint and print.&quot;</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>                 src, <span class="co"># name of src code you are exploring</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>                 db<span class="op">=</span><span class="va">False</span>): <span class="co"># db=True will run some debugging prints</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.orisrc <span class="op">=</span> src</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.margin <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outenv <span class="op">=</span> src.__globals__</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cmts <span class="op">=</span> {}</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eg <span class="op">=</span> <span class="va">None</span> <span class="co"># add example in string format</span></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.egEnv <span class="op">=</span> <span class="va">None</span> <span class="co"># add example env in dict</span></span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> db:</span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L241" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb" class="level3">
<h3>Fastdb</h3>
<blockquote>
<pre><code> Fastdb (src, db=False)</code></pre>
</blockquote>
<p>Create a Fastdebug class which has two functionalities: dbprint and print.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src</td>
<td></td>
<td></td>
<td>name of src code you are exploring</td>
</tr>
<tr class="even">
<td>db</td>
<td>bool</td>
<td>False</td>
<td>db=True will run some debugging prints</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode" id="cb232"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># a srcline under investigation, can be either string or int</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb232-23"><a href="#cb232-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb232-24"><a href="#cb232-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb232-25"><a href="#cb232-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb232-26"><a href="#cb232-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-27"><a href="#cb232-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb232-28"><a href="#cb232-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb232-29"><a href="#cb232-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb232-30"><a href="#cb232-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb232-31"><a href="#cb232-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb232-32"><a href="#cb232-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-33"><a href="#cb232-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb232-34"><a href="#cb232-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-35"><a href="#cb232-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb232-36"><a href="#cb232-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-37"><a href="#cb232-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb232-38"><a href="#cb232-38" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb232-39"><a href="#cb232-39" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb232-40"><a href="#cb232-40" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb232-41"><a href="#cb232-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb232-42"><a href="#cb232-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb232-43"><a href="#cb232-43" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb232-44"><a href="#cb232-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb232-45"><a href="#cb232-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb232-46"><a href="#cb232-46" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb232-47"><a href="#cb232-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-48"><a href="#cb232-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-49"><a href="#cb232-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-50"><a href="#cb232-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-51"><a href="#cb232-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb232-52"><a href="#cb232-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb232-53"><a href="#cb232-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-54"><a href="#cb232-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb232-55"><a href="#cb232-55" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb232-56"><a href="#cb232-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-57"><a href="#cb232-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb232-58"><a href="#cb232-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb232-59"><a href="#cb232-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-60"><a href="#cb232-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb232-61"><a href="#cb232-61" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb232-62"><a href="#cb232-62" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb232-63"><a href="#cb232-63" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb232-64"><a href="#cb232-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb232-65"><a href="#cb232-65" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb232-66"><a href="#cb232-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;dbprintinsert&quot;</span> <span class="kw">in</span> l:</span>
<span id="cb232-67"><a href="#cb232-67" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb232-68"><a href="#cb232-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb232-69"><a href="#cb232-69" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb232-70"><a href="#cb232-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-71"><a href="#cb232-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb232-72"><a href="#cb232-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-73"><a href="#cb232-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="make-sure-showdbsrctrue-give-us-the-line-starting-with-dbprintinsert" class="level3">
<h3>Make sure <code>showdbsrc=True</code> give us the line starting with ‘dbprintinsert’</h3>
<div class="cell">
<div class="sourceCode" id="cb233"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># a srcline under investigation, can be either string or int</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb233-34"><a href="#cb233-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-35"><a href="#cb233-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb233-36"><a href="#cb233-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-37"><a href="#cb233-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb233-38"><a href="#cb233-38" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb233-39"><a href="#cb233-39" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb233-40"><a href="#cb233-40" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb233-41"><a href="#cb233-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb233-42"><a href="#cb233-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb233-43"><a href="#cb233-43" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb233-44"><a href="#cb233-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb233-45"><a href="#cb233-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb233-46"><a href="#cb233-46" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb233-47"><a href="#cb233-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-48"><a href="#cb233-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-49"><a href="#cb233-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-50"><a href="#cb233-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb233-51"><a href="#cb233-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb233-52"><a href="#cb233-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb233-53"><a href="#cb233-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-54"><a href="#cb233-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb233-55"><a href="#cb233-55" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb233-56"><a href="#cb233-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-57"><a href="#cb233-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb233-58"><a href="#cb233-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb233-59"><a href="#cb233-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-60"><a href="#cb233-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb233-61"><a href="#cb233-61" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb233-62"><a href="#cb233-62" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb233-63"><a href="#cb233-63" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb233-64"><a href="#cb233-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb233-65"><a href="#cb233-65" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb233-66"><a href="#cb233-66" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb233-67"><a href="#cb233-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb233-68"><a href="#cb233-68" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb233-69"><a href="#cb233-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb233-70"><a href="#cb233-70" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb233-71"><a href="#cb233-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb233-72"><a href="#cb233-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb233-73"><a href="#cb233-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-74"><a href="#cb233-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb233-75"><a href="#cb233-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb233-76"><a href="#cb233-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb233-77"><a href="#cb233-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;type(locals()[self.orisrc.__name__]): </span><span class="sc">{</span><span class="bu">type</span>(<span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb233-78"><a href="#cb233-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="make-sure-showdbsrctrue-give-us-info-on-changes-in-g-or-outenv" class="level3">
<h3>Make sure <code>showdbsrc=True</code> give us info on changes in g or outenv</h3>
<div class="cell">
<div class="sourceCode" id="cb234"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> dbcode</span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode: </span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb234-38"><a href="#cb234-38" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb234-39"><a href="#cb234-39" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb234-40"><a href="#cb234-40" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb234-41"><a href="#cb234-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb234-42"><a href="#cb234-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb234-43"><a href="#cb234-43" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb234-44"><a href="#cb234-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb234-45"><a href="#cb234-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb234-46"><a href="#cb234-46" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb234-47"><a href="#cb234-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-48"><a href="#cb234-48" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-49"><a href="#cb234-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-50"><a href="#cb234-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb234-51"><a href="#cb234-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb234-52"><a href="#cb234-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb234-53"><a href="#cb234-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-54"><a href="#cb234-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb234-55"><a href="#cb234-55" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb234-56"><a href="#cb234-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-57"><a href="#cb234-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb234-58"><a href="#cb234-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb234-59"><a href="#cb234-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-60"><a href="#cb234-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb234-61"><a href="#cb234-61" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb234-62"><a href="#cb234-62" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb234-63"><a href="#cb234-63" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb234-64"><a href="#cb234-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb234-65"><a href="#cb234-65" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb234-66"><a href="#cb234-66" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb234-67"><a href="#cb234-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb234-68"><a href="#cb234-68" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb234-69"><a href="#cb234-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb234-70"><a href="#cb234-70" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb234-71"><a href="#cb234-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb234-72"><a href="#cb234-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-73"><a href="#cb234-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-74"><a href="#cb234-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-75"><a href="#cb234-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-76"><a href="#cb234-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb234-77"><a href="#cb234-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb234-78"><a href="#cb234-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-79"><a href="#cb234-79" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;type(locals()[self.orisrc.__name__]): </span><span class="sc">{</span><span class="bu">type</span>(<span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-80"><a href="#cb234-80" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-81"><a href="#cb234-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-82"><a href="#cb234-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb234-83"><a href="#cb234-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-84"><a href="#cb234-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="exit-and-print-a-warning-message-idx-has-to-be-int" class="level3">
<h3>exit and print a warning message: idx has to be int</h3>
<div class="cell">
<div class="sourceCode" id="cb235"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb235-29"><a href="#cb235-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb235-30"><a href="#cb235-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb235-31"><a href="#cb235-31" aria-hidden="true" tabindex="-1"></a>        colwarn <span class="op">=</span> colorize(<span class="st">&quot;Warning!&quot;</span>, color<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb235-32"><a href="#cb235-32" aria-hidden="true" tabindex="-1"></a>        colmsg <span class="op">=</span> colorize(<span class="st">&quot; param decode has to be an int as idx.&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)</span>
<span id="cb235-33"><a href="#cb235-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(colwarn <span class="op">+</span> colmsg)</span>
<span id="cb235-34"><a href="#cb235-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb235-35"><a href="#cb235-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb235-36"><a href="#cb235-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-37"><a href="#cb235-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb235-38"><a href="#cb235-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-39"><a href="#cb235-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb235-40"><a href="#cb235-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-41"><a href="#cb235-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if the new codes is not empty</span></span>
<span id="cb235-42"><a href="#cb235-42" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.strip())</span>
<span id="cb235-43"><a href="#cb235-43" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb235-44"><a href="#cb235-44" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb235-45"><a href="#cb235-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb235-46"><a href="#cb235-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb235-47"><a href="#cb235-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb235-48"><a href="#cb235-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb235-49"><a href="#cb235-49" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb235-50"><a href="#cb235-50" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb235-51"><a href="#cb235-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-52"><a href="#cb235-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb235-53"><a href="#cb235-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb235-54"><a href="#cb235-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb235-55"><a href="#cb235-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb235-56"><a href="#cb235-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb235-57"><a href="#cb235-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-58"><a href="#cb235-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb235-59"><a href="#cb235-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb235-60"><a href="#cb235-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-61"><a href="#cb235-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb235-62"><a href="#cb235-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb235-63"><a href="#cb235-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-64"><a href="#cb235-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb235-65"><a href="#cb235-65" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb235-66"><a href="#cb235-66" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb235-67"><a href="#cb235-67" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb235-68"><a href="#cb235-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb235-69"><a href="#cb235-69" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb235-70"><a href="#cb235-70" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb235-71"><a href="#cb235-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb235-72"><a href="#cb235-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb235-73"><a href="#cb235-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb235-74"><a href="#cb235-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb235-75"><a href="#cb235-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb235-76"><a href="#cb235-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-77"><a href="#cb235-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-78"><a href="#cb235-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-79"><a href="#cb235-79" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-80"><a href="#cb235-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb235-81"><a href="#cb235-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb235-82"><a href="#cb235-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-83"><a href="#cb235-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;type(locals()[self.orisrc.__name__]): </span><span class="sc">{</span><span class="bu">type</span>(<span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-84"><a href="#cb235-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-85"><a href="#cb235-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-86"><a href="#cb235-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb235-87"><a href="#cb235-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-88"><a href="#cb235-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="handle-errors-by-codes-with-trailing-spaces" class="level3">
<h3>handle errors by codes with trailing spaces</h3>
<div class="cell">
<div class="sourceCode" id="cb236"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>        colwarn <span class="op">=</span> colorize(<span class="st">&quot;Warning!&quot;</span>, color<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>        colmsg <span class="op">=</span> colorize(<span class="st">&quot; param decode has to be an int as idx.&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(colwarn <span class="op">+</span> colmsg)</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb236-42"><a href="#cb236-42" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb236-43"><a href="#cb236-43" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb236-44"><a href="#cb236-44" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb236-45"><a href="#cb236-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb236-46"><a href="#cb236-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb236-47"><a href="#cb236-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb236-48"><a href="#cb236-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb236-49"><a href="#cb236-49" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb236-50"><a href="#cb236-50" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb236-51"><a href="#cb236-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-52"><a href="#cb236-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb236-53"><a href="#cb236-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb236-54"><a href="#cb236-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb236-55"><a href="#cb236-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb236-56"><a href="#cb236-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb236-57"><a href="#cb236-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-58"><a href="#cb236-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb236-59"><a href="#cb236-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb236-60"><a href="#cb236-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-61"><a href="#cb236-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb236-62"><a href="#cb236-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb236-63"><a href="#cb236-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-64"><a href="#cb236-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb236-65"><a href="#cb236-65" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb236-66"><a href="#cb236-66" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb236-67"><a href="#cb236-67" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb236-68"><a href="#cb236-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb236-69"><a href="#cb236-69" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb236-70"><a href="#cb236-70" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb236-71"><a href="#cb236-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb236-72"><a href="#cb236-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb236-73"><a href="#cb236-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb236-74"><a href="#cb236-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb236-75"><a href="#cb236-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb236-76"><a href="#cb236-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-77"><a href="#cb236-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-78"><a href="#cb236-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-79"><a href="#cb236-79" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-80"><a href="#cb236-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb236-81"><a href="#cb236-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb236-82"><a href="#cb236-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-83"><a href="#cb236-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;type(locals()[self.orisrc.__name__]): </span><span class="sc">{</span><span class="bu">type</span>(<span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-84"><a href="#cb236-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-85"><a href="#cb236-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-86"><a href="#cb236-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]]<span class="sc">.</span>dbprint <span class="op">==</span> Fastdb<span class="sc">.</span>dbprint<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb236-87"><a href="#cb236-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-88"><a href="#cb236-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="showdbsrctrue-check-whether-fastdb.dbprint-and-fdb.dbprint-are-same-object-using-is" class="level3">
<h3>showdbsrc=True, check whether Fastdb.dbprint and fdb.dbprint are same object using <code>is</code></h3>
<div class="cell">
<div class="sourceCode" id="cb237"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating&quot;</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a>    onedbprint <span class="op">=</span> <span class="va">False</span></span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb237-21"><a href="#cb237-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-22"><a href="#cb237-22" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb237-23"><a href="#cb237-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb237-24"><a href="#cb237-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb237-25"><a href="#cb237-25" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb237-26"><a href="#cb237-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-27"><a href="#cb237-27" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb237-28"><a href="#cb237-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb237-29"><a href="#cb237-29" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb237-30"><a href="#cb237-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb237-31"><a href="#cb237-31" aria-hidden="true" tabindex="-1"></a>        colwarn <span class="op">=</span> colorize(<span class="st">&quot;Warning!&quot;</span>, color<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb237-32"><a href="#cb237-32" aria-hidden="true" tabindex="-1"></a>        colmsg <span class="op">=</span> colorize(<span class="st">&quot; param decode has to be an int as idx.&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)</span>
<span id="cb237-33"><a href="#cb237-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(colwarn <span class="op">+</span> colmsg)</span>
<span id="cb237-34"><a href="#cb237-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb237-35"><a href="#cb237-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb237-36"><a href="#cb237-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-37"><a href="#cb237-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb237-38"><a href="#cb237-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-39"><a href="#cb237-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb237-40"><a href="#cb237-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-41"><a href="#cb237-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb237-42"><a href="#cb237-42" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb237-43"><a href="#cb237-43" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb237-44"><a href="#cb237-44" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb237-45"><a href="#cb237-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb237-46"><a href="#cb237-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb237-47"><a href="#cb237-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb237-48"><a href="#cb237-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb237-49"><a href="#cb237-49" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb237-50"><a href="#cb237-50" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb237-51"><a href="#cb237-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-52"><a href="#cb237-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb237-53"><a href="#cb237-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb237-54"><a href="#cb237-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb237-55"><a href="#cb237-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb237-56"><a href="#cb237-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb237-57"><a href="#cb237-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-58"><a href="#cb237-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb237-59"><a href="#cb237-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb237-60"><a href="#cb237-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-61"><a href="#cb237-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb237-62"><a href="#cb237-62" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb237-63"><a href="#cb237-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-64"><a href="#cb237-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb237-65"><a href="#cb237-65" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb237-66"><a href="#cb237-66" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb237-67"><a href="#cb237-67" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb237-68"><a href="#cb237-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb237-69"><a href="#cb237-69" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb237-70"><a href="#cb237-70" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb237-71"><a href="#cb237-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb237-72"><a href="#cb237-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb237-73"><a href="#cb237-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb237-74"><a href="#cb237-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb237-75"><a href="#cb237-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb237-76"><a href="#cb237-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-77"><a href="#cb237-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-78"><a href="#cb237-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-79"><a href="#cb237-79" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: {self.outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint is Fastdb.dbprint}&quot;)</span></span>
<span id="cb237-80"><a href="#cb237-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb237-81"><a href="#cb237-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb237-82"><a href="#cb237-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, locals(): </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-83"><a href="#cb237-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;type(locals()[self.orisrc.__name__]): </span><span class="sc">{</span><span class="bu">type</span>(<span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-84"><a href="#cb237-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Fastdb.dbprint has __code__?: </span><span class="sc">{</span><span class="bu">hasattr</span>(Fastdb.dbprint, <span class="st">&#39;__code__&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-85"><a href="#cb237-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;does Fastdb.dbprint has source available?: </span><span class="sc">{</span><span class="kw">not</span> inspect<span class="sc">.</span>getsourcefile(Fastdb.dbprint) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb237-86"><a href="#cb237-86" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f&quot;outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint == Fastdb.dbprint: {self.outenv[self.orisrc.__qualname__.split(&#39;.&#39;)[0]].dbprint is Fastdb.dbprint}&quot;)</span></span>
<span id="cb237-87"><a href="#cb237-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-88"><a href="#cb237-88" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb237-89"><a href="#cb237-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;locals()[self.orisrc.__name__]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb237-90"><a href="#cb237-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="remove-unnecessary-db-printout-when-showdbsrctrue-and-add-printout-to-display-sections" class="level3">
<h3>remove unnecessary db printout when showdbsrc=True and add printout to display sections</h3>
<div class="cell">
<div class="sourceCode" id="cb238"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-28"><a href="#cb238-28" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb238-29"><a href="#cb238-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb238-30"><a href="#cb238-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb238-31"><a href="#cb238-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb238-32"><a href="#cb238-32" aria-hidden="true" tabindex="-1"></a>        colwarn <span class="op">=</span> colorize(<span class="st">&quot;Warning!&quot;</span>, color<span class="op">=</span><span class="st">&quot;r&quot;</span>)</span>
<span id="cb238-33"><a href="#cb238-33" aria-hidden="true" tabindex="-1"></a>        colmsg <span class="op">=</span> colorize(<span class="st">&quot; param decode has to be an int as idx.&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)</span>
<span id="cb238-34"><a href="#cb238-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(colwarn <span class="op">+</span> colmsg)</span>
<span id="cb238-35"><a href="#cb238-35" aria-hidden="true" tabindex="-1"></a><span class="co">#         srclines = dbcode</span></span>
<span id="cb238-36"><a href="#cb238-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb238-37"><a href="#cb238-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-38"><a href="#cb238-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb238-39"><a href="#cb238-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-40"><a href="#cb238-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb238-41"><a href="#cb238-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-42"><a href="#cb238-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb238-43"><a href="#cb238-43" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb238-44"><a href="#cb238-44" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb238-45"><a href="#cb238-45" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb238-46"><a href="#cb238-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb238-47"><a href="#cb238-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb238-48"><a href="#cb238-48" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb238-49"><a href="#cb238-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb238-50"><a href="#cb238-50" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb238-51"><a href="#cb238-51" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb238-52"><a href="#cb238-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-53"><a href="#cb238-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb238-54"><a href="#cb238-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb238-55"><a href="#cb238-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb238-56"><a href="#cb238-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb238-57"><a href="#cb238-57" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb238-58"><a href="#cb238-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-59"><a href="#cb238-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb238-60"><a href="#cb238-60" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb238-61"><a href="#cb238-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-62"><a href="#cb238-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb238-63"><a href="#cb238-63" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb238-64"><a href="#cb238-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-65"><a href="#cb238-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb238-66"><a href="#cb238-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb238-67"><a href="#cb238-67" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb238-68"><a href="#cb238-68" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb238-69"><a href="#cb238-69" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb238-70"><a href="#cb238-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb238-71"><a href="#cb238-71" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb238-72"><a href="#cb238-72" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb238-73"><a href="#cb238-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb238-74"><a href="#cb238-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb238-75"><a href="#cb238-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb238-76"><a href="#cb238-76" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb238-77"><a href="#cb238-77" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb238-78"><a href="#cb238-78" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)</span>
<span id="cb238-79"><a href="#cb238-79" aria-hidden="true" tabindex="-1"></a>        clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb238-80"><a href="#cb238-80" aria-hidden="true" tabindex="-1"></a>        methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb238-81"><a href="#cb238-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-82"><a href="#cb238-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-83"><a href="#cb238-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-84"><a href="#cb238-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-85"><a href="#cb238-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-86"><a href="#cb238-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-87"><a href="#cb238-87" aria-hidden="true" tabindex="-1"></a>        expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb238-88"><a href="#cb238-88" aria-hidden="true" tabindex="-1"></a>        expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb238-89"><a href="#cb238-89" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-90"><a href="#cb238-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-91"><a href="#cb238-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb238-92"><a href="#cb238-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb238-93"><a href="#cb238-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb238-94"><a href="#cb238-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb238-95"><a href="#cb238-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-96"><a href="#cb238-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-97"><a href="#cb238-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-98"><a href="#cb238-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-99"><a href="#cb238-99" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-100"><a href="#cb238-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-101"><a href="#cb238-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-102"><a href="#cb238-102" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in locals(): {[i in list(locals().keys()) for i in [self.orisrc.__name__, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb238-103"><a href="#cb238-103" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in self.outenv(): {[i in self.outenv for i in [methodname, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb238-104"><a href="#cb238-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-105"><a href="#cb238-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb238-106"><a href="#cb238-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb238-107"><a href="#cb238-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;locals()[self.orisrc.__name__]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb238-108"><a href="#cb238-108" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb238-109"><a href="#cb238-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb238-110"><a href="#cb238-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="raise-typeerror-when-decode-are-not-integer-and-showdbsrctrue-working-on-both-method-and-function" class="level3">
<h3>raise TypeError when decode are not integer and showdbsrc=true working on both method and function</h3>
<div class="cell">
<div class="sourceCode" id="cb239"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb239-18"><a href="#cb239-18" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb239-19"><a href="#cb239-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-20"><a href="#cb239-20" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb239-21"><a href="#cb239-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb239-22"><a href="#cb239-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-23"><a href="#cb239-23" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb239-24"><a href="#cb239-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb239-25"><a href="#cb239-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb239-26"><a href="#cb239-26" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb239-27"><a href="#cb239-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-28"><a href="#cb239-28" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb239-29"><a href="#cb239-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb239-30"><a href="#cb239-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb239-31"><a href="#cb239-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb239-32"><a href="#cb239-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb239-33"><a href="#cb239-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-34"><a href="#cb239-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb239-35"><a href="#cb239-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-36"><a href="#cb239-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb239-37"><a href="#cb239-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-38"><a href="#cb239-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb239-39"><a href="#cb239-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb239-40"><a href="#cb239-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb239-41"><a href="#cb239-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb239-42"><a href="#cb239-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb239-43"><a href="#cb239-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb239-44"><a href="#cb239-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb239-45"><a href="#cb239-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb239-46"><a href="#cb239-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb239-47"><a href="#cb239-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb239-48"><a href="#cb239-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-49"><a href="#cb239-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb239-50"><a href="#cb239-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb239-51"><a href="#cb239-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb239-52"><a href="#cb239-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb239-53"><a href="#cb239-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb239-54"><a href="#cb239-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-55"><a href="#cb239-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb239-56"><a href="#cb239-56" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb239-57"><a href="#cb239-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-58"><a href="#cb239-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()): <span class="co"># make sure pure indentation + \n is ignored</span></span>
<span id="cb239-59"><a href="#cb239-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb239-60"><a href="#cb239-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-61"><a href="#cb239-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb239-62"><a href="#cb239-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb239-63"><a href="#cb239-63" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb239-64"><a href="#cb239-64" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb239-65"><a href="#cb239-65" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb239-66"><a href="#cb239-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb239-67"><a href="#cb239-67" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb239-68"><a href="#cb239-68" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb239-69"><a href="#cb239-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb239-70"><a href="#cb239-70" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb239-71"><a href="#cb239-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb239-72"><a href="#cb239-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb239-73"><a href="#cb239-73" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb239-74"><a href="#cb239-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-75"><a href="#cb239-75" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)</span>
<span id="cb239-76"><a href="#cb239-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb239-77"><a href="#cb239-77" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb239-78"><a href="#cb239-78" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb239-79"><a href="#cb239-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-80"><a href="#cb239-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-81"><a href="#cb239-81" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-82"><a href="#cb239-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-83"><a href="#cb239-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-84"><a href="#cb239-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-85"><a href="#cb239-85" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb239-86"><a href="#cb239-86" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb239-87"><a href="#cb239-87" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-88"><a href="#cb239-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-89"><a href="#cb239-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb239-90"><a href="#cb239-90" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb239-91"><a href="#cb239-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb239-92"><a href="#cb239-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb239-93"><a href="#cb239-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-94"><a href="#cb239-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb239-95"><a href="#cb239-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-96"><a href="#cb239-96" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-97"><a href="#cb239-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-98"><a href="#cb239-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-99"><a href="#cb239-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-100"><a href="#cb239-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-101"><a href="#cb239-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in locals(): {[i in list(locals().keys()) for i in [self.orisrc.__name__, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb239-102"><a href="#cb239-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in self.outenv(): {[i in self.outenv for i in [methodname, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb239-103"><a href="#cb239-103" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-104"><a href="#cb239-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb239-105"><a href="#cb239-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb239-106"><a href="#cb239-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;locals()[self.orisrc.__name__]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb239-107"><a href="#cb239-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb239-108"><a href="#cb239-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb239-109"><a href="#cb239-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="when-debugging-dbprint-make-sure-dbsrc-is-printed-with-the-same-idx-as-original" class="level3">
<h3>when debugging dbprint, make sure dbsrc is printed with the same idx as original</h3>
<div class="cell">
<div class="sourceCode" id="cb240"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>            dbcode:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({dbcode: cmt})</span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-14"><a href="#cb240-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, dbcode, cmt, expand)</span>
<span id="cb240-15"><a href="#cb240-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb240-16"><a href="#cb240-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb240-17"><a href="#cb240-17" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb240-18"><a href="#cb240-18" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb240-19"><a href="#cb240-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-20"><a href="#cb240-20" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb240-21"><a href="#cb240-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb240-22"><a href="#cb240-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-23"><a href="#cb240-23" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb240-24"><a href="#cb240-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb240-25"><a href="#cb240-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb240-26"><a href="#cb240-26" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb240-27"><a href="#cb240-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-28"><a href="#cb240-28" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb240-29"><a href="#cb240-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(dbcode) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb240-30"><a href="#cb240-30" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[dbcode]</span>
<span id="cb240-31"><a href="#cb240-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb240-32"><a href="#cb240-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb240-33"><a href="#cb240-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-34"><a href="#cb240-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb240-35"><a href="#cb240-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-36"><a href="#cb240-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> dbcode:</span>
<span id="cb240-37"><a href="#cb240-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-38"><a href="#cb240-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># no codes, no dbprintinsert</span></span>
<span id="cb240-39"><a href="#cb240-39" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb240-40"><a href="#cb240-40" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb240-41"><a href="#cb240-41" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb240-42"><a href="#cb240-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb240-43"><a href="#cb240-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb240-44"><a href="#cb240-44" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb240-45"><a href="#cb240-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb240-46"><a href="#cb240-46" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb240-47"><a href="#cb240-47" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb240-48"><a href="#cb240-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-49"><a href="#cb240-49" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb240-50"><a href="#cb240-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb240-51"><a href="#cb240-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb240-52"><a href="#cb240-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb240-53"><a href="#cb240-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb240-54"><a href="#cb240-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-55"><a href="#cb240-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb240-56"><a href="#cb240-56" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb240-57"><a href="#cb240-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb240-58"><a href="#cb240-58" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb240-59"><a href="#cb240-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-60"><a href="#cb240-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb240-61"><a href="#cb240-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb240-62"><a href="#cb240-62" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb240-63"><a href="#cb240-63" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb240-64"><a href="#cb240-64" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb240-65"><a href="#cb240-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb240-66"><a href="#cb240-66" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb240-67"><a href="#cb240-67" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb240-68"><a href="#cb240-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb240-69"><a href="#cb240-69" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb240-70"><a href="#cb240-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb240-71"><a href="#cb240-71" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb240-72"><a href="#cb240-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb240-73"><a href="#cb240-73" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb240-74"><a href="#cb240-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb240-75"><a href="#cb240-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-76"><a href="#cb240-76" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)</span>
<span id="cb240-77"><a href="#cb240-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb240-78"><a href="#cb240-78" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb240-79"><a href="#cb240-79" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb240-80"><a href="#cb240-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-81"><a href="#cb240-81" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-82"><a href="#cb240-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-83"><a href="#cb240-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-84"><a href="#cb240-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-85"><a href="#cb240-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-86"><a href="#cb240-86" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb240-87"><a href="#cb240-87" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb240-88"><a href="#cb240-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-89"><a href="#cb240-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-90"><a href="#cb240-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-91"><a href="#cb240-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># make sure b can access lst from above</span></span>
<span id="cb240-92"><a href="#cb240-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb240-93"><a href="#cb240-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb240-94"><a href="#cb240-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb240-95"><a href="#cb240-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-96"><a href="#cb240-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb240-97"><a href="#cb240-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-98"><a href="#cb240-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-99"><a href="#cb240-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-100"><a href="#cb240-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-101"><a href="#cb240-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-102"><a href="#cb240-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-103"><a href="#cb240-103" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in locals(): {[i in list(locals().keys()) for i in [self.orisrc.__name__, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb240-104"><a href="#cb240-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         print(f&quot;after exec, are {methodname} and {clsname} and {self.orisrc.__qualname__} in self.outenv(): {[i in self.outenv for i in [methodname, clsname, self.orisrc.__qualname__]]}&quot;)</span></span>
<span id="cb240-105"><a href="#cb240-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-106"><a href="#cb240-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb240-107"><a href="#cb240-107" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb240-108"><a href="#cb240-108" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb240-109"><a href="#cb240-109" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;locals()[self.orisrc.__name__]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb240-110"><a href="#cb240-110" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb240-111"><a href="#cb240-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb240-112"><a href="#cb240-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]</span></code></pre></div>
</div>
</section>
<section id="update-dbsrc-to-the-global-env" class="level3">
<h3>update dbsrc to the global env</h3>
</section>
<section id="go-back-to-normal-before-running-dbprint-again" class="level3">
<h3>go back to normal before running dbprint again</h3>
<div class="cell" data-code_folding="[2,9]">
<div class="sourceCode" id="cb241"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.goback() <span class="co"># refresh </span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({idxsrc: cmt})</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, idxsrc, cmt, expand)</span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb241-27"><a href="#cb241-27" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb241-28"><a href="#cb241-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-29"><a href="#cb241-29" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-30"><a href="#cb241-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb241-31"><a href="#cb241-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb241-32"><a href="#cb241-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb241-33"><a href="#cb241-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb241-34"><a href="#cb241-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-35"><a href="#cb241-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb241-36"><a href="#cb241-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-37"><a href="#cb241-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb241-38"><a href="#cb241-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-39"><a href="#cb241-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># no codes, no dbprintinsert</span></span>
<span id="cb241-40"><a href="#cb241-40" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb241-41"><a href="#cb241-41" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb241-42"><a href="#cb241-42" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb241-43"><a href="#cb241-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb241-44"><a href="#cb241-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb241-45"><a href="#cb241-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb241-46"><a href="#cb241-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb241-47"><a href="#cb241-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb241-48"><a href="#cb241-48" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb241-49"><a href="#cb241-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-50"><a href="#cb241-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-51"><a href="#cb241-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-52"><a href="#cb241-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb241-53"><a href="#cb241-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb241-54"><a href="#cb241-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb241-55"><a href="#cb241-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-56"><a href="#cb241-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb241-57"><a href="#cb241-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb241-58"><a href="#cb241-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb241-59"><a href="#cb241-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb241-60"><a href="#cb241-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-61"><a href="#cb241-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb241-62"><a href="#cb241-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb241-63"><a href="#cb241-63" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb241-64"><a href="#cb241-64" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb241-65"><a href="#cb241-65" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb241-66"><a href="#cb241-66" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb241-67"><a href="#cb241-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb241-68"><a href="#cb241-68" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb241-69"><a href="#cb241-69" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb241-70"><a href="#cb241-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb241-71"><a href="#cb241-71" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb241-72"><a href="#cb241-72" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx            </span>
<span id="cb241-73"><a href="#cb241-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb241-74"><a href="#cb241-74" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb241-75"><a href="#cb241-75" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb241-76"><a href="#cb241-76" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-77"><a href="#cb241-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb241-78"><a href="#cb241-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb241-79"><a href="#cb241-79" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb241-80"><a href="#cb241-80" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb241-81"><a href="#cb241-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb241-82"><a href="#cb241-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-83"><a href="#cb241-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-84"><a href="#cb241-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-85"><a href="#cb241-85" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb241-86"><a href="#cb241-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb241-87"><a href="#cb241-87" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb241-88"><a href="#cb241-88" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb241-89"><a href="#cb241-89" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb241-90"><a href="#cb241-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-91"><a href="#cb241-91" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-92"><a href="#cb241-92" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-93"><a href="#cb241-93" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-94"><a href="#cb241-94" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-95"><a href="#cb241-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-96"><a href="#cb241-96" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb241-97"><a href="#cb241-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-98"><a href="#cb241-98" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb241-99"><a href="#cb241-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-100"><a href="#cb241-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-101"><a href="#cb241-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-102"><a href="#cb241-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-103"><a href="#cb241-103" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb241-104"><a href="#cb241-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb241-105"><a href="#cb241-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb241-106"><a href="#cb241-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb241-107"><a href="#cb241-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb241-108"><a href="#cb241-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-109"><a href="#cb241-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-110"><a href="#cb241-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb241-111"><a href="#cb241-111" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-112"><a href="#cb241-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb241-113"><a href="#cb241-113" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb241-114"><a href="#cb241-114" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-115"><a href="#cb241-115" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-116"><a href="#cb241-116" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-117"><a href="#cb241-117" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-118"><a href="#cb241-118" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-119"><a href="#cb241-119" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-120"><a href="#cb241-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-121"><a href="#cb241-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-122"><a href="#cb241-122" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb241-123"><a href="#cb241-123" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb241-124"><a href="#cb241-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-125"><a href="#cb241-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-126"><a href="#cb241-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-127"><a href="#cb241-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb241-128"><a href="#cb241-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-129"><a href="#cb241-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-130"><a href="#cb241-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-131"><a href="#cb241-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb241-132"><a href="#cb241-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb241-133"><a href="#cb241-133" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb241-134"><a href="#cb241-134" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb241-135"><a href="#cb241-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb241-136"><a href="#cb241-136" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-137"><a href="#cb241-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb241-138"><a href="#cb241-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-139"><a href="#cb241-139" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb241-140"><a href="#cb241-140" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb241-141"><a href="#cb241-141" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span></code></pre></div>
</div>
</section>
<section id="auto-print-src-with-cmt-and-idx-as-the-ending-part-of-dbprint" class="level3">
<h3>auto print src with cmt and idx as the ending part of dbprint</h3>
<div class="cell" data-code_folding="[2,9]">
<div class="sourceCode" id="cb242"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.goback() <span class="co"># refresh </span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({idxsrc: cmt})</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, idxsrc, cmt, expand)</span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-35"><a href="#cb242-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb242-36"><a href="#cb242-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-37"><a href="#cb242-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb242-38"><a href="#cb242-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-39"><a href="#cb242-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># no codes, no dbprintinsert</span></span>
<span id="cb242-40"><a href="#cb242-40" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb242-41"><a href="#cb242-41" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb242-42"><a href="#cb242-42" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb242-43"><a href="#cb242-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb242-44"><a href="#cb242-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb242-45"><a href="#cb242-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb242-46"><a href="#cb242-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb242-47"><a href="#cb242-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb242-48"><a href="#cb242-48" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb242-49"><a href="#cb242-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-50"><a href="#cb242-50" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-51"><a href="#cb242-51" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-52"><a href="#cb242-52" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb242-53"><a href="#cb242-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb242-54"><a href="#cb242-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb242-55"><a href="#cb242-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-56"><a href="#cb242-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb242-57"><a href="#cb242-57" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb242-58"><a href="#cb242-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb242-59"><a href="#cb242-59" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb242-60"><a href="#cb242-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-61"><a href="#cb242-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb242-62"><a href="#cb242-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb242-63"><a href="#cb242-63" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb242-64"><a href="#cb242-64" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb242-65"><a href="#cb242-65" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb242-66"><a href="#cb242-66" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb242-67"><a href="#cb242-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb242-68"><a href="#cb242-68" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb242-69"><a href="#cb242-69" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb242-70"><a href="#cb242-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb242-71"><a href="#cb242-71" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb242-72"><a href="#cb242-72" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx            </span>
<span id="cb242-73"><a href="#cb242-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb242-74"><a href="#cb242-74" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb242-75"><a href="#cb242-75" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb242-76"><a href="#cb242-76" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-77"><a href="#cb242-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb242-78"><a href="#cb242-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb242-79"><a href="#cb242-79" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb242-80"><a href="#cb242-80" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-81"><a href="#cb242-81" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb242-82"><a href="#cb242-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-83"><a href="#cb242-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-84"><a href="#cb242-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-85"><a href="#cb242-85" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb242-86"><a href="#cb242-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb242-87"><a href="#cb242-87" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb242-88"><a href="#cb242-88" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb242-89"><a href="#cb242-89" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb242-90"><a href="#cb242-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-91"><a href="#cb242-91" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-92"><a href="#cb242-92" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-93"><a href="#cb242-93" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-94"><a href="#cb242-94" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-95"><a href="#cb242-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-96"><a href="#cb242-96" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb242-97"><a href="#cb242-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-98"><a href="#cb242-98" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb242-99"><a href="#cb242-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-100"><a href="#cb242-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-101"><a href="#cb242-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-102"><a href="#cb242-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-103"><a href="#cb242-103" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb242-104"><a href="#cb242-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb242-105"><a href="#cb242-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb242-106"><a href="#cb242-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb242-107"><a href="#cb242-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb242-108"><a href="#cb242-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-109"><a href="#cb242-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-110"><a href="#cb242-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb242-111"><a href="#cb242-111" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-112"><a href="#cb242-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb242-113"><a href="#cb242-113" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb242-114"><a href="#cb242-114" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-115"><a href="#cb242-115" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-116"><a href="#cb242-116" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-117"><a href="#cb242-117" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-118"><a href="#cb242-118" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-119"><a href="#cb242-119" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-120"><a href="#cb242-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-121"><a href="#cb242-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-122"><a href="#cb242-122" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb242-123"><a href="#cb242-123" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb242-124"><a href="#cb242-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-125"><a href="#cb242-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-126"><a href="#cb242-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb242-127"><a href="#cb242-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb242-128"><a href="#cb242-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-129"><a href="#cb242-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-130"><a href="#cb242-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-131"><a href="#cb242-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb242-132"><a href="#cb242-132" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb242-133"><a href="#cb242-133" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb242-134"><a href="#cb242-134" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb242-135"><a href="#cb242-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb242-136"><a href="#cb242-136" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-137"><a href="#cb242-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb242-138"><a href="#cb242-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-139"><a href="#cb242-139" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb242-140"><a href="#cb242-140" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb242-141"><a href="#cb242-141" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb242-142"><a href="#cb242-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-143"><a href="#cb242-143" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the srcode with comments</span></span>
<span id="cb242-144"><a href="#cb242-144" aria-hidden="true" tabindex="-1"></a>    totalines <span class="op">=</span> <span class="bu">len</span>(inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))</span>
<span id="cb242-145"><a href="#cb242-145" aria-hidden="true" tabindex="-1"></a>    maxpcell <span class="op">=</span> <span class="dv">33</span></span>
<span id="cb242-146"><a href="#cb242-146" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> idxsrc <span class="op">//</span> maxpcell</span>
<span id="cb242-147"><a href="#cb242-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-148"><a href="#cb242-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">&gt;</span> maxpcell <span class="kw">and</span> idx <span class="op">%</span> maxpcell <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb242-149"><a href="#cb242-149" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, pt <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb242-150"><a href="#cb242-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> idx <span class="op">%</span> maxpcell <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb242-151"><a href="#cb242-151" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, pt <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb242-152"><a href="#cb242-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb242-153"><a href="#cb242-153" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, <span class="dv">1</span>)</span></code></pre></div>
</div>
</section>
<section id="to-mark-my-explorations-expressions-to-evaluate-to-stand-out" class="level3">
<h3>to mark my explorations (expressions to evaluate) to stand out</h3>
<div class="cell" data-code_folding="[2,9]">
<div class="sourceCode" id="cb243"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.goback() <span class="co"># refresh </span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({idxsrc: cmt})</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>    printsrc(src, idxsrc, cmt, expand)</span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb243-20"><a href="#cb243-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-21"><a href="#cb243-21" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb243-22"><a href="#cb243-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb243-23"><a href="#cb243-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-24"><a href="#cb243-24" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb243-25"><a href="#cb243-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb243-26"><a href="#cb243-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb243-27"><a href="#cb243-27" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb243-28"><a href="#cb243-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-29"><a href="#cb243-29" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb243-30"><a href="#cb243-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb243-31"><a href="#cb243-31" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb243-32"><a href="#cb243-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb243-33"><a href="#cb243-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb243-34"><a href="#cb243-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-35"><a href="#cb243-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb243-36"><a href="#cb243-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-37"><a href="#cb243-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb243-38"><a href="#cb243-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-39"><a href="#cb243-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb243-40"><a href="#cb243-40" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb243-41"><a href="#cb243-41" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb243-42"><a href="#cb243-42" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb243-43"><a href="#cb243-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb243-44"><a href="#cb243-44" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb243-45"><a href="#cb243-45" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb243-46"><a href="#cb243-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb243-47"><a href="#cb243-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb243-48"><a href="#cb243-48" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb243-49"><a href="#cb243-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-50"><a href="#cb243-50" aria-hidden="true" tabindex="-1"></a>                emptyline <span class="op">=</span> <span class="st">&quot;print()&quot;</span></span>
<span id="cb243-51"><a href="#cb243-51" aria-hidden="true" tabindex="-1"></a>                exploreStart <span class="op">=</span> <span class="st">&quot;print(&#39;</span><span class="sc">{:=&gt;157}</span><span class="st">&#39;.format(colorize(&#39;Start of my srcline exploration:&#39;, color=&#39;r&#39;)))&quot;</span></span>
<span id="cb243-52"><a href="#cb243-52" aria-hidden="true" tabindex="-1"></a>                exploreEnd <span class="op">=</span> <span class="st">&quot;print(&#39;</span><span class="sc">{:=&gt;157}</span><span class="st">&#39;.format(colorize(&#39;End of my srcline exploration:&#39;, color=&#39;r&#39;)))&quot;</span></span>
<span id="cb243-53"><a href="#cb243-53" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> emptyline <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                   </span>
<span id="cb243-54"><a href="#cb243-54" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> exploreStart <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>   </span>
<span id="cb243-55"><a href="#cb243-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb243-56"><a href="#cb243-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb243-57"><a href="#cb243-57" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> exploreEnd <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb243-58"><a href="#cb243-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> emptyline <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                   </span>
<span id="cb243-59"><a href="#cb243-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb243-60"><a href="#cb243-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb243-61"><a href="#cb243-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb243-62"><a href="#cb243-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-63"><a href="#cb243-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb243-64"><a href="#cb243-64" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb243-65"><a href="#cb243-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb243-66"><a href="#cb243-66" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb243-67"><a href="#cb243-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-68"><a href="#cb243-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb243-69"><a href="#cb243-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-70"><a href="#cb243-70" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb243-71"><a href="#cb243-71" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb243-72"><a href="#cb243-72" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb243-73"><a href="#cb243-73" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb243-74"><a href="#cb243-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb243-75"><a href="#cb243-75" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb243-76"><a href="#cb243-76" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb243-77"><a href="#cb243-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb243-78"><a href="#cb243-78" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb243-79"><a href="#cb243-79" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx            </span>
<span id="cb243-80"><a href="#cb243-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb243-81"><a href="#cb243-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb243-82"><a href="#cb243-82" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb243-83"><a href="#cb243-83" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb243-84"><a href="#cb243-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb243-85"><a href="#cb243-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb243-86"><a href="#cb243-86" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb243-87"><a href="#cb243-87" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb243-88"><a href="#cb243-88" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb243-89"><a href="#cb243-89" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-90"><a href="#cb243-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-91"><a href="#cb243-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-92"><a href="#cb243-92" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb243-93"><a href="#cb243-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb243-94"><a href="#cb243-94" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-95"><a href="#cb243-95" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb243-96"><a href="#cb243-96" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb243-97"><a href="#cb243-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-98"><a href="#cb243-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-99"><a href="#cb243-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-100"><a href="#cb243-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-101"><a href="#cb243-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-102"><a href="#cb243-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-103"><a href="#cb243-103" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb243-104"><a href="#cb243-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-105"><a href="#cb243-105" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb243-106"><a href="#cb243-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-107"><a href="#cb243-107" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-108"><a href="#cb243-108" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-109"><a href="#cb243-109" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-110"><a href="#cb243-110" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb243-111"><a href="#cb243-111" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb243-112"><a href="#cb243-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb243-113"><a href="#cb243-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb243-114"><a href="#cb243-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-115"><a href="#cb243-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb243-116"><a href="#cb243-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb243-117"><a href="#cb243-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb243-118"><a href="#cb243-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-119"><a href="#cb243-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb243-120"><a href="#cb243-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb243-121"><a href="#cb243-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-122"><a href="#cb243-122" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-123"><a href="#cb243-123" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-124"><a href="#cb243-124" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-125"><a href="#cb243-125" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-126"><a href="#cb243-126" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-127"><a href="#cb243-127" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-128"><a href="#cb243-128" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-129"><a href="#cb243-129" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb243-130"><a href="#cb243-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb243-131"><a href="#cb243-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-132"><a href="#cb243-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-133"><a href="#cb243-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb243-134"><a href="#cb243-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb243-135"><a href="#cb243-135" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-136"><a href="#cb243-136" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-137"><a href="#cb243-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-138"><a href="#cb243-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb243-139"><a href="#cb243-139" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb243-140"><a href="#cb243-140" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb243-141"><a href="#cb243-141" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb243-142"><a href="#cb243-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb243-143"><a href="#cb243-143" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-144"><a href="#cb243-144" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb243-145"><a href="#cb243-145" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-146"><a href="#cb243-146" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb243-147"><a href="#cb243-147" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb243-148"><a href="#cb243-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-149"><a href="#cb243-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-150"><a href="#cb243-150" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the srcode with comments</span></span>
<span id="cb243-151"><a href="#cb243-151" aria-hidden="true" tabindex="-1"></a>    totalines <span class="op">=</span> <span class="bu">len</span>(inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>))</span>
<span id="cb243-152"><a href="#cb243-152" aria-hidden="true" tabindex="-1"></a>    maxpcell <span class="op">=</span> <span class="dv">33</span></span>
<span id="cb243-153"><a href="#cb243-153" aria-hidden="true" tabindex="-1"></a>    pt <span class="op">=</span> idxsrc <span class="op">//</span> maxpcell</span>
<span id="cb243-154"><a href="#cb243-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-155"><a href="#cb243-155" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb243-156"><a href="#cb243-156" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:=&lt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;Review srcode with all comments added so far&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb243-157"><a href="#cb243-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="op">&gt;</span> maxpcell <span class="kw">and</span> idx <span class="op">%</span> maxpcell <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb243-158"><a href="#cb243-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, pt <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb243-159"><a href="#cb243-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> idx <span class="op">%</span> maxpcell <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb243-160"><a href="#cb243-160" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, pt <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb243-161"><a href="#cb243-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb243-162"><a href="#cb243-162" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">print</span>(maxpcell, <span class="dv">1</span>)</span>
<span id="cb243-163"><a href="#cb243-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code></pre></div>
</div>
</section>
<section id="add-the-print-of-src-with-idx-and-comments-at-the-end-of-dbsrc" class="level3">
<h3>Add the print of src with idx and comments at the end of dbsrc</h3>
<div class="cell" data-code_folding="[2,9]">
<div class="sourceCode" id="cb244"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbprint(<span class="va">self</span>:Fastdb, </span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment added to the srcline</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>codes, <span class="co"># a list of expressions (str) you write to be evaluated above the srcline</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>            expand:<span class="bu">int</span><span class="op">=</span><span class="dv">2</span>, <span class="co"># span 2 lines of srcode up and down from the srcline investigated</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code </span><span class="ch">\</span></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a><span class="co">you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.&quot;</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.goback() <span class="co"># refresh </span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.idxsrc <span class="op">=</span> idxsrc</span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>: <span class="va">self</span>.cmts.update({idxsrc: cmt})</span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a>    printsrc(src, idxsrc, cmt, expand)</span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-26"><a href="#cb244-26" aria-hidden="true" tabindex="-1"></a>    newlst <span class="op">=</span> []</span>
<span id="cb244-27"><a href="#cb244-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> codes: <span class="co"># no matter whether there is &quot;&quot; or &quot;  &quot; in the front or in the middle of codes</span></span>
<span id="cb244-28"><a href="#cb244-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(i.strip()): newlst.append(i)</span>
<span id="cb244-29"><a href="#cb244-29" aria-hidden="true" tabindex="-1"></a>    codes <span class="op">=</span> newlst</span>
<span id="cb244-30"><a href="#cb244-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-31"><a href="#cb244-31" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb244-32"><a href="#cb244-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb244-33"><a href="#cb244-33" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb244-34"><a href="#cb244-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb244-35"><a href="#cb244-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb244-36"><a href="#cb244-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-37"><a href="#cb244-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb244-38"><a href="#cb244-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-39"><a href="#cb244-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb244-40"><a href="#cb244-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-41"><a href="#cb244-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codes) <span class="op">&gt;</span> <span class="dv">0</span>: </span>
<span id="cb244-42"><a href="#cb244-42" aria-hidden="true" tabindex="-1"></a>                numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb244-43"><a href="#cb244-43" aria-hidden="true" tabindex="-1"></a>                dbcodes <span class="op">=</span> <span class="st">&quot;dbprintinsert(&quot;</span></span>
<span id="cb244-44"><a href="#cb244-44" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb244-45"><a href="#cb244-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> codes:</span>
<span id="cb244-46"><a href="#cb244-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">==</span> <span class="bu">len</span>(codes):</span>
<span id="cb244-47"><a href="#cb244-47" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="st">&quot;env=g&quot;</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span></span>
<span id="cb244-48"><a href="#cb244-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb244-49"><a href="#cb244-49" aria-hidden="true" tabindex="-1"></a>                        dbcodes <span class="op">=</span> dbcodes <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb244-50"><a href="#cb244-50" aria-hidden="true" tabindex="-1"></a>                    count <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb244-51"><a href="#cb244-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-52"><a href="#cb244-52" aria-hidden="true" tabindex="-1"></a>                emptyline <span class="op">=</span> <span class="st">&quot;print()&quot;</span></span>
<span id="cb244-53"><a href="#cb244-53" aria-hidden="true" tabindex="-1"></a>                exploreStart <span class="op">=</span> <span class="st">&quot;print(&#39;</span><span class="sc">{:=&gt;157}</span><span class="st">&#39;.format(colorize(&#39;Start of my srcline exploration:&#39;, color=&#39;r&#39;)))&quot;</span></span>
<span id="cb244-54"><a href="#cb244-54" aria-hidden="true" tabindex="-1"></a>                exploreEnd <span class="op">=</span> <span class="st">&quot;print(&#39;</span><span class="sc">{:=&gt;157}</span><span class="st">&#39;.format(colorize(&#39;End of my srcline exploration:&#39;, color=&#39;r&#39;)))&quot;</span></span>
<span id="cb244-55"><a href="#cb244-55" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> emptyline <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                   </span>
<span id="cb244-56"><a href="#cb244-56" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> exploreStart <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>   </span>
<span id="cb244-57"><a href="#cb244-57" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> <span class="st">&quot;g = locals()&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb244-58"><a href="#cb244-58" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb244-59"><a href="#cb244-59" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> exploreEnd <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb244-60"><a href="#cb244-60" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> emptyline <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                   </span>
<span id="cb244-61"><a href="#cb244-61" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb244-62"><a href="#cb244-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb244-63"><a href="#cb244-63" aria-hidden="true" tabindex="-1"></a>                dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>                </span>
<span id="cb244-64"><a href="#cb244-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-65"><a href="#cb244-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb244-66"><a href="#cb244-66" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb244-67"><a href="#cb244-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb244-68"><a href="#cb244-68" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb244-69"><a href="#cb244-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-70"><a href="#cb244-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb244-71"><a href="#cb244-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=Start&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb244-72"><a href="#cb244-72" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb244-73"><a href="#cb244-73" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb244-74"><a href="#cb244-74" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb244-75"><a href="#cb244-75" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb244-76"><a href="#cb244-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb244-77"><a href="#cb244-77" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb244-78"><a href="#cb244-78" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb244-79"><a href="#cb244-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;dbprintinsert&quot;</span>): </span>
<span id="cb244-80"><a href="#cb244-80" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb244-81"><a href="#cb244-81" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx            </span>
<span id="cb244-82"><a href="#cb244-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb244-83"><a href="#cb244-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb244-84"><a href="#cb244-84" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb244-85"><a href="#cb244-85" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb244-86"><a href="#cb244-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb244-87"><a href="#cb244-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb244-88"><a href="#cb244-88" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span>                </span>
<span id="cb244-89"><a href="#cb244-89" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb244-90"><a href="#cb244-90" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb244-91"><a href="#cb244-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-92"><a href="#cb244-92" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-93"><a href="#cb244-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-94"><a href="#cb244-94" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb244-95"><a href="#cb244-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb244-96"><a href="#cb244-96" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb244-97"><a href="#cb244-97" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb244-98"><a href="#cb244-98" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb244-99"><a href="#cb244-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-100"><a href="#cb244-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-101"><a href="#cb244-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-102"><a href="#cb244-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-103"><a href="#cb244-103" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-104"><a href="#cb244-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-105"><a href="#cb244-105" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb244-106"><a href="#cb244-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-107"><a href="#cb244-107" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb244-108"><a href="#cb244-108" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-109"><a href="#cb244-109" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-110"><a href="#cb244-110" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-111"><a href="#cb244-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-112"><a href="#cb244-112" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb244-113"><a href="#cb244-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb244-114"><a href="#cb244-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(dbsrc, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb244-115"><a href="#cb244-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb244-116"><a href="#cb244-116" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb244-117"><a href="#cb244-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-118"><a href="#cb244-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-119"><a href="#cb244-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb244-120"><a href="#cb244-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-121"><a href="#cb244-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb244-122"><a href="#cb244-122" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb244-123"><a href="#cb244-123" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-124"><a href="#cb244-124" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-125"><a href="#cb244-125" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-126"><a href="#cb244-126" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-127"><a href="#cb244-127" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-128"><a href="#cb244-128" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-129"><a href="#cb244-129" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-130"><a href="#cb244-130" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-131"><a href="#cb244-131" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb244-132"><a href="#cb244-132" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb244-133"><a href="#cb244-133" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-134"><a href="#cb244-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-135"><a href="#cb244-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb244-136"><a href="#cb244-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb244-137"><a href="#cb244-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-138"><a href="#cb244-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-139"><a href="#cb244-139" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-140"><a href="#cb244-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb244-141"><a href="#cb244-141" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb244-142"><a href="#cb244-142" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb244-143"><a href="#cb244-143" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb244-144"><a href="#cb244-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb244-145"><a href="#cb244-145" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-146"><a href="#cb244-146" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb244-147"><a href="#cb244-147" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-148"><a href="#cb244-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb244-149"><a href="#cb244-149" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb244-150"><a href="#cb244-150" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb244-151"><a href="#cb244-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-152"><a href="#cb244-152" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the srcode with comments using self.autoprint()</span></span>
<span id="cb244-153"><a href="#cb244-153" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f&quot;self: {self}&quot;)</span></span></code></pre></div>
</div>
</section>
<section id="embed-example-and-autoprint-to-shorten-the-code-to-type" class="level3">
<h3>embed example and autoprint to shorten the code to type</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L257" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb.dbprint" class="level3">
<h3>Fastdb.dbprint</h3>
<blockquote>
<pre><code> Fastdb.dbprint (idxsrc:int, cmt:str, *codes, expand:int=2,
                 showdbsrc:bool=False)</code></pre>
</blockquote>
<p>Add comment and evaluate custom (single or multi lines) expressions to any srcline of the source code you are investigating. Run exec on the entire srcode with added expressions (dbsrc), so that dbsrc is callable.</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>idxsrc</td>
<td>int</td>
<td></td>
<td>idx of a srcline under investigation, can only be int</td>
</tr>
<tr class="even">
<td>cmt</td>
<td>str</td>
<td></td>
<td>comment added to the srcline</td>
</tr>
<tr class="odd">
<td>codes</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>expand</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
<tr class="odd">
<td>showdbsrc</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L415" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb.autoprint" class="level3">
<h3>Fastdb.autoprint</h3>
<blockquote>
<pre><code> Fastdb.autoprint ()</code></pre>
</blockquote>
</section>
</section>
<section id="take-an-example-and-its-env-into-fastdb-obj" class="level2">
<h2>Take an example and its env into Fastdb obj</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L433" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="fastdb.takexample" class="level3">
<h3>Fastdb.takExample</h3>
<blockquote>
<pre><code> Fastdb.takExample (eg, **env)</code></pre>
</blockquote>
</section>
</section>
<section id="print-src-with-idx-and-cmt-in-whole-or-parts" class="level2">
<h2>print src with idx and cmt in whole or parts</h2>
<div class="cell" data-code_folding="[2]">
<div class="sourceCode" id="cb248"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">print</span>(<span class="va">self</span>:Fastdb, </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>            maxlines:<span class="bu">int</span><span class="op">=</span><span class="dv">33</span>, <span class="co"># maximum num of lines per page</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>            part:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="co"># if the src is more than 33 lines, then divide the src by 33 into a few parts</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;Print the source code in whole or parts with idx and comments you added with dbprint along the way.&quot;</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>    totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>    lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>    lspace <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>    lstsrc <span class="op">=</span> inspect.getsource(<span class="va">self</span>.orisrc).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>    numparts <span class="op">=</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span> <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">len</span>(lstsrc) <span class="op">%</span> <span class="dv">33</span> <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">len</span>(lstsrc) <span class="op">//</span> <span class="dv">33</span></span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a>    cmts <span class="op">=</span> <span class="va">self</span>.cmts</span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part <span class="op">==</span> <span class="dv">0</span>: </span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb248-24"><a href="#cb248-24" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-25"><a href="#cb248-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb248-26"><a href="#cb248-26" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-27"><a href="#cb248-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>: </span>
<span id="cb248-28"><a href="#cb248-28" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-29"><a href="#cb248-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-30"><a href="#cb248-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb248-31"><a href="#cb248-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-32"><a href="#cb248-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-33"><a href="#cb248-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb248-34"><a href="#cb248-34" aria-hidden="true" tabindex="-1"></a>                    cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb248-35"><a href="#cb248-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb248-36"><a href="#cb248-36" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb248-37"><a href="#cb248-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb248-38"><a href="#cb248-38" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                      </span>
<span id="cb248-39"><a href="#cb248-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-40"><a href="#cb248-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb248-41"><a href="#cb248-41" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                 </span>
<span id="cb248-42"><a href="#cb248-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-43"><a href="#cb248-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(numparts):</span>
<span id="cb248-44"><a href="#cb248-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lstsrc)), lstsrc):</span>
<span id="cb248-45"><a href="#cb248-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-46"><a href="#cb248-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (maxlines<span class="op">*</span>p <span class="op">&lt;=</span> idx <span class="op">&lt;</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part):</span>
<span id="cb248-47"><a href="#cb248-47" aria-hidden="true" tabindex="-1"></a>                lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb248-48"><a href="#cb248-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb248-49"><a href="#cb248-49" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-50"><a href="#cb248-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> lenl <span class="op">+</span> lspace <span class="op">&gt;=</span> <span class="dv">100</span>:</span>
<span id="cb248-51"><a href="#cb248-51" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb248-52"><a href="#cb248-52" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb248-53"><a href="#cb248-53" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb248-54"><a href="#cb248-54" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx] <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx<span class="op">-</span><span class="bu">len</span>(cmts[idx])<span class="op">-</span><span class="dv">3</span>) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-55"><a href="#cb248-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb248-56"><a href="#cb248-56" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-57"><a href="#cb248-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>: </span>
<span id="cb248-58"><a href="#cb248-58" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb248-59"><a href="#cb248-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-60"><a href="#cb248-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-61"><a href="#cb248-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb248-62"><a href="#cb248-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-63"><a href="#cb248-63" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">bool</span>(cmts):</span>
<span id="cb248-64"><a href="#cb248-64" aria-hidden="true" tabindex="-1"></a>                        cmtidx <span class="op">=</span> [cmt[<span class="dv">0</span>] <span class="cf">for</span> cmt <span class="kw">in</span> <span class="bu">list</span>(cmts.items())]</span>
<span id="cb248-65"><a href="#cb248-65" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> idx <span class="kw">in</span> cmtidx:</span>
<span id="cb248-66"><a href="#cb248-66" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span> <span class="op">+</span> <span class="st">&quot; # &quot;</span> <span class="op">+</span> cmts[idx]))</span>
<span id="cb248-67"><a href="#cb248-67" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb248-68"><a href="#cb248-68" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                                                          </span>
<span id="cb248-69"><a href="#cb248-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-70"><a href="#cb248-70" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb248-71"><a href="#cb248-71" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&lt;100}</span><span class="st">&#39;</span>.<span class="bu">format</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(<span class="dv">100</span><span class="op">-</span>lenl<span class="op">-</span>lspace) <span class="op">+</span> <span class="ss">f&quot;(</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">)&quot;</span>))                      </span>
<span id="cb248-72"><a href="#cb248-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-73"><a href="#cb248-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx <span class="op">==</span> maxlines<span class="op">*</span>(p<span class="op">+</span><span class="dv">1</span>) <span class="kw">or</span> idx <span class="op">==</span> <span class="bu">len</span>(lstsrc) <span class="op">-</span> <span class="dv">1</span>) <span class="kw">and</span> p<span class="op">+</span><span class="dv">1</span> <span class="op">==</span> part:</span>
<span id="cb248-74"><a href="#cb248-74" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:&gt;157}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="ss">f&quot;part No.</span><span class="sc">{</span>p<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> out of </span><span class="sc">{</span>numparts<span class="sc">}</span><span class="ss"> parts&quot;</span>))</span>
<span id="cb248-75"><a href="#cb248-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span></code></pre></div>
</div>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L445" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="fastdb.print" class="level3">
<h3>Fastdb.print</h3>
<blockquote>
<pre><code> Fastdb.print (maxlines:int=33, part:int=0)</code></pre>
</blockquote>
<p>Print the source code in whole or parts with idx and comments you added with dbprint along the way.</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>maxlines</td>
<td>int</td>
<td>33</td>
<td>maximum num of lines per page</td>
</tr>
<tr class="even">
<td>part</td>
<td>int</td>
<td>0</td>
<td>if the src is more than 33 lines, then divide the src by 33 into a few parts</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="goback" class="level2">
<h2>goback</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L522" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="fastdb.goback" class="level3">
<h3>Fastdb.goback</h3>
<blockquote>
<pre><code> Fastdb.goback ()</code></pre>
</blockquote>
<p>Return src back to original state.</p>
</section>
</section>
<section id="fastdb.explore" class="level2">
<h2>Fastdb.explore</h2>
<section id="adding-one-breakpoint-with-comment" class="level3">
<h3>adding one breakpoint with comment</h3>
<div class="cell">
<div class="sourceCode" id="cb251"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explore(<span class="va">self</span>:Fastdb, </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idx of a srcline under investigation, can only be int</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;insert &#39;import ipdb; ipdb.set_trace()&#39; above srcline of idx to create dbsrc, and exec on dbsrc&quot;</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>    printsrc(src, idxsrc, cmt)</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-19"><a href="#cb251-19" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb251-20"><a href="#cb251-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb251-21"><a href="#cb251-21" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb251-22"><a href="#cb251-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb251-23"><a href="#cb251-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer.&quot;</span>)</span>
<span id="cb251-24"><a href="#cb251-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-25"><a href="#cb251-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb251-26"><a href="#cb251-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-27"><a href="#cb251-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> l.strip() <span class="kw">in</span> srclines <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb251-28"><a href="#cb251-28" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) <span class="co"># make sure indent not messed up by trailing spaces</span></span>
<span id="cb251-29"><a href="#cb251-29" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;import ipdb; ipdb.set_trace()&quot;</span></span>
<span id="cb251-30"><a href="#cb251-30" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb251-31"><a href="#cb251-31" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb251-32"><a href="#cb251-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb251-33"><a href="#cb251-33" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb251-34"><a href="#cb251-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb251-35"><a href="#cb251-35" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb251-36"><a href="#cb251-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-37"><a href="#cb251-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb251-38"><a href="#cb251-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print out dbsrc&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb251-39"><a href="#cb251-39" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb251-40"><a href="#cb251-40" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb251-41"><a href="#cb251-41" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb251-42"><a href="#cb251-42" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb251-43"><a href="#cb251-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb251-44"><a href="#cb251-44" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb251-45"><a href="#cb251-45" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb251-46"><a href="#cb251-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;import ipdb&quot;</span>): </span>
<span id="cb251-47"><a href="#cb251-47" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb251-48"><a href="#cb251-48" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx</span>
<span id="cb251-49"><a href="#cb251-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb251-50"><a href="#cb251-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb251-51"><a href="#cb251-51" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb251-52"><a href="#cb251-52" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb251-53"><a href="#cb251-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb251-54"><a href="#cb251-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb251-55"><a href="#cb251-55" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb251-56"><a href="#cb251-56" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb251-57"><a href="#cb251-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb251-58"><a href="#cb251-58" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb251-59"><a href="#cb251-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb251-60"><a href="#cb251-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb251-61"><a href="#cb251-61" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb251-62"><a href="#cb251-62" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb251-63"><a href="#cb251-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-64"><a href="#cb251-64" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-65"><a href="#cb251-65" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-66"><a href="#cb251-66" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-67"><a href="#cb251-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-68"><a href="#cb251-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-69"><a href="#cb251-69" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb251-70"><a href="#cb251-70" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-71"><a href="#cb251-71" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb251-72"><a href="#cb251-72" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-73"><a href="#cb251-73" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-74"><a href="#cb251-74" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-75"><a href="#cb251-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-76"><a href="#cb251-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-77"><a href="#cb251-77" aria-hidden="true" tabindex="-1"></a>    file_name <span class="op">=</span><span class="st">&#39;/tmp/&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span> <span class="op">+</span> <span class="st">&#39;.py&#39;</span> <span class="co"># learn about /tmp folder https://www.fosslinux.com/41739/linux-tmp-directory-everything-you-need-to-know.htm</span></span>
<span id="cb251-78"><a href="#cb251-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_name, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb251-79"><a href="#cb251-79" aria-hidden="true" tabindex="-1"></a>        f.write(dbsrc)</span>
<span id="cb251-80"><a href="#cb251-80" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> <span class="bu">compile</span>(dbsrc, file_name, <span class="st">&#39;exec&#39;</span>)</span>
<span id="cb251-81"><a href="#cb251-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(code, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb251-82"><a href="#cb251-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb251-83"><a href="#cb251-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb251-84"><a href="#cb251-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-85"><a href="#cb251-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-86"><a href="#cb251-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb251-87"><a href="#cb251-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-88"><a href="#cb251-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb251-89"><a href="#cb251-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb251-90"><a href="#cb251-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-91"><a href="#cb251-91" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-92"><a href="#cb251-92" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-93"><a href="#cb251-93" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-94"><a href="#cb251-94" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-95"><a href="#cb251-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-96"><a href="#cb251-96" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-97"><a href="#cb251-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-98"><a href="#cb251-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb251-99"><a href="#cb251-99" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb251-100"><a href="#cb251-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-101"><a href="#cb251-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-102"><a href="#cb251-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-103"><a href="#cb251-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb251-104"><a href="#cb251-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-105"><a href="#cb251-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-106"><a href="#cb251-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-107"><a href="#cb251-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb251-108"><a href="#cb251-108" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb251-109"><a href="#cb251-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb251-110"><a href="#cb251-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb251-111"><a href="#cb251-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb251-112"><a href="#cb251-112" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-113"><a href="#cb251-113" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb251-114"><a href="#cb251-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-115"><a href="#cb251-115" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb251-116"><a href="#cb251-116" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb251-117"><a href="#cb251-117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span></code></pre></div>
</div>
</section>
<section id="adding-multiple-breakpoints-by-multiple-set_trace" class="level3">
<h3>Adding multiple breakpoints by multiple set_trace()</h3>
<div class="cell">
<div class="sourceCode" id="cb252"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explore(<span class="va">self</span>:Fastdb, </span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idxsrc can be an int or a list of int</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment can be a string or a list of strings</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;insert &#39;import ipdb; ipdb.set_trace()&#39; above srcline of idx to create dbsrc, and exec on dbsrc&quot;</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     printsrc(src, idxsrc, cmt)</span></span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb252-18"><a href="#cb252-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-19"><a href="#cb252-19" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="va">None</span></span>
<span id="cb252-20"><a href="#cb252-20" aria-hidden="true" tabindex="-1"></a>    idxlst <span class="op">=</span> <span class="va">None</span></span>
<span id="cb252-21"><a href="#cb252-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb252-22"><a href="#cb252-22" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb252-23"><a href="#cb252-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">list</span>:</span>
<span id="cb252-24"><a href="#cb252-24" aria-hidden="true" tabindex="-1"></a>        idxlst <span class="op">=</span> idxsrc</span>
<span id="cb252-25"><a href="#cb252-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb252-26"><a href="#cb252-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer or a list.&quot;</span>)</span>
<span id="cb252-27"><a href="#cb252-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-28"><a href="#cb252-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb252-29"><a href="#cb252-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-30"><a href="#cb252-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span> <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb252-31"><a href="#cb252-31" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb252-32"><a href="#cb252-32" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;import ipdb; ipdb.set_trace()&quot;</span></span>
<span id="cb252-33"><a href="#cb252-33" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb252-34"><a href="#cb252-34" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb252-35"><a href="#cb252-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">list</span> <span class="kw">and</span> idx <span class="kw">in</span> idxlst:</span>
<span id="cb252-36"><a href="#cb252-36" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb252-37"><a href="#cb252-37" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;import ipdb; ipdb.set_trace()&quot;</span></span>
<span id="cb252-38"><a href="#cb252-38" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb252-39"><a href="#cb252-39" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>  </span>
<span id="cb252-40"><a href="#cb252-40" aria-hidden="true" tabindex="-1"></a>            idxlst.remove(idx)</span>
<span id="cb252-41"><a href="#cb252-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb252-42"><a href="#cb252-42" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb252-43"><a href="#cb252-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb252-44"><a href="#cb252-44" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb252-45"><a href="#cb252-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-46"><a href="#cb252-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb252-47"><a href="#cb252-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print out dbsrc&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb252-48"><a href="#cb252-48" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb252-49"><a href="#cb252-49" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb252-50"><a href="#cb252-50" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb252-51"><a href="#cb252-51" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb252-52"><a href="#cb252-52" aria-hidden="true" tabindex="-1"></a>        idxcount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb252-53"><a href="#cb252-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb252-54"><a href="#cb252-54" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb252-55"><a href="#cb252-55" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb252-56"><a href="#cb252-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;import ipdb&quot;</span>): </span>
<span id="cb252-57"><a href="#cb252-57" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb252-58"><a href="#cb252-58" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx</span>
<span id="cb252-59"><a href="#cb252-59" aria-hidden="true" tabindex="-1"></a>                idxcount <span class="op">=</span> idxcount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb252-60"><a href="#cb252-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb252-61"><a href="#cb252-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb252-62"><a href="#cb252-62" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> idxcount</span>
<span id="cb252-63"><a href="#cb252-63" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb252-64"><a href="#cb252-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb252-65"><a href="#cb252-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb252-66"><a href="#cb252-66" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> idxcount</span>
<span id="cb252-67"><a href="#cb252-67" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb252-68"><a href="#cb252-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb252-69"><a href="#cb252-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-70"><a href="#cb252-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-71"><a href="#cb252-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-72"><a href="#cb252-72" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb252-73"><a href="#cb252-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb252-74"><a href="#cb252-74" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb252-75"><a href="#cb252-75" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb252-76"><a href="#cb252-76" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb252-77"><a href="#cb252-77" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-78"><a href="#cb252-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-79"><a href="#cb252-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-80"><a href="#cb252-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-81"><a href="#cb252-81" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-82"><a href="#cb252-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-83"><a href="#cb252-83" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb252-84"><a href="#cb252-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-85"><a href="#cb252-85" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb252-86"><a href="#cb252-86" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-87"><a href="#cb252-87" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-88"><a href="#cb252-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-89"><a href="#cb252-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-90"><a href="#cb252-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-91"><a href="#cb252-91" aria-hidden="true" tabindex="-1"></a>    file_name <span class="op">=</span><span class="st">&#39;/tmp/&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span> <span class="op">+</span> <span class="st">&#39;.py&#39;</span> <span class="co"># learn about /tmp folder https://www.fosslinux.com/41739/linux-tmp-directory-everything-you-need-to-know.htm</span></span>
<span id="cb252-92"><a href="#cb252-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_name, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb252-93"><a href="#cb252-93" aria-hidden="true" tabindex="-1"></a>        f.write(dbsrc)</span>
<span id="cb252-94"><a href="#cb252-94" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> <span class="bu">compile</span>(dbsrc, file_name, <span class="st">&#39;exec&#39;</span>)</span>
<span id="cb252-95"><a href="#cb252-95" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(code, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb252-96"><a href="#cb252-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb252-97"><a href="#cb252-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb252-98"><a href="#cb252-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-99"><a href="#cb252-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-100"><a href="#cb252-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb252-101"><a href="#cb252-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-102"><a href="#cb252-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb252-103"><a href="#cb252-103" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb252-104"><a href="#cb252-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-105"><a href="#cb252-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-106"><a href="#cb252-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-107"><a href="#cb252-107" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-108"><a href="#cb252-108" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-109"><a href="#cb252-109" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-110"><a href="#cb252-110" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-111"><a href="#cb252-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-112"><a href="#cb252-112" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb252-113"><a href="#cb252-113" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb252-114"><a href="#cb252-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-115"><a href="#cb252-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-116"><a href="#cb252-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-117"><a href="#cb252-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb252-118"><a href="#cb252-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-119"><a href="#cb252-119" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-120"><a href="#cb252-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-121"><a href="#cb252-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb252-122"><a href="#cb252-122" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb252-123"><a href="#cb252-123" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb252-124"><a href="#cb252-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb252-125"><a href="#cb252-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb252-126"><a href="#cb252-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-127"><a href="#cb252-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb252-128"><a href="#cb252-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-129"><a href="#cb252-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb252-130"><a href="#cb252-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb252-131"><a href="#cb252-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span></code></pre></div>
</div>
</section>
<section id="go-back-to-normal-before-running-explore-again" class="level3">
<h3>Go back to normal before running explore again</h3>
<div class="cell" data-code_folding="[2]">
<div class="sourceCode" id="cb253"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explore(<span class="va">self</span>:Fastdb, </span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>            idxsrc:<span class="bu">int</span>, <span class="co"># idxsrc can be an int or a list of int</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>            cmt:<span class="bu">str</span>, <span class="co"># comment can be a string or a list of strings</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>            showdbsrc:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>): <span class="co"># display dbsrc</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;insert &#39;import ipdb; ipdb.set_trace()&#39; above srcline of idx to create dbsrc, and exec on dbsrc&quot;</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.goback()</span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> <span class="va">self</span>.orisrc</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     printsrc(src, idxsrc, cmt)</span></span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print selected srcline with expands above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a>    dbsrc <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a>    indent <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> inspect.getsource(src).split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb253-18"><a href="#cb253-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">bool</span>(lst[<span class="op">-</span><span class="dv">1</span>]): lst <span class="op">=</span> lst[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb253-19"><a href="#cb253-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-20"><a href="#cb253-20" aria-hidden="true" tabindex="-1"></a>    srclines <span class="op">=</span> <span class="va">None</span></span>
<span id="cb253-21"><a href="#cb253-21" aria-hidden="true" tabindex="-1"></a>    idxlst <span class="op">=</span> <span class="va">None</span></span>
<span id="cb253-22"><a href="#cb253-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span>:</span>
<span id="cb253-23"><a href="#cb253-23" aria-hidden="true" tabindex="-1"></a>        srclines <span class="op">=</span> lst[idxsrc]</span>
<span id="cb253-24"><a href="#cb253-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">list</span>:</span>
<span id="cb253-25"><a href="#cb253-25" aria-hidden="true" tabindex="-1"></a>        idxlst <span class="op">=</span> idxsrc</span>
<span id="cb253-26"><a href="#cb253-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb253-27"><a href="#cb253-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">&quot;decode must be an integer or a list.&quot;</span>)</span>
<span id="cb253-28"><a href="#cb253-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-29"><a href="#cb253-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(lst)), lst):</span>
<span id="cb253-30"><a href="#cb253-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-31"><a href="#cb253-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">int</span> <span class="kw">and</span> idx <span class="op">==</span> idxsrc:</span>
<span id="cb253-32"><a href="#cb253-32" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb253-33"><a href="#cb253-33" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;import ipdb; ipdb.set_trace()&quot;</span></span>
<span id="cb253-34"><a href="#cb253-34" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb253-35"><a href="#cb253-35" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>     </span>
<span id="cb253-36"><a href="#cb253-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">type</span>(idxsrc) <span class="op">==</span> <span class="bu">list</span> <span class="kw">and</span> idx <span class="kw">in</span> idxlst:</span>
<span id="cb253-37"><a href="#cb253-37" aria-hidden="true" tabindex="-1"></a>            numindent <span class="op">=</span> <span class="bu">len</span>(l) <span class="op">-</span> <span class="bu">len</span>(l.lstrip()) </span>
<span id="cb253-38"><a href="#cb253-38" aria-hidden="true" tabindex="-1"></a>            dbcodes <span class="op">=</span> <span class="st">&quot;import ipdb; ipdb.set_trace()&quot;</span></span>
<span id="cb253-39"><a href="#cb253-39" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>numindent <span class="op">+</span> dbcodes <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb253-40"><a href="#cb253-40" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>  </span>
<span id="cb253-41"><a href="#cb253-41" aria-hidden="true" tabindex="-1"></a>            idxlst.remove(idx)</span>
<span id="cb253-42"><a href="#cb253-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">bool</span>(l.strip()) <span class="kw">and</span> idx <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(lst):</span>
<span id="cb253-43"><a href="#cb253-43" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l</span>
<span id="cb253-44"><a href="#cb253-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># make sure this printout is identical to the printsrc output</span></span>
<span id="cb253-45"><a href="#cb253-45" aria-hidden="true" tabindex="-1"></a>            dbsrc <span class="op">=</span> dbsrc <span class="op">+</span> l <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb253-46"><a href="#cb253-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-47"><a href="#cb253-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: <span class="co"># added to debug</span></span>
<span id="cb253-48"><a href="#cb253-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;print out dbsrc&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb253-49"><a href="#cb253-49" aria-hidden="true" tabindex="-1"></a>        totallen <span class="op">=</span> <span class="dv">157</span></span>
<span id="cb253-50"><a href="#cb253-50" aria-hidden="true" tabindex="-1"></a>        lenidx <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb253-51"><a href="#cb253-51" aria-hidden="true" tabindex="-1"></a>        dblst <span class="op">=</span> dbsrc.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb253-52"><a href="#cb253-52" aria-hidden="true" tabindex="-1"></a>        idxsrcline <span class="op">=</span> <span class="va">None</span></span>
<span id="cb253-53"><a href="#cb253-53" aria-hidden="true" tabindex="-1"></a>        idxcount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb253-54"><a href="#cb253-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, l <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(dblst)), dblst):</span>
<span id="cb253-55"><a href="#cb253-55" aria-hidden="true" tabindex="-1"></a>            lenl <span class="op">=</span> <span class="bu">len</span>(l)</span>
<span id="cb253-56"><a href="#cb253-56" aria-hidden="true" tabindex="-1"></a><span class="co">#             if &quot;dbprintinsert&quot; in l: </span></span>
<span id="cb253-57"><a href="#cb253-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> l.strip().startswith(<span class="st">&quot;import ipdb&quot;</span>): </span>
<span id="cb253-58"><a href="#cb253-58" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(db)&quot;</span>)</span>
<span id="cb253-59"><a href="#cb253-59" aria-hidden="true" tabindex="-1"></a>                idxsrcline <span class="op">=</span> idx</span>
<span id="cb253-60"><a href="#cb253-60" aria-hidden="true" tabindex="-1"></a>                idxcount <span class="op">=</span> idxcount <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb253-61"><a href="#cb253-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="bu">bool</span>(l.strip()):</span>
<span id="cb253-62"><a href="#cb253-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb253-63"><a href="#cb253-63" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> idxcount</span>
<span id="cb253-64"><a href="#cb253-64" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot; &quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb253-65"><a href="#cb253-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb253-66"><a href="#cb253-66" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">bool</span>(idxsrcline) <span class="kw">and</span> idx <span class="op">&gt;</span> idxsrcline:</span>
<span id="cb253-67"><a href="#cb253-67" aria-hidden="true" tabindex="-1"></a>                    idx <span class="op">=</span> idx <span class="op">-</span> idxcount</span>
<span id="cb253-68"><a href="#cb253-68" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(l <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span>(totallen<span class="op">-</span>lenl<span class="op">-</span>lenidx) <span class="op">+</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> <span class="bu">str</span>(idx) <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb253-69"><a href="#cb253-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb253-70"><a href="#cb253-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-71"><a href="#cb253-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-72"><a href="#cb253-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;before exec, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-73"><a href="#cb253-73" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> <span class="va">self</span>.orisrc.__qualname__.split(<span class="st">&#39;.&#39;</span>)        </span>
<span id="cb253-74"><a href="#cb253-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb253-75"><a href="#cb253-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb253-76"><a href="#cb253-76" aria-hidden="true" tabindex="-1"></a>            clsname <span class="op">=</span> names[<span class="dv">0</span>]</span>
<span id="cb253-77"><a href="#cb253-77" aria-hidden="true" tabindex="-1"></a>            methodname <span class="op">=</span> names[<span class="dv">1</span>]</span>
<span id="cb253-78"><a href="#cb253-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-79"><a href="#cb253-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-80"><a href="#cb253-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-81"><a href="#cb253-81" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-82"><a href="#cb253-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-83"><a href="#cb253-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;before exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-84"><a href="#cb253-84" aria-hidden="true" tabindex="-1"></a>            expr <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> clsname <span class="op">+</span> <span class="st">&quot;&#39;].&quot;</span> <span class="op">+</span> methodname</span>
<span id="cb253-85"><a href="#cb253-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr: </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-86"><a href="#cb253-86" aria-hidden="true" tabindex="-1"></a>            expr1 <span class="op">=</span> <span class="st">&quot;self.outenv[&quot;</span> <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span> <span class="op">+</span> methodname <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span></span>
<span id="cb253-87"><a href="#cb253-87" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;expr1: </span><span class="sc">{</span>expr1<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-88"><a href="#cb253-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(&#39;</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">&#39;) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-89"><a href="#cb253-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-90"><a href="#cb253-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-91"><a href="#cb253-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-92"><a href="#cb253-92" aria-hidden="true" tabindex="-1"></a>    file_name <span class="op">=</span><span class="st">&#39;/tmp/&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span> <span class="op">+</span> <span class="st">&#39;.py&#39;</span> <span class="co"># learn about /tmp folder https://www.fosslinux.com/41739/linux-tmp-directory-everything-you-need-to-know.htm</span></span>
<span id="cb253-93"><a href="#cb253-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_name, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb253-94"><a href="#cb253-94" aria-hidden="true" tabindex="-1"></a>        f.write(dbsrc)</span>
<span id="cb253-95"><a href="#cb253-95" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> <span class="bu">compile</span>(dbsrc, file_name, <span class="st">&#39;exec&#39;</span>)</span>
<span id="cb253-96"><a href="#cb253-96" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exec</span>(code, <span class="bu">globals</span>().update(<span class="va">self</span>.outenv)) <span class="co"># when dbsrc is a method, it will update as part of a class</span></span>
<span id="cb253-97"><a href="#cb253-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb253-98"><a href="#cb253-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;exec on dbsrc above&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span>
<span id="cb253-99"><a href="#cb253-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb253-100"><a href="#cb253-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb253-101"><a href="#cb253-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc: </span>
<span id="cb253-102"><a href="#cb253-102" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals() keys: </span><span class="sc">{</span><span class="bu">list</span>(<span class="bu">locals</span>().keys())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-103"><a href="#cb253-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(names) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb253-104"><a href="#cb253-104" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;the src is a method of a class&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))            </span>
<span id="cb253-105"><a href="#cb253-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-106"><a href="#cb253-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-107"><a href="#cb253-107" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in locals(): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="bu">locals</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-108"><a href="#cb253-108" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is methodname: </span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>methodname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-109"><a href="#cb253-109" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is clsname: </span><span class="sc">{</span>clsname<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span>clsname <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-110"><a href="#cb253-110" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;after exec, is self.orisrc.__qualname__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__<span class="sc">}</span><span class="ss"> in self.outenv: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__qualname__ <span class="kw">in</span> <span class="va">self</span><span class="sc">.</span>outenv<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-111"><a href="#cb253-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;inspect.getsourcefile(</span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">) == &#39;&lt;string&gt;&#39;: </span><span class="sc">{</span><span class="va">True</span> <span class="cf">if</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr)) <span class="op">==</span> <span class="st">&#39;&lt;string&gt;&#39;</span> <span class="cf">else</span> inspect<span class="sc">.</span>getsourcefile(<span class="bu">eval</span>(expr))<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-112"><a href="#cb253-112" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.outenv[&#39;</span><span class="sc">{</span>methodname<span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">eval</span>(expr1)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-113"><a href="#cb253-113" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>expr<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(expr)<span class="sc">}</span><span class="ss">&quot;</span>)            </span>
<span id="cb253-114"><a href="#cb253-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb253-115"><a href="#cb253-115" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-116"><a href="#cb253-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-117"><a href="#cb253-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb253-118"><a href="#cb253-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb253-119"><a href="#cb253-119" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-120"><a href="#cb253-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-121"><a href="#cb253-121" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after exec and before self.outenv update, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is locals()[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">locals</span>()[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-122"><a href="#cb253-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Important! update dbsrc to module.func, fu.whatinside, inspect._signature_from_callable</span></span>
<span id="cb253-123"><a href="#cb253-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.outenv.update(<span class="bu">locals</span>()) </span>
<span id="cb253-124"><a href="#cb253-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     self.outenv[self.orisrc.__name__] = locals()[self.orisrc.__name__]</span></span>
<span id="cb253-125"><a href="#cb253-125" aria-hidden="true" tabindex="-1"></a><span class="co">#     return locals()[self.orisrc.__name__]</span></span>
<span id="cb253-126"><a href="#cb253-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> showdbsrc:</span>
<span id="cb253-127"><a href="#cb253-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;]: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-128"><a href="#cb253-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exec</span>(<span class="st">&quot;import &quot;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.__module__.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>])</span>
<span id="cb253-129"><a href="#cb253-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.orisrc.__name__: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-130"><a href="#cb253-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;after update self.outenv, self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;] is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>outenv[<span class="va">self</span>.orisrc.<span class="va">__name__</span>] <span class="kw">is</span> <span class="bu">eval</span>(<span class="va">self</span>.orisrc.__module__ <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> <span class="va">self</span>.orisrc.<span class="va">__name__</span>, {}, <span class="bu">locals</span>())<span class="sc">}</span><span class="ss">&quot;</span>)        </span>
<span id="cb253-131"><a href="#cb253-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Therefore, to use dbsrc we must use self.outenv[&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&#39;], or </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span>__module__<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>orisrc<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb253-132"><a href="#cb253-132" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{:-&lt;60}</span><span class="st">&#39;</span>.<span class="bu">format</span>(colorize(<span class="st">&quot;showdbsrc=End&quot;</span>, color<span class="op">=</span><span class="st">&quot;y&quot;</span>)))</span></code></pre></div>
</div>
</section>
<section id="make-a-copy-of-orisrc-and-update-whatinside-and-fu.whatinside-both-into-dbsrc" class="level3">
<h3>make a copy of orisrc and update whatinside and fu.whatinside both into dbsrc</h3>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L528" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fastdb.explore-1" class="level3">
<h3>Fastdb.explore</h3>
<blockquote>
<pre><code> Fastdb.explore (idxsrc:int, cmt:str, showdbsrc:bool=False)</code></pre>
</blockquote>
<p>insert ‘import ipdb; ipdb.set_trace()’ above srcline of idx to create dbsrc, and exec on dbsrc</p>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>idxsrc</td>
<td>int</td>
<td></td>
<td>idxsrc can be an int or a list of int</td>
</tr>
<tr class="even">
<td>cmt</td>
<td>str</td>
<td></td>
<td>comment can be a string or a list of strings</td>
</tr>
<tr class="odd">
<td>showdbsrc</td>
<td>bool</td>
<td>False</td>
<td>display dbsrc</td>
</tr>
</tbody>
</table>
</section>
<section id="use-dbprint-to-override-the-original-official-code-without-changing-its-own-pyfile-1" class="level3">
<h3>use dbprint to override the original official code without changing its own pyfile</h3>
<p>see the example <a href="./examples/dbprint.ipynb#make-inspect.signature-to-run-our-dbsrc-code">here</a></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>dbsig <span class="op">=</span> sig.dbprint(<span class="dv">29</span>, <span class="st">&quot;why has to unwrap?&quot;</span>, <span class="st">&quot;hasattr(obj, &#39;__signature__&#39;)&quot;</span>)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>inspect._signature_from_callable <span class="op">=</span> dbsig</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>pprint(inspect.signature(Foo))</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>sig.<span class="bu">print</span>(part<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</section>
<section id="use-guide-on-fastdb.dbprint" class="level3">
<h3>use guide on Fastdb.dbprint</h3>
<ol type="1">
<li>don’t use for the line start with <code>elif</code>, as putting <a href="https://EmbraceLife.github.io/fastdebug/core.html#dbprintinsert"><code>dbprintinsert</code></a> above <code>elif</code> without indentation will cause syntax error. I am not sure whether I need to fix it now.</li>
</ol>
<p>see example <a href="./examples/Fastdb.ipynb">here</a></p>
<p>test it with example <a href="./examples/print.ipynb">here</a></p>
</section>
</section>
<section id="reliveonce" class="level2">
<h2>reliveonce</h2>
<hr />
<p><a href="https://github.com/EmbraceLife/fastdebug/blob/master/fastdebug/core.py#L663" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="reliveonce-1" class="level3">
<h3>reliveonce</h3>
<blockquote>
<pre><code> reliveonce (func, oldfunc:str, alive:bool=True, db=False)</code></pre>
</blockquote>
<p>Replace current version of srcode with older version, and back to normal</p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>func</td>
<td></td>
<td></td>
<td>the current func</td>
</tr>
<tr class="even">
<td>oldfunc</td>
<td>str</td>
<td></td>
<td>the old version of func in string</td>
</tr>
<tr class="odd">
<td>alive</td>
<td>bool</td>
<td>True</td>
<td>True to bring old to live, False to return back to normal</td>
</tr>
<tr class="even">
<td>db</td>
<td>bool</td>
<td>False</td>
<td>True, to print for debugging</td>
</tr>
</tbody>
</table>
<p>see example <a href="./Demos/Debug_FixSigMeta_signature.ipynb#Using-old-_signature_from_callable">here</a></p>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">fastdebug</span> <span class="hidden" data-render-id="quarto-int-navbar-title">fastdebug</span> <span class="hidden" data-render-id="quarto-int-prev">fastdebug</span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.html">fastdebug</span> <span class="hidden" data-render-id="quarto-int-sidebar:/core.html">core</span> <span class="hidden" data-render-id="quarto-int-sidebar:/utils.html">Utils</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-twittercardtitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-ogcardtitle">fastdebug - core</span> <span class="hidden" data-render-id="quarto-metasitename">fastdebug</span> <span class="hidden" data-render-id="quarto-metadesc">the core functionalities of fastdebug</span></p>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->

</body>

</html>